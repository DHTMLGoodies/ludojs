/* Generated Sun Feb 12 0:51:49 CET 2017 */
/************************************************************************************************************
@fileoverview
ludoJS - Javascript framework, 1.1.449
Copyright (C) 2012-2017  ludoJS.com, Alf Magne Kalleland
This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.
This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.
You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
ludoJS.com., hereby disclaims all copyright interest in this script
written by Alf Magne Kalleland.
Alf Magne Kalleland, 2017
Owner of ludoJS.com
************************************************************************************************************/
/*!
 Web Build: http://mootools.net/core/builder/e7289bd0058c6790cb2b769822285f97
 */
/*! MooTools: the javascript framework. license: MIT-style license. copyright: Copyright (c) 2006-2015 [Valerio Proietti](http://mad4milk.net/).*/
(function(){this.MooTools={version:"1.6.0",build:"529422872adfff401b901b8b6c7ca5114ee95e2b"};var g=this.typeOf=function(v){if(v==null){return"null"}if(v.$family!=null){return v.$family()}if(v.nodeName){if(v.nodeType==1){return"element"}if(v.nodeType==3){return(/\S/).test(v.nodeValue)?"textnode":"whitespace"}}else{if(typeof v.length=="number"){if("callee" in v){return"arguments"}if("item" in v){return"collection"}}}return typeof v};var u=this.instanceOf=function(x,v){if(x==null){return false}var w=x.$constructor||x.constructor;while(w){if(w===v){return true}w=w.parent}if(!x.hasOwnProperty){return false}return x instanceof v};var n=Object.prototype.hasOwnProperty;var r=true;for(var q in {toString:1}){r=null}if(r){r=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]}function h(w,y,z){if(r){for(var x=r.length;x--;){var v=r[x];if(n.call(w,v)){y.call(z,v,w[v])}}}}var j=this.Function;j.prototype.overloadSetter=function(w){var v=this;return function(y,x){if(y==null){return this}if(w||typeof y!="string"){for(var z in y){v.call(this,z,y[z])}h(y,v,this)}else{v.call(this,y,x)}return this}};j.prototype.overloadGetter=function(w){var v=this;return function(y){var z,x;if(typeof y!="string"){z=y}else{if(arguments.length>1){z=arguments}else{if(w){z=[y]}}}if(z){x={};for(var A=0;A<z.length;A++){x[z[A]]=v.call(this,z[A])}}else{x=v.call(this,y)}return x}};j.prototype.extend=function(v,w){this[v]=w}.overloadSetter();j.prototype.implement=function(v,w){this.prototype[v]=w}.overloadSetter();var o=Array.prototype.slice;Array.convert=function(v){if(v==null){return[]}return(m.isEnumerable(v)&&typeof v!="string")?(g(v)=="array")?v:o.call(v):[v]};j.convert=function(v){return(g(v)=="function")?v:function(){return v}};Number.convert=function(w){var v=parseFloat(w);return isFinite(v)?v:null};String.convert=function(v){return v+""};j.from=j.convert;Number.from=Number.convert;String.from=String.convert;j.implement({hide:function(){this.$hidden=true;return this},protect:function(){this.$protected=true;return this}});var m=this.Type=function(y,x){if(y){var w=y.toLowerCase();var v=function(z){return(g(z)==w)};m["is"+y]=v;if(x!=null){x.prototype.$family=(function(){return w}).hide()}}if(x==null){return null}x.extend(this);x.$constructor=m;x.prototype.$constructor=x;return x};var p=Object.prototype.toString;m.isEnumerable=function(v){return(v!=null&&typeof v.length=="number"&&p.call(v)!="[object Function]")};var b={};var f=function(v){var w=g(v.prototype);return b[w]||(b[w]=[])};var k=function(w,A){if(A&&A.$hidden){return}var v=f(this);for(var x=0;x<v.length;x++){var z=v[x];if(g(z)=="type"){k.call(z,w,A)}else{z.call(this,w,A)}}var y=this.prototype[w];if(y==null||!y.$protected){this.prototype[w]=A}if(this[w]==null&&g(A)=="function"){t.call(this,w,function(B){return A.apply(B,o.call(arguments,1))})}};var t=function(v,x){if(x&&x.$hidden){return}var w=this[v];if(w==null||!w.$protected){this[v]=x}};m.implement({implement:k.overloadSetter(),extend:t.overloadSetter(),alias:function(v,w){k.call(this,v,this.prototype[w])}.overloadSetter(),mirror:function(v){f(this).push(v);return this}});new m("Type",m);var d=function(v,A,y){var x=(A!=Object),E=A.prototype;if(x){A=new m(v,A)}for(var B=0,z=y.length;B<z;B++){var F=y[B],D=A[F],C=E[F];if(D){D.protect()}if(x&&C){A.implement(F,C.protect())}}if(x){var w=E.propertyIsEnumerable(y[0]);A.forEachMethod=function(J){if(!w){for(var I=0,G=y.length;I<G;I++){J.call(E,E[y[I]],y[I])}}for(var H in E){J.call(E,E[H],H)}}}return d};d("String",String,["charAt","charCodeAt","concat","contains","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","trim","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight","contains"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",j,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);Object.extend=t.overloadSetter();Date.extend("now",function(){return +(new Date)});new m("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide();Number.extend("random",function(w,v){return Math.floor(Math.random()*(v-w+1)+w)});Object.extend({keys:function(w){var x=[];for(var v in w){if(n.call(w,v)){x.push(v)}}h(w,function(y){x.push(y)});return x},forEach:function(v,w,x){Object.keys(v).forEach(function(y){w.call(x,v[y],y,v)
})}});Object.each=Object.forEach;var s=function(v){switch(g(v)){case"array":return v.clone();case"object":return Object.clone(v);default:return v}};Array.implement("clone",function(){var v=this.length,w=new Array(v);while(v--){w[v]=s(this[v])}return w});var a=function(w,v,x){switch(g(x)){case"object":if(g(w[v])=="object"){Object.merge(w[v],x)}else{w[v]=Object.clone(x)}break;case"array":w[v]=x.clone();break;default:w[v]=x}return w};Object.extend({merge:function(C,y,x){if(g(y)=="string"){return a(C,y,x)}for(var B=1,w=arguments.length;B<w;B++){var z=arguments[B];for(var A in z){a(C,A,z[A])}}return C},clone:function(v){var x={};for(var w in v){x[w]=s(v[w])}return x},append:function(z){for(var y=1,w=arguments.length;y<w;y++){var v=arguments[y]||{};for(var x in v){z[x]=v[x]}}return z}});jQuery.each(["Object","WhiteSpace","TextNode","Collection","Arguments"],function(w,v){new m(v)});var l=Date.now();String.extend("uniqueID",function(){return(l++).toString(36)})})();Array.implement({every:function(d,f){for(var b=0,a=this.length>>>0;b<a;b++){if((b in this)&&!d.call(f,this[b],b,this)){return false}}return true},filter:function(f,h){var d=[];for(var g,b=0,a=this.length>>>0;b<a;b++){if(b in this){g=this[b];if(f.call(h,g,b,this)){d.push(g)}}}return d},indexOf:function(d,f){var b=this.length>>>0;for(var a=(f<0)?Math.max(0,b+f):f||0;a<b;a++){if(this[a]===d){return a}}return -1},map:function(d,g){var f=this.length>>>0,b=Array(f);for(var a=0;a<f;a++){if(a in this){b[a]=d.call(g,this[a],a,this)}}return b},some:function(d,f){for(var b=0,a=this.length>>>0;b<a;b++){if((b in this)&&d.call(f,this[b],b,this)){return true}}return false},clean:function(){return this.filter(function(a){return a!=null})},invoke:function(a){var b=Array.slice(arguments,1);return this.map(function(d){return d[a].apply(d,b)})},associate:function(d){var f={},b=Math.min(this.length,d.length);for(var a=0;a<b;a++){f[d[a]]=this[a]}return f},link:function(d){var a={};for(var g=0,b=this.length;g<b;g++){for(var f in d){if(d[f](this[g])){a[f]=this[g];delete d[f];break}}}return a},contains:function(a,b){return this.indexOf(a,b)!=-1},append:function(a){this.push.apply(this,a);return this},getLast:function(){return(this.length)?this[this.length-1]:null},getRandom:function(){return(this.length)?this[Number.random(0,this.length-1)]:null},include:function(a){if(!this.contains(a)){this.push(a)}return this},combine:function(d){for(var b=0,a=d.length;b<a;b++){this.include(d[b])}return this},erase:function(b){for(var a=this.length;a--;){if(this[a]===b){this.splice(a,1)}}return this},empty:function(){this.length=0;return this},flatten:function(){var f=[];for(var b=0,a=this.length;b<a;b++){var d=typeOf(this[b]);if(d=="null"){continue}f=f.concat((d=="array"||d=="collection"||d=="arguments"||instanceOf(this[b],Array))?Array.flatten(this[b]):this[b])}return f},pick:function(){for(var b=0,a=this.length;b<a;b++){if(this[b]!=null){return this[b]}}return null},hexToRgb:function(b){if(this.length!=3){return null}var a=this.map(function(d){if(d.length==1){d+=d}return parseInt(d,16)});return(b)?a:"rgb("+a+")"},rgbToHex:function(f){if(this.length<3){return null}if(this.length==4&&this[3]==0&&!f){return"transparent"}var b=[];for(var a=0;a<3;a++){var d=(this[a]-0).toString(16);b.push((d.length==1)?"0"+d:d)}return(f)?b:"#"+b.join("")}});Function.extend({attempt:function(){for(var b=0,a=arguments.length;b<a;b++){try{return arguments[b]()}catch(d){}}return null}});Function.implement({attempt:function(a,d){try{return this.apply(d,Array.convert(a))}catch(b){}return null},bind:function(g){var a=this,b=arguments.length>1?Array.slice(arguments,1):null,f=function(){};var d=function(){var j=g,k=arguments.length;if(this instanceof d){f.prototype=a.prototype;j=new f}var h=(!b&&!k)?a.call(j):a.apply(j,b&&k?b.concat(Array.slice(arguments)):b||arguments);return j==g?h:j};return d},pass:function(b,d){var a=this;if(b!=null){b=Array.convert(b)}return function(){return a.apply(d,b||arguments)}},delay:function(b,d,a){return setTimeout(this.pass((a==null?[]:a),d),b)},periodical:function(d,b,a){return setInterval(this.pass((a==null?[]:a),b),d)}});Number.implement({limit:function(b,a){return Math.min(a,Math.max(b,this))},round:function(a){a=Math.pow(10,a||0).toFixed(a<0?-a:0);return Math.round(this*a)/a},times:function(b,d){for(var a=0;a<this;a++){b.call(d,a,this)}},toFloat:function(){return parseFloat(this)},toInt:function(a){return parseInt(this,a||10)}});Number.alias("each","times");(function(b){var a={};jQuery.each(b,function(f,d){if(!Number[d]){a[d]=function(){return Math[d].apply(null,[this].concat(Array.convert(arguments)))}}});Number.implement(a)})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);String.implement({contains:function(b,a){return(a?String(this).slice(a):String(this)).indexOf(b)>-1},test:function(a,b){return((typeOf(a)=="regexp")?a:new RegExp(""+a,b)).test(this)},trim:function(){return String(this).replace(/^\s+|\s+$/g,"")},clean:function(){return String(this).replace(/\s+/g," ").trim()
},camelCase:function(){return String(this).replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return String(this).replace(/[A-Z]/g,function(a){return("-"+a.charAt(0).toLowerCase())})},capitalize:function(){return String(this).replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},escapeRegExp:function(){return String(this).replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(a){return parseInt(this,a||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(b){var a=String(this).match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(a)?a.slice(1).hexToRgb(b):null},rgbToHex:function(b){var a=String(this).match(/\d{1,3}/g);return(a)?a.rgbToHex(b):null},substitute:function(a,b){return String(this).replace(b||(/\\?\{([^{}]+)\}/g),function(f,d){if(f.charAt(0)=="\\"){return f.slice(1)}return(a[d]!=null)?a[d]:""})}});(function(){var g=this.document;var f=g.window=this;var a=function(n,m){n=n.toLowerCase();m=(m?m.toLowerCase():"");var o=n.match(/(edge)[\s\/:]([\w\d\.]+)/);if(!o){o=n.match(/(opera|ie|firefox|chrome|trident|crios|version)[\s\/:]([\w\d\.]+)?.*?(safari|(?:rv[\s\/:]|version[\s\/:])([\w\d\.]+)|$)/)||[null,"unknown",0]}if(o[1]=="trident"){o[1]="ie";if(o[4]){o[2]=o[4]}}else{if(o[1]=="crios"){o[1]="chrome"}}m=n.match(/ip(?:ad|od|hone)/)?"ios":(n.match(/(?:webos|android)/)||n.match(/mac|win|linux/)||["other"])[0];if(m=="win"){m="windows"}return{extend:Function.prototype.extend,name:(o[1]=="version")?o[3]:o[1],version:parseFloat((o[1]=="opera"&&o[4])?o[4]:o[2]),platform:m}};var l=this.Browser=a(navigator.userAgent,navigator.platform);if(l.name=="ie"&&g.documentMode){l.version=g.documentMode}l.extend({Features:{xpath:!!(g.evaluate),air:!!(f.runtime),query:!!(g.querySelector),json:!!(f.JSON)},parseUA:a});l.Request=(function(){var o=function(){return new XMLHttpRequest()};var n=function(){return new ActiveXObject("MSXML2.XMLHTTP")};var m=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){o();return o},function(){n();return n},function(){m();return m})})();l.Features.xhr=!!(l.Request);l.exec=function(n){if(!n){return n}if(f.execScript){f.execScript(n)}else{var m=g.createElement("script");m.setAttribute("type","text/javascript");m.text=n;g.head.appendChild(m);g.head.removeChild(m)}return n};String.implement("stripScripts",function(n){var m="";var o=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(p,q){m+=q+"\n";return""});if(n===true){l.exec(m)}else{if(typeOf(n)=="function"){n(m,o)}}return o});l.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event});this.Window=this.$constructor=new Type("Window",function(){});this.$family=Function.convert("window").hide();Window.mirror(function(m,n){f[m]=n});this.Document=g.$constructor=new Type("Document",function(){});g.$family=Function.convert("document").hide();Document.mirror(function(m,n){g[m]=n});g.html=g.documentElement;if(!g.head){g.head=g.getElementsByTagName("head")[0]}if(g.execCommand){try{g.execCommand("BackgroundImageCache",false,true)}catch(d){}}if(this.attachEvent&&!this.addEventListener){var b=function(){this.detachEvent("onunload",b);g.head=g.html=g.window=null;f=this.Window=g=null};this.attachEvent("onunload",b)}var h=Array.convert;try{h(g.html.childNodes)}catch(d){Array.convert=function(n){if(typeof n!="string"&&Type.isEnumerable(n)&&typeOf(n)!="array"){var m=n.length,o=new Array(m);while(m--){o[m]=n[m]}return o}return h(n)};var j=Array.prototype,k=j.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(m){var n=j[m];Array[m]=function(o){return n.apply(Array.convert(o),k.call(arguments,1))}})}})();(function(){var a=this.Class=new Type("Class",function(k){if(instanceOf(k,Function)){k={initialize:k}}var j=function(){g(this);if(j.$prototyping){return this}this.$caller=null;this.$family=null;var l=(this.initialize)?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;return l}.extend(this).implement(k);j.$constructor=a;j.prototype.$constructor=j;j.prototype.parent=d;return j});var d=function(){if(!this.$caller){throw new Error('The method "parent" cannot be called.')}var j=this.$caller.$name,k=this.$caller.$owner.parent,l=(k)?k.prototype[j]:null;if(!l){throw new Error('The method "'+j+'" has no parent.')}return l.apply(this,arguments)};var g=function(j){for(var k in j){var m=j[k];switch(typeOf(m)){case"object":var l=function(){};l.prototype=m;j[k]=g(new l);break;case"array":j[k]=m.clone();break}}return j};var b=function(j,k,m){if(m.$origin){m=m.$origin}var l=function(){if(m.$protected&&this.$caller==null){throw new Error('The method "'+k+'" cannot be called.')}var o=this.caller,p=this.$caller;this.caller=p;this.$caller=l;var n=m.apply(this,arguments);this.$caller=p;this.caller=o;return n}.extend({$owner:j,$origin:m,$name:k});return l};var h=function(k,l,j){if(a.Mutators.hasOwnProperty(k)){l=a.Mutators[k].call(this,l);if(l==null){return this}}if(typeOf(l)=="function"){if(l.$hidden){return this
}this.prototype[k]=(j)?l:b(this,k,l)}else{Object.merge(this.prototype,k,l)}return this};var f=function(j){j.$prototyping=true;var k=new j;delete j.$prototyping;return k};a.implement("implement",h.overloadSetter());a.Mutators={Extends:function(j){this.parent=j;this.prototype=f(j)},Implements:function(j){Array.convert(j).each(function(m){var k=new m;for(var l in k){h.call(this,l,k[l],true)}},this)}}})();(function(){this.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));return this},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false},clearChain:function(){this.$chain.empty();return this}});var a=function(b){return b.replace(/^on([A-Z])/,function(d,f){return f.toLowerCase()})};this.Events=new Class({$events:{},addEvent:function(f,d,b){f=a(f);this.$events[f]=(this.$events[f]||[]).include(d);if(b){d.internal=true}return this},addEvents:function(b){for(var d in b){this.addEvent(d,b[d])}return this},fireEvent:function(g,d,b){g=a(g);var f=this.$events[g];if(!f){return this}d=Array.convert(d);jQuery.each(f,function(h,j){if(b){j.delay(b,this,d)}else{if(j){j.apply(this,d)}}}.bind(this));return this},removeEvent:function(g,f){g=a(g);var d=this.$events[g];if(d&&!f.internal){var b=d.indexOf(f);if(b!=-1){delete d[b]}}return this},removeEvents:function(f){var g;if(typeOf(f)=="object"){for(g in f){this.removeEvent(g,f[g])}return this}if(f){f=a(f)}for(g in this.$events){if(f&&f!=g){continue}var d=this.$events[g];for(var b=d.length;b--;){if(b in d){this.removeEvent(g,d[b])}}}return this}});this.Options=new Class({setOptions:function(){var b=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent){for(var d in b){if(typeOf(b[d])!="function"||!(/^on[A-Z]/).test(d)){continue}this.addEvent(d,b[d]);delete b[d]}}return this}})})();
/*!
 Web Build: http://mootools.net/more/builder/447324cc9ea6344646513d80fe56da74
 */
MooTools.More={version:"1.6.0",build:"45b71db70f879781a7e0b0d3fb3bb1307c2521eb"};(function(){var b=function(d){return d!=null};var a=Object.prototype.hasOwnProperty;Object.extend({getFromPath:function(g,h){if(typeof h=="string"){h=h.split(".")}for(var f=0,d=h.length;f<d;f++){if(a.call(g,h[f])){g=g[h[f]]}else{return null}}return g},cleanValues:function(d,g){g=g||b;for(var f in d){if(!g(d[f])){delete d[f]}}return d},erase:function(d,f){if(a.call(d,f)){delete d[f]}return d},run:function(f){var d=Array.slice(arguments,1);for(var g in f){if(f[g].apply){f[g].apply(f,d)}}return f}})})();(function(){var b=null,a={},f={};var d=function(h){if(instanceOf(h,g.Set)){return h}else{return a[h]}};var g=this.Locale={define:function(h,m,k,l){var j;if(instanceOf(h,g.Set)){j=h.name;if(j){a[j]=h}}else{j=h;if(!a[j]){a[j]=new g.Set(j)}h=a[j]}if(m){h.define(m,k,l)}if(!b){b=h}return h},use:function(h){h=d(h);if(h){b=h;this.fireEvent("change",h)}return this},getCurrent:function(){return b},get:function(j,h){return(b)?b.get(j,h):""},inherit:function(h,j,k){h=d(h);if(h){h.inherit(j,k)}return this},list:function(){return Object.keys(a)}};Object.append(g,new Events);g.Set=new Class({sets:{},inherits:{locales:[],sets:{}},initialize:function(h){this.name=h||""},define:function(l,j,k){var h=this.sets[l];if(!h){h={}}if(j){if(typeOf(j)=="object"){h=Object.merge(h,j)}else{h[j]=k}}this.sets[l]=h;return this},get:function(t,m,s){var r=Object.getFromPath(this.sets,t);if(r!=null){var o=typeOf(r);if(o=="function"){r=r.apply(null,Array.convert(m))}else{if(o=="object"){r=Object.clone(r)}}return r}var k=t.indexOf("."),q=k<0?t:t.substr(0,k),n=(this.inherits.sets[q]||[]).combine(this.inherits.locales).include("en-US");if(!s){s=[]}for(var j=0,h=n.length;j<h;j++){if(s.contains(n[j])){continue}s.include(n[j]);var p=a[n[j]];if(!p){continue}r=p.get(t,m,s);if(r!=null){return r}}return""},inherit:function(j,k){j=Array.convert(j);if(k&&!this.inherits.sets[k]){this.inherits.sets[k]=[]}var h=j.length;while(h--){(k?this.inherits.sets[k]:this.inherits.locales).unshift(j[h])}return this}})})();Locale.define("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",firstDayOfWeek:0,ordinal:function(a){return(a>3&&a<21)?"th":["th","st","nd","rd","th"][Math.min(a%10,4)]},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"});
(function(){var a=this.Date;var h=a.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};jQuery.each(["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds","UTCMilliseconds"],function(v,w){a.Methods[w.toLowerCase()]=w});var s=function(x,w,v){if(w==1){return x}return x<Math.pow(10,w-1)?(v||"0")+s(x,w-1,v):x};a.implement({set:function(x,v){x=x.toLowerCase();var w=h[x]&&"set"+h[x];if(w&&this[w]){this[w](v)}return this}.overloadSetter(),get:function(w){w=w.toLowerCase();var v=h[w]&&"get"+h[w];if(v&&this[v]){return this[v]()}return null}.overloadGetter(),clone:function(){return new a(this.get("time"))},increment:function(v,x){v=v||"day";x=x!=null?x:1;switch(v){case"year":return this.increment("month",x*12);case"month":var w=this.get("date");this.set("date",1).set("mo",this.get("mo")+x);return this.set("date",w.min(this.get("lastdayofmonth")));case"week":return this.increment("day",x*7);case"day":return this.set("date",this.get("date")+x)}if(!a.units[v]){throw new Error(v+" is not a supported interval")}return this.set("time",this.get("time")+x*a.units[v]())},decrement:function(v,w){return this.increment(v,-1*(w!=null?w:1))},isLeapYear:function(){return a.isLeapYear(this.get("year"))},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0})},diff:function(w,v){if(typeOf(w)=="string"){w=a.parse(w)}return((w-this)/a.units[v||"day"](3,3)).round()},getLastDayOfMonth:function(){return a.daysInMonth(this.get("mo"),this.get("year"))},getDayOfYear:function(){return(a.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-a.UTC(this.get("year"),0,1))/a.units.day()},setDay:function(w,v){if(v==null){v=a.getMsg("firstDayOfWeek");if(v===""){v=1}}w=(7+a.parseDay(w,true)-v)%7;var x=(7+this.get("day")-v)%7;return this.increment("day",w-x)},getWeek:function(y){if(y==null){y=a.getMsg("firstDayOfWeek");if(y===""){y=1}}var A=this,x=(7+A.get("day")-y)%7,w=0,z;if(y==1){var B=A.get("month"),v=A.get("date")-x;if(B==11&&v>28){return 1}if(B==0&&v<-2){A=new a(A).decrement("day",x);x=0}z=new a(A.get("year"),0,1).get("day")||7;if(z>4){w=-7}}else{z=new a(A.get("year"),0,1).get("day")}w+=A.get("dayofyear");w+=6-x;w+=(7+z-y)%7;return(w/7)},getOrdinal:function(v){return a.getMsg("ordinal",v||this.get("date"))},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},getGMTOffset:function(){var v=this.get("timezoneOffset");return((v>0)?"-":"+")+s((v.abs()/60).floor(),2)+s(v%60,2)},setAMPM:function(v){v=v.toUpperCase();var w=this.get("hr");if(w>11&&v=="AM"){return this.decrement("hour",12)}else{if(w<12&&v=="PM"){return this.increment("hour",12)}}return this},getAMPM:function(){return(this.get("hr")<12)?"AM":"PM"},parse:function(v){this.set("time",a.parse(v));return this},isValid:function(v){if(!v){v=this}return typeOf(v)=="date"&&!isNaN(v.valueOf())},format:function(v){if(!this.isValid()){return"invalid date"}if(!v){v="%x %X"}if(typeof v=="string"){v=j[v.toLowerCase()]||v}if(typeof v=="function"){return v(this)}var w=this;return v.replace(/%([a-z%])/gi,function(y,x){switch(x){case"a":return a.getMsg("days_abbr")[w.get("day")];case"A":return a.getMsg("days")[w.get("day")];case"b":return a.getMsg("months_abbr")[w.get("month")];case"B":return a.getMsg("months")[w.get("month")];case"c":return w.format("%a %b %d %H:%M:%S %Y");case"d":return s(w.get("date"),2);case"e":return s(w.get("date"),2," ");case"H":return s(w.get("hr"),2);case"I":return s((w.get("hr")%12)||12,2);case"j":return s(w.get("dayofyear"),3);case"k":return s(w.get("hr"),2," ");case"l":return s((w.get("hr")%12)||12,2," ");case"L":return s(w.get("ms"),3);case"m":return s((w.get("mo")+1),2);case"M":return s(w.get("min"),2);case"o":return w.get("ordinal");case"p":return a.getMsg(w.get("ampm"));case"s":return Math.round(w/1000);case"S":return s(w.get("seconds"),2);case"T":return w.format("%H:%M:%S");case"U":return s(w.get("week"),2);case"w":return w.get("day");case"x":return w.format(a.getMsg("shortDate"));case"X":return w.format(a.getMsg("shortTime"));case"y":return w.get("year").toString().substr(2);case"Y":return w.get("year");case"z":return w.get("GMTOffset");case"Z":return w.get("Timezone")}return x})},toISOString:function(){return this.format("iso8601")}}).alias({toJSON:"toISOString",compare:"diff",strftime:"format"});var n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var j={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S","short":"%d %b %H:%M","long":"%B %d, %Y %H:%M",rfc822:function(v){return n[v.get("day")]+v.format(", %d ")+k[v.get("month")]+v.format(" %Y %H:%M:%S %Z")},rfc2822:function(v){return n[v.get("day")]+v.format(", %d ")+k[v.get("month")]+v.format(" %Y %H:%M:%S %z")
},iso8601:function(v){return(v.getUTCFullYear()+"-"+s(v.getUTCMonth()+1,2)+"-"+s(v.getUTCDate(),2)+"T"+s(v.getUTCHours(),2)+":"+s(v.getUTCMinutes(),2)+":"+s(v.getUTCSeconds(),2)+"."+s(v.getUTCMilliseconds(),3)+"Z")}};var d=[],q=a.parse;var u=function(y,A,x){var w=-1,z=a.getMsg(y+"s");switch(typeOf(A)){case"object":w=z[A.get(y)];break;case"number":w=z[A];if(!w){throw new Error("Invalid "+y+" index: "+A)}break;case"string":var v=z.filter(function(B){return this.test(B)},new RegExp("^"+A,"i"));if(!v.length){throw new Error("Invalid "+y+" string")}if(v.length>1){throw new Error("Ambiguous "+y)}w=v[0]}return(x)?z.indexOf(w):w};var l=1900,r=70;a.extend({getMsg:function(w,v){return Locale.get("Date."+w,v)},units:{ms:Function.convert(1),second:Function.convert(1000),minute:Function.convert(60000),hour:Function.convert(3600000),day:Function.convert(86400000),week:Function.convert(608400000),month:function(w,v){var x=new a;return a.daysInMonth(w!=null?w:x.get("mo"),v!=null?v:x.get("year"))*86400000},year:function(v){v=v||new a().get("year");return a.isLeapYear(v)?31622400000:31536000000}},daysInMonth:function(w,v){return[31,a.isLeapYear(v)?29:28,31,30,31,30,31,31,30,31,30,31][w]},isLeapYear:function(v){return((v%4===0)&&(v%100!==0))||(v%400===0)},parse:function(x){var w=typeOf(x);if(w=="number"){return new a(x)}if(w!="string"){return x}x=x.clean();if(!x.length){return null}var v;d.some(function(z){var y=z.re.exec(x);return(y)?(v=z.handler(y)):false});if(!(v&&v.isValid())){v=new a(q(x));if(!(v&&v.isValid())){v=new a(x.toInt())}}return v},parseDay:function(v,w){return u("day",v,w)},parseMonth:function(w,v){return u("month",w,v)},parseUTC:function(w){var v=new a(w);var x=a.UTC(v.get("year"),v.get("mo"),v.get("date"),v.get("hr"),v.get("min"),v.get("sec"),v.get("ms"));return new a(x)},orderIndex:function(v){return a.getMsg("dateOrder").indexOf(v)+1},defineFormat:function(v,w){j[v]=w;return this},defineParser:function(v,w){d.push((w.re&&w.handler)?w:o(w));return this},defineParsers:function(){var v=Array.flatten(arguments);jQuery.each(v,a.defineParser);return this},define2DigitYearStart:function(v){r=v%100;l=v-r;return this}}).extend({defineFormats:a.defineFormat.overloadSetter()});var f=function(v){return new RegExp("(?:"+a.getMsg(v).map(function(w){return w.substr(0,3)}).join("|")+")[a-z]*")};var p=function(v){switch(v){case"T":return"%H:%M:%S";case"x":return((a.orderIndex("month")==1)?"%m[-./]%d":"%d[-./]%m")+"([-./]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%z?"}return null};var m={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,z:/Z|[+-]\d{2}(?::?\d{2})?/};m.m=m.I;m.S=m.M;var g;var b=function(v){g=v;m.a=m.A=f("days");m.b=m.B=f("months");jQuery.each(d,function(w,x){if(x.format){d[w]=o(x.format)}})};var o=function(x){if(!g){return{format:x}}var v=[];var w=(x.source||x).replace(/%([a-z])/gi,function(z,y){return p(y)||z}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function(z,y){var A=m[y];if(!A){return y}v.push(y);return"("+A.source+")"}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff;&]");return{format:x,re:new RegExp("^"+w+"$","i"),handler:function(B){B=B.slice(1).associate(v);var y=new a().clearTime(),A=B.y||B.Y;if(A!=null){t.call(y,"y",A)}if("d" in B){t.call(y,"d",1)}if("m" in B||B.b||B.B){t.call(y,"m",1)}for(var z in B){t.call(y,z,B[z])}return y}}};var t=function(v,w){if(!w){return this}switch(v){case"a":case"A":return this.set("day",a.parseDay(w,true));case"b":case"B":return this.set("mo",a.parseMonth(w,true));case"d":return this.set("date",w);case"H":case"I":return this.set("hr",w);case"m":return this.set("mo",w-1);case"M":return this.set("min",w);case"p":return this.set("ampm",w.replace(/\./g,""));case"S":return this.set("sec",w);case"s":return this.set("ms",("0."+w)*1000);case"w":return this.set("day",w);case"Y":return this.set("year",w);case"y":w=+w;if(w<100){w+=l+(w<r?100:0)}return this.set("year",w);case"z":if(w=="Z"){w="+00"}var x=w.match(/([+-])(\d{2}):?(\d{2})?/);x=(x[1]+"1")*(x[2]*60+(+x[3]||0))+this.getTimezoneOffset();return this.set("time",this-x*60000)}return this};a.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %z %Y","%T","%H:%M( ?%p)?");Locale.addEvent("change",function(v){if(Locale.get("Date")){b(v)}}).fireEvent("change",Locale.getCurrent())})();Date.implement({timeDiffInWords:function(a){return Date.distanceOfTimeInWords(this,a||new Date)},timeDiff:function(h,d){if(h==null){h=new Date}var k=((h-this)/1000).floor().abs();var g=[],a=[60,60,24,365,0],f=["s","m","h","d","y"],j,b;for(var l=0;l<a.length;l++){if(l&&!k){break}j=k;if((b=a[l])){j=(k%b);k=(k/b).floor()}g.unshift(j+(f[l]||""))}return g.join(d||":")}}).extend({distanceOfTimeInWords:function(b,a){return Date.getTimePhrase(((a-b)/1000).toInt())},getTimePhrase:function(h){var f=(h<0)?"Until":"Ago";
if(h<0){h*=-1}var b={minute:60,hour:60,day:24,week:7,month:52/12,year:12,eon:Infinity};var g="lessThanMinute";for(var d in b){var a=b[d];if(h<1.5*a){if(h>0.75*a){g=d}break}h/=a;g=d+"s"}h=h.round();return Date.getMsg(g+f,h).substitute({delta:h})}}).defineParsers({re:/^(?:tod|tom|yes)/i,handler:function(a){var b=new Date().clearTime();switch(a[0]){case"tom":return b.increment();case"yes":return b.decrement();default:return b}}},{re:/^(next|last) ([a-z]+)$/i,handler:function(g){var h=new Date().clearTime();var b=h.getDay();var f=Date.parseDay(g[2],true);var a=f-b;if(f<=b){a+=7}if(g[1]=="last"){a-=7}return h.set("date",h.getDate()+a)}}).alias("timeAgoInWords","timeDiffInWords");window.ludo={form:{validator:{}},color:{},dialog:{},remote:{},tree:{},model:{},tpl:{},video:{},storage:{},grid:{},effect:{},paging:{},calendar:{},layout:{},progress:{},keyboard:{},chart:{},dataSource:{},controller:{},card:{},svg:{},socket:{},menu:{},view:{},audio:{},ludoDB:{},theme:{}};if(navigator.appName=="Microsoft Internet Explorer"){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}}ludo.SINGLETONS={};ludo.CmpMgrClass=new Class({Extends:Events,components:{},formElements:{},activeComponent:undefined,activeButton:undefined,availableButtons:undefined,initialize:function(){jQuery(document.documentElement).on("keypress",this.autoSubmit.bind(this))},autoSubmit:function(b){if(b.key=="enter"){if(b.target.tagName.toLowerCase()!=="textarea"){if(this.activeButton){this.activeButton.click()}}}if(b.key=="tab"){var a=b.target.tagName.toLowerCase();if(a!=="input"&&a!=="textarea"){this.selectNextButton()}}},registerComponent:function(a){this.components[a.id]=a;if(a.buttonBar||a.buttons){a.addEvent("activate",this.selectFirstButton.bind(this));a.addEvent("hide",this.clearButtons.bind(this))}if(a.singleton&&a.type){ludo.SINGLETONS[a.type]=a}},selectFirstButton:function(d){if(d.isHidden()||!d.getButtons){return}this.activeComponent=d;if(this.activeButton){this.activeButton.deSelect()}this.activeButton=undefined;var b=this.availableButtons=d.getButtons();var a;for(a=0;a<b.length;a++){if(!b[a].isHidden()&&b[a].selected){this.activeButton=b[a];b[a].select();return}}for(a=0;a<b.length;a++){if(!b[a].isHidden()&&b[a].type=="form.SubmitButton"){this.activeButton=b[a];b[a].select();return}}for(a=0;a<b.length;a++){if(!b[a].isHidden()&&b[a].type=="form.CancelButton"){this.activeButton=b[a];b[a].select();return}}},selectNextButton:function(){if(this.activeButton){this.activeButton.deSelect()}var a=this.availableButtons.indexOf(this.activeButton);a++;if(a>=this.availableButtons.length){a=0}this.activeButton=this.availableButtons[a];this.activeButton.select()},clearButtons:function(a){if(this.activeComponent&&this.activeComponent.getId()==a.getId()){this.activeComponent=undefined;this.activeButton=undefined;this.activeButton=undefined}},deleteComponent:function(a){this.clearButtons(a);delete this.components[a.getId()]},get:function(a){return a.initialize!==undefined?a:this.components[a]},zIndex:1,getNewZIndex:function(){this.zIndex++;return this.zIndex},newComponent:function(cmpConfig,parentComponent){console.log("old code");cmpConfig=cmpConfig||{};if(!this.isConfigObject(cmpConfig)){if(parentComponent){if(cmpConfig.getParent()&&cmpConfig.getParent().removeChild){cmpConfig.getParent().removeChild(cmpConfig)}cmpConfig.setParentComponent(parentComponent)}return cmpConfig}else{if(parentComponent){cmpConfig.els=cmpConfig.els||{};if(!cmpConfig.renderTo&&parentComponent.getEl()){cmpConfig.renderTo=parentComponent.getEl()}cmpConfig.parentComponent=parentComponent}var ret;var cmpType=this.getViewType(cmpConfig,parentComponent);if(cmpType.countNameSpaces>1){var tokens=cmpConfig.type.split(/\./g);var ns=tokens.join(".");ret=eval("new window.ludo."+ns+"(cmpConfig)");if(!ret.type){ret.type=ns}return ret}else{if(cmpType.nameSpace){if(!window.ludo[cmpType.nameSpace][cmpType.componentType]&&parentComponent){parentComponent.log("Class ludo."+cmpType.nameSpace+"."+cmpType.componentType+" does not exists")}ret=new window.ludo[cmpType.nameSpace][cmpType.componentType](cmpConfig);if(!ret.type){ret.type=cmpType.nameSpace}return ret}else{if(!window.ludo[cmpType.componentType]&&parentComponent){parentComponent.log("Cannot create object of type "+cmpType.componentType)}return new window.ludo[cmpType.componentType](cmpConfig)}}}},getViewType:function(d,h){var b="";var a="";if(d.type){b=d.type}else{if(d.cType){b=d.cType}else{b=h.cType}}var g=0;if(b.indexOf(".")>=0){var f=b.split(/\./g);a=f[0];b=f[1];g=f.length-1}return{nameSpace:a,componentType:b,countNameSpaces:g}},isConfigObject:function(a){return a&&a.initialize?false:true}});ludo.CmpMgr=new ludo.CmpMgrClass();ludo.getView_250_40=function(a){return ludo.CmpMgr.get(a)};ludo.get=function(a){return ludo.CmpMgr.get(a)};ludo.$=function(a){return ludo.CmpMgr.get(a)};ludo._new=function(a){if(a.type&&ludo.SINGLETONS[a.type]){return ludo.SINGLETONS[a.type]}return ludo.factory.create(a)};ludo.FormMgrClass=new Class({Extends:Events,formElements:{},elementArray:[],posArray:{},forms:{},add:function(b){var a=b.getName();
if(!this.formElements[a]){this.formElements[a]=b;this.elementArray.push(b);this.posArray[b.getId()]=this.elementArray.length-1}b.addEvent("focus",this.setFocus.bind(this));b.addEvent("click",this.setFocus.bind(this))},getNext:function(b){if(this.posArray[b.getId()]){var a=this.posArray[b.getId()];if(a<this.elementArray.length-1){return this.elementArray[a+1]}}return null},get:function(a){return this.formElements[a]?this.formElements[a]:null},currentFocusedElement:undefined,setFocus:function(b,a){if(a.isFormElement()&&a!==this.currentFocusedElement){if(this.currentFocusedElement&&this.currentFocusedElement.hasFocus()){this.currentFocusedElement.blur()}this.currentFocusedElement=a;this.fireEvent("focus",a)}}});ludo.Form=new ludo.FormMgrClass();Events.prototype.on=Events.prototype.addEvent;Events.prototype.off=Events.prototype.removeEvent;ludo.util={types:{},isIe:function(){return navigator.appName=="Microsoft Internet Explorer"},isArray:function(a){return ludo.util.type(a)=="array"},isObject:function(a){return ludo.util.type(a)==="object"},isString:function(a){return ludo.util.type(a)==="string"},isFunction:function(a){return ludo.util.type(a)==="function"},argsToArray:function(a){return Array.prototype.slice.call(a)},clamp:function(b,d,a){return Math.min(Math.max(b,d),a)},type:function(a){if(a==null){return String(a)}return typeof a==="object"||typeof a==="function"?ludo.util.types[ludo.util.types.toString.call(a)]||"object":typeof a},isLudoJSConfig:function(a){return a.initialize===undefined&&a.type},tabletOrMobile:undefined,isTabletOrMobile:function(){if(ludo.util.tabletOrMobile===undefined){var a=false;(function(b){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))){a=true}})(navigator.userAgent||navigator.vendor||window.opera);ludo.util.tabletOrMobile=a}return ludo.util.tabletOrMobile},cancelEvent:function(){return false},log:function(a){if(window.console){console.log(a)}},warn:function(a){if(window.console){console.warn(a)}},getNewZIndex:function(a){var d=ludo.CmpMgr.getNewZIndex();var f=a.getEl().parent();var b;if(!a.els){b=a.el;if(!b){return d}}else{b=a.els.container}if(f.length>0&&f[0]==document.body&&b.css("position")==="absolute"){d+=10000}if(a.alwaysInFront){d+=400000}return d},dispose:function(a){console.log("remove");if(a.getParent()){a.getParent().removeChild(a)}a.removeEvents();this.disposeDependencies(a.dependency);a.disposeAllChildren();jQuery.each(a.els,function(b){if(b!="parent"&&a.els[b]&&a.els[b].prop&&a.els[b].prop("tagName")){a.els[b].off();a.els[b].remove()}}.bind(a));ludo.CmpMgr.deleteComponent(a);a.els={}},disposeDependencies:function(b){for(var a in b){if(b.hasOwnProperty(a)){if(b[a].removeEvents){b[a].removeEvents()}if(b[a].dispose){b[a].dispose()}else{if(b[a].dependency&&b[a].dependency.length){ludo.util.disposeDependencies(b[a].dependency)}}b[a]=undefined}}},parseDate:function(b,h){if(ludo.util.isString(b)){var g=h.split(/[^a-z%]/gi);var a=b.split(/[\.\-\/]/g);var f={};for(var d=0;d<g.length;d++){f[g[d]]=a[d]}f["%m"]=f["%m"]?f["%m"]-1:0;f["%h"]=f["%h"]||0;f["%i"]=f["%i"]||0;f["%s"]=f["%s"]||0;
return new Date(f["%Y"],f["%m"],f["%d"],f["%h"],f["%i"],f["%s"])}return ludo.util.isString(b)?"":b},getDragStartEvent:function(){return ludo.util.isTabletOrMobile()?"touchstart":"mousedown"},getDragMoveEvent:function(){return ludo.util.isTabletOrMobile()?"touchmove":"mousemove"},getDragEndEvent:function(){return ludo.util.isTabletOrMobile()?"touchend":"mouseup"},supportsSVG:function(){return !!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg")["createSVGRect"]},lengthOfObject:function(d){if(d.keys!=undefined){return d.keys().length}var a=0;for(var b in d){if(d.hasOwnProperty(b)){a++}}return a},pageXY:function(b){var a=b.touches&&b.touches.length>0?b.touches[0]:b.originalEvent!=undefined&&b.originalEvent.touches!=undefined&&b.originalEvent.touches.length>0?b.originalEvent.touches[0]:b;return{x:a.pageX,y:a.pageY,clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY}}};var ludoUtilTypes="Boolean Number String Function Array Date RegExp Object Error".split(" ");for(var i=0;i<ludoUtilTypes.length;i++){ludo.util.types["[object "+ludoUtilTypes[i]+"]"]=ludoUtilTypes[i].toLowerCase()}ludo.isMobile=ludo.util.isTabletOrMobile();ludo.Effect=new Class({Extends:Events,inProgress:false,initialize:function(){if(ludo.util.isIe()){jQuery(document.documentElement).on("selectstart",this.cancelSelection.bind(this))}},fireEvents:function(a){this.fireEvent("start",a);this.fireEvent("end",a)},start:function(){this.fireEvent("start");this.inProgress=true;this.disableSelection()},end:function(){this.fireEvent("end");this.inProgress=false;this.enableSelection()},disableSelection:function(){jQuery(document.body).addClass("ludo-unselectable")},enableSelection:function(){jQuery(document.body).removeClass("ludo-unselectable")},cancelSelection:function(){return !(this.inProgress)}});ludo.EffectObject=new ludo.Effect();ludo.language={words:{},set:function(a,b){this.words[a]=b},get:function(a){return this.words[a]?this.words[a]:a},fill:function(a){this.words=Object.merge(this.words,a)}};ludo.RegistryClass=new Class({storage:{},set:function(a,b){this.storage[a]=b},get:function(a){return this.storage[a]}});ludo.registry=new ludo.RegistryClass();ludo.storage.LocalStorage=new Class({supported:false,initialize:function(){this.supported=typeof(Storage)!=="undefined"},save:function(a,d){if(!this.supported){return}var b="simple";if(jQuery.isPlainObject(d)||jQuery.isArray(d)){d=JSON.stringify(d);b="object"}localStorage[a]=d;localStorage[this.getTypeKey(a)]=b},getNumeric:function(b,a){return this.get(b,a)/1},get:function(d,a){if(!this.supported){return a}var f=this.getType(d);if(f==="object"){var b=JSON.parse(localStorage[d]);return b?b:a}var g=localStorage.getItem(d);return g?g:a},getTypeKey:function(a){return a+"___type"},getType:function(a){a=this.getTypeKey(a);if(localStorage[a]!==undefined){return localStorage[a]}return"simple"},empty:function(){localStorage.clear()}});ludo.localStorage=undefined;ludo.getLocalStorage=function(){if(!ludo.localStorage){ludo.localStorage=new ludo.storage.LocalStorage()}return ludo.localStorage};ludo.ObjectFactory=new Class({namespaces:[],classReferences:{},create:function(a){if(this.isClass(a)){return a}a.type=a.type||"View";if(this.classReferences[a.type]!==undefined){return new this.classReferences[a.type](a)}var d=this.getInNamespace("ludo",a);if(d){return d}for(var b=0;b<this.namespaces.length;b++){var g=this.getInNamespace(this.namespaces[b],a);if(g){return g}}try{var g=this.createInstance(a.type,a);if(g!=undefined){return g}}catch(f){}ludo.util.log("Could not find class "+a.type);return undefined},createInstance:function(h,b){var g=h.split(/\./g);var a=g.pop();var f=window;for(var d=0;d<g.length;d++){var j=g[d];if(f[j]!=undefined){f=f[j]}}if(f[a]!=undefined){return new f[a](b)}return undefined},registerClass:function(a,b){this.classReferences[a]=b},createAlias:function(a,b){this.classReferences[a]=b},createNamespace:function(a){if(window[a]===undefined){window[a]={}}if(this.namespaces.indexOf(a)===-1){this.namespaces.push(a)}},ns:function(d){var b=window;var f=d.split(/\./g);for(var a=0;a<f.length;a++){var g=f[a];if(b[g]==undefined){b[g]={}}b=b[g]}},getInNamespace:function(f,a){if(jQuery.type(a)=="string"){console.trace()}var d=a.type.split(/\./g);if(d[0]===f){d.shift()}var g=window[f];for(var b=0;b<d.length;b++){if(g[d[b]]!==undefined){g=g[d[b]]}else{return undefined}}return new g(a)},isClass:function(a){return a&&a.initialize!==undefined}});ludo.factory=new ludo.ObjectFactory();ludo._Config=new Class({storage:{},initialize:function(){this.setDefaultValues()},reset:function(){this.setDefaultValues()},setDefaultValues:function(){this.storage={url:undefined,documentRoot:"/",socketUrl:"http://your-node-js-server-url:8080/",modRewrite:false,fileUploadUrl:undefined}},setUrl:function(a){this.storage.url=a},getUrl:function(){return this.storage.url},enableModRewriteUrls:function(){this.storage.modRewrite=true},disableModRewriteUrls:function(){this.storage.modRewrite=false
},hasModRewriteUrls:function(){return this.storage.modRewrite===true},setSocketUrl:function(a){this.storage.socketUrl=a},getSocketUrl:function(){return this.storage.socketUrl},setDocumentRoot:function(a){this.storage.documentRoot=a==="."?"":a},getDocumentRoot:function(){return this.storage.documentRoot},setFileUploadUrl:function(a){this.storage.fileUploadUrl=a},getFileUploadUrl:function(){return this.storage.fileUploadUrl}});ludo.config=new ludo._Config();var Asset={javascript:function(f,b){if(!b){b={}}var a=jQuery('<script src="'+f+'" type="javascript"><\/script>'),g=b.document||document,d=b.onload||b.onLoad;delete b.onload;delete b.onLoad;delete b.document;if(d){if(typeof a.onreadystatechange!="undefined"){a.on("readystatechange",function(){if(["loaded","complete"].contains(this.readyState)){d.call(this)}})}else{a.on("load",d)}}this.addProperties(a,b);jQuery(g.head).append(a);return a},addProperties:function(d,b){for(var a in b){if(b.hasOwnProperty(a)){d.attr(a,b[a])}}},css:function(f,a){if(!a){a={}}var b=jQuery('<link rel="stylesheet" type="text/css" media="screen" href="'+f+'" />');var d=a.onload||a.onLoad,g=a.document||document;delete a.onload;delete a.onLoad;delete a.document;if(d){b.on("load",d)}this.addProperties(b,a);jQuery(g.head).append(b);return b}};ludo.Core=new Class({Extends:Events,id:undefined,name:undefined,module:undefined,submodule:undefined,controller:undefined,useController:false,stateful:false,statefulProperties:undefined,dependency:{},plugins:undefined,initialize:function(a){a=a||{};this.lifeCycle(a);this.applyplugins()},lifeCycle:function(a){this.__construct(a);this.ludoEvents()},applyplugins:function(){if(this.plugins){jQuery.each(this.plugins,function(a,b){this.addPlugin(b,a)}.bind(this))}},addPlugin:function(b,a){a=a!=undefined?a:this.plugins.length;b.parentComponent=this;this.plugins[a]=this.createDependency("plugins"+a,b)},__construct:function(a){this.setConfigParams(a,["url","name","controller","module","submodule","stateful","id","useController","plugins"]);if(a!=undefined){for(var b in a){if(a.hasOwnProperty(b)&&jQuery.type(a[b])=="function"&&this[b]==undefined){this[b]=a[b].bind(this)}}}if(this.stateful&&this.statefulProperties&&this.id){a=this.appendPropertiesFromStore(a);this.addEvent("state",this.saveStatefulProperties.bind(this))}if(a.listeners!==undefined){this.addEvents(a.listeners)}if(this.controller!==undefined){ludo.controllerManager.assignSpecificControllerFor(this.controller,this)}if(this.module||this.useController){ludo.controllerManager.registerComponent(this)}if(!this.id){this.id="ludo-"+String.uniqueID()}ludo.CmpMgr.registerComponent(this)},setConfigParams:function(a,d){for(var b=0;b<d.length;b++){if(a[d[b]]!==undefined){this[d[b]]=a[d[b]]}}},ludoEvents:function(){},appendPropertiesFromStore:function(a){var f=ludo.getLocalStorage().get(this.getKeyForLocalStore());if(f){var d=this.statefulProperties;for(var b=0;b<d.length;b++){a[d[b]]=f[d[b]]}}return a},saveStatefulProperties:function(){var d={};var b=this.statefulProperties;for(var a=0;a<b.length;a++){d[b[a]]=this[b[a]]}ludo.getLocalStorage().save(this.getKeyForLocalStore(),d)},getKeyForLocalStore:function(){return"state_"+this.id},getId:function(){return this.id},getName:function(){return this.name},getUrl:function(){if(this.url){return this.url}if(this.component){return this.component.getUrl()}if(this.applyTo){return this.applyTo.getUrl()}if(this.parentComponent){return this.parentComponent.getUrl()}return undefined},getEventEl:function(){return Browser.ie?jQuery(document.documentElement):jQuery(window)},isConfigObject:function(a){return a.initialize===undefined},NS:undefined,getNamespace:function(){if(this.NS==undefined){if(this.type){var a=this.type.split(/\./g);a.pop();this.NS=a.join(".")}else{this.NS=""}}return this.NS},hasController:function(){return this.controller?true:false},getController:function(){return this.controller},setController:function(a){this.controller=a;this.addControllerEvents()},addControllerEvents:function(){},getModule:function(){return this.getInheritedProperty("module")},getSubModule:function(){return this.getInheritedProperty("submodule")},getInheritedProperty:function(a){return this[a]!==undefined?this[a]:this.parentComponent?this.parentComponent.getInheritedProperty(a):undefined},saveState:function(){this.fireEvent("state")},createDependency:function(b,a){this.dependency[b]=ludo.util.isLudoJSConfig(a)?ludo._new(a):a;return this.dependency[b]},hasDependency:function(a){return this.dependency[a]?true:false},getDependency:function(b,a){if(this.dependency[b]){return this.dependency[b]}return this.createDependency(b,a)},relayEvents:function(d,b){for(var a=0;a<b.length;a++){d.on(b[a],this.getRelayFn(b[a]).bind(this))}},getRelayFn:function(a){return function(){this.fireEvent.call(this,a,Array.prototype.slice.call(arguments))}.bind(this)}});ludo.theme.Themes=new Class({currentTheme:undefined,themes:{twilight:{c100:"#ffffff",c200:"#eeeeee",c300:"#aeb0b0",c400:"#8b8c8c",c500:"#535353",c600:"#424242",c700:"#383838",c800:"#282828",c900:"#282828",border:"#424242",background:"#535353",background2:"#535353",text:"#aeb0b0"},blue:{c100:"#ffffff",c200:"#d1e7ff",c300:"#c6e1ff",c400:"#a6cbf5",c500:"#354150",c600:"#000000",border:"#a6cbf5",background:"#535353",background2:"#535353",text:"#000000"},"light-gray":{c100:"#FFFFFF",c200:"#f5f5f5",c300:"#e2e2e2",c400:"#d7d7d7",c500:"#c6c6c6",c600:"#AAAAAA",c700:"#777777",c800:"#555555",c900:"#000000",border:"#d7d7d7",background:"#FFFFFF",background2:"#e2e2e2",text:"#555555"}},addTheme:function(b,a){this.themes[b]=a
},setTheme:function(b){if(this.themes[b]==undefined){console.warn("Undefined theme "+b)}var a=this.getCurrentTheme();if(a==b){return}if(a){jQuery(document.body).removeClass("ludo-"+this.currentTheme)}this.currentTheme=b;jQuery(document.body).addClass("ludo-"+b)},getThemeEl:function(){var a=this.getCurrentTheme();if(a!=undefined){return jQuery(".ludo-"+a)}return jQuery(document.body)},getCurrentTheme:function(){if(this.currentTheme==undefined){var a=jQuery(document.documentElement);jQuery.each(this.themes,function(f){if(!this.currentTheme){var b=".ludo-"+f;var d=a.find(b);if(d.length>0){this.currentTheme=f}}}.bind(this))}return this.currentTheme},color:function(a){var b=this.getCurrentTheme();if(!b){return undefined}if(this.themes[b]!=undefined){return this.themes[b][a]}return undefined},clear:function(){this.currentTheme=undefined}});ludo.Theme=new ludo.theme.Themes();ludo.$C=ludo.Theme.color.bind(ludo.Theme);ludo.Movable=new Class({Extends:Events,sources:{},targets:{},records:{},components:{},els:{shim:null,insertionMarker:null},dragProperties:{el:null,waiting:null,countSources:0,mouseOverCol:null,originalMousePos:{x:null,y:null},originalElPos:{x:null,y:null},jsObjects:{source:{item:null,column:null},target:{item:null,column:null,pos:null}}},id:null,delay:1,initialize:function(){this.createElements();this.id=String.uniqueID();jQuery(document.body).on("mouseup",this.stopMove.bind(this));jQuery(document.body).on("mousemove",this.mouseMove.bind(this))},addSource:function(j){var g=j.handle||null;var a=j.record||null;var b=j.component||null;var f=j.el||b.getEl();if(f.hasClass("ludo-movable")){return}if(!f.id){f.id="ludo-movable-"+String.uniqueID()}if(this.sources[f.id]){ludo.util.log(f.id);ludo.util.log("Error: "+f.id+" has duplicates")}if(a){this.records[f.id]=a}if(b){this.components[f.id]=b}this.sources[f.id]=j.el||j.component;f.addClass("ludo-movable");if(g){var d=f.getElements(g)[0];try{d.addEvent("mousedown",this.startMove.bind(this))}catch(h){ludo.util.log(j)}d.addClass("ludo-movable-handle");d.setStyle("cursor","move")}else{f.addEvent("mousedown",this.startMove.bind(this))}},addTarget:function(f){var a=f.record||null;var b=f.component||null;var d=f.el||b.getEl();if(!d.id){d.id="ludo-movable-target-"+String.uniqueID()}this.targets[d.id]=f.el||f.component;if(a){this.records[d.id]=a}if(b){this.components[d.id]=b}d.addEvent("mousemove",this.mouseMoveOnTarget.bind(this));d.addEvent("mouseover",this.mouseOverTarget.bind(this));d.addClass("ludo-movable-target")},mouseOverTarget:function(){},mouseMoveOnTarget:function(){},setWidthOfShimAndInsertionPoint:function(a){this.els.shim.setStyle("width",a);this.els.insertionMarker.setStyles({width:a,display:""})},getTargetElementFromEvent:function(b){var a=b.target;if(!a.hasClass("ludo-movable-target")){a=a.getParent(".ludo-movable-target")}return a},placeInsertionMarker:function(){},createElements:function(){this.createShim();this.createInsertionMarker()},createShim:function(){var a=this.els.shim=jQuery("<div>");a.addClass("ludo-framed-view-shim");a.setStyle("display","none");document.body.append(a)},createInsertionMarker:function(){var a=this.els.insertionMarker=jQuery("<div>");a.setStyle("display","none");document.body.append(a)},stopMove:function(){if(this.dragProperties.waiting||this.dragProperties.mode){this.fireEvent("stop")}if(this.dragProperties.waiting){clearTimeout(this.dragProperties.waiting)}if(this.dragProperties.mode){this.dragProperties.mode=null;this.dragProperties.el.setStyle("display","");this.els.shim.setStyle("display","none");this.els.insertionMarker.setStyle("display","none");this.fireEvent("drop",[this,this.getSourceItem(),this.getTargetItem()])}},startMove:function(a){this.fireEvent("start");this.dragProperties.el=a.target;if(!this.dragProperties.el.hasClass("ludo-movable")){this.dragProperties.el=this.dragProperties.el.getParent(".ludo-movable")}var b=this.dragProperties.el.getCoordinates();this.els.shim.setStyle("display","none");this.resizeShim(b);this.dragProperties.mouseOverCol=null;this.dragProperties.jsObjects.target={column:null,item:null};this.setHeightOfInsertionMarker();this.dragProperties.jsObjects.source={item:this.sources[this.dragProperties.el.id],column:this.sources[this.dragProperties.el.id].getParent?this.sources[this.dragProperties.el.id].getParent():null};this.dragProperties.originalElPos={x:b.left,y:b.top};this.dragProperties.originalMousePos={x:a.page.x,y:a.page.y};if(this.hasDelay()){this.dragProperties.waiting=this.startMoveAfterDelay.delay(this.delay*1000,this)}else{this.hideSourceAndShowShim()}return false},setHeightOfInsertionMarker:function(){var a=this.dragProperties.el.getSize();this.els.insertionMarker.setStyle("height",a.y)},resizeShim:function(a){this.els.shim.setStyles({left:a.left,top:a.top+30,width:a.width,height:a.height})},hasDelay:function(){return this.delay>0},showShim:function(){this.els.shim.setStyle("display","")},startMoveAfterDelay:function(){if(this.dragProperties.waiting){this.hideSourceAndShowShim()
}},hideSourceAndShowShim:function(){this.dragProperties.el.setStyle("display","none");this.dragProperties.mode="move";this.showShim();this.setInitialInsertionPoint();this.placeInsertionMarker()},mouseMove:function(a){if(this.dragProperties.mode=="move"){this.els.shim.setStyles({left:this.dragProperties.originalElPos.x+a.page.x-this.dragProperties.originalMousePos.x,top:this.dragProperties.originalElPos.y+a.page.y-this.dragProperties.originalMousePos.y+30});return false}return undefined},setInitialInsertionPoint:function(){},isActive:function(){return this.dragProperties.mode?true:false},getSourceColumn:function(){return this.dragProperties.jsObjects.source.column},getSourceItem:function(){return this.dragProperties.jsObjects.source.item},getTargetColumn:function(){return this.dragProperties.jsObjects.target.column},getTargetItem:function(){return this.dragProperties.jsObjects.target.item},getTargetPosition:function(){return this.dragProperties.jsObjects.target.pos},getSourceRecord:function(){return this.records[this.dragProperties.jsObjects.source.item.id]},getTargetRecord:function(){if(!this.dragProperties.jsObjects.target.item){return null}return this.records[this.dragProperties.jsObjects.target.item.id]},getSourceComponent:function(){return this.components[this.dragProperties.jsObjects.source.item.id]},getTargetView:function(){if(!this.dragProperties.jsObjects.target.item){return null}return this.components[this.dragProperties.jsObjects.target.item.id]}});ludo.remote.Inject=new Class({data:{},add:function(b,f){var g=b.split(/\//g);var d=g[0];var a=g[1];if(this.data[d]===undefined){this.data[d]={}}this.data[d][a]=f},get:function(d,a){if(this.data[d]&&this.data[d][a]){var b=this.data[d][a];delete this.data[d][a];return b}return undefined}});ludo.remoteInject=new ludo.remote.Inject();ludo.remote.Base=new Class({Extends:Events,remoteData:undefined,method:"post",initialize:function(a){a=a||{};if(a.listeners!==undefined){this.addEvents(a.listeners)}this.method=a.method||this.method;if(a.resource!==undefined){this.resource=a.resource}if(a.url!==undefined){this.url=a.url}if(a.shim){new ludo.remote.Shim({renderTo:a.shim.renderTo,remoteObj:this,txt:a.shim.txt})}},send:function(a,f,b,d){this.remoteData=undefined;if(f&&!ludo.util.isArray(f)){f=[f]}ludo.remoteBroadcaster.clear(this,a);this.fireEvent("start");this.sendToServer(a,f,b,d)},onComplete:function(){this.fireEvent("complete",this)},getUrl:function(a,d){var b=this.url!==undefined?this.url:ludo.config.getUrl();if(ludo.config.hasModRewriteUrls()){b=ludo.config.getDocumentRoot()+this.getServicePath(a,d)}else{b=this.url!==undefined?ludo.util.isFunction(this.url)?this.url.call():this.url:ludo.config.getUrl()}return b},getServicePath:function(a,b){var d=[this.resource];if(b&&b.length){d.push(b.join("/"))}if(a){d.push(a)}return d.join("/")},getDataForRequest:function(a,d,h,g){var b={data:h};if(g){if(ludo.util.isObject(g)){b=Object.merge(g,b)}}if(!ludo.config.hasModRewriteUrls()&&this.resource){b.request=this.getServicePath(a,d)}var f=ludo.remoteInject.get(this.resource,a);if(f){b.data=b.data?Object.merge(b.data,f):f}return b},getResponseCode:function(){return this.remoteData&&this.remoteData.code?this.remoteData.code:0},getResponseMessage:function(){return this.remoteData&&this.remoteData.message?this.remoteData.message:undefined},getResource:function(){return this.resource},sendBroadCast:function(a){ludo.remoteBroadcaster.broadcast(this,a)}});ludo.remote.JSON=new Class({Extends:ludo.remote.Base,resource:undefined,url:undefined,initialize:function(a){this.parent(a)},sendToServer:function(a,f,b,d){if(f&&!ludo.util.isArray(f)){f=[f]}this.fireEvent("start",this);this.sendBroadCast(a);var g=this.getDataForRequest(a,f,b,d);if(!a&&!f){g=g.data}jQuery.ajax({url:this.getUrl(a,f),method:this.method,cache:false,dataType:"json",data:g,success:function(h){this.remoteData=h;if(jQuery.type(h)!="array"||h.success||h.success===undefined){this.fireEvent("success",this)}else{this.fireEvent("failure",this)}this.sendBroadCast(a);this.onComplete()}.bind(this),fail:function(j,h){this.remoteData={code:500,message:h};this.fireEvent("servererror",this);this.sendBroadCast(a);this.onComplete()}.bind(this)})},getResponseData:function(){if(this.remoteData&&jQuery.type(this.remoteData)=="array"){return this.remoteData}if(!this.remoteData.response&&!this.remoteData.data){return undefined}return this.remoteData.data?this.remoteData.data:this.remoteData.response.data?this.remoteData.response.data:this.remoteData.response},getResponse:function(){return this.remoteData},setResource:function(a){this.resource=a}});ludo.remote.HTML=new Class({Extends:ludo.remote.Base,HTML:undefined,sendToServer:function(a,f,b,d){jQuery.ajax({dataType:"html",method:this.method,url:this.getUrl(a,f),async:true,cache:false,data:this.getDataForRequest(a,f,b,d),success:function(g){this.remoteData=g;this.fireEvent("success",this);this.sendBroadCast(a);this.onComplete()}.bind(this),error:function(j,h,g){this.remoteData={code:500,message:g};
this.fireEvent("servererror",this);this.sendBroadCast(a);this.onComplete()}.bind(this)})},getResponseData:function(){return this.remoteData},getResponse:function(){return this.remoteData}});ludo.remote.Broadcaster=new Class({Extends:Events,defaultMessages:{},broadcast:function(h,b){var g=h.getResponseCode();var f,a;switch(g){case 0:f="start";break;case 200:f="success";break;default:f="failure";break}var d=this.getEventName(f,h.getResource());if(d){a=this.getEventName(f,h.getResource(),b)}else{d=this.getEventName("serverError",h.getResource());a=this.getEventName("serverError",h.getResource(),b)}var j={message:h.getResponseMessage(),code:h.getResponseCode(),resource:h.getResource(),service:b,type:f};if(!j.message){j.message=this.getDefaultMessage(a||d)}this.fireEvent(d,j);if(b){this.fireEvent(a,j)}},getDefaultMessage:function(a){return this.defaultMessages[a]?this.defaultMessages[a]:""},clear:function(f,b){var g={message:f.getResponseMessage(),code:f.getResponseCode(),resource:f.getResource(),service:b};var d=this.getEventName("clear",g.resource);var a=this.getEventName("clear",g.resource,b);this.fireEvent(d,g);if(b){this.fireEvent(a,g)}},getEventName:function(b,d,a){d=d||"";a=a||"";return[d,a,b.capitalize(),"Message"].join("")},addResourceEvent:function(a,d,b){this.addEvent(this.getEventName(a,d),b)},addServiceEvent:function(d,g,b,f){if(!b.length){this.addEvent(this.getEventName(d,g,undefined),f)}else{for(var a=0;a<b.length;a++){this.addEvent(this.getEventName(d,g,b[a]),f)}}},setDefaultMessage:function(d,b,f,a){this.defaultMessages[this.getEventName(b,f,a)]=d},eventObjToBuild:{},withResourceService:function(a){var b=a.split(/\//g);this.withResource(b[0]);if(b.length==2){this.withService(b[1])}return this},withResource:function(a){this.eventObjToBuild={resource:a};return this},withService:function(a){if(this.eventObjToBuild.service===undefined){this.eventObjToBuild.service=[]}this.eventObjToBuild.service.push(a);return this},on:function(b,d){if(!ludo.util.isArray(b)){b=[b]}for(var a=0;a<b.length;a++){this.addServiceEvent(b[a],this.eventObjToBuild.resource,this.eventObjToBuild.service,d)}return this}});ludo.remoteBroadcaster=new ludo.remote.Broadcaster();ludo.svg.Matrix=new Class({a:1,b:0,c:0,d:1,e:0,f:0,_translateCommited:[0,0],matrix:undefined,node:undefined,transformationObject:undefined,currentRotation:undefined,initialize:function(a){this.node=a;this.currentRotation=[0,0,0]},getScale:function(){var a=this.getSVGMatrix();return[a.a,a.d]},setScale:function(a,b){this.matrix=this.getSVGMatrix();this.matrix.a=a;this.matrix.d=arguments.length==1?a:b;this.update()},scale:function(a,b){this.matrix=this.getSVGMatrix.scale(a,this.arguments.length==1?a:b);this.update()},getTranslate:function(){var a=this.getSVGMatrix();return[a.e,a.f]},setTranslate:function(a,b){this.matrix=this.getSVGMatrix();this.matrix.e=a;this.matrix.f=b;this.update()},translate:function(a,b){this.matrix=this.getSVGMatrix().translate(a,b);this.update()},getRotation:function(){return this.currentRotation},setRotation:function(f,b,g){if(this.currentRotation!=undefined){var d=this.currentRotation;this.rotate(-d[0],d[1],d[2])}this.rotate(f,b,g)},rotate:function(b,a,d){if(b<0){b+=360}b=b%360;this.getSVGMatrix();if(arguments.length>1){this.matrix=this.matrix.translate(a,d)}this.matrix=this.matrix.rotate(b,a,d);if(arguments.length>1){this.matrix=this.matrix.translate(-a,-d)}this.currentRotation[0]=b;this.currentRotation[1]=a;this.currentRotation[2]=d;this.update()},commitTranslate:function(){this._translateCommited[0]=this.e;this._translateCommited[1]=this.f},getSVGMatrix:function(){if(this.matrix==undefined){this.matrix=ludo.svg.SVGElement.createSVGMatrix()}return this.matrix},update:function(){this.getTransformObject().setMatrix(this.matrix)},getTransformObject:function(){if(this.transformationObject==undefined){if(this.node.el.transform.baseVal.numberOfItems==0){var a;if(this.node.el.ownerSVGElement){a=this.node.el.ownerSVGElement}else{a=document.createElementNS("http://www.w3.org/2000/svg","svg")}var b=a.createSVGTransform();this.node.el.transform.baseVal.appendItem(b)}this.transformationObject=this.node.el.transform.baseVal.getItem(0)}return this.transformationObject}});ludo.svg.setGlobalMatrix=function(a){ludo.svg.SVGElement=a;ludo.svg.globalMatrix=a.createSVGMatrix()};ludo.svg.Engine=new Class({get:function(b,a){if(a.substring(0,6)=="xlink:"){return b.getAttributeNS("http://www.w3.org/1999/xlink",a.substring(6))}else{return b.getAttribute(a)}}});ludo.svgEngine=new ludo.svg.Engine();ludo.svg.Util={pathStyles:function(b){var d=jQuery("<div>");d.addClass(b);d.css("display","none");ludo.Theme.getThemeEl().append(d);var a={fill:ludo.svg.Util.toRGBColor(d.css("background-color")),"fill-opacity":d.css("opacity"),stroke:ludo.svg.Util.toRGBColor(d.css("border-color")),"stroke-width":d.css("border-width").replace("px","")};d.remove();return a},textStyles:function(d){var f=jQuery("<div>");f.addClass(d);f.css("display","none");ludo.Theme.getThemeEl().append(f);
var a=f.css("line-height").replace(/[^0-9\.]/g,"");if(!a){a=f.css("font-size")}var g=parseInt(f.css("font-size"));g++;var b={"font-size":g+"px","font-family":f.css("font-family"),"font-weight":f.css("font-weight"),"font-style":f.css("font-style"),"line-height":a,fill:ludo.svg.Util.toRGBColor(f.css("color")),stroke:"none","stroke-opacity":0};b["line-height"]=b["line-height"]||b["font-size"];f.remove();return b},toRGBColor:function(b){if(b.indexOf("rgb")>=0){if(this.colorUtil==undefined){this.colorUtil=new ludo.color.Color()}b=b.replace(/[^0-9,]/g,"");var a=b.split(/,/g);if(a.length==4){return b}b=this.colorUtil.rgbCode(a[0]/1,a[1]/1,a[2]/1);return b}return b}};ludo.svg.Node=new Class({Extends:Events,el:undefined,tagName:undefined,id:undefined,dirty:undefined,_bbox:undefined,_attr:undefined,classNameCache:[],tCache:{},tCacheStrings:undefined,initialize:function(b,a,d){this._attr={};a=a||{};a.id=this.id=a.id||"ludo-svg-node-"+String.uniqueID();if(b!==undefined){this.tagName=b}this.createNode(this.tagName,a);if(d!==undefined){this.text(d)}},createNode:function(b,a){if(a!==undefined){if(typeof b=="string"){b=this.createNode(b)}var d=this;Object.each(a,function(g,f){if(g.getUrl!==undefined){g=g.getUrl()}if(f=="css"){this.css(g)}else{if(f.substring(0,6)=="xlink:"){b.setAttributeNS("http://www.w3.org/1999/xlink",f.substring(6),g)}else{b.setAttribute(f,g);d._attr[f]=g}}}.bind(this))}else{b=document.createElementNS("http://www.w3.org/2000/svg",b)}this.el=b;b.style&&(b.style.webkitTapHighlightColor="rgba(0,0,0,0)");return b},getEl:function(){return this.el},addEvents:function(b){for(var a in b){if(b.hasOwnProperty(a)){this.on(a,b[a])}}},on:function(b,a){switch(b.toLowerCase()){case"mouseenter":ludo.canvasEventManager.addMouseEnter(this,a);break;case"mouseleave":ludo.canvasEventManager.addMouseLeave(this,a);break;default:this._addEvent(b,this.getDOMEventFn(b,a),this.el);this.addEvent(b,a)}},_addEvent:(function(){if(document.addEventListener){return function(d,b,a){if(a==undefined){a=this.el}a.addEventListener(d,b,false)}}else{return function(d,b,a){if(a==undefined){a=this.el}a.attachEvent("on"+d,b)}}})(),off:function(a,b){if(this.el.removeEventListener){this.el.removeEventListener(a,b,false)}else{this.el.detachEvent("on"+a,b)}},relativePosition:function(b){var a=this.el.getBoundingClientRect();return{x:b.clientX-a.left,y:b.clientY-a.top}},getDOMEventFn:function(a,b){return function(l){l=l||window.event;var m=l.currentTarget||l.target||l.srcElement;while(m&&m.nodeType==3){m=m.parentNode}m=m.correspondingUseElement||m;var h,g;var j=l.touches;if(!j&&l.originalEvent){j=l.originalEvent.touches}var f=l.pageX;var n=l.pageY;if(j&&j.length>0){h=j[0].clientX;g=j[0].clientY;f=j[0].pageX;n=j[0].pageY}else{h=l.clientX;g=l.clientY}var k=this.el.tagName=="svg"?this.el:this.el.ownerSVGElement;var d=k?k.getBoundingClientRect():{left:0,top:0};l={target:m,pageX:(f!=null)?f:h+document.scrollLeft,pageY:(n!=null)?n:g+document.scrollTop,clientX:h-d.left,clientY:g-d.top,event:l};if(b){b.call(this,l,this,b)}return false}.bind(this)},svgCoordinates:undefined,svgPos:function(a){if(this.svgCoordinates==undefined){while(a.tagName.toLowerCase()!="g"){a=a.parentNode}this.svgCoordinates=jQuery(a).position();console.log(this.svgCoordinates)}return this.svgCoordinates},append:function(a){this.el.appendChild(a.getEl());a.parentNode=this;return this},parent:function(){return this.parentNode},show:function(){this.css("display","")},hide:function(){this.css("display","none")},isHidden:function(){return this.css("display")=="none"},setAttributes:function(a){jQuery.each(a,function(b,d){this.set(b,d)}.bind(this))},setProperties:function(a){this.setAttributes(a)},attr:function(a,b){if(arguments.length==1){return this.get(a)}this.set(a,b)},set:function(a,b){this._attr[a]=b;this.dirty=true;if(a.substring(0,6)=="xlink:"){if(b.id!==undefined){b="#"+b.getId()}this.el.setAttributeNS("http://www.w3.org/1999/xlink",a.substring(6),b)}else{if(b!=undefined&&b.id!==undefined){b="url(#"+b.getId()+")"}this.el.setAttribute(a,b);if(a=="class"&&b.length==0){this.classNameCache=[]}}},_setPlain:function(a,b){this._attr[a]=b;this.dirty=true;this.el.setAttribute(a,b)},removeAttr:function(a){if(a.substring(0,6)=="xlink:"){this.el.removeAttributeNS("http://www.w3.org/1999/xlink",a.substring(6))}else{this.el.removeAttribute(a)}},remove:function(){if(this.el.parentNode){this.el.parentNode.removeChild(this.el)}},get:function(a){if(a.substring(0,6)=="xlink:"){return this.el.getAttributeNS("http://www.w3.org/1999/xlink",a.substring(6))}else{return this.el[a]!=undefined&&this.el[a].animVal!=undefined?this.el[a].animVal.value:this.el.getAttribute(a)}},getTranslate:function(){return this._getMatrix().getTranslate()},applyFilter:function(a){this.set("filter",a.getUrl())},applyMask:function(a){this.set("mask",a.getUrl())},clip:function(a){this.set("clip-path",a.getUrl())},setPattern:function(a){this.set("fill",a.getUrl())},url:function(a,b){this.set(a,b.getUrl!==undefined?b.getUrl():"url(#"+b+")")
},href:function(a){this.set("xlink:href",a)},text:function(a){this.el.textContent=a},add:function(b,a,f){var d=new ludo.svg.Node(b,a,f);this.append(d);return d},css:function(a,d){if(arguments.length==1&&jQuery.type(a)=="string"){return this.el.style[String.camelCase(a)]}else{if(arguments.length==1){var b=this.el;jQuery.each(a,function(f,g){b.style[String.camelCase(f)]=g})}else{this.el.style[String.camelCase(a)]=d}}return this},addClass:function(b){if(!this.hasClass(b)){this.classNameCache.push(b);this.updateNodeClassNameById()}var a=this.el.getAttribute("class");if(a){a=a.split(/\s/g);if(a.indexOf(b)>=0){return}a.push(b);this.set("class",a.join(" "))}else{this.set("class",b)}return this},hasClass:function(b){if(!this.classNameCache){var a=this.el.getAttribute("class");if(a){this.classNameCache=a.split(/\s/g)}else{this.classNameCache=[]}}return this.classNameCache.indexOf(b)>=0},removeClass:function(a){if(this.hasClass(a)){var b=this._attr.id;this.classNameCache.erase(a);this.updateNodeClassNameById()}return this},removeAllClasses:function(){this.set("class","");this.classNameCache=[]},updateNodeClassNameById:function(){this.set("class",this.classNameCache.join(" "))},getId:function(){return this.id},getUrl:function(){return"url(#"+this.id+")"},position:function(){var d=this.getBBox();if(this.tagName=="g"){if(this._matrix!=undefined){var b=this._matrix.getTranslate();return{left:b[0],top:b[1]}}else{return{left:0,top:0}}}var a=[0,0];if(this._matrix!=undefined){a=this._matrix.getTranslate()}return{left:d.x+a[0],top:d.y+a[1]}},offset:function(){var d=this.position();var a=this.parentNode;while(a&&a.tagName!="svg"){var b=a.position();d.left+=b.left;d.top+=b.top;a=a.parentNode}return d},getBBox:function(){if(this.tagName=="g"||this.tagName=="text"){return this.el.getBBox()}if(this._bbox==undefined||this.dirty){var a=this._attr;switch(this.tagName){case"rect":this._bbox={x:a.x||0,y:a.y||0,width:a.width,height:a.height};break;case"circle":this._bbox={x:a.cx-a.r,y:a.cy-a.r,width:a.r*2,height:a.r*2};break;case"ellipse":this._bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:a.rx*2,height:a.ry*2};break;case"path":this._setBBoxOfPath("d");break;case"polyline":case"polygon":this._setBBoxOfPath("points");break;case"image":var b=this.el.getBoundingClientRect();this._bbox={x:a.x||0,y:a.y||0,width:b.width,height:b.height};break;default:this._bbox={x:0,y:0,width:0,height:0}}}return this._bbox},_setBBoxOfPath:function(o){var f=this._attr[o];f=f.replace(/,/g," ");f=f.replace(/([a-z])/g,"$1 ");f=f.replace(/\s+/g," ");if(o=="d2"){if(this.el.getBoundingClientRect!=undefined){var b=this.el.getBoundingClientRect();var k=this.getTranslate();var n=this.el.parentNode.getBoundingClientRect();if(b!=undefined){this._bbox={x:b.left-k[0]-n.left,y:b.top-k[1]-n.top,width:b.width,height:b.height};console.log(b,n);return}}}f=f.replace(/\s+/g," ");f=f.trim();var q=f.split(/\s/g);var h,g,d,a;var s=undefined;var j=0;while(j<q.length){f=q[j];if(isNaN(f)){f=f.toLowerCase();if(f=="l"||f=="m"){s=f;j++;yi=j+2}}if(!isNaN(q[j])){var m=parseFloat(q[j]);if(h==undefined||m<h){h=m}if(d==undefined||m>d){d=m}var l=parseFloat(q[j+1]);if(g==undefined||l<g){g=l}if(a==undefined||l>a){a=l}j+=2}else{j++}}this._bbox={x:h,y:g,width:d-h,height:a-g}},getSize:function(){var a=this.getBBox();return{x:a.width-a.x,y:a.height-a.y}},svg:function(){return this.el.ownerSVGElement},getViewPort:function(){return this.el.viewPortElement},getRotate:function(){return this._getMatrix().getRotation()},setScale:function(a,b){this._getMatrix().setScale(a,b)},scale:function(a,b){this._getMatrix().scale(a,b)},setRotate:function(b,a,d){this._getMatrix().setRotation(b,a,d)},rotate:function(b,a,d){this._getMatrix().rotate(b,a,d)},setTranslate:function(a,b){this._getMatrix().setTranslate(a,b)},translate:function(a,b){this._getMatrix().translate(a,b)},_matrix:undefined,_getMatrix:function(){if(this._matrix==undefined){this._matrix=new ludo.svg.Matrix(this)}return this._matrix},empty:function(){this.el.textContent=""},animate:function(f,b,g,a){var d={};if(!jQuery.isPlainObject(b)){d.duration=b;d.easing=g;d.complete=a}else{d=b}ludo.svgAnimation.animate(this,f,d);return this},_animation:undefined,animation:function(){if(this._animation===undefined){this._animation=new ludo.svg.Animation(this.getEl())}return this._animation},toFront:function(){if(Browser.ie){this._toFront.delay(20,this)}else{this._toFront()}},_toFront:function(){this.el.parentNode.appendChild(this.el)},toBack:function(){if(Browser.ie){this._toBack.delay(20,this)}else{this._toBack()}},_toBack:function(){this.el.parentNode.insertBefore(this.el,this.el.parentNode.firstChild)}});ludo.svg.View=new Class({Extends:ludo.Core,node:undefined,tag:undefined,engine:ludo.svg,p:undefined,attr:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["tag","attr"]);this.node=new ludo.svg.Node(this.tag,this.attr)},$:function(a,b){return new ludo.svg.Node(a,b)},getNode:function(){return this.node},getEl:function(){return this.node.el},set:function(a,b){this.node.set(a,b)
},get:function(a){return this.node.get(a)},html:function(a){this.node.html(a)},rotate:function(a){this.node.rotate(a)},toFront:function(){this.node.toFront()},toBack:function(){this.node.toBack()},skewX:function(a){this.node.skewX(a)},skewY:function(a){this.node.skewY(a)},hide:function(){this.node.hide()},show:function(){this.node.show()},scale:function(a,b){this.node.scale(a,b)},css:function(a,b){this.node.css(a,b)},append:function(a){this.node.append(a);return this},empty:function(){this.node.empty();return this},add:function(b,a,d){return this.node.add(b,a,d)}});ludo.svg.Canvas=new Class({Extends:ludo.svg.View,tag:"svg",defaultProperties:{xmlns:"http://www.w3.org/2000/svg",version:"1.1"},renderTo:undefined,view:undefined,title:undefined,description:undefined,__construct:function(a){a=a||{};a.attr=a.attr||{};a.attr=Object.merge(a.attr,this.defaultProperties);this.parent(a);this.setConfigParams(a,["renderTo","title","description"]);if(this.title){this.createTitle()}if(this.description){this.createDescription()}ludo.svg.setGlobalMatrix(this.node.el);if(this.renderTo!==undefined){if(this.renderTo.$b!==undefined){this.view=this.renderTo;this.view.addEvent("resize",this.fitParent.bind(this));this.renderTo=this.view.$b()}else{this.renderTo=jQuery(this.renderTo)}this.renderTo.append(this.getEl());this.setInitialSize(a)}},setInitialSize:function(a){a.width=a.width||this.width;a.height=a.height||this.height;if(a.width&&a.height){this.set("width",a.width);this.set("height",a.height);this.setViewBox(a.width,a.height);this.width=a.width;this.height=a.height}else{this.fitParent();this.renderTo.on("resize",this.fitParent.bind(this))}},fitParent:function(){var a={x:this.renderTo.width(),y:this.renderTo.height()};if(a.x===0||a.y===0){return}this.set("width",a.x);this.set("height",a.y);this.setViewBox(a.x,a.y);this.node.css("width",a.x+"px");this.node.css("height",a.y+"px");this.width=a.x;this.height=a.y;this.fireEvent("resize",a)},getHeight:function(){return this.height},getWidth:function(){return this.width},getCenter:function(){return{x:this.width/2,y:this.height/2}},setViewBox:function(d,b,a,f){this.set("viewBox",(a||0)+" "+(f||0)+" "+d+" "+b)},createTitle:function(){this.append(new ludo.svg.Node("title",{},this.title))},createDescription:function(){this.append(new ludo.svg.Node("desc",{},this.description))},addStyleSheet:function(a,b){var d=new ludo.svg.Paint(b,{className:a});this.appendDef(d)},defsNode:undefined,getDefs:function(){if(this.defsNode===undefined){this.defsNode=new ludo.svg.Node("defs");this.append(this.defsNode)}return this.defsNode},appendDef:function(a){return this.getDefs().append(a)}});ludo.layout.TextBox=new Class({Extends:ludo.svg.Canvas,rotation:270,text:undefined,className:undefined,classNameOver:undefined,width:200,height:200,size:{x:0,y:0},x:0,y:0,colorUtil:undefined,__construct:function(a){this.text=a.text;this.rotation=a.rotation;this.className=a.className;this.classNameOver=a.classNameOver||a.className;this.renderTo=a.renderTo;if(a.x!==undefined){this.x=a.x}if(a.y!==undefined){this.y=a.y}if(document.createElementNS===undefined){this.createIE8Box(a);return}this.parent(a);this.createStyles();this.renderText();this.storeSize();this.rotate();this.resizeCanvas()},createIE8Box:function(){var a=document.createElement("span");jQuery(this.renderTo).append(jQuery(a));a.innerHTML=this.text;this.setIE8Transformation(a);return a},setIE8Transformation:function(b){var a=b.style;a.display="block";a.visibility="hidden";a.position="absolute";b.className=this.className;jQuery(document.body).append(b);a.fontSize="12px";a.fontWeight="normal";a.filter="progid:DXImageTransform.Microsoft.Matrix("+this.getIE8Transformation()+", sizingMethod='auto expand')";a.height=b.height()+"px";this.size.x=b.width();this.size.y=b.height();if(this.rotation===90){a.right="0px"}a.visibility="visible";document.id(this.renderTo).appendChild(b)},leave:function(){this.textNode.removeClass(this.classNameOver+"svg");this.textNode.addClass(this.className+"svg")},enter:function(){this.textNode.addClass(this.classNameOver+"svg")},deg2radians:Math.PI*2/360,getIE8Transformation:function(){var a=this.rotation*this.deg2radians;var b=Math.cos(a);var d=Math.sin(a);return["M11="+b,"M12="+(d*-1),"M21="+d,"M22="+b].join(",")},resizeCanvas:function(){var a=this.getSize();this.setViewBox(a.x,a.y);this.set("width",a.x);this.set("height",a.y)},createStyles:function(){this.styles=ludo.svg.Util.textStyles(this.className);this.stylesOver=ludo.svg.Util.textStyles(this.classNameOver);this.stylesOver["font-size"]=this.styles["font-size"];this.stylesOver["line-height"]=this.styles["line-height"];this.addStyleSheet(this.className+"svg",this.styles);this.addStyleSheet(this.classNameOver+"svg",this.stylesOver)},renderText:function(){var a=this.textNode=new ludo.svg.Node("text",{x:this.x,y:this.y+parseInt(this.styles["font-size"]),"class":this.className+"svg"});a.text(this.text);this.append(a)},storeSize:function(){var a=this.textNode.el.getBBox();this.size={x:a.width+a.x,y:a.height+a.y}
},rotate:function(){var a=this.size.x;var f=this.size.y;var d=(this.size.y-parseInt(this.styles["line-height"]))/2;var b="";switch(this.rotation){case 270:b="translate("+(d*-1)+" "+a+") rotate("+this.rotation+")";break;case 180:b="rotate("+this.rotation+" "+(a/2)+" "+(f/2)+")";break;case 90:b="translate("+(f-d)+" "+0+") rotate("+this.rotation+")";break;case 0:b="translate(0 "+(d*-1)+")"}this.textNode.set("transform",b)},getSize:function(){switch(this.rotation){case 270:case 90:return{x:this.size.y,y:this.size.x};default:return this.size}}});ludo.layout.Resizer=new Class({Extends:ludo.Core,type:"layout.Resizer",layout:{},orientation:undefined,view:undefined,dd:undefined,pos:undefined,isActive:false,hidden:false,lm:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["orientation","view","layout","pos","hidden","lm"]);this.createDOM(a.renderTo);this.addViewEvents();this.createDragable();if(this.lm.type=="layout.Docking"&&this.lm.collapsed){this.hidden=true}if(this.hidden){this.hide()}this.lm.on("collapse",this.hide.bind(this));this.lm.on("expand",this.show.bind(this))},createDOM:function(a){this.el=jQuery("<div>");this.el.on("mouseenter",this.enterResizer.bind(this));this.el.on("mouseleave",this.leaveResizer.bind(this));this.el.addClass("ludo-resize-handle");this.el.addClass("ludo-resize-handle-"+((this.orientation==="horizontal")?"col":"row"));this.el.addClass("ludo-layout-resize-"+((this.orientation==="horizontal")?"col":"row"));this.el.css({cursor:(this.orientation=="horizontal"?"ew-resize":"ns-resize"),zIndex:100000});a.append(this.el)},enterResizer:function(){if(!this.isActive){this.el.css("z-index",parseInt(this.el.css("z-index"))+1);this.el.addClass("ludo-resize-handle-active")}},leaveResizer:function(){if(!this.isActive){this.el.css("z-index",parseInt(this.el.css("z-index"))-1);this.el.removeClass("ludo-resize-handle-active")}},createDragable:function(){this.dd=new ludo.effect.Drag({directions:this.orientation=="horizontal"?"X":"Y"});this.dd.addEvent("before",this.beforeDrag.bind(this));this.dd.addEvent("end",this.endDrag.bind(this));this.dd.add(this.el)},beforeDrag:function(){this.dd.setMinX(30);this.isActive=true;this.el.removeClass("ludo-resize-handle-active");this.el.addClass("ludo-resize-handle-active");this.fireEvent("before",[this,this.view]);this.fireEvent("startResize")},setMinWidth:function(a){if(this.pos==="left"){var b=this.view.getEl();this.dd.setMaxX(b.position().left+b.width()-a)}else{this.dd.setMinX(this.view.getEl().position().left+a)}},setMaxWidth:function(a){var b=this.view.getEl();if(this.pos==="right"){this.dd.setMaxX(b.position().left+a)}else{var d=0;if(this.layout.affectedSibling){d=this.layout.affectedSibling.getEl().position().left+10}this.dd.setMinX(Math.max(d,b.position().left+b.width()-a))}},setMinHeight:function(b){if(this.pos==="above"){var a=this.view.getEl();this.dd.setMaxY(a.position().top+a.height()-b)}else{this.dd.setMinY(this.view.getEl().position().top+b)}},setMaxHeight:function(d){var a=this.view.getEl();if(this.pos==="below"){this.dd.setMaxY(a.position().top+d)}else{var b=10;if(this.layout.affectedSibling){b=this.layout.affectedSibling.getEl().position().top+10}this.dd.setMinY(Math.max(b,a.position().top+a.height()-d))}},endDrag:function(b,a){this.el.removeClass("ludo-resize-handle-over");this.el.removeClass("ludo-resize-handle-active");var d=this.orientation==="horizontal"?a.getDraggedX():a.getDraggedY();if(this.pos==="left"||this.pos==="above"){d*=-1}this.fireEvent("resize",d);this.fireEvent("stopResize");this.isActive=false},getEl:function(){return this.el},addViewEvents:function(){this.view.addEvent("maximize",this.show.bind(this));this.view.addEvent("expand",this.show.bind(this));this.view.addEvent("minimize",this.hide.bind(this));this.view.addEvent("collapse",this.hide.bind(this));this.view.addEvent("hide",this.hide.bind(this));this.view.addEvent("show",this.show.bind(this))},show:function(){this.el.css("display","");this.hidden=false},hide:function(){this.hidden=true;this.el.css("display","none")},getWidth:function(){return this.hidden?0:5},getHeight:function(){return this.hidden?0:5},resize:function(a){this.el.css({left:"",top:"",right:"",bottom:""});if(a.width!==undefined&&a.width>0){this.el.css("width",a.width)}if(a.height!==undefined&&a.height>0){this.el.css("height",(a.height-ludo.dom.getMBPH(this.el)))}if(a.left!==undefined){this.el.css("left",a.left)}if(a.top!==undefined){this.el.css("top",a.top)}if(a.bottom!==undefined){this.el.css("bottom",a.bottom)}if(a.right!==undefined){this.el.css("right",a.right)}},getParent:function(){},setParentComponent:function(){},isVisible:function(){return !this.hidden},isHidden:function(){return this.hidden},hasChildren:function(){return false},isFormElement:function(){return false}});ludo.layout.Base=new Class({Extends:Events,view:null,tabStrip:null,resizables:[],benchmarkTime:false,dependency:{},viewport:undefined,resized:false,hasWrapWidth:undefined,hasWrapHeight:undefined,initialize:function(a){this.id=String.uniqueID();
this.view=a;this.viewport={top:parseInt(this.view.$b().css("padding-top")),left:parseInt(this.view.$b().css("padding-left")),width:0,height:0,bottom:0,right:0};if(a.$b()){this.onCreate()}this.hasWrapWidth=!a.layout.weight&&a.layout.width=="wrap";this.hasWrapHeight=!a.layout.weight&&a.layout.height=="wrap"},prepareForChildrenOnCreate:function(){},onCreate:function(){if(this.view.layout.collapseBar){this.addCollapseBars()}if(this.view.layout.listeners!=undefined){this.addEvents(this.view.layout.listeners)}this.fireEvent("create",[this,this.view])},addChild:function(j,g,h){j=this.getValidChild(j);j=this.getNewComponent(j);var f=this.getParentForNewChild(j);f=jQuery(f);if(g){var b=[];for(var a=0;a<this.view.children.length;a++){if(h=="after"){b.push(this.view.children[a]);f.append(this.view.children[a].getEl())}if(this.view.children[a].getId()==g.getId()){b.push(j);f.append(j.getEl())}if(h=="before"){b.push(this.view.children[a]);f.append(this.view.children[a].getEl())}}this.view.children=b}else{this.view.children.push(j);var d=j.getEl();f.append(d)}this.onNewChild(j);this.addChildEvents(j);this.fireEvent("addChild",[this,this.view,j]);if(this.firstResized){this.fireEvent("addChildRuntime",[this,this.view,j])}return j},getParentForNewChild:function(){return jQuery(this.view.els.body)},layoutProperties:["collapsed"],getValidChild:function(a){return a},onNewChild:function(d){var b=this.layoutProperties;for(var a=0;a<b.length;a++){if(d.layout[b[a]]===undefined&&d[b[a]]!==undefined){d.layout[b[a]]=d[b[a]]}}},addChildEvents:function(){},firstResized:false,resizeChildren:function(){if(this.benchmarkTime){var a=new Date().getTime()}if(this.view.isHidden()){return}if(this.idLastDynamic===undefined){this.setIdOfLastChildWithDynamicWeight()}this.storeViewPortSize();if(!this.firstResized){this.beforeFirstResize()}this.resize();if(!this.firstResized){this.firstResized=true;if(this.hasWrapHeight){this.view.layout.height=this.viewport.height=this.getWrappedHeight()}if(this.hasWrapWidth){this.view.layout.width=this.viewport.width=this.getWrappedWidth()}if(this.hasWrapHeight||this.hasWrapWidth){this.view.resize({height:this.view.layout.height,width:this.view.layout.width});this.storeViewPortSize();this.hasWrapWidth=false;this.hasWrapHeight=false}this.fireEvent("rendered",[this,this.view]);this.afterRendered()}if(this.benchmarkTime){ludo.util.log("Time for resize("+this.view.layout.type+"): "+(new Date().getTime()-a))}},afterRendered:function(){},hasBeenRendered:function(){return this.firstResized},beforeFirstResize:function(){},getWrappedHeight:function(){return this.view.getEl().outerHeight(true)-this.view.$b().height()},getWrappedWidth:function(){return 0},storeViewPortSize:function(){this.viewport.absWidth=this.getAvailWidth();this.viewport.absHeight=this.getAvailHeight();this.viewport.width=this.getAvailWidth();this.viewport.height=this.getAvailHeight()},previousContentWidth:undefined,idLastDynamic:undefined,setIdOfLastChildWithDynamicWeight:function(){for(var a=this.view.children.length-1;a>=0;a--){if(this.hasLayoutWeight(this.view.children[a])){this.idLastDynamic=this.view.children[a].id;return}}this.idLastDynamic="NA"},hasLayoutWeight:function(a){return a.layout!==undefined&&a.layout.weight!==undefined},getNewComponent:function(a){a.renderTo=this.view.$b();a.type=a.type||this.view.cType;a.parentComponent=this.view;return ludo.factory.create(a)},isLastSibling:function(b){var a=this.view.initialItemsObject;if(a.length){return a[a.length-1].id==b.id}else{return this.view.children[this.view.children.length-1].id==b.id}},prepareView:function(){},resize:function(){var a={};a.width=this.view.$b().width();if(a.width<0){a.width=undefined}for(var b=0;b<this.view.children.length;b++){this.view.children[b].resize(a)}},getAvailWidth:function(){return this.view.$b().width()},getAvailHeight:function(){return this.view.$b().height()},addCollapseBars:function(){var b=this.view.layout.collapseBar;if(!ludo.util.isArray(b)){b=[b]}for(var a=0;a<b.length;a++){this.addChild(this.getCollapseBar(b[a]))}},collapseBars:{},getCollapseBar:function(a){a=a||"left";if(this.collapseBars[a]===undefined){var b=this.collapseBars[a]=new ludo.layout.CollapseBar({position:a,parentComponent:this.view,parentLayout:this.view.layout,listeners:{show:this.toggleCollapseBar.bind(this),hide:this.toggleCollapseBar.bind(this)}});this.updateViewport(b.getChangedViewport())}return this.collapseBars[a]},toggleCollapseBar:function(a){this.updateViewport(a.getChangedViewport());this.resize()},updateViewport:function(a){if(a){this.viewport[a.key]=a.value}},createRenderer:function(){if(this.renderer===undefined){this.renderer=this.dependency.renderer=new ludo.layout.Renderer({view:this.view})}return this.renderer},getRenderer:function(){return this.renderer?this.renderer:this.createRenderer()},hideChild:function(a){this.setTemporarySize(a,{width:0,height:0})},minimize:function(b,a){this.setTemporarySize(b,a);this.resize()},setTemporarySize:function(b,a){if(a.width!==undefined){b.layout.cached_width=b.layout.width;
b.layout.width=a.width}else{b.layout.cached_height=b.layout.height;b.layout.height=a.height}},clearTemporaryValues:function(a){if(a){}if(a.layout.cached_width!==undefined){a.layout.width=a.layout.cached_width}if(a.layout.cached_height!==undefined){a.layout.height=a.layout.cached_height}a.layout.cached_width=undefined;a.layout.cached_height=undefined;this.resize()},getWidthOf:function(a){return a.layout.width},heightSizeForWrap:function(b){var a={width:this.viewport.width,height:this.viewport.height};jQuery.each(this.view.children,function(d,f){if(f.id!=b.id&&f.layout!=undefined&&!isNaN(f.layout.height)){a.height-=f.layout.height}});return a},getHeightOf:function(b){var a=b.wrappedHeight!=undefined?b.wrappedHeight(this.heightSizeForWrap(b)):undefined;if(a!=undefined){return a}if(b.layout.height=="wrap"){b.layout.height=b.getEl().outerHeight(true)}return isNaN(b.layout.height)?b.getEl().outerHeight(true):b.layout.height}});ludo.layout.Factory=new Class({getManager:function(a){return new ludo.layout[this.getLayoutClass(a)](a)},getLayoutClass:function(a){if(!a.layout||!a.layout.type){return"Base"}switch(a.layout.type.toLowerCase()){case"docking":return"Docking";case"accordion":return"Accordion";case"table":return"Table";case"navbar":return"NavBar";case"relative":return"Relative";case"fill":return"Fill";case"viewpager":return"ViewPager";case"card":return"Card";case"grid":return"Grid";case"menu":return["Menu",(a.layout.orientation&&a.layout.orientation.toLowerCase()=="horizontal")?"Horizontal":"Vertical"].join("");case"tabs":case"tab":return"Tab";case"column":case"cols":return"LinearHorizontal";case"popup":return"Popup";case"canvas":return"Canvas";case"rows":case"row":return"LinearVertical";case"linear":return["Linear",(a.layout.orientation&&a.layout.orientation.toLowerCase()=="horizontal")?"Horizontal":"Vertical"].join("");default:return"Base"}},getValidLayoutObject:function(a,d){a.layout=this.toLayoutObject(a.layout);d.layout=this.toLayoutObject(d.layout);if(!this.hasLayoutProperties(a,d)){return{}}var b=this.getMergedLayout(a.layout,d.layout);if(typeof b==="string"){b={type:b}}b=this.transferFromView(a,d,b);if(b.left===undefined&&b.x!==undefined){b.left=b.x}if(b.top===undefined&&b.y!==undefined){b.top=b.y}if(b.aspectRatio){if(b.width){b.height=Math.round(b.width/b.aspectRatio)}else{if(b.height){b.width=Math.round(b.height*b.aspectRatio)}}}b.type=b.type||"Base";return b},toLayoutObject:function(a){if(!a){return{}}if(ludo.util.isString(a)){return{type:a}}return a},hasLayoutProperties:function(a,b){if(a.layout||b.layout){return true}var f=["left","top","height","width","weight","x","y"];for(var d=0;d<f.length;d++){if(b[f[d]]!==undefined||a[f[d]]!==undefined){return true}}return false},transferFromView:function(a,d,b){var g=["left","top","width","height","weight","x","y"];for(var f=0;f<g.length;f++){if(b[g[f]]===undefined&&(d[g[f]]!==undefined||a[g[f]]!==undefined)){b[g[f]]=d[g[f]]||a[g[f]]}a[g[f]]=undefined}return b},getMergedLayout:function(d,b){for(var a in b){if(b.hasOwnProperty(a)){d[a]=b[a]}}return d}});ludo.layoutFactory=new ludo.layout.Factory();ludo.dataSource.Base=new Class({Extends:ludo.Core,singleton:false,url:undefined,postData:undefined,data:undefined,autoload:true,method:"post",inLoadMode:false,dataHandler:undefined,shim:undefined,__waiting:false,__construct:function(a){this.parent(a);if(a.data!=undefined){this.autoload=false}this.setConfigParams(a,["method","url","autoload","shim","dataHandler"]);this.on("init",this.setWaiting.bind(this));this.on("complete",this.setDone.bind(this));if(this.postData==undefined){this.postData={}}if(a.postData!=undefined){this.postData=Object.merge(this.postData,a.postData)}if(this.dataHandler==undefined){this.dataHandler=function(b){return jQuery.isArray(b)?b:b.response!=undefined?b.response:b.data!=undefined?b.data:false}}if(a.data!=undefined){this.setData(a.data)}},setWaiting:function(){this.__waiting=true},setDone:function(){this.__waiting=false},isWaitingData:function(){return this.__waiting},setPostData:function(a,b){this.postData[a]=b},ludoEvents:function(){if(this.autoload){this.load()}},sendRequest:function(a){this.arguments=arguments;this.beforeLoad();this.fireEvent("init",this)},setData:function(a){},hasData:function(){return(this.data!==undefined)},getData:function(){return this.data},setPostParam:function(b,a){this.postData[b]=a},getSourceType:function(){return"JSON"},beforeLoad:function(){this.inLoadMode=true;this.fireEvent("beforeload")},load:function(){},loadUrl:function(a){this.url=a;this._request=undefined;this.load()},parseNewData:function(){this.inLoadMode=false},isLoading:function(){return this.inLoadMode},getPostData:function(){return this.postData}});ludo.dataSource.JSON=new Class({Extends:ludo.dataSource.Base,type:"dataSource.JSON",_loaded:false,load:function(){if(this._url()){this.parent();this.sendRequest(this.getPostData())}},_url:function(){return this.url||ludo.config.getUrl()},sendRequest:function(a){this.parent();jQuery.ajax({url:this._url(),method:"post",cache:false,dataType:"json",data:a,complete:function(d,b){this._loaded=true;
if(b=="success"){var f=d.responseJSON;var g=this.dataHandler(f);if(g===false){this.fireEvent("fail",["error","error",this])}else{this.parseNewData(g,f);this.fireEvent("success",[f,this])}}else{this.fireEvent("fail",[d.responseText,b,this])}this.fireEvent("complete")}.bind(this),fail:function(d,b){console.log("error",b);this.fireEvent("fail",[d,b,this]);this.fireEvent("complete")}.bind(this)})},setData:function(a){this.parseNewData(a)},parseNewData:function(a){this.parent();var b=!this.data;this.data=a;this.fireEvent("parsedata");this.fireEvent("load",[this.data,this]);if(b){this.fireEvent("firstLoad",[this.data,this])}}});ludo.factory.registerClass("dataSource.JSON",ludo.dataSource.JSON);ludo.layout.Renderer=new Class({view:undefined,options:["width","height","rightOf","leftOf","below","above","sameHeightAs","sameWidthAs","offsetWidth","offsetHeight","rightOrLeftOf","leftOrRightOf","alignLeft","alignRight","alignTop","alignBottom","centerIn","left","top","offsetX","offsetY","fitVerticalViewPort"],fn:undefined,viewport:{x:0,y:0,width:0,height:0},coordinates:{left:undefined,right:undefined,above:undefined,below:undefined,width:undefined,height:undefined},lastCoordinates:{},initialize:function(a){this.view=a.view;this.fixReferences();this.setDefaultProperties();this.view.addEvent("show",this.resize.bind(this));ludo.dom.clearCache();this.addResizeEvent();if(this.view.getLayout!=undefined){this.view.getLayout().on("addChild",this.clearFn.bind(this))}this.view.on("addChild",this.clearFn.bind(this));this.view.on("remove",this.removeEvents.bind(this))},fixReferences:function(){var f;var g=false;for(var d=0;d<this.options.length;d++){var b=this.options[d];switch(b){case"offsetX":case"offsetY":case"width":case"height":case"left":case"top":case"fitVerticalViewPort":break;default:f=undefined;if(this.view.layout[b]!==undefined){g=true;var h=this.view.layout[b];if(typeof h==="string"){var a;if(h==="parent"){a=this.view.getParent()}else{a=ludo.get(h)}if(a){f=a.getEl();a.addEvent("resize",this.clearFn.bind(this))}else{f=jQuery(h)}}else{if(h.getEl!==undefined){f=h.getEl();h.addEvent("resize",this.clearFn.bind(this))}else{f=jQuery(h)}}if(f){this.view.layout[b]=f}else{this.view.layout[b]=undefined}}}}if(g){this.view.getEl().css("position","absolute")}},setDefaultProperties:function(){this.view.layout.width=this.view.layout.width||"matchParent";this.view.layout.height=this.view.layout.height||"matchParent"},resizeFn:undefined,addResizeEvent:function(){if(this.view.isWindow){return}this.resizeFn=this.resize.bind(this);jQuery(window).on("resize",this.resizeFn)},getParentNode:function(){var a=this.view.getEl().parent();if(!a||!a.prop("tagName")){return}if(a.prop("tagName").toLowerCase()!=="body"){a=jQuery(a)}else{a=jQuery(window)}return a},removeEvents:function(){if(this.resizeFn){jQuery(window).off("resize",this.resizeFn)}},buildResizeFn:function(){var d=this.view.getEl().parent();if(!d){this.fn=function(){}}var b=[];var f=[];for(var a=0;a<this.options.length;a++){if(this.view.layout[this.options[a]]!==undefined){b.push(this.getFnFor(this.options[a],this.view.layout[this.options[a]]));f.push(this.options[a])}}this.fn=function(){for(a=0;a<b.length;a++){b[a].call(this,this.view,this)}}},getFnFor:function(d,f){var g=this.coordinates;switch(d){case"height":if(f==="matchParent"){return function(h,j){g.height=j.viewport.height}}if(f==="wrap"){var b=ludo.dom.getWrappedSizeOfView(this.view);this.view.layout.height=b.y;return function(){g.height=b.y}}if(f.indexOf!==undefined&&f.indexOf("%")>0){f=parseInt(f);return function(h,j){g.height=(j.viewport.height*f/100)}}return function(){g.height=this.view.layout[d]}.bind(this);case"width":if(f==="matchParent"){return function(h,j){g.width=j.viewport.width}}if(f==="wrap"){var a=ludo.dom.getWrappedSizeOfView(this.view);this.view.layout.width=a.x;return function(){g.width=a.x}}if(f.indexOf!==undefined&&f.indexOf("%")>0){f=parseInt(f);return function(h,j){g.width=(j.viewport.width*f/100)}}return function(){g.width=this.view.layout[d]}.bind(this);case"rightOf":return function(){g.left=f.offset().left+f.outerWidth()};case"leftOf":return function(){g.left=f.offset().left-g.width};case"leftOrRightOf":return function(){var h=f.offset().left-g.width;if(h-g.width<0){h+=(f.outerWidth()+g.width)}g.left=h};case"rightOrLeftOf":return function(h,j){var k=f.offset().left+f.outerWidth();if(k+g.width>j.viewport.width){k-=(f.outerWidth()+g.width)}g.left=k};case"above":return function(h,j){g.top=f.offset().top-g.height};case"below":return function(){g.top=f.offset().top+f.height()};case"alignLeft":return function(){g.left=f.offset().left};case"alignTop":return function(){g.top=f.offset().top};case"alignRight":return function(){g.left=f.offset().left+f.outerWidth()-g.width};case"alignBottom":return function(){g.top=f.offset().top+f.outerHeight()-g.height};case"offsetX":return function(){g.left=g.left?g.left+f:f};case"offsetY":return function(){g.top=g.top?g.top+f:f};case"sameHeightAs":return function(){g.height=f.height()
};case"offsetWidth":return function(){g.width=g.width+f};case"offsetHeight":return function(){g.height=g.height+f};case"centerIn":return function(){f=f.getEl!=undefined?f.getEl():f;var h=f.offset();g.top=(h.top+(f.height()/2))-(g.height/2);g.left=(h.left+f.outerWidth()/2)-(g.width/2)};case"centerHorizontalIn":return function(){g.left=(f.offset().left+f.outerWidth())/2-(g.width/2)};case"centerVerticalIn":return function(){g.top=(f.offset().top+(f.height()/2))-(g.height/2)};case"sameWidthAs":return function(){g.width=f.outerWidth()};case"x":case"left":return function(){g.left=this.view.layout[d]}.bind(this);case"y":case"top":return function(){g.top=this.view.layout[d]}.bind(this);case"fitVerticalViewPort":return function(h,j){if(g.height){var k=g.top!==undefined?g.top:h.getEl().offset().top;if(k+g.height>j.viewport.height-2){g.top=j.viewport.height-g.height-2}}};default:return function(){}}},posKeys:["left","right","top","bottom"],clearFn:function(){this.fn=undefined},resize:function(){if(this.view.isHidden()){return}if(this.fn===undefined){this.buildResizeFn()}this.setViewport();this.fn.call(this);var d=this.coordinates;this.view.resize(d);if(d.bottom){d.top=undefined}if(d.right){d.left=undefined}for(var b=0;b<this.posKeys.length;b++){var a=this.posKeys[b];if(this.coordinates[a]!==undefined&&this.coordinates[a]!==this.lastCoordinates[a]){this.view.getEl().css(a,d[a])}}this.lastCoordinates=Object.clone(d)},resizeChildren:function(){if(this.view.children.length>0){this.view.getLayout().resizeChildren()}},setViewport:function(){if(!this.view.getEl||!this.view.getEl()){console.trace();console.log(this.view);return}var a=this.view.getEl().parent();if(!a){return}this.viewport.width=a.width();this.viewport.height=a.height()},getMinWidth:function(){return this.view.layout.minWidth||5},getMinHeight:function(){return this.view.layout.minHeight||5},getMaxHeight:function(){return this.view.layout.maxHeight||5000},getMaxWidth:function(){return this.view.layout.maxWidth||5000},setPosition:function(a,b){if(a!==undefined&&a>=0){this.coordinates.left=this.view.layout.left=a;this.view.getEl().css("left",a);this.lastCoordinates.left=a}if(b!==undefined&&b>=0){this.coordinates.top=this.view.layout.top=b;this.view.getEl().css("top",b);this.lastCoordinates.top=b}},setSize:function(a){if(a.left){this.coordinates.left=this.view.layout.left=a.left}if(a.top){this.coordinates.top=this.view.layout.top=a.top}if(a.width){this.view.layout.width=this.coordinates.width=a.width}if(a.height){this.view.layout.height=this.coordinates.height=a.height}this.resize()},position:function(){return{x:this.coordinates.left,y:this.coordinates.top}},getSize:function(){return{x:this.coordinates.width,y:this.coordinates.height}},setValue:function(a,b){this.view.layout[a]=b},getValue:function(a){return this.view.layout[a]}});ludo.tpl.Parser=new Class({Extends:ludo.Core,type:"tpl.Parser",compiledTpl:undefined,getCompiled:function(b,g){if(!ludo.util.isArray(b)){b=[b]}var f=[];g=this.getCompiledTpl(g);for(var h=0;h<b.length;h++){var l=[];for(var d=0;d<g.length;d++){var a=g[d]["key"];if(a){l.push(b[h][a]?b[h][a]:"")}else{l.push(g[d])}}f.push(l.join(""))}return f},getCompiledTpl:function(d){if(!this.compiledTpl){this.compiledTpl=[];var g=d.indexOf("{");var b=0;while(g>=0&&b!=-1){if(g>b){var f=b===0?b:b+1;var a=b===0?g-b:g-b-1;this.compiledTpl.push(d.substr(f,a))}b=d.indexOf("}",g);if(b!=-1){this.compiledTpl.push({key:d.substr(g,b-g).replace(/[{}"]/g,"")})}g=d.indexOf("{",b)}if(b!=-1&&b<d.length){this.compiledTpl.push(d.substr(b+1))}}return this.compiledTpl},asString:function(b,a){return this.getCompiled(b,a).join("")},getTplValue:function(a,b){return b}});ludo.dom={cache:{PW:{},PH:{},BW:{},BH:{},MW:{},MH:{}},getMW:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.MW[a.id]===undefined){ludo.dom.cache.MW[a.id]=ludo.dom.getNumericStyle(a,"margin-left")+ludo.dom.getNumericStyle(a,"margin-right")}return ludo.dom.cache.MW[a.id]},getBW:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.BW[a.id]===undefined){ludo.dom.cache.BW[a.id]=ludo.dom.getNumericStyle(a,"border-left-width")+ludo.dom.getNumericStyle(a,"border-right-width")}return ludo.dom.cache.BW[a.id]},getPW:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.PW[a.id]===undefined){ludo.dom.cache.PW[a.id]=ludo.dom.getNumericStyle(a,"padding-left")+ludo.dom.getNumericStyle(a,"padding-right")}return ludo.dom.cache.PW[a.id]},getMH:function(a){this.addId(a);var b=a.attr("id");if(ludo.dom.cache.MH[b]===undefined){ludo.dom.cache.MH[b]=ludo.dom.getNumericStyle(a,"margin-top")+ludo.dom.getNumericStyle(a,"margin-bottom")}return ludo.dom.cache.MH[b]},getBH:function(a){this.addId(a);var b=a.attr("id");if(ludo.dom.cache.BH[b]===undefined){ludo.dom.cache.BH[b]=ludo.dom.getNumericStyle(a,"border-top-width")+ludo.dom.getNumericStyle(a,"border-bottom-width")}return ludo.dom.cache.BH[b]},getPH:function(a){this.addId(a);var b=a.attr("id");if(ludo.dom.cache.PH[b]===undefined){ludo.dom.cache.PH[b]=ludo.dom.getNumericStyle(a,"padding-top")+ludo.dom.getNumericStyle(a,"padding-bottom")
}return ludo.dom.cache.PH[b]},getMBPW:function(a){return ludo.dom.getPW(a)+ludo.dom.getMW(a)+ludo.dom.getBW(a)},getMBPH:function(a){return ludo.dom.getPH(a)+ludo.dom.getMH(a)+ludo.dom.getBH(a)},addId:function(a){if(!a.attr("id")){a.attr("id",String.uniqueID())}},clearCache:function(){ludo.dom.cache={PW:{},PH:{},BW:{},BH:{},MW:{},MH:{}}},getNumericStyle:function(b,a){if(!b||!a||!b.css){return 0}var d=b.css(a);return d&&d!="thin"&&d!="auto"&&d!="medium"?parseInt(d):0},isInFamilies:function(d,b){for(var a=0;a<b.length;a++){if(ludo.dom.isInFamily(d,b[a])){return true}}return false},isInFamily:function(a,b){a=jQuery(a);if(a.attr("id")===b){return true}return a.parent("#"+b)},addClass:function(b,a){console.info("Use of deprecated ludo.dom.addClass");console.trace();if(b&&!this.hasClass(b,a)){if(b.attr!=undefined){b.addClass(a)}else{b.className=b.className?b.className+" "+a:a}}},hasClass:function(d,b){console.info("use of deprecated ludo.dom.hasClass");console.trace();if(d.attr!=undefined){return d.hasClass(b)}var a=d.attr!=undefined?d.attr("class"):d.className;return d&&a?a.split(/\s/g).indexOf(b)>-1:false},removeClass:function(b,a){console.info("use of deprecated ludo.dom.removeClass");console.trace();b.removeClass(a)},getParent:function(b,a){b=b.parentNode;while(b&&!ludo.dom.hasClass(b,a)){b=b.parentNode}return b},scrollIntoView:function(g,d){var k=d.getEl();var f=d.$b();var b=k.offsetHeight-ludo.dom.getPH(k)-ludo.dom.getBH(k)-ludo.dom.getMBPH(f);var j=g.getPosition(f).y;var h=(j+20)-(k.scrollTop+b);if(h>0){f.scrollTop+=h}var a=k.scrollTop-j;if(a>0){f.scrollTop-=a}},size:function(a){return{x:a.width(),y:a.height()}},getWrappedSizeOfView:function(f){f.getEl().css("height","auto");f.$b().css("height","auto");var h=f.getEl();var d=f.$b();d.css("position","absolute");var g=d.outerWidth();d.css("position","relative");var a=d.outerHeight();return{x:g+ludo.dom.getMBPW(h),y:a+ludo.dom.getMBPH(h)+(f.getHeightOfTitleBar?f.getHeightOfTitleBar():0)}},getMeasuredWidth:function(a){var d=a.$b();var b=d.measure(function(){return this.getSize()});return b.x+ludo.dom.getMW(d)},create:function(b){console.info("use of deprecated ludo.dom.create");console.trace();var a=jQuery("<"+(b.tag||"div")+">");if(b.cls){a.addClass(b.cls)}if(b.renderTo){jQuery(b.renderTo).append(a)}if(b.css){a.css(b.css)}if(b.id){a.attr("id",b.id)}if(b.html){a.html(b.html)}return a}};ludo.view.Shim=new Class({txt:"Loading content...",el:undefined,shim:undefined,renderTo:undefined,initialize:function(a){if(a.txt){this.txt=a.txt}this.renderTo=a.renderTo},getEl:function(){if(this.el===undefined){this.el=jQuery('<div class="ludo-shim-loading" style="display:none">'+this.getText(this.txt)+"</div>");this.getRenderTo().append(this.el)}return this.el},getShim:function(){if(this.shim===undefined){if(ludo.util.isString(this.renderTo)){this.renderTo=ludo.get(this.renderTo).getEl()}this.shim=jQuery('<div class="ludo-loader-shim" style="display:none"></div>');this.getRenderTo().append(this.shim)}return this.shim},getRenderTo:function(){if(ludo.util.isString(this.renderTo)){var a=ludo.get(this.renderTo);if(!a){return undefined}this.renderTo=ludo.get(this.renderTo).getEl()}return this.renderTo},show:function(a){this.getEl().html(this.getText((a&&!ludo.util.isObject(a))?a:this.txt));this.css("");this.resizeShim()},resizeShim:function(){var b=jQuery(this.el).find("span");var a=(b.width()+5);this.el.css("width",a+"px");this.el.css("marginLeft",(Math.round(a/2)*-1)+"px")},getText:function(a){a=ludo.util.isFunction(a)?a.call():a?a:"";return"<span>"+a+"</span>"},hide:function(){this.css("none")},css:function(a){this.getShim().css("display",a);this.getEl().css("display",a===""&&this.txt?"":"none")}});ludo.remote.Shim=new Class({Extends:ludo.view.Shim,initialize:function(a){this.parent(a);this.addShowHideEvents(a.remoteObj)},addShowHideEvents:function(a){if(a){a.addEvents({start:this.show.bind(this),complete:this.hide.bind(this)})}}});ludo.View=new Class({Extends:ludo.Core,type:"View",cType:"View",cls:"",bodyCls:"",cssSignature:undefined,closable:true,minimizable:false,movable:false,resizable:false,alwaysInFront:false,statefulProperties:["layout"],els:{},state:{},defaultDS:"dataSource.JSON",tagBody:"div",id:null,children:[],child:{},dataSource:undefined,parentComponent:null,objMovable:null,width:undefined,height:undefined,overflow:undefined,_html:"",hidden:false,css:undefined,elCss:undefined,formConfig:undefined,isRendered:false,unRenderedChildren:[],frame:false,form:undefined,layout:undefined,tpl:"",JSONParser:{type:"tpl.Parser"},initialItemsObject:[],contextMenu:undefined,lifeCycleComplete:false,loadMessage:undefined,lifeCycle:function(a){this._createDOM();if(!a.children){a.children=this.children;this.children=[]}this.__construct(a);if(!a.children||!a.children.length){a.children=this.__children()}if(this.hidden){this.unRenderedChildren=a.children}else{this.remainingLifeCycle(a)}},__children:function(){return this.children},remainingLifeCycle:function(a){if(this.lifeCycleComplete){return
}if(!a&&this.unRenderedChildren){a={children:this.unRenderedChildren}}this.lifeCycleComplete=true;this._styleDOM();if(a.children&&a.children.length>0){this.getLayout().prepareForChildrenOnCreate(a.children);for(var b=0;b<a.children.length;b++){a.children[b].id=a.children[b].id||a.children[b].name||"ludo-"+String.uniqueID()}this.initialItemsObject=a.children;this.addChildren(a.children)}this.ludoDOM();this.ludoCSS();this.ludoEvents();this.increaseZIndex();if(this.layout&&this.layout.type&&(this.layout.type=="tabs"||this.layout.type=="docking")){this.getLayout().prepareView()}this.addCoreEvents();this.__rendered();if(!this.parentComponent){ludo.dom.clearCache();ludo.dom.clearCache.delay(50,this);var d=this.getLayout().getRenderer();d.resize()}this.fireEvent("render",this)},__construct:function(a){this.parent(a);a.els=a.els||{};if(this.parentComponent){a.renderTo=undefined}var b=["contextMenu","renderTo","tpl","elCss","form","title","hidden","dataSource","movable","resizable","closable","minimizable","alwaysInFront","parentComponent","cls","bodyCls","objMovable","width","height","frame","formConfig","overflow","loadMessage"];if(a.css!=undefined){if(this.css!=undefined){this.css=Object.merge(this.css,a.css)}else{this.css=a.css}}if(a.html!=undefined){this._html=a.html}this.setConfigParams(a,b);if(this.renderTo){this.renderTo=jQuery(this.renderTo)}this.layout=ludo.layoutFactory.getValidLayoutObject(this,a);this.insertDOMContainer()},insertDOMContainer:function(){if(this.hidden){this.els.container.css("display","none")}if(this.renderTo){this.renderTo.append(this.els.container)}},ludoDOM:function(){if(this.contextMenu){if(!ludo.util.isArray(this.contextMenu)){this.contextMenu=[this.contextMenu]}for(var a=0;a<this.contextMenu.length;a++){this.contextMenu[a].applyTo=this;this.contextMenu[a].contextEl=this.isFormElement()?this.getFormEl():this.getEl();new ludo.menu.Context(this.contextMenu[a])}this.contextMenu=undefined}},ludoCSS:function(){},ludoEvents:function(){if(this.dataSource){this.getDataSource()}},__rendered:function(){if(!this.layout.height&&!this.layout.above&&!this.layout.sameHeightAs&&!this.layout.alignWith){this.autoSetHeight()}if(!this.parentComponent){this.getEl().addClass("ludo-view-top")}if(!this.parentComponent){this.getLayout().createRenderer()}this.isRendered=true;if(this.form){this.getForm()}},JSON:function(b,a){a=a||this.tpl;if(a){if(jQuery.isFunction(a)){this.$b().html(a.call(this,b))}else{this.$b().html(this.getTplParser().asString(b,a))}}},getTplParser:function(){if(!this.tplParser){this.tplParser=this.createDependency("tplParser",this.JSONParser)}return this.tplParser},autoSetHeight:function(){var a=this.$b().outerHeight(true);this.layout.height=a+ludo.dom.getMBPH(this.getEl())},html:function(a){this.$b().html(a)},setContent:function(){if(this._html){if(this.children.length){var a=jQuery("<div>"+this._html+"</div>");this.$b().append(a)}else{this.$b().html(this._html)}}},load:function(){this.fireEvent("beforeload",[this.getUrl(),this]);if(this.dataSource){this.getDataSource().load()}},getParent:function(){return this.parentComponent?this.parentComponent:null},setParentComponent:function(a){this.parentComponent=a},_createDOM:function(){this.els.container=jQuery("<div>");this.els.body=jQuery("<"+this.tagBody+">");this.els.container.append(this.els.body)},_styleDOM:function(){var a=this.els.body;var d=this.els.container;d.addClass("ludo-view");a.addClass("ludo-body");d.attr("id",this.getId());a.css("height","100%");if(this.overflow=="hidden"){a.css("overflow","hidden")}if(ludo.util.isTabletOrMobile()){d.addClass("ludo-view-mobile")}if(this.cls){d.addClass(this.cls)}if(this.bodyCls){a.addClass(this.bodyCls)}if(this.type){d.addClass("ludo-"+(this.type.replace(/\./g,"-").toLowerCase()))}if(this.css){a.css(this.css)}if(this.elCss){d.css(this.elCss)}if(this.frame){d.addClass("ludo-container-frame");a.addClass("ludo-body-frame")}if(this.cssSignature!==undefined){d.addClass(this.cssSignature)}this.setContent()},addCoreEvents:function(){if(!this.getParent()&&this.type!=="Application"){this.getEl().on("mousedown",this.increaseZIndex.bind(this))}},increaseZIndex:function(a){if(a&&a.target&&a.target.tagName.toLowerCase()=="a"){return}this.fireEvent("activate",this);this.fireEvent("toFront",this);this.setNewZIndex()},setNewZIndex:function(){this.getEl().css("zIndex",ludo.util.getNewZIndex(this))},getEl:function(){return this.els.container?this.els.container:null},$b:function(){return this.els.body},getBody:function(){return this.els.body},hide:function(){if(!this.hidden&&this.getEl().css("display")!=="none"){this.getEl().css("display","none");this.hidden=true;this.resizeParent();this.fireEvent("hide",this)}},isHidden:function(){return this.hidden},isVisible:function(){return !this.hidden},show:function(a){if(this.els.container.css("display")==="none"){this.els.container.css("display","");this.hidden=false}if(!this.lifeCycleComplete){this.remainingLifeCycle()}if(!a){this.fireEvent("beforeshow",this)}this.setNewZIndex();
if(!this.parentComponent){this.getLayout().getRenderer().resize()}if(!a){this.fireEvent("show",this)}},resizeParent:function(){var a=this.getParent();if(a){if(a.children.length>0){a.getLayout().resizeChildren()}}},showChild:function(a){var b=this.getChild(a);if(b){b.show();return true}return false},getChildren:function(){return this.children},getAllChildren:function(){var a=[];for(var b=0;b<this.children.length;b++){a.push(this.children[b]);if(this.children[b].hasChildren()){a=a.append(this.children[b].getChildren())}}return a},hasChildren:function(){return this.children.length>0},setTitle:function(a){this.title=a;this.fireEvent("setTitle",[a,this])},getWidth:function(){return this.layout.pixelWidth?this.layout.pixelWidth:this.layout.width?this.layout.width:this.$b().width()},getHeight:function(){return this.layout.pixelHeight?this.layout.pixelHeight:this.layout.height},_fr:false,resize:function(f){if(this.isHidden()){return}var b=this.layout;f=f||{};if(f.width){if(b.aspectRatio&&b.preserveAspectRatio&&f.width&&!this.isMinimized()){f.height=f.width/b.aspectRatio}b.pixelWidth=f.width;if(!isNaN(b.width)){b.width=f.width}var a=f.width-ludo.dom.getMBPW(this.els.container);if(a>0){this.els.container.css("width",a)}}if(f.height&&!this.state.isMinimized){if(!this.state.isMinimized){b.pixelHeight=f.height;if(!isNaN(b.height)){b.height=f.height}}var d=f.height-ludo.dom.getMBPH(this.els.container);if(d>0){this.els.container.css("height",d)}}if(f.left!==undefined||f.top!==undefined){this.setPosition(f)}this.resizeDOM();if(f.height||f.width){this.fireEvent("resize",f)}if(this._fr==false){this.fireEvent("rendered",this);this._fr=true}if(this.children.length>0){this.getLayout().resizeChildren()}},isChildOf:function(a){var b=this.parentComponent;while(b){if(b.id===a.id){return true}b=b.parentComponent}return false},setPosition:function(a){if(a.left!==undefined&&a.left>=0){this.els.container.css("left",a.left)}if(a.top!==undefined&&a.top>=0){this.els.container.css("top",a.top)}},getLayout:function(){if(!this.hasDependency("layoutManager")){this.createDependency("layoutManager",ludo.layoutFactory.getManager(this))}return this.getDependency("layoutManager")},resizeChildren:function(){if(this.children.length>0){this.getLayout().resizeChildren()}},isMinimized:function(){return false},resizeDOM:function(){if(this.layout.pixelHeight>0){var a=this.layout.pixelHeight?this.layout.pixelHeight-ludo.dom.getMBPH(this.els.container):this.els.container.css("height").replace("px","");a-=ludo.dom.getMBPH(this.els.body);if(a<=0||isNaN(a)){return}this.els.body.css("height",a)}},addChildren:function(d){var a=[];for(var b=0,f=d.length;b<f;b++){a.push(this.addChild(d[b]))}return a},addChild:function(d,a,b){d=this.getLayout().addChild(d,a,b);if(d.name){this.child[d.name]=d}d.addEvent("remove",this.removeChild.bind(this));return d},getChild:function(a){for(var b=0;b<this.children.length;b++){if(this.children[b].id==a||this.children[b].name==a){return this.children[b]}}return undefined},removeChild:function(a){this.children.erase(a);a.parentComponent=null},disposeAllChildren:function(){for(var a=this.children.length-1;a>=0;a--){this.children[a].remove()}},remove:function(){this.fireEvent("remove",this);ludo.util.dispose(this)},dispose:function(){console.warn("Use of deprecated dispose");console.trace();this.fireEvent("remove",this);ludo.util.dispose(this)},getTitle:function(){return this.title},dataSourceObj:undefined,getDataSource:function(){if(!this.dataSourceObj&&this.dataSource){var a;if(ludo.util.isString(this.dataSource)){a=this.dataSourceObj=ludo.get(this.dataSource)}else{if(!this.dataSource.type){this.dataSource.type=this.defaultDS}a=this.dataSourceObj=this.createDependency("viewDataSource",this.dataSource)}if(this.loadMessage){a.on("init",function(){this.shim().show(this.loadMessage)}.bind(this));a.on("complete",function(){this.shim().hide()}.bind(this));if(a.isWaitingData()){this.shim().show(this.loadMessage)}}var b=a.getSourceType()==="HTML"?"html":"JSON";if(a.hasData()){this[b](a.getData())}a.addEvent("load",this[b].bind(this))}return this.dataSourceObj},_shim:undefined,shim:function(){if(this._shim===undefined){this._shim=new ludo.view.Shim({txt:"",renderTo:this.getEl()})}return this._shim},getForm:function(){if(!this.hasDependency("formManager")){this.createDependency("formManager",{type:"ludo.form.Manager",view:this,form:this.form})}return this.getDependency("formManager")},getParentForm:function(){var a=this.getParent();return a?a.hasDependency("formManager")?a.getDependency("formManager"):a.getParentForm():undefined},isFormElement:function(){return false},getHeightOfButtonBar:function(){return 0},svg:function(){if(this.canvas===undefined){this.canvas=this.createDependency("canvas",new ludo.svg.Canvas({renderTo:this}))}return this.canvas},canvas:undefined,wrappedWidth:function(){return undefined},wrappedHeight:function(){return undefined}});ludo.factory.registerClass("View",ludo.View);ludo.remote.Message=new Class({Extends:ludo.View,cls:"ludo-remote-message",listenTo:[],messageTypes:["success","failure","error"],__construct:function(a){this.parent(a);
this.setConfigParams(a,["listenTo"]);if(!ludo.util.isArray(this.listenTo)){this.listenTo=[this.listenTo]}this.validateListenTo()},validateListenTo:function(){for(var a=0;a<this.listenTo.length;a++){this.listenTo[a]=this.listenTo[a].replace(/\//g,".")}},ludoEvents:function(){this.parent();var b=this.getResources();for(var a in b){if(b.hasOwnProperty(a)){this.addResourceEvent(a,b[a])}}},getResources:function(){var b={};var f,a;for(var d=0;d<this.listenTo.length;d++){if(this.listenTo[d].indexOf(".")>=0){var g=this.listenTo[d].split(/\./g);if(g.length===2){a=g.pop();f=g[0];a=a!="*"?a:undefined}}else{f=this.listenTo[d];a=undefined}if(b[f]==undefined){b[f]=[]}if(a&&b[f].indexOf(a)===-1){b[f].push(a)}}return b},addResourceEvent:function(d,a){ludo.remoteBroadcaster.addServiceEvent("clear",d,a,this.hideMessage.bind(this));for(var b=0;b<this.messageTypes.length;b++){ludo.remoteBroadcaster.addServiceEvent(this.messageTypes[b],d,a,this.showMessage.bind(this))}},showMessage:function(a){this.show();if(a.code&&a.code!==200){this.getEl().addClass("ludo-remote-error-message")}else{this.getEl().removeClass("ludo-remote-error-message")}this.html(a.message);this.fireEvent("showMessage",this)},hideMessage:function(){this.html("")}});ludo.remote.ErrorMessage=new Class({Extends:ludo.remote.Message,messageTypes:["failure","serverError"]});ludo.svg.Effect=new Class({fps:33,fly:function(b,a,g,d){var f=this.getTranslate(b);this.execute("translate",b,[f.x,f.y],[f.y+a,f.y+g],d)},flyBack:function(a,b){var d=this.getTranslate(a);this.execute("translate",a,[d.x,d.y],[0,0],b)},getTranslate:function(b){var a=ludo.svg.getTransformation(b,"translate");if(!a){a={x:0,y:0}}return a},execute:function(f,d,h,b,g){g=g||0.25;var a=this.getEffectConfig(h,b,g);this.executeStep(f,d,h,a.steps,a.count,0)},executeStep:function(h,f,j,b,a,g){for(var d=0;d<b.length;d++){j[d]+=b[d]}ludo.svg.setTransformation(f,h,j.join(" "));g++;if(g<a){this.executeStep.delay(this.fps,this,[h,f,j,b,a,g])}},getEffectConfig:function(h,b,g){if(!ludo.util.isArray(h)){h=[h]}if(!ludo.util.isArray(b)){b=[b]}var a=Math.round(g*this.fps);var d=[];for(var f=0;f<h.length;f++){d.push((b[f]-h[f])/a)}return{steps:d,count:a}}});ludo.dataSource.Record=new Class({Extends:Events,record:undefined,collection:undefined,eventKeys:undefined,initialize:function(a,b){this.record=a;this.collection=b},set:function(a,b){this.fireEvent("beforeUpdate",this.record);this.record[a]=b;if(!this.eventKeys||this.eventKeys.indexOf(a)>=0){this.fireEvent("update",this.record)}return this},get:function(a){return this.record[a]},setProperties:function(b){this.fireEvent("beforeUpdate",this.record);for(var a in b){if(b.hasOwnProperty(a)){this.record[a]=b[a]}}this.fireEvent("update",[this.record,undefined,"update"]);return this},addChild:function(a){a=this.getPlainRecord(a);this.record.children=this.record.children||[];this.record.children.push(a);if(a.parentUid){var b=this.collection.getRecord(a.parentUid);if(b){b.removeChild(a)}}this.fireEvent("addChild",[a,this.record,"addChild"]);return this},getParent:function(){return this.collection.getRecord(this.record.parentUid)},getCollection:function(){return this.collection},isRecordObject:function(a){return a.initialize!==undefined&&a.record!==undefined},getChildren:function(){return this.record.children},removeChild:function(a){a=this.getPlainRecord(a);var b=this.record.children.indexOf(a);if(b>=0){this.record.children.splice(b,1);this.fireEvent("removeChild",[a,this.record,"removeChild"])}},getPlainRecord:function(a){return this.isRecordObject(a)?a.record:a},select:function(){this.fireEvent("select",this)},insertBefore:function(a,b){if(this.inject(a,b)){this.fireEvent("insertBefore",[a,b,"insertBefore"])}},insertAfter:function(a,b){if(this.inject(a,b,1)){this.fireEvent("insertAfter",[a,b,"insertAfter"])}},inject:function(a,f,g){g=g||0;a=this.getPlainRecord(a);f=this.getPlainRecord(f);if(a===f){return false}if(a.parentUid){var d=this.collection.getRecord(a.parentUid);if(d){if(this.isMyChild(a)){this.record.children.splice(this.getChildIndex(a),1)}else{d.removeChild(a)}}}var b=this.record.children.indexOf(f);if(b!==-1){this.record.children.splice(b+g,0,a);return true}return false},getChildIndex:function(a){return this.record.children?this.record.children.indexOf(this.getPlainRecord(a)):-1},isMyChild:function(a){return this.record.children&&this.record.children.indexOf(this.getPlainRecord(a))!==-1},getUID:function(){return this.record.uid},getData:function(){return this.record},dispose:function(){this.fireEvent("remove",this.record);delete this.record}});ludo.chart.Record=new Class({Extends:ludo.dataSource.Record,eventKeys:["value","label"],getStartPercent:function(){var a=this.getCollection();return a.getSumOf(0,a.indexOf(this)-1)/a.getSum()*100},getPercent:function(){return(this.getValue()/this.getCollection().getSum())*100},getSum:function(){return this.getCollection().getSum()},getDegrees:function(){return this.getPercent()*360/100},getAngle:function(){var b=this.getCollection().startAngle;
var a=b+(this.getStartPercent()*360/100);if(a>360){a-=360}return a},getValue:function(){return this.get("value")},getLabel:function(){return this.get("label")},setValue:function(a){a=parseFloat(a);if(a!==this.get("value")){this.set("value",a)}},focus:function(){this.fireEvent("focus",this);this.set("focused",true)},blur:function(){this.fireEvent("blur",this);this.set("focused",false)},click:function(){var a=this.get("focused")?true:false;this[a?"blur":"focus"]()},isFocused:function(){return this.get("focused")?true:false},enter:function(){this.fireEvent("enter",this)},leave:function(){this.fireEvent("leave",this)}});ludo.color.Color=new Class({randomColor:function(){return this.rgbCode({r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255)})},rgbColors:function(b){if(b.substr!==undefined){return this.rgbObject(b)}if(b.h!==undefined){return this.hsvToRGB(b.h,b.s,b.v)}return undefined},rgbObject:function(a){a=a.replace("#","");return{r:a.substr(0,2).toInt(16),g:a.substr(2,2).toInt(16),b:a.substr(4,2).toInt(16)}},rgbCode:function(f,d,h){if(d===undefined){if(f.r!==undefined){d=f.g;h=f.b;f=f.r}else{if(f.h!==undefined){var g=this.hsvToRGB(f.h,f.s,f.v);f=g.r;d=g.g;h=g.b}}}return this.toRGB(f,d,h)},toRGB:function(k,j,d){var h=Math.round(k).toString(16);var f=Math.round(j).toString(16);var a=Math.round(d).toString(16);if(h.length===1){h=["0",h].join("")}if(f.length===1){f=["0",f].join("")}if(a.length===1){a=["0",a].join("")}return["#",h,f,a].join("").toUpperCase()},toRGBFromObject:function(a){return this.toRGB(a.r,a.g,a.b)},brightness:function(a,d){if(arguments.length==1){return this.toHSV(a).v}else{var b=this.toHSV(a);b.v=d;return this.rgbCode(b)}},saturation:function(a,d){if(arguments.length==1){return this.toHSV(a).s}else{var b=this.toHSV(a);b.s=d;return this.rgbCode(b)}},toHSV:function(a){if(a.r===undefined){a=this.rgbObject(a)}return this.toHSVFromRGB(a.r,a.g,a.b)},toHSVFromRGBCode:function(b){var a=this.rgbObject(b);return this.toHSVFromRGB(a.r,a.g,a.b)},toHSVFromRGB:function(n,m,f){n=n/255;m=m/255;f=f/255;var a=Math.max(n,m,f),j=Math.min(n,m,f);var l,k;var o=a-j;k=a==0?0:o/a;if(a==j){l=0}else{switch(a){case n:l=(m-f)/o+(m<f?6:0);break;case m:l=(f-n)/o+2;break;case f:l=(n-m)/o+4;break}l/=6}return{h:l*360,s:k*100,v:a*100}},hsvToRGBCode:function(f,d,a){if(d===undefined){d=f.s;a=f.v;f=f.h}var b=this.hsvToRGB(f,d,a);return this.toRGB(b.r,b.g,b.b)},hsvToRGB:function(l,x,u){if(x===undefined){x=l.s;u=l.v;l=l.h}l/=360;x/=100;u/=100;var a,m,o;var k=Math.floor(l*6);var n=l*6-k;var j=u*(1-x);var d=u*(1-n*x);var w=u*(1-(1-n)*x);switch(k%6){case 0:a=u;m=w;o=j;break;case 1:a=d;m=u;o=j;break;case 2:a=j;m=u;o=w;break;case 3:a=j;m=d;o=u;break;case 4:a=w;m=j;o=u;break;case 5:a=u;m=j;o=d;break}return{r:a*255,g:m*255,b:o*255}},hslToRgb:function(m,t,k){var a,n,o;if(t==0){a=n=o=k}else{function j(h,g,b){if(b<0){b+=1}if(b>1){b-=1}if(b<1/6){return h+(g-h)*6*b}if(b<1/2){return g}if(b<2/3){return h+(g-h)*(2/3-b)*6}return h}var d=k<0.5?k*(1+t):k+t-k*t;var f=2*k-d;a=j(f,d,m+1/3);n=j(f,d,m);o=j(f,d,m-1/3)}return{r:a*255,g:n*255,b:o*255}},offsetHue:function(a,d){var b=this.toHSV(a);b.h+=d;b.h=b.h%360;return this.rgbCode(b)},offsetBrightness:function(a,d){var b=this.toHSV(a);b.v+=d;if(b.v>100){b.v=100}if(b.v<0){b.v=0}return this.rgbCode(b)},offsetSaturation:function(a,d){var b=this.toHSV(a);b.s+=d;if(b.s>100){b.s=100}if(b.s<0){b.s=0}return this.rgbCode(b)},brighten:function(a,d){var b=this.toHSV(a);a=this.offsetBrightness(a,b.v*d/100);a=this.offsetSaturation(a,b.s*d/100*-1);return a},darken:function(a,d){var b=this.toHSV(a);a=this.offsetBrightness(a,b.v*d/100*-1);a=this.offsetSaturation(a,b.s*d/100);return a}});ludo.chart.DataSource=new Class({Extends:ludo.dataSource.JSON,type:"chart.DataSource",map:undefined,valueOf:undefined,textOf:undefined,valueKey:"value",childKey:"children",startAngle:0,color:"#1976D2",colorOf:undefined,colorOverOf:undefined,strokeOf:undefined,strokeOverOf:undefined,colorUtilObj:undefined,count:undefined,highlighted:undefined,selectedRecord:undefined,maxVal:undefined,dataFor:undefined,sortFn:undefined,_maxIndexSum:undefined,maxValAggr:undefined,minVal:undefined,minValAgr:undefined,_increments:undefined,increments:undefined,minBrightness:undefined,maxBrightness:undefined,minSaturation:undefined,maxSaturation:undefined,__construct:function(a){this.setConfigParams(a,["indexStartValueOf","minBrightness","maxBrightness","minSaturation","maxSaturation","shapeOf","dataFor","sortFn","shouldInheritColor","childKey","valueKey","color","valueOf","textOf","getText","max","min","increments","strokeOf","strokeOverOf","valueForDisplay"]);this.parent(a);if(this.valueOf==undefined){console.warn("Method valueOf(record, caller) not implemented in chart data source")}if(this.textOf==undefined){console.warn("Method textOf(record, caller) not implemented in chart data source")}},parseNewData:function(a){this.handleData(a);this.parent(this.data)},handleData:function(a){if(!jQuery.isArray(a)){a=[a]}this.data=a;
this.map={};this.startAngle=0;this.minVal=undefined;this.minValAgr=undefined;this.maxVal=undefined;this.maxValAggr=undefined;this.count=this.getCount(this.data);this.parseChartBranch(this.data);this.setSumIndexes(this.data);if(this.sortFn!=undefined){this.sortBranch(this.data)}this.updateIncrements()},update:function(a){this.handleData(this.data);this.fireEvent("update",[a,this])},updateIncrements:function(){if(this.increments==undefined){return}var d=this.increments(this.minVal,this.maxVal,this);if(jQuery.isArray(d)){this._increments=d}else{this._increments=[];for(var b=this.min(),a=this.max();b<=a;b+=d){this._increments.push(b)}}},getIncrements:function(){return this._increments},sum:function(b){var a=0;jQuery.each(b,function(d,f){a+=(this.value(f,this)||0)}.bind(this));return a},getCount:function(b){var a=0;jQuery.each(b,function(d,f){a++;if(f[this.childKey]!=undefined&&jQuery.isArray(f[this.childKey])){a+=this.getCount(f[this.childKey])}}.bind(this));return a},updateValues:function(b,a){jQuery.each(b,function(d,f){var h=this.value(f,this);if(h==undefined||!isNaN(h)){if(f[this.childKey]!=undefined){h=this.sum(f[this.childKey]);var g=this.valueKey;if(g!=undefined){f[g]=h}}}if(h!=undefined&&!isNaN(h)){if(f[this.childKey]==undefined){this.setMax(h);this.setMin(h)}this.setMinAgr(h);this.setMaxAgr(h)}}.bind(this))},setMax:function(a){if(this.maxVal==undefined){this.maxVal=a}else{this.maxVal=Math.max(this.maxVal,a)}},setMaxAgr:function(a){if(this.maxValAggr==undefined){this.maxValAggr=a}else{this.maxValAggr=Math.max(this.maxValAggr,a)}},setMin:function(a){if(this.minVal==undefined){this.minVal=a}else{this.minVal=Math.min(this.minVal,a)}},setMinAgr:function(a){if(this.minValAgr==undefined){this.minValAgr=a}else{this.minValAgr=Math.min(this.minValAgr,a)}},sortBranch:function(d,b){if(b!=undefined&&this.sortFn!=undefined){var a=this.sortFn(b,this);if(a!=undefined){d=d.sort(a)}}jQuery.each(d,function(f,g){g.__index=f;if(g[this.childKey]!=undefined){this.sortBranch(g[this.childKey],g)}}.bind(this))},parseChartBranch:function(f,d){this.updateValues(f,d);var b=this.sum(f);var g=d&&d.angle?d.angle:0;var a=0;jQuery.each(f,function(h,j){f[h]=this.parseNode(j,d,a,b,g);if(j.__radians){g+=j.__radians}a++;if(j[this.childKey]!=undefined){this.parseChartBranch(j[this.childKey],j)}}.bind(this));return f},parseNode:function(f,d,a,b,h){f.__sum=b;var g=this.value(f,this);if(!isNaN(g)){f.__min=this.minVal;f.__max=this.maxVal;f.__maxAggr=this.maxValAggr;f.__minAgr=this.minValAgr;f.__fraction=g/b;f.__percent=Math.round(f.__fraction*100);f.__radians=ludo.geometry.toRadians(f.__fraction*360);f.__angle=h}f.__count=this.count;if(f.index==undefined){f.__index=a}if(d!=undefined){f.__parent=d.id;f.getParent=function(){return d}}else{f.getParent=function(){return undefined}}if(f.id==undefined){f.id="chart-node-"+String.uniqueID()}if(f.__uid==undefined){f.__uid="chart-node-"+String.uniqueID()}this.map[f.id]=f;var j=this.childKey;f.getChildren=function(){return f[j]};f.getChild=function(k){return f[j][k]};this.setColor(f);return f},setSumIndexes:function(b){var a=b[0].getChildren!=undefined?b[0].getChildren():undefined;if(a==undefined){return}var d=[];jQuery.each(b,function(g,f){var h=f.getChildren();if(h&&h.length){jQuery.each(h,function(k,j){j.__val=this.valueOf(j,this)||0;if(d.length==k){d.push(0)}j.__indexStartVal=d[k];d[k]+=j.__val}.bind(this))}}.bind(this));this._maxIndexSum=undefined;jQuery.each(b,function(g,f){var h=f.getChildren();if(h&&h.length){jQuery.each(h,function(k,j){if(this._maxIndexSum==undefined){this._maxIndexSum=d[k]}else{this._maxIndexSum=Math.max(this._maxIndexSum,d[k])}j.__indexSum=d[k];j.__indexFraction=j.__val/d[k];j.__indexStartFraction=j.__indexStartVal/d[k]}.bind(this))}}.bind(this))},maxIndexSum:function(){return this._maxIndexSum},val:function(d,a){if(arguments.length==2){if(this.valueKey!=undefined){var b=this.byId(d);if(b){b[this.valueKey]=a;this.update(b)}}}else{return this.valueOf(this.byId(d))}},byId:function(a){if(this.map!=undefined){return this.map[a]}return undefined},enterId:function(a){this.enter(this.map[a])},enter:function(a){this.highlighted=a;this.fireEvent("enter",[a,this]);this.fireEvent("enter"+a.__uid,[a,this])},leaveId:function(a){this.leave(this.map[a])},leave:function(a){this.fireEvent("leave",[a,this]);this.fireEvent("leave"+a.__uid,[a,this])},selectId:function(a){this.select(this.map[a])},select:function(a){if(this.selectedRecord!=undefined){this.fireEvent("blur",[this.selectedRecord,this]);this.fireEvent("blur"+this.selectedRecord.__uid,[this.selectedRecord,this])}this.selectedRecord=a;this.fireEvent("select",[a,this]);this.fireEvent("select"+a.__uid,[a,this])},value:function(a,b){var d=this.valueOf!=undefined?this.valueOf(a,b):undefined;if(d==undefined&&this.valueKey!=undefined){return a[this.valueKey]}return d},isSelected:function(a){return this.selectedRecord==a},hasData:function(){return this.data&&this.data.length>0},shapes:["circle","rect","triangle","rotatedrect"],shapeIndex:0,sumBy:function(b,a){return this._sumBy(this.data,b,a)
},_sumBy:function(f,b,a){var d=0;jQuery.each(f,function(h,g){if(this.isMatching(g,b)){d+=g[a]}var j=g.getChildren();if(j&&j.length>0){d+=this._sumBy(j,b,a,d)}}.bind(this));return d},isMatching:function(a,d){for(var b in d){if(a[b]==undefined){return false}if(a[b]!=d[b]){return false}}return true},setColor:function(a){var b=false;if(this.shouldInheritColor(a)&&a.__parent){var d=a.getParent();a.__color=d.__color;a.__colorOver=d.__colorOver;a.__stroke=d.__stroke;a.__strokeOver=d.__strokeOver;a.__shape=d.__shape;this.color=this.colorUtil().offsetHue(this.color,(360/(a.__count+1)));return}if(a.__shape==undefined){a.__shape=this.shapes[this.shapeIndex++];this.shapeIndex=this.shapeIndex%this.shapes.length}if(a.__color==undefined){if(this.colorOf!=undefined){a.__color=this.colorOf(a)}if(!a.__color){a.__color=this.color}b=true}if(a.__colorOver==undefined){a.__colorOver=this.colorUtil().brighten(a.__color,7);if(a.__colorOver==a.__color){a.__color=this.colorUtil().darken(a.__color,7)}b=true}if(a.__stroke==undefined&&this.strokeOf!=undefined){a.__stroke=this.strokeOf(a,this)}if(a.__strokeOver==undefined&&this.strokeOverOf!=undefined){a.__strokeOver=this.strokeOverOf(a,this)}this.adjustColor(a);if(b){this.color=this.colorUtil().offsetHue(a.__color,(360/(a.__count+1)))}},adjustColor:function(d){var a,g;var f=this.colorUtil();d.__color=this.rgba(d.__color);d.__colorOver=this.rgba(d.__colorOver);d.__stroke=this.rgba(d.__stroke);d.__strokeOver=this.rgba(d.__strokeOver);if(this.minBrightness!=undefined){a=f.brightness(d.__color);if(a<this.minBrightness){d.__color=f.brightness(d.__color,this.minBrightness)}}if(this.maxBrightness!=undefined){a=f.brightness(d.__color);if(a>this.maxBrightness){d.__color=f.brightness(d.__color,this.maxBrightness)}}if(this.minSaturation!=undefined){g=f.saturation(d.__color);if(g<this.minSaturation){d.__color=f.saturation(d.__color,this.minSaturation)}}if(this.maxSaturation!=undefined){g=f.saturation(d.__color);if(g>this.maxSaturation){d.__color=f.saturation(d.__color,this.maxSaturation)}}},rgba:function(d){if(d!=undefined&&d.indexOf("#")==0&&d.length==9){var b=d.substr(7,2);var g=d.substr(0,7);var f=this.colorUtil().rgbColors(g);return"rgba("+f.r+","+f.g+","+f.b+","+(b.toInt(16)/255)+")"}return d},colorUtil:function(){if(this.colorUtilObj==undefined){this.colorUtilObj=new ludo.color.Color()}return this.colorUtilObj},getHighlighted:function(){return this.highlighted},getText:function(a){},length:function(){return this.data.length},max:function(){return this.maxVal},min:function(){return Math.min(0,this.minVal)},maxX:function(){return this.max()},maxY:function(){return this.max()},minX:function(){return this.min()},minY:function(){return this.min()},valueForDisplay:function(a){return a},shouldInheritColor:function(){return false},getData:function(a){if(!a){return this.parent()}else{if(!a.type){console.warn("Type not set",a);console.trace()}}a=a||this;var b=this.parent();var f=this.dataFor!=undefined?this.dataFor(a,b):undefined;return f?f:b},shapeOf:function(){return undefined},indexStartValueOf:function(a){return a.__indexStartVal||0}});ludo.chart.Chart=new Class({Extends:ludo.View,css:{},currentGroup:undefined,__construct:function(a){this.parent(a);this.layout.type="Canvas";this.svg()},__rendered:function(){this.parent();this.svg().on("mouseleave",this.enterGroup.bind(this))},updateChildren:function(){jQuery.each(this.children,function(a,b){if(b.rendered&&b.update){b.onResize()}})},JSON:function(){},resize:function(a){this.parent(a);this.updateChildren()},enterGroup:function(a){if(a.id!=this.currentGroup){if(this.currentGroup){this.fireEvent("leavegroup",this.currentGroup)}this.currentGroup=a.id;this.fireEvent("entergroup",a.id)}}});ludo.chart.ScatterDataSource=new Class({Extends:ludo.chart.DataSource,_minX:undefined,_maxX:undefined,_minY:undefined,_maxY:undefined,_minMagnitude:undefined,_maxMagnitude:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["minX","maxX","minY","maxY"])},parseNode:function(f,d,a,b,g){if(jQuery.isArray(f)){this._setMin("_minX",f[0]);this._setMax("_maxX",f[0]);this._setMin("_minY",f[1]);this._setMax("_maxY",f[1]);if(f.length==3){this._setMin("_minMagnitude",f[2]);this._setMax("_maxMagnitude",f[2])}f={x:f[0],y:f[1],magnitude:f.length==3?f[2]:1}}return this.parent(f,d,a,b,g)},shouldInheritColor:function(){return true},_setMin:function(a,b){if(this[a]==undefined){this[a]=b}else{this[a]=Math.min(this[a],b)}},_setMax:function(a,b){if(this[a]==undefined){this[a]=b}else{this[a]=Math.max(this[a],b)}},minX:function(){return this._minX},maxX:function(){return this._maxX},minY:function(){return this._minY},maxY:function(){return this._maxY}});ludo.chart.Fragment=new Class({Extends:ludo.Core,record:undefined,nodes:[],map:undefined,rendering:{},ds:undefined,area:undefined,points:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["record","parentComponent"]);var b=this.parentComponent.getSize();this.area={x:0,y:0,width:b.x,height:b.y};this.map={};
this.ds=this.parentComponent.getDataSource();this.createNodes()},chart:function(){return this.parentComponent.chart()},getNode:function(){return this.nodes[this.nodes.length-1]},createNodes:function(){},getDataSource:function(){return this.getParent().getDataSource()},ludoEvents:function(){this.parent();this.ds.addEvent("update",this.update.bind(this));var b=this.getDataSource();var a=this.record.children!=undefined?this.record.children:[this.record];if(this.parentComponent.interactive){jQuery.each(a,function(f,d){b.on("select"+d.__uid,this.focus.bind(this));b.on("blur"+d.__uid,this.blur.bind(this));b.on("enter"+d.__uid,this.enter.bind(this));b.on("leave"+d.__uid,this.leave.bind(this))}.bind(this))}},getParent:function(){return this.parentComponent},createNode:function(d,b,g,a){var f;f=new ludo.svg.Node(d,b,g);this.dependency["node-"+this.nodes.length]=f;this.nodes.push(f);if(a!=undefined){f.attr("ludojs-svg-id",a.id);this.map[a.id]=f}if(f.mouseenter!=undefined){f.mouseenter(this.enterNode.bind(this));f.mouseleave(this.leaveNode.bind(this))}else{f.on("mouseenter",this.enterNode.bind(this));f.on("mouseleave",this.leaveNode.bind(this))}f.on("click",this.clickNode.bind(this));f.css("cursor","pointer");this.getParent().getChartNode().append(f);this.relayEvents(f,["mouseenter","mouseleave"]);return f},enterNode:function(a){this.dsEvent(a,"enter")},leaveNode:function(a){this.dsEvent(a,"leave")},clickNode:function(a){this.dsEvent(a,"select")},dsEvent:function(a,f){var d=ludo.svgEngine.get(a.target,"ludojs-svg-id");var b=this.record;if(d){this.ds[f+"Id"](d);b=this.ds.byId(d)}else{this.ds[f](this.record)}this.parentComponent.onFragmentAction(f,this,b,this.map[b.id],a)},resize:function(b,a){this.area.width=b;this.area.height=a},getEventNode:function(a){return a.target},createStyle:function(a){var b=new ludo.svg.Paint(a);this.svg().appendDef(b);return b},highlight:function(){},update:function(){},click:function(){this.clicked=true},svg:function(){return this.getParent().getParent().getCanvas()},storeRendering:function(a){this.rendering=a},focus:function(){},blur:function(){},enter:function(){},leave:function(){},getRecord:function(){return this.record},animate:function(){}});ludo.svg.Group=new Class({Extends:ludo.svg.View,type:"svg.Group",tag:"g",layout:{},width:undefined,children:undefined,parentGroup:undefined,height:undefined,child:undefined,bbox:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["layout","renderTo","parentComponent","parentGroup","__rendered"]);this.layout=this.layout||{};this.layout.type="Canvas";a.children=a.children||this.__children();this.children=[];this.child={};if(this.renderTo){this.renderTo.append(this)}this.bbox={left:0,top:0,width:0,height:0};jQuery.each(a.children,function(b,d){d.layout=d.layout||{};d.parentGroup=this;this.children[b]=d=this.getLayout().addChild(d);d.renderTo=this;this.child[d.id||d.name]=d}.bind(this));if(a.css){this.node.css(this.css)}},__children:function(){return this.children||[]},__rendered:function(){},resize:function(a){if(a.width){this.width=this.bbox.width=Math.max(0,a.width);this.set("width",a.width+"px")}if(a.height){this.height=this.bbox.height=Math.max(0,a.height);this.set("height",a.height+"px")}if(this.children.length>0){this.getLayout().resizeChildren()}this.fireEvent("resize",a)},getSize:function(){return{x:this.width||this.renderTo.width(),y:this.height||this.renderTo.height()}},getCenter:function(){var a=this.getSize();return{x:a.x/2,y:a.y/2}},isHidden:function(){return false},position:function(a,d){if(arguments.length>0){this.bbox.left=a;this.bbox.top=d;this.node.setTranslate(a,d)}else{var b=this.node.getTranslate();return{left:b[0],top:b[1]}}},getLayout:function(){if(!this.hasDependency("layoutManager")){this.createDependency("layoutManager",ludo.layoutFactory.getManager(this))}return this.getDependency("layoutManager")},$b:function(){return this.node},append:function(a){return this.node.append(a)}});ludo.chart.Base=new Class({Extends:ludo.svg.Group,fragments:[],fragmentType:"chart.Fragment",highlighted:undefined,focused:undefined,plugins:undefined,fragmentMap:{},rendered:false,bgColor:undefined,bgRect:undefined,ds:undefined,easing:undefined,duration:300,data:undefined,entered:undefined,chartNode:undefined,clipPath:undefined,clipRect:undefined,dataSource:undefined,interactive:true,revealAnim:false,revealAnimDirection:"right",revealAnimDuration:500,__construct:function(a){this.parent(a);this.setConfigParams(a,["revealAnim","revealAnimDirection","revealAnimDuration","interactive","dataSource","animate","bgColor","duration","data"]);this.ds=this.getDataSource();this.easing=a.easing||ludo.svg.easing.outSine;this.ds.on("load",this.create.bind(this));this.ds.on("update",this.onResize.bind(this));this.ds.on("select",this.select.bind(this));this.ds.on("blur",this.blur.bind(this));this.ds.on("enter",this.enter.bind(this));this.ds.on("leave",this.leave.bind(this));this.node.on("mouseenter",this.enterGroup.bind(this))},chart:function(){return this.getParent()
},enterGroup:function(a){if(a.target.tagName=="g"){this.getParent().enterGroup(this)}},getChartNode:function(){if(this.chartNode==undefined){var d=this.svg();this.chartNode=d.$("g");this.append(this.chartNode);var a=this.layout.xOffset||0;var b=this.layout.yOffset||0;if(a!=0||b!=0){this.chartNode.setTranslate(a,b)}}return this.chartNode},select:function(a){},blur:function(a){},enter:function(a){},leave:function(a){},ludoEvents:function(){this.parent();var a=this.getDataSource();a.addEvent("update",this.update.bind(this))},createFragments:function(){if(this.fragmentType==undefined){return}var a=this.getRecords();for(var b=0;b<a.length;b++){this.createFragment(a[b])}},createFragment:function(a){var b=this.createDependency("fragment"+this.fragments.length,Object.merge({type:this.fragmentType,record:a,parentComponent:this},this.getFragmentProperties()));this.fragmentMap[a.__uid]=b;this.fragments.push(b);this.relayEvents(b,["mouseenter","mouseleave"]);return b},getFragmentProperties:function(){return{}},getFragments:function(){return this.fragments},getParent:function(){return this.parentComponent},getRecords:function(){return this.ds.getData(this)},getDataSource:function(){return this.dataSource?this.dataSource:this.parentComponent.getDataSource()},getCenter:function(){var a=this.getSize();return{x:a.x/2,y:a.y/2}},getRadius:function(){var a=this.getCenter();return Math.min(a.x,a.y)},create:function(){this.renderBackgroundItems();if(this.ds.hasData()){this.dataRendered=true;this.createFragments()}this.render();this.rendered=true;if(this.animate){this.renderAnimation()}},renderAnimation:function(){if(this.revealAnim){this.reveal()}else{jQuery.each(this.fragments,function(b,a){a.animate()})}},renderBackgroundItems:function(){var a=this.getSize();this.bgRect=new ludo.svg.Rect({x:0,y:0,width:a.x,height:a.y});if(this.bgColor){this.bgRect.css("fill",this.bgColor)}else{this.bgRect.set("fill-opacity",0)}this.append(this.bgRect)},render:function(){},update:function(a){this.fireEvent("update",a)},getFragmentFor:function(a){return this.fragmentMap[a.__uid]},onResize:function(){if(this.bgRect!=undefined){var a=this.getSize();this.bgRect.attr("width",a.x);this.bgRect.attr("height",a.y)}},svg:function(){return this.parentComponent.svg()},getSquareSize:function(){var a=this.getSize();return Math.min(a.x,a.y)},dataRendered:false,resize:function(b){this.parent(b);if(!this.dataRendered&&this.ds.hasData()){this.create()}var a=this.getSize();jQuery.each(this.fragments,function(f,d){d.resize(a.x,a.y)})},onFragmentAction:function(g,b,a,f,d){this.fireEvent(g,[b,a,f,d])},getTooltipPosition:function(){return"left"},tooltipAtMouseCursor:function(){return false},reveal:function(g,f){g=this.revealAnimDirection||"right";f=this.revealAnimDuration||600;var a=this.getSize();var h=this.svg();if(this.clipPath==undefined){this.clipPath=h.$("clipPath");h.appendDef(this.clipPath);this.clipRect=h.$("rect",{x:0,y:0,width:0,height:0});this.clipPath.append(this.clipRect)}this.getChartNode().clip(this.clipPath);var b=this.clipRect;b.set("x",0);b.set("y",0);b.set("width",0);b.set("height",0);var d={};switch(g){case"right":b.set("height",a.y);d.width=a.x;break;case"up":b.set("y",a.y);b.set("width",a.x);d.height=a.y;d.y=0;break;case"left":b.set("x",a.x);b.set("height",a.y);d.x=0;d.width=a.x;break;case"down":b.set("width",a.x);b.set("height",0);d.height=a.y;break}this.clipRect.animate(d,{duration:f,easing:ludo.svg.easing.inSine,complete:this.removeClipPath.bind(this)})},removeClipPath:function(){this.getChartNode().removeAttr("clip-path")}});ludo.chart.PieSlice=new Class({Extends:ludo.chart.Fragment,createNodes:function(){var a=this.createStyle(this.getSliceStyle());this.createNode("path",{"class":a},undefined,this.record)},getSliceStyle:function(){return{"stroke-location":"inside",fill:this.record.__color,"stroke-linejoin":"round",stroke:"#ffffff",cursor:"pointer"}},set:function(a,d,b){this.nodes[0].set("d",this.getPath({radius:a,angle:d,radians:b}))},getPath:function(b){var a=b.center||this.getParent().getCenter();var g=["M "+a.x+" "+a.y];if(b.angle>Math.PI*2){b.angle-=Math.PI}var f=ludo.geometry.getPointDistanceFrom(a.x,a.y,b.angle,b.radius);g.push("L "+f.x+" "+f.y);g.push("M "+f.x+" "+f.y);g.push("A "+b.radius+" "+b.radius);g.push("0");g.push(b.radians>Math.PI?"1":"0");g.push("1");var d=ludo.geometry.getPointDistanceFrom(a.x,a.y,b.angle+b.radians,b.radius);g.push(d.x+" "+d.y);g.push("L "+a.x+" "+a.y);this.storeRendering(b);return g.join(" ")},focus:function(){var a=this.centerOffset(this.getParent().getHighlightSize());this.node().animate({translate:[a.x,a.y]},100)},blur:function(){this.node().animate({translate:[0,0]},100)},node:function(){return this.nodes[0]},centerOffset:function(b){var a=this.record.__angle+(this.record.__radians/2);return ludo.geometry.getPointDistanceFrom(0,0,a,b)},enter:function(){console.log("enter");this.nodes[0].css("fill",this.record.__colorOver)},leave:function(){this.nodes[0].css("fill",this.record.__color)},update:function(){var a=this.getParent().getRadius();
if(Math.round(a)==Math.round(this.rendering.radius)&&this.rendering.angle==this.record.__angle&&this.rendering.radians==this.record.__radians){return}var d=new ludo.svg.Effect();var b=d.getEffectConfig([this.rendering.radius,this.rendering.angle,this.rendering.radians],[a,this.record.__angle,this.record.__radians],1);b.center=this.getParent().getCenter();this.executeAnimation(b,0)},executeAnimation:function(a,b){this.nodes[0].set("d",this.getPath({radius:this.rendering.radius,angle:this.rendering.angle+a.steps[1],radians:this.rendering.radians+a.steps[2],center:a.center}));if(b<a.count-1){this.executeAnimation.delay(33,this,[a,b+1])}}});ludo.chart.Pie=new Class({Extends:ludo.chart.Base,fragmentType:"chart.PieSlice",rendered:false,plugins:[],highlightSize:10,__construct:function(a){this.parent(a);this.setConfigParams(a,["highlightSize"])},getHighlightSize:function(){return this.highlightSize},render:function(){this.renderAnimation()},getRadius:function(){return this.parent()-20},renderAnimation:function(){var d=this.getRecords();if(!d){return}var j=new ludo.svg.Effect();var a=j.getEffectConfig([0],[this.getRadius()],1);var h=[];var g=[];for(var b=0;b<d.length;b++){h.push(j.getEffectConfig([0],[d[b].__radians],1).steps[0]);g.push(0)}this.rendered=false;var f={startAngle:this.ds.startAngle,radius:a.steps[0],currentRadius:0,radians:h,currentRadians:g,count:a.count};this.executeAnimation(f,0)},executeAnimation:function(a,d){a.currentRadius+=a.radius;var f=a.startAngle;for(var b=0;b<a.radians.length;b++){a.currentRadians[b]+=a.radians[b];this.fragments[b].set(a.currentRadius,f,a.currentRadians[b]);f+=a.currentRadians[b]}if(d<a.count-1){this.executeAnimation.delay(33,this,[a,d+1])}else{this.rendered=true}},update:function(){if(!this.rendered){this.render()}},onResize:function(){if(!this.rendered){return}var d=this.getRecords();var a=this.getRadius();for(var b=0;b<d.length;b++){this.fragments[b].set(a,d[b].__angle,d[b].__radians)}},tooltipAtMouseCursor:function(){return true},getTooltipPosition:function(){return"above"}});ludo.chart.LabelList=new Class({Extends:ludo.chart.Base,type:"chart.LabelList",fragmentType:"chart.LabelListItem",textStyles:undefined,textStylesOver:undefined,boxStyles:undefined,boxStylesOver:undefined,orientation:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["orientation","textStyles","boxStyles","textStylesOver","boxStylesOver"])},render:function(){this.onResize()},onResize:function(){if(!this.fragments.length){return}var a=this.getSize();this[this.orientation==="horizontal"||a.x>a.y?"resizeHorizontal":"resizeVertical"]()},resizeHorizontal:function(){var h=[];var d=this.getSize();var a=0;for(var b=0;b<this.fragments.length;b++){var g=this.fragments[b].getSize();var f=g.x+12;h.push(a);a+=f}var j=(d.x-a)/2;var k=(d.y-this.fragments[0].getSize().y)/2;for(b=0;b<this.fragments.length;b++){this.fragments[b].node().setTranslate(h[b]+j,k)}},resizeVertical:function(){var h=[];var f=this.getSize();var d=0;for(var b=0;b<this.fragments.length;b++){var g=this.fragments[b].getSize();var a=g.y+3;h.push(d);d+=a}var j=(f.y-d)/2;for(b=0;b<this.fragments.length;b++){this.fragments[b].node().setTranslate(2,h[b]+j)}},getRecords:function(){var a=this.parent();if(a.length>0&&a[0].children!=undefined){return a[0].children}return a}});ludo.chart.LabelListItem=new Class({Extends:ludo.chart.Fragment,type:"chart.LabelListItem",createNodes:function(){var b=this.createNode("g");this.bg=new ludo.svg.Rect({x:0,y:0,width:10,height:10});this.bg.css("fill","#fff");this.bg.css("fill-opacity","0");b.append(this.bg);var a=this.getCoordinatesForColorBox();this.colorBox=new ludo.svg.Rect(a);b.append(this.colorBox);this.colorBox.css(this.getBoxStyles());this.textNode=new ludo.svg.Text(this.getDataSource().textOf(this.record,this),{x:a.x+a.width+3,y:this.getYForText()});this.textNode.css(this.getTextStyles());b.append(this.textNode);this.setSize();this.bg.set("width",this.size.x);this.bg.set("height",this.size.x)},getFontSize:function(){var a=this.getTextStyles();return a["font-size"]?parseInt(a["font-size"]):13},getYForText:function(){return Math.floor(this.getFontSize()*0.9)},getCoordinatesForColorBox:function(){var b=this.getFontSize();var a=Math.round(b);return{x:0,y:b-a,width:a,height:a}},setSize:function(){this.size=this.nodes[0].getSize()},getSize:function(){return this.size},node:function(){return this.nodes[0]},getBoxStyles:function(){var a=this.getParent().boxStyles||{};a.fill=this.record.__color;return a},getTextStyles:function(){return this.getParent().textStyles||{"font-size":"13px","font-weight":"normal"}},getTextStylesOver:function(){return this.getParent().textStylesOver||{"font-weight":"bold"}},getBoxStylesOver:function(){var a=this.getParent().boxStylesOver||{};if(!a.fill){a.fill=this.record.__colorOver}return a},enter:function(){this.textNode.css(this.getTextStylesOver());this.colorBox.css(this.getBoxStylesOver())},leave:function(){this.textNode.css(this.getTextStyles());this.colorBox.css(this.getBoxStyles())
}});ludo.chart.AddOn=new Class({Extends:ludo.Core,__construct:function(a){this.parent(a);this.parentComponent=a.parentComponent},getParent:function(){return this.parentComponent},getDataSource:function(){return this.parentComponent.getDataSource()},chart:function(){return this.parentComponent.chart()}});ludo.chart.PieSliceHighlighted=new Class({Extends:ludo.chart.AddOn,tagName:"path",styles:{stroke:"#ffffff",fill:"#ffffff","stroke-location":"inside","fill-opacity":0.5,"stroke-opacity":0.8,"stroke-width":1},size:5,__construct:function(a){this.parent(a);this.setConfigParams(a,["styles","size"]);this.node=new ludo.svg.Path();if(this.styles){this.node.css(this.styles)}else{this.node.css("fill-opacity",0.3)}this.getParent().append(this.node);this.node.toBack()},ludoEvents:function(){this.parent();var a=this.getParent().getDataSource();a.addEvents({enter:this.show.bind(this),leave:this.hide.bind(this),select:this.focus.bind(this),blur:this.blur.bind(this)})},show:function(a){if(!this.getParent().rendered){return}var d=this.getParent().getFragmentFor(a);var g=d.getPath({radius:this.getParent().getRadius()+this.size,angle:a.__angle,radians:a.__radians});this.node.set("d",g);this.node.css("fill",a.__colorOver);if(this.getParent().getDataSource().isSelected(a)){var b=d.nodes[0].getTranslate();this.node.setTranslate(b[0],b[1])}else{this.node.setTranslate(0,0)}this.node.show()},hide:function(){this.node.hide()},focus:function(a){var d=this.getParent().getFragmentFor(a);var b=d.centerOffset(this.getParent().getHighlightSize());this.node.updateMatrix();this.node.animate({translate:[b.x,b.y]},100)},blur:function(){this.node.animate({translate:[0,0]},100)}});ludo.svg.Paint=new Class({Extends:ludo.svg.Node,tagName:"style",css:{},nodes:[],className:undefined,tag:undefined,cssPrefix:undefined,mappings:{color:["stroke-color"],"background-color":["fill-color"],opacity:["fill-opacity","stroke-opacity"]},initialize:function(b,a){a=a||{};this.className=a.className||"css-"+String.uniqueID();this.cssPrefix=a.selectors?a.selectors:"."+this.className;if(a.selectors){delete a.selectors}if(a.className){delete a.className}this.parent(this.tagName,a);if(b!==undefined){this.setStyles(b)}},setStyles:function(a){Object.each(a,function(d,b){this.setStyleProperty(b,d)},this);this.updateCssContent()},setStyle:function(a,b){this.setStyleProperty(a,b);this.updateCssContent()},updateCssContent:function(){var a=JSON.stringify(this.css);a=a.replace(/"/g,"");a=a.replace(/,/g,";");this.text(this.cssPrefix+a)},setStyleProperty:function(a,b){b=this.getRealValue(b);if(this.mappings[a]){this.setMapped(a,b)}else{this.css[a]=b}},setMapped:function(d,f){for(var b=0;b<this.mappings[d].length;b++){var a=this.mappings[d][b];this.css[a]=f}},getStyle:function(a){if(this.mappings[a]){a=this.mappings[a][0]}return this.css[a]},getRealValue:function(a){return a&&a.id!==undefined?"url(#"+a.id+")":a},applyTo:function(a){ludo.svg.addClass(a.el?a.el:a,this.className)},getClassName:function(){return this.className},getUrl:function(){return this.className}});ludo.svg.NamedNode=new Class({Extends:ludo.svg.Node,initialize:function(a,b){a=a||{};if(a.listeners){this.addEvents(a.listeners);delete a.listeners}this.parent(this.tagName,a,b)}});ludo.svg.Rect=new Class({Extends:ludo.svg.NamedNode,tagName:"rect",getX:function(){return this.el.x.animVal.value},getY:function(){return this.el.y.animVal.value},getWidth:function(){return this.el.width.animVal.value},getHeight:function(){return this.el.height.animVal.value},getRx:function(){return this.el.rx.animVal.value},getRy:function(){return this.el.ry.animVal.value},setX:function(a){this.set("x",a)},setY:function(a){this.set("y",a)},setWidth:function(a){this.set("width",a)},setHeight:function(a){this.set("height",a)},setRx:function(a){this.set("rx",a)},setRy:function(a){this.set("ry",a)}});ludo.svg.TextBox=new Class({Extends:ludo.svg.Group,tag:"g",text:undefined,css:{"line-height":13},presentationAttributes:["x","y","width","height"],currentY:0,tags:{"<br>":"text"},__construct:function(a){a=a||{};a.attr=this.getAttributes(a);this.parent(a);this.text=a.text;if(a.css){this.css=a.css}if(this.text){this.renderText()}},getAttributes:function(b){var a=b.attr||{};var f=this.presentationAttributes;for(var d=0;d<f.length;d++){if(b[f[d]]!==undefined){a[f[d]]=b[f[d]]}}return a},tagsToInsert:function(){var a=this.getTextParts();return this.toTags(a)},getTextParts:function(){var f=this.text.match(/(<\/?[a-z]+?>)/gmi);if(!f){return[this.text]}var b=0;var a=[];for(var d=0;d<f.length;d++){var g=this.text.indexOf(f[d],b===0?b:b+1);if(g>b){a.push(this.text.substr(b,g-b))}b=g}if(b<this.text.length){a.push(this.text.substr(b))}return a},toTags:function(b){var f=[{tag:"text",properties:{y:this.getYOfLine()}}];var d=f[0];for(var g=0;g<b.length;g++){var a=b[g].match(/<([a-z]+?)>/gi);if(a){a=a[0]}var h={properties:{}};h.tag=this.tags[a]?this.tags[a]:"tspan";h=this.assignDefaultProperties(h,a);h.text=this.stripTags(b[g]);if(h.tag==="tspan"){d.children=d.children||[];
d.children.push(h)}else{f.push(h)}if(h.tag==="text"){h.properties.y=this.getYOfLine();d=h}}return f},assignDefaultProperties:function(g,a){if(a){var d=this.getDefaultTagProperties();var f=d[a];if(f){for(var b in f){if(f.hasOwnProperty(b)){g.properties[b]=f[b]}}}}return g},getYOfLine:function(){this.currentY+=15;return this.currentY},setText:function(a){this.currentY=0;this.empty();this.text=a;this.renderText()},renderText:function(){this.renderItems(this.tagsToInsert(),this)},renderItems:function(a,d){for(var b=0;b<a.length;b++){var f=new ludo.svg.Node(a[b].tag,a[b].properties,a[b].text);d.append(f);if(a[b].children){this.renderItems(a[b].children,f)}}},stripTags:function(a){return a.replace(/<\/?[^>]+?>/g,"")},getDefaultTagProperties:function(){return{"<strong>":{"font-weight":"bold"},"<b>":{"font-weight":"bold"},"<em>":{"font-style":"italic"},"<i>":{"font-style":"italic"}}}});ludo.chart.Tooltip=new Class({Extends:ludo.chart.AddOn,type:"chart.Tooltip",tpl:"{label}: {value}",shown:false,offset:undefined,size:{x:0,y:0},arrowSize:5,boxStyles:{},textStyles:{},record:undefined,_autoLeave:undefined,animationDuration:100,group:undefined,__construct:function(a){this.parent(a);this.offset={x:0,y:0};this.setConfigParams(a,["tpl","boxStyles","textStyles","animationDuration"]);this.createDOM();var b=this.getParent();b.on("enter",this.show.bind(this));b.on("leave",this.autoHide.bind(this));if(b.tooltipAtMouseCursor()){this.getParent().getNode().on("mousemove",this.move.bind(this))}else{}this.chart().on("entergroup",this.leaveGroup.bind(this))},leaveGroup:function(a){if(!this.group){return}if(a!=this.group.id){this.hide()}},createDOM:function(){this.node=new ludo.svg.Node("g");this.getParent().svg().append(this.node);this.node.hide();this.node.toFront.delay(50,this.node);this.rect=new ludo.svg.Path();this.rect.css(this.getBoxStyling());this.rect.set("stroke-linejoin","round");this.rect.set("stroke-linecap","round");this.node.append(this.rect);this.textBox=new ludo.svg.TextBox();this.node.append(this.textBox);this.textBox.getNode().setTranslate(6,2);this.textBox.getNode().css(this.getTextStyles())},getBoxStyling:function(){var a=this.boxStyles||{};if(!a.fill){a.fill="#fff"}if(!a["stroke-location"]){a["stroke-location"]="inside"}if(a["fill-opacity"]===undefined){a["fill-opacity"]=0.8}if(a["stroke-width"]===undefined){a["stroke-width"]=1}return a},getTextStyles:function(){var a=this.textStyles||{};if(!a.fill){a.fill="#000"}return a},show:function(b,j,g,f){this.group=b.getParent();this._autoLeave=false;if(j==this.record){return}if(b.getParent().node.el!=this.node.el.parentNode){b.getParent().append(this.node)}this.record=j;if(j==undefined){this.hide();return}var a=!this.node.isHidden();this.node.set("fill-opacity",1);this.rect.set("fill-opacity",1);this.node.show();this.node.toFront();this.shown=true;this.textBox.setText(this.getParsedHtml());this.rect.css("stroke",this.record.__color);this.updateRect(b,h);this.rect.show();var d=this.getParent().tooltipAtMouseCursor();var h;if(d){this.move(f)}else{h=this.getXY(b,g);if(this.offset.x!=0||this.offset.y!=0){this.updateRect(b)}if(a){this.node.animate({translate:[h.x,h.y]},{duration:this.animationDuration,queue:false,validate:function(l,k){return l==k}})}else{this.node.setTranslate(h.x,h.y)}}},autoHide:function(){this._autoLeave=true;this.autoHideAfterDelay.delay(2000,this)},autoHideAfterDelay:function(){if(!this._autoLeave){return}this.node.hide();this.record=undefined},updateRect:function(b,h){this.size=this.textBox.getNode().getSize();this.size.x+=12;this.size.y+=15;var a=this.size.x/2+this.offset.x;var g=this.size.y/2;if(a+this.arrowSize>this.size.x){a-=((a+this.arrowSize)-this.size.x)}if(a<0){a=0}var d;var f=this.getParent().getTooltipPosition();switch(f){case"above":d=[this.size.x,0,this.size.x,this.size.y,a+this.arrowSize,this.size.y,a,this.size.y+this.arrowSize,a-this.arrowSize,this.size.y,0,this.size.y,0,0];break;case"left":d=[this.size.x,0,this.size.x,g-this.arrowSize,this.size.x+this.arrowSize,g,this.size.x,g+this.arrowSize,this.size.x,this.size.y,0,this.size.y,0,0];break;case"right":d=[this.size.x,0,this.size.x,this.size.y,0,this.size.y,0,g+this.arrowSize,0-this.arrowSize,g,0,g-this.arrowSize,0,0];break;default:d=[this.size.x,0,this.size.x,this.size.y,0,this.size.y,0,0]}this.rect.setPath("M 0 0 L "+d.join(" ")+" Z")},getXY:function(g,f){this.offset.x=0;this.offset.y=0;var a=f.getBBox();var l=this.rect.getBBox();var h=f.position();var j=this.getParent().getTooltipPosition();switch(j){case"left":return{x:h.left-l.width,y:h.top+a.height/2-l.height/2};case"right":return{x:h.left+a.width+this.arrowSize,y:h.top+a.height/2-l.height/2};default:var k=h.left+a.width/2-l.width/2;var b=this.getParent().svg().width;var d=(k+l.width)-b;if(d>0){this.offset.x=d;k-=d}return{x:k,y:h.top-l.height}}},move:function(a){this.node.setTranslate(a.clientX-(this.size.x/2),a.clientY-this.size.y-15)},hide:function(){this.node.hide();this.rect.hide();this.shown=false;this.record=undefined},getParsedHtml:function(){var b=this.getDataSource().textOf(this.record,this);
jQuery.each(this.record,function(d,g){var f=new RegExp("{record."+d+"}","g");b=b.replace(f,g)});if(this.record.__parent&&b.indexOf("parent.")>=0){var a=this.getDataSource().byId(this.record.__parent);jQuery.each(a,function(d,g){var f=new RegExp("{parent."+d+"}","g");b=b.replace(f,g)})}b=b.replace(/{.*?}/g,"");return b},getRecord:function(){return this.record}});ludo.chart.Text=new Class({Extends:ludo.chart.Base,type:"chart.Text",rotate:undefined,text:undefined,styling:undefined,fragmentType:undefined,anchor:undefined,n:undefined,textSizeRatio:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["rotate","text","styling","anchor"]);if(this.anchor==undefined){this.anchor=[0.5,0.5]}if(this.rotate=="left"){this.rotate=-90}if(this.rotate=="right"){this.rotate=90}if(this.rotate=="flip"){this.rotate=180}if(this.styling==undefined){this.styling={}}},create:function(){this.parent();if(this.text==undefined){this.text=this.getDataSource().getText(this)}this.n=new ludo.svg.Text(this.text,{});this.n.attr("alignment-baseline","after-edge");this.n.css(this.styling);if(this.anchor[0]>0){this.n.textAnchor(this.anchor[0]==0.5?"middle":"end")}this.append(this.n);this.resizeText()},onResize:function(){this.parent();this.resizeText()},resizeText:function(){var d=this.n.getBBox();var b=this.getSize();this.n.setRotate(0,0,0);var a=0;var f=0;if(this.rotate==-90){f=b.y-(this.anchor[0]*b.y);a=b.x*this.anchor[1];a+=(d.height/2)}else{if(this.rotate==90){f=(this.anchor[0]*b.y);a=b.x-(b.x*this.anchor[1]);a-=(d.height*(1-this.anchor[1]))}else{if(this.rotate==180){a=b.x-(b.x*this.anchor[0]);f=b.y-(b.y*this.anchor[1]+(d.height/2))}else{a=b.x*this.anchor[0];f=b.y*this.anchor[1]+(d.height/2)}}}if(this.rotate){this.n.setRotate(this.rotate,a,f)}this.n.setTranslate(a,f)},rect:function(){var a=this.getSize();return this.rotate==90||this.rotate==-90?{x:a.y,y:a.x}:a},center:function(){var a=this.rect();return{x:a.x/2,y:a.y/2}},update:function(){this.parent();this.resizeText()}});ludo.chart.ChartLabels=new Class({Extends:ludo.chart.Base,fragmentType:undefined,type:"chart.ChartLabels",orientation:undefined,styling:undefined,textNodes:undefined,padding:0,halfInset:true,__construct:function(a){this.parent(a);this.setConfigParams(a,["orientation","styling","padding","halfInset"]);if(this.orientation==undefined){this.orientation="horizontal"}this.styling=this.styling||{};this.textNodes=[]},render:function(){this.parent();var a=this.getDataSource().length();for(var b=0;b<a;b++){this.getTextNode(b)}this.resizeChartLabels()},onResize:function(){this.resizeChartLabels()},resizeChartLabels:function(){var f=this.getSize();var b=this.length();var d,h;if(this.orientation=="horizontal"){var g=f.x/(this.halfInset?b:b-1);var j=this.getCenter().y;for(d=0;d<b;d++){h=this.getTextNode(d);if(h){h.attr("x",(g*d)+(this.halfInset?(g/2):0));h.attr("y",j+this.padding)}}}else{var a=f.y/(this.halfInset?b:b-1);for(d=0;d<b;d++){h=this.getTextNode(d);if(h){h.attr("x",f.x-this.padding);h.attr("y",(d*a)+(this.halfInset?(a/2):0))}}}},getTextNode:function(b){var a=this.getText(b);if(!a){if(this.textNodes[b]==undefined){this.textNodes.push(undefined)}return undefined}if(this.textNodes[b]==undefined){var d=new ludo.svg.Text("",{});this.textNodes.push(d);if(this.orientation=="horizontal"){d.textAnchor("middle")}else{d.textAnchor("end");d.attr("alignment-baseline","middle")}d.css(this.styling);this.append(d)}this.textNodes[b].text(a);return this.textNodes[b]},getText:function(a){if(this.data!=undefined){return this.data[a]}var b=this.ds.getData(this)[a];return this.ds.textOf(b,this)},length:function(){if(this.data!=undefined){return this.data.length}return this.getDataSource().getData(this).length}});ludo.chart.ChartValues=new Class({Extends:ludo.chart.Base,type:"chart.ChartValues",fragmentType:undefined,orientation:undefined,styling:undefined,nodes:undefined,min:undefined,max:undefined,count:undefined,size:undefined,increment:10,padding:0,values:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["orientation","styling","padding"]);if(this.orientation==undefined){this.orientation="horizontal"}this.styling=this.styling||{};this.nodes=[]},render:function(){this.parent();this.resizeNodes()},onResize:function(){this.parent();this.resizeNodes()},resizeNodes:function(){var f=this.ds;if(this.ds.minX!=undefined){if(this.orientation=="horizontal"){this.min=f.minX();this.max=f.maxX()}else{this.min=f.minY();this.max=f.maxY()}}else{this.min=f.min();this.max=f.max()}this.size=this.getSize();var d=this.orientation=="horizontal"?this.size.x:this.size.y;this.values=ludo.chart.LineUtil.values(this.min,this.max,d,this);this.count=this.values.length;jQuery.each(this.nodes,function(j,k){k.hide()});for(var a=0;a<this.count;a++){var b=this.getNode(a);b.show();var g=this.val(a);b.text(this.ds.valueForDisplay(g,this));var h=this.getPos(g);b.attr("x",h.x);b.attr("y",h.y);if(a==this.count-1){b.textAnchor("end")}}},val:function(a){return this.values[a]},getCount:function(){return this.values.length
},getPos:function(d){var a={x:0,y:0};var b=(d-this.min)/(this.max-this.min);if(this.orientation=="horizontal"){a.x=(this.size.x*b);a.y=this.size.y/2+this.padding}else{a.x=this.size.x-this.padding;a.y=this.size.y-(this.size.y*b)}return a},getNode:function(a){if(this.nodes[a]==undefined){var b=new ludo.svg.Text("",{});this.nodes.push(b);if(this.orientation=="horizontal"){b.textAnchor(a==0?"start":a==this.getCount()?"end":"middle")}else{b.textAnchor("end");b.attr("alignment-baseline","middle")}b.css(this.styling);this.append(b)}return this.nodes[a]}});ludo.chart.Bar=new Class({Extends:ludo.chart.Base,type:"chart.Bar",nodes:undefined,orientation:"horizontal",barSize:undefined,outline:undefined,lines:undefined,animationDuration:500,fragmentType:"chart.BarItem",stacked:false,__construct:function(a){this.parent(a);this.setConfigParams(a,["outline","bgLines","orientation","stacked"]);this.barSize=a.barSize||0.8;this.lineIncrement=a.lineIncrement||10;this.nodes={outline:{},lines:undefined,bars:[],barMap:{}}},renderBackgroundItems:function(){this.parent();this.createOutline()},render:function(){this.parent();this.resizeElements()},enter:function(a){},leave:function(a){},fn:function(b,a){var d=this.ds;return function(){d[b](a.id)}},createOutline:function(){if(!this.outline){return}var b=this.getSize();if(this.outline.left||this.outline.bottom||this.outline.top||this.outline.right){jQuery.each(this.outline,function(d,g){var h={x1:0,y1:0,x2:0,y2:0};var f=this.outline[d]=new ludo.svg.Node("line",h);f.css(g);this.append(f)}.bind(this))}else{var a=this.outline.around=new ludo.svg.Rect({x:0,y:0,width:b.x,height:b.y});a.css(this.outline);this.append(a)}},getLine:function(a){if(this.nodes.lines==undefined){this.nodes.lines=[]}if(this.nodes.lines[a]==undefined){var b=new ludo.svg.Node("line",{x1:0,y1:0,x2:0,y2:0});this.append(b);b.css(this.bgLines);this.nodes.lines.push(b)}return this.nodes.lines[a]},onResize:function(){this.parent();this.resizeElements()},resizeElements:function(){this.resizeOutline();this.resizeBgLines();this.resizeBars();jQuery.each(this.nodes.outline,function(a,b){b.toFront()})},resizeBars:function(){var j=this.getSize();var l=this.ds.getData(this);var b={x:0,y:0,width:j.x,height:j.y};var h=this.orientation=="horizontal"?j.x/l.length:j.y/l.length;var k=0;var g=0;if(this.orientation=="horizontal"){b.width=(j.x/l.length)*this.barSize;k=(h-b.width)/2}else{b.height=(j.y/l.length)*this.barSize;g=(h-b.height)/2}for(var f=0;f<l.length;f++){this.fragments[f].setArea(b.x+k,b.y+g,b.width,b.height);if(this.orientation=="horizontal"){b.x+=h}else{b.y+=h}}},resizeBgLines:function(){if(this.bgLines==undefined){return}var h=this.getSize();var g=this.ds.min();var a=this.ds.max();var d=ludo.chart.LineUtil.values(g,a,this.orientation=="vertical"?h.x:h.y);jQuery.each(this.nodes.lines,function(l,k){k.hide()});for(var f=0;f<d.length;f++){var j=(d[f]-g)/(a-g);var b=this.getLine(f);b.show();if(this.orientation=="horizontal"){b.attr("x2",h.x);b.attr("y1",h.y*j);b.attr("y2",h.y*j)}else{b.attr("y2",h.y);b.attr("x1",h.x*j);b.attr("x2",h.x*j)}}},resizeOutline:function(){var a=this.getSize();jQuery.each(this.outline,function(b,d){d.toFront();switch(b){case"around":d.css({width:a.x,height:a.y});break;case"left":d.attr("y2",a.y);break;case"right":d.attr("x2",a.x);d.attr("x1",a.x);d.attr("y2",a.y);break;case"top":d.attr("x2",a.x);break;case"bottom":d.attr("x2",a.x);d.attr("y1",a.y);d.attr("y2",a.y);break}}.bind(this))},getTooltipPosition:function(){return this.orientation=="horizontal"?"above":"right"}});ludo.chart.BarItem=new Class({Extends:ludo.chart.Fragment,type:"chart.BarItem",area:undefined,__construct:function(a){this.parent(a)},createNodes:function(){var a=this.record[this.ds.childKey]!=undefined?this.record[this.ds.childKey]:[this.record];jQuery.each(a,function(d,b){var f=this.createNode("rect",{x:0,y:0,width:0,height:0},undefined,b);f.css("fill",b.__color)}.bind(this))},setArea:function(s,q,d,t){this.area.x=s;this.area.y=q;this.area.width=d;this.area.height=t;var g=this.area.x;var b=0;var f=this.parentComponent.orientation;var m=this.parentComponent.stacked;var p=!m&&f=="horizontal"?d/this.nodes.length:d;var o=!m&&f=="vertical"?t/this.nodes.length:t;for(var k=0;k<this.nodes.length;k++){var j=this.nodes[k];j.set("x",g);j.set("y",q);j.set("width",p);j.set("height",o);var a=this.getRatio(k);if(f=="horizontal"){var l=this.area.height*a;j.attr("height",l);j.attr("y",this.area.height-b-l);if(!m){g+=p}else{b+=l}}else{j.attr("width",this.area.width*a);if(!m){b+=o}else{g+=this.area.width*a}}}},getRatio:function(b){var g=this.record.children!=undefined?this.record.children[b]:this.record;var d=this.ds.min();var a=this.ds.max();var f=this.ds.valueOf(g,this);return(f-d)/(a-d)},enter:function(a){this.map[a.id].css("fill",a.__colorOver)},leave:function(a){this.map[a.id].css("fill",a.__color)},click:function(a){},animate:function(){var j=this.area.height;var l=0;var g=this.parentComponent.stacked;for(var d=0;d<this.nodes.length;d++){var a=this.getRatio(d);
var k=this.nodes[d];if(this.parentComponent.orientation=="horizontal"){k.attr("height",0);k.attr("y",this.area.height);var n=this.area.height;var f=n*a;k.animate({height:f,y:j-f},this.parentComponent.duration,this.parentComponent.easing);if(g){j-=f}}else{var m=this.area.width*a;k.attr("width",0);k.attr("x",0);k.animate({width:m,x:l},this.parentComponent.duration,this.parentComponent.easing);if(g){l+=m}}}}});ludo.chart.Line=new Class({Extends:ludo.chart.Bar,fragmentType:"chart.LineItem",type:"chart.Line",lineStyles:undefined,currentHighlighted:undefined,showDots:true,revealAnim:true,halfInset:true,__construct:function(a){this.parent(a);this.setConfigParams(a,["halfInset","lineStyles","showDots"]);this.chart().on("leavegroup",this.leaveGroup.bind(this))},__rendered:function(){this.parent();this.chart().svg().node.on("mousemove",this.mousemove.bind(this))},leaveGroup:function(){this.currentHighlighted=undefined},mousemove:function(f){var d;if(!ludo.geometry.isWithinBBox(f.clientX,f.clientY,this.bbox)){return}var a=f.clientX-this.bbox.left;var h=f.clientY-this.bbox.top;var g=0;var b=undefined;jQuery.each(this.points,function(j,l){var k=l[0]-a;k*=(k*k);g=ludo.geometry.distanceBetweenPoints(a,h,k,l[1]);if(d==undefined||g<d){d=g;b=j}});if(b!=this.currentHighlighted){if(this.currentHighlighted){this.ds.leaveId(this.currentHighlighted)}this.ds.enterId(b);this.currentHighlighted=b}},resizeElements:function(){this.resizeOutline();this.resizeBgLines();this.resizeLines();jQuery.each(this.nodes.outline,function(a,b){b.toFront()})},createFragments:function(){this.parent();if(this.lineStyles!=undefined){var a=this.lineStyles;jQuery.each(this.fragments,function(d,b){b.getNode().css(a)})}},resizeLines:function(){var a=this.getSize();jQuery.each(this.fragments,function(d,b){b.resize(a.x,a.y)})},setPoint:function(b,a,d){if(this.points==undefined){this.points={}}this.points[b.id]=[a,d]}});ludo.chart.Area=new Class({Extends:ludo.chart.Line,type:"chart.Area",showDots:false,revealAnim:false,halfInset:false,areaStyles:undefined,__construct:function(a){if(a.areaStyles!=undefined){this.areaStyles=a.areaStyles}this.parent(a)},getFragmentProperties:function(){return{filled:true}}});ludo.chart.LineItem=new Class({Extends:ludo.chart.Fragment,type:"chart.LineItem",dots:undefined,filled:false,__construct:function(a){if(a.filled!=undefined){this.filled=a.filled}this.parent(a)},createNodes:function(){this.parent();if(this.filled){var b=this.createNode("path",{d:this.getPath(false,true)});b.css("fill",this.record.__color);b.css("fill-opacity",0.3);var f=this.getParent().areaStyles;if(f!=undefined){b.css(f)}}var j=this.createNode("path",{d:this.getPath(false,false)});j.css("fill","none");j.attr("stroke",this.record.__color);j.attr("stroke-linejoin","round");this.dots=[];var h=this.record.getChildren();for(var a=0;a<h.length;a++){var g=new ludo.chart.LineDot({record:h[a],ds:this.ds,renderTo:this.getParent().getChartNode(),parentComponent:this});this.dots.push(g);if(this.parentComponent.interactive){g.on("enter",this.enterDot.bind(this));g.on("leave",this.leaveDot.bind(this))}}this.chart().on("entergroup",this.leaveDot.bind(this))},dsEvent:function(){},enterDot:function(){if(this.nodes.length==1){this.nodes[0].css("stroke-width",3)}},leaveDot:function(){if(this.nodes.length==1){this.nodes[0].css("stroke-width",2)}},getPath:function(h,k){var b=this.length();var l=["M"];var g=this.getParent().stacked;for(var f=0;f<b;f++){if(f>0){l.push("L")}var a=this.xPos(f);if(f==0&&k){if(g){for(var d=b-1;d>=0;d--){l.push(this.xPos(d));l.push(h?this.area.height:this.yPos(d,true))}}else{l.push(a);l.push(this.area.height)}}l.push(a);l.push(h?this.area.height:this.yPos(f));if(f==b-1&&k){if(!g){l.push(this.xPos(f));l.push(this.area.height)}l.push(" Z")}}return l.join(" ")},resize:function(b,a){this.parent(b,a);if(this.filled){this.nodes[0].set("d",this.getPath(false,true))}this.nodes[this.nodes.length-1].set("d",this.getPath());this.positionDots()},xPos:function(d){var g=this.parentComponent.halfInset;var b=this.length();if(!g){b--}var f=this.area.width/b;var a=f*d;if(!!g){a+=(f/2)}return a},yPos:function(d,b){if(!this.ds){return this.area.height}var h=this.record.getChild(d);var g=this.ds.valueOf(h,this);if(this.parentComponent.stacked){if(b){g=this.ds.indexStartValueOf(h)}else{g+=this.ds.indexStartValueOf(h)}}var f=this.ds.min();var a=this.ds.max();return this.area.height-((g-f)/(a-f)*this.area.height)},animate:function(){this.nodes[this.nodes.length-1].set("d",this.getPath(true));if(this.filled){this.nodes[0].set("d",this.getPath(true,true))}this.hideDots();var a=this.getPath();this.nodes[this.nodes.length-1].animate({d:a},500,ludo.svg.easing.outSine,this.showDots.bind(this));if(this.filled){this.nodes[0].animate({d:this.getPath(false,true)},500,ludo.svg.easing.outSine)}},hideDots:function(){jQuery.each(this.dots,function(b,a){a.hide()})},showDots:function(){jQuery.each(this.dots,function(b,a){a.show()}.bind(this));this.positionDots()},positionDots:function(){var b=this.getParent();
var a=this.record.getChildren();jQuery.each(this.dots,function(g,f){var d=this.xPos(g);var h=this.yPos(g);f.position(d,h);b.setPoint(a[g],d,h)}.bind(this))},length:function(){return this.record.getChildren!=undefined?this.record.getChildren().length:this.record.length}});ludo.svg.Path=new Class({Extends:ludo.svg.NamedNode,tagName:"path",pointString:undefined,pointArray:undefined,size:undefined,position:undefined,initialize:function(b,a){a=a||{};if(b){b=this.getValidPointString(b);a.d=b}this.parent(a);this.pointString=b},getValidPointString:function(a){return a.replace(/([A-Z])/g,"$1 ").trim().replace(/,/g," ").replace(/\s+/g," ")},setPath:function(a){this.pointString=this.getValidPointString(a);this.pointArray=undefined;this.set("d",this.pointString)},getPoint:function(a){if(this.pointArray===undefined){this.buildPointArray()}a*=3;return{x:this.pointArray[a+1],y:this.pointArray[a+2]}},setPoint:function(b,a,d){if(this.pointArray===undefined){this.buildPointArray()}b*=3;if(b<this.pointArray.length-3){this.pointArray[b+1]=a;this.pointArray[b+2]=d;this.pointString=this.pointArray.join(" ");this.set("d",this.pointString);this.size=undefined;this.position=undefined}},buildPointArray:function(){var a=this.pointString.replace(/,/g," ").replace(/\s+/g," ");this.pointArray=a.split(/([A-Z\s])/g).erase(" ").erase("")},getSize:function(){if(this.size===undefined){var a=this.getMinAndMax();this.size={x:Math.abs(a.maxX-a.minX),y:Math.abs(a.maxY-a.minY)}}return this.size},getPosition:function(){if(this.position===undefined){var a=this.getMinAndMax();this.position={x:a.minX,y:a.minY}}return this.position},getMinAndMax:function(){if(this.pointArray===undefined){this.buildPointArray()}var d=this.pointArray;var a=[];var f=[];for(var b=0;b<d.length-2;b+=3){a.push(d[b+1]);f.push(d[b+2])}return{minX:Math.min.apply(this,a),minY:Math.min.apply(this,f),maxX:Math.max.apply(this,a),maxY:Math.max.apply(this,f)}}});ludo.chart.LineDot=new Class({Extends:Events,type:"chart.LineDot",shape:undefined,record:undefined,size:8,ds:undefined,node:undefined,nodeHighlight:undefined,renderTo:undefined,x:undefined,y:undefined,parentComponent:undefined,showDots:true,initialize:function(a){this.ds=a.ds;this.record=a.record;this.shape=this.ds.shapeOf(this.record)||this.record.__shape||"circle";this.renderTo=a.renderTo;this.parentComponent=a.parentComponent;this.showDots=this.parentComponent.getParent().showDots;this.node=this.getNewNode();this.node.attr("stroke-width",0);this.node.css("cursor","pointer");this.node.css("fill",this.record.getParent().__color);this.node.css("stroke",this.record.getParent().__stroke);this.node.set("d",this.getPath());this.renderTo.append(this.node);if(!this.showDots){this.node.set("fill-opacity",0);this.node.set("stroke-opacity",0)}if(this.parentComponent.getParent().interactive){this.ds.on("enter"+this.record.__uid,this.enter.bind(this));this.ds.on("leave"+this.record.__uid,this.leave.bind(this))}this.parentComponent.chart().on("leavegroup",this.leave.bind(this))},getPath:function(a){return ludo.chart.ChartUtil.getShape(this.shape,a?this.size*1.4:this.size)},getNewNode:function(){return new ludo.svg.Path()},enter:function(){if(this.nodeHighlight==undefined){this.nodeHighlight=new ludo.svg.Node("circle",{r:this.size*1.6,cx:0,cy:0});this.nodeHighlight.css({"stroke-opacity":0.5,fill:this.record.getParent().__color,"stroke-width":0,stroke:"none","fill-opacity":0.3});this.renderTo.append(this.nodeHighlight);this.node.toFront()}this.nodeHighlight.setTranslate(this.x,this.y);this.nodeHighlight.show();this.node.css("stroke",this.record.getParent().__stroke);this.node.set("stroke-width",1);var a={};a.d=this.getPath(true);if(!this.showDots){a["fill-opacity"]=1;a["stroke-opacity"]=1}this.parentComponent.parentComponent.onFragmentAction("enter",this.parentComponent,this.record,this.nodeHighlight,{});this.node.animate(a,{duration:100,validate:function(f,d){return f==d}});this.fireEvent("enter",this)},leave:function(){if(!this.nodeHighlight){return}this.nodeHighlight.hide();var a={d:this.getPath(false)};this.node.set("stroke-width",0);if(!this.showDots){a["fill-opacity"]=0;a["stroke-opacity"]=0}this.node.animate(a,{duration:100,validate:function(f,d){return f==d}});this.fireEvent("leave",this)},position:function(a,b){this.x=a;this.y=b;this.node.setTranslate(a,b);if(this.nodeHighlight){this.nodeHighlight.setTranslate(a,b)}},hide:function(){this.node.hide()},show:function(){this.node.show()}});ludo.chart.Outline=new Class({Extends:ludo.chart.Base,fragmentType:undefined,outline:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["outline"]);this.createOutline()},onResize:function(){this.parent();var a=this.getSize();jQuery.each(this.outline,function(b,d){d.toFront();switch(b){case"around":d.css({width:a.x,height:a.y});break;case"left":d.attr("y2",a.y);break;case"right":d.attr("x2",a.x);d.attr("x1",a.x);d.attr("y2",a.y);break;case"top":d.attr("x2",a.x);break;case"bottom":d.attr("x2",a.x);d.attr("y1",a.y);d.attr("y2",a.y);
break}}.bind(this))},createOutline:function(){if(!this.outline){return}var b=this.getSize();if(this.outline.left||this.outline.bottom||this.outline.top||this.outline.right){jQuery.each(this.outline,function(d,g){var h={x1:0,y1:0,x2:0,y2:0};var f=this.outline[d]=new ludo.svg.Node("line",h);f.css(g);this.append(f)}.bind(this))}else{var a=this.outline.around=new ludo.svg.Rect({x:0,y:0,width:b.x,height:b.y});a.css(this.outline);this.append(a)}}});ludo.chart.LineUtil={minTickSize:120,_ticks:undefined,values:function(d,k,h,a,f){var l=this.ticks(0,(k-d)/h*(f||this.minTickSize));var g=l.pop();var j=[];var b=d+(d%g);while(b<=k){j.push(b);b+=g}return j},ticks:function(f,a){if(this._ticks==undefined){this.createTicks()}var b=[];var d=0;while(this._ticks[d]<=a&&d<this._ticks.length){var g=this._ticks[d];if(g>=f&&g<=a){b.push(g)}d++}return b},createTicks:function(){this._ticks=[];var b=1/100;for(var a=0;a<10;a++){this._ticks.push(-b);this._ticks.push(-2*b);this._ticks.push(-5*b);b*=10}b=0.1;this._ticks.push(0);for(a=0;a<10;a++){this._ticks.push(b);this._ticks.push(2*b);this._ticks.push(5*b);b*=10}}};ludo.chart.Scatter=new Class({Extends:ludo.chart.Base,fragmentType:"chart.ScatterSeries",type:"chart.Scatter",revealAnim:true,getTooltipPosition:function(){return"above"}});ludo.chart.ScatterSeries=new Class({Extends:ludo.chart.Fragment,type:"chart.ScatterSeries",dots:undefined,highlightNode:undefined,dotSize:8,createNodes:function(){this.parent();this.dots=[];var a=this.record.__color;this.highlightNode=new ludo.svg.Node("circle",{cx:0,cy:0,r:this.dotSize*1.2});this.highlightNode.hide();this.highlightNode.set("fill",this.record.__colorOver);this.highlightNode.set("fill-opacity",0.2);this.getParent().getChartNode().append(this.highlightNode);var b=this.record.getChildren();jQuery.each(b,function(d,g){var f=this.createNode("path",{d:ludo.chart.ChartUtil.getShape(this.record.__shape,this.dotSize)},"",g);f.set("fill",a);f.set("stroke",this.record.__stroke);f.set("stroke-width",0);f.set("data-index",d);this.dots.push(f)}.bind(this))},enterNode:function(b,a){var d=a.getTranslate();this.highlightNode.setTranslate(d[0],d[1]);this.highlightNode.show();a.set("stroke-width",1);this.animatePath(a,this.dotSize*1.4);var f=this.record.getChild(a.get("data-index"));this.parentComponent.onFragmentAction("enter",this,f,this.highlightNode,{})},leaveNode:function(b,a){this.parent(b,a);this.highlightNode.hide();a.set("stroke-width",0);this.animatePath(a,this.dotSize)},animatePath:function(b,a){var d=ludo.chart.ChartUtil.getShape(this.record.__shape,a);b.animate({d:d},{duration:100})},resize:function(b,a){this.parent(b,a);this.positionNodes()},animate:function(){this.positionNodes()},positionNodes:function(){var b=this.record.getChildren();var a=this.ds.minX();var f=this.ds.maxX();var g=this.ds.minY();var d=this.ds.maxY();jQuery.each(b,function(k,j){var h=(j.x-a)/(f-a);var l=(j.y-g)/(d-g);h*=this.area.width;l*=this.area.height;l=this.area.height-l;this.dots[k].setTranslate(h,l)}.bind(this))}});ludo.chart.ChartUtil={getShape:function(d,g){var h=g;if(d=="rotatedrect"){h=Math.sqrt((h*h)+(h*h))}var f=-(h/2);var b=(h/2);switch(d){case"circle":var a=g/2;return["m",f,0,"a",a,a,0,1,0,g,0,"a",a,a,0,1,0,-g,0].join(" ");case"rect":return["M",f,f,"L",b,f,b,b,f,b,f,f].join(" ");case"triangle":return["M",0,f,"L",b,b,f,b,0,f].join(" ");case"rotatedrect":return["M",f,0,"L",0,f,b,0,0,b,f,0].join(" ")}}};ludo.chart.Ticks=new Class({Extends:ludo.chart.Base,type:"chart.Ticks",fragmentType:undefined,axis:undefined,animate:false,vAlign:undefined,ticks:undefined,styles:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["axis","vAlign","styles"]);this.vAlign=this.vAlign||(this.axis=="x"?"top":"right");this.ticks=[];this.styling=this.styling||{};this.styling["stroke-width"]=this.styling["stroke-width"]||1},render:function(){this.parent();this.positionTicks()},onResize:function(){this.parent();this.positionTicks()},positionTicks:function(){if(!this.width||!this.height){return}var b=this.axis=="x"?this.ds.minX():this.ds.minY();var h=this.axis=="x"?this.ds.maxX():this.ds.maxY();var l=this.getSize();var d=this.axis=="x"?l.x:l.y;jQuery.each(this.ticks,function(o,n){n.hide()});var f=0;var m=this.getTick(f++);var a=m.css("stroke-width")/2;if(this.axis=="x"){var g=this.vAlign=="top"?a:this.height-a;m.setProperties({x1:0,x2:this.width,y1:g,y2:g});m.show()}else{var j=this.vAlign=="left"?a:this.width-a;m.setProperties({x1:j,x2:j,y1:0,y2:d});m.show()}var k=ludo.chart.LineUtil.values(b,h,d);jQuery.each(k,function(p,n){var o=this.getTick(f++);o.show();var q=(n-b)/(h-b)*d;if(this.axis=="x"){o.set("x1",q);o.set("x2",q);o.set("y1",0);o.set("y2",this.height)}else{o.set("y1",this.height-q);o.set("y2",this.height-q);o.set("x1",0);o.set("x2",this.width)}}.bind(this));k=ludo.chart.LineUtil.values(b,h,d,this,ludo.chart.LineUtil.minTickSize/5);jQuery.each(k,function(p,n){var o=this.getTick(f++);o.show();var q=(n-b)/(h-b)*d;if(this.axis=="x"){o.set("x1",q);o.set("x2",q);o.set("y1",this.vAlign=="top"?0:this.height);
o.set("y2",this.height/2)}else{o.set("y1",this.height-q);o.set("y2",this.height-q);o.set("x1",this.vAlign=="left"?0:this.width);o.set("x2",this.width/2)}}.bind(this))},getTick:function(a){if(this.ticks[a]==undefined){this.ticks[a]=new ludo.svg.Node("line");this.ticks[a].css(this.styles);this.getChartNode().append(this.ticks[a])}return this.ticks[a]}});ludo.chart.BgLines=new Class({Extends:ludo.chart.Base,type:"chart.BgLines",fragmentType:undefined,x:undefined,y:undefined,lines:undefined,animate:false,__construct:function(a){this.parent(a);this.lines={x:[],y:[]};this.setConfigParams(a,["x","y"])},onResize:function(){this.parent();this.resizeBgLines("x");this.resizeBgLines("y")},render:function(){this.resizeBgLines("x");this.resizeBgLines("y")},resizeBgLines:function(j){if(this[j]==undefined){return}var h=this.getSize();var g=j=="x"?this.ds.minX():this.ds.minY();var a=j=="x"?this.ds.maxX():this.ds.maxY();var d=ludo.chart.LineUtil.values(g,a,j=="y"?h.y:h.x,this);jQuery.each(this.lines[j],function(m,l){l.hide()});for(var f=0;f<d.length;f++){var k=(d[f]-g)/(a-g);var b=this.getLine(j,f);b.show();if(j=="y"){b.attr("x2",h.x);b.attr("y1",h.y-(h.y*k));b.attr("y2",h.y-(h.y*k))}else{b.attr("y2",h.y);b.attr("x1",h.x*k);b.attr("x2",h.x*k)}}},getLine:function(d,a){if(this.lines[d][a]==undefined){var b=new ludo.svg.Node("line",{x1:0,y1:0,x2:0,y2:0});this.append(b);b.css(this[d]);this.lines[d].push(b)}return this.lines[d][a]}});ludo.ludoDB.Factory=new Class({Extends:ludo.Core,ludoDBConfig:undefined,arguments:undefined,resource:undefined,url:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["url","resource","arguments"]);if(this.arguments&&!ludo.util.isArray(this.arguments)){this.arguments=[this.arguments]}this.ludoDBConfig=a},load:function(){var a=[this.resource];if(this.arguments){a.splice(1,0,this.arguments)}var b=new ludo.remote.JSON({resource:"LudoJS",url:this.getUrl()});b.addEvent("success",this.parseNewData.bind(this));b.send("form",a)},parseNewData:function(a){this.fireEvent("load",a.getResponseData())}});ludo.color.Base=new Class({Extends:ludo.View,setColor:function(a){this.value=a}});ludo.color.Boxes=new Class({Extends:ludo.color.Base,__construct:function(a){this.parent(a);this.setConfigParams(a,["colors"])},ludoDOM:function(){this.parent();this.$b().css("overflowY","auto")},ludoEvents:function(){this.parent();this.$b().on("click",this.clickOnColorBox.bind(this))},__rendered:function(){this.parent();this.addColorBoxes()},addColorBoxes:function(){var f=[];for(var d=0;d<this.colors.length;d++){var a=this.getColorsIn(this.colors[d]);if(a.length>1){f.push('<div style="clear:both">')}for(var b=0;b<a.length;b++){f.push(this.getColorBox(a[b]))}if(a.length>1){f.push("</div>")}}this.$b().html(f.join(""))},getColorBox:function(a){if(!ludo.util.isArray(a)){a=[a,a]}var b=[];b.push('<div title="'+a[0]+'" rgbColor="'+a[1]+'" class="ludo-color-box" style="background-color:'+a[1]+'"></div>');return b.join("")},getColorsIn:function(f){var b=[];switch(f){case"grayScale":for(var d=0;d<256;d+=8){var g=this.getColorPrefixed(d);var a="#"+g+g+g;b.push([a,a])}break;case"namedColors":return this.namedColors;default:return f}return b},getColorPrefixed:function(b){var a=b.toString(16);if(a.length===1){a="0"+a}return a},clickOnColorBox:function(a){if(jQuery(a.target).hasClass("ludo-color-box")){this.fireEvent("setColor",jQuery(a.target).attr("rgbColor"))}}});ludo.color.NamedColors=new Class({Extends:ludo.color.Boxes,colors:["grayScale","namedColors"],namedColors:[["AliceBlue","#F0F8FF"],["AntiqueWhite","#FAEBD7"],["Aqua","#00FFFF"],["Aquamarine","#7FFFD4"],["Azure","#F0FFFF"],["Beige","#F5F5DC"],["Bisque","#FFE4C4"],["Black","#000000"],["BlanchedAlmond","#FFEBCD"],["Blue","#0000FF"],["BlueViolet","#8A2BE2"],["Brown","#A52A2A"],["BurlyWood","#DEB887"],["CadetBlue","#5F9EA0"],["Chartreuse","#7FFF00"],["Chocolate","#D2691E"],["Coral","#FF7F50"],["CornflowerBlue","#6495ED"],["Cornsilk","#FFF8DC"],["Crimson","#DC143C"],["Cyan","#00FFFF"],["DarkBlue","#00008B"],["DarkCyan","#008B8B"],["DarkGoldenRod","#B8860B"],["DarkGray","#A9A9A9"],["DarkGreen","#006400"],["DarkKhaki","#BDB76B"],["DarkMagenta","#8B008B"],["DarkOliveGreen","#556B2F"],["Darkorange","#FF8C00"],["DarkOrchid","#9932CC"],["DarkRed","#8B0000"],["DarkSalmon","#E9967A"],["DarkSeaGreen","#8FBC8F"],["DarkSlateBlue","#483D8B"],["DarkSlateGray","#2F4F4F"],["DarkTurquoise","#00CED1"],["DarkViolet","#9400D3"],["DeepPink","#FF1493"],["DeepSkyBlue","#00BFFF"],["DimGray","#696969"],["DimGrey","#696969"],["DodgerBlue","#1E90FF"],["FireBrick","#B22222"],["FloralWhite","#FFFAF0"],["ForestGreen","#228B22"],["Fuchsia","#FF00FF"],["Gainsboro","#DCDCDC"],["GhostWhite","#F8F8FF"],["Gold","#FFD700"],["GoldenRod","#DAA520"],["Gray","#808080"],["Green","#008000"],["GreenYellow","#ADFF2F"],["HoneyDew","#F0FFF0"],["HotPink","#FF69B4"],["IndianRed","#CD5C5C"],["Indigo","#4B0082"],["Ivory","#FFFFF0"],["Khaki","#F0E68C"],["Lavender","#E6E6FA"],["LavenderBlush","#FFF0F5"],["LawnGreen","#7CFC00"],["LemonChiffon","#FFFACD"],["LightBlue","#ADD8E6"],["LightCoral","#F08080"],["LightCyan","#E0FFFF"],["LightGoldenRodYellow","#FAFAD2"],["LightGray","#D3D3D3"],["LightGreen","#90EE90"],["LightPink","#FFB6C1"],["LightSalmon","#FFA07A"],["LightSeaGreen","#20B2AA"],["LightSkyBlue","#87CEFA"],["LightSlateGray","#778899"],["LightSteelBlue","#B0C4DE"],["LightYellow","#FFFFE0"],["Lime","#00FF00"],["LimeGreen","#32CD32"],["Linen","#FAF0E6"],["Magenta","#FF00FF"],["Maroon","#800000"],["MediumAquaMarine","#66CDAA"],["MediumBlue","#0000CD"],["MediumOrchid","#BA55D3"],["MediumPurple","#9370DB"],["MediumSeaGreen","#3CB371"],["MediumSlateBlue","#7B68EE"],["MediumSpringGreen","#00FA9A"],["MediumTurquoise","#48D1CC"],["MediumVioletRed","#C71585"],["MidnightBlue","#191970"],["MintCream","#F5FFFA"],["MistyRose","#FFE4E1"],["Moccasin","#FFE4B5"],["NavajoWhite","#FFDEAD"],["Navy","#000080"],["OldLace","#FDF5E6"],["Olive","#808000"],["OliveDrab","#6B8E23"],["Orange","#FFA500"],["OrangeRed","#FF4500"],["Orchid","#DA70D6"],["PaleGoldenRod","#EEE8AA"],["PaleGreen","#98FB98"],["PaleTurquoise","#AFEEEE"],["PaleVioletRed","#DB7093"],["PapayaWhip","#FFEFD5"],["PeachPuff","#FFDAB9"],["Peru","#CD853F"],["Pink","#FFC0CB"],["Plum","#DDA0DD"],["PowderBlue","#B0E0E6"],["Purple","#800080"],["Red","#FF0000"],["RosyBrown","#BC8F8F"],["RoyalBlue","#4169E1"],["SaddleBrown","#8B4513"],["Salmon","#FA8072"],["SandyBrown","#F4A460"],["SeaGreen","#2E8B57"],["SeaShell","#FFF5EE"],["Sienna","#A0522D"],["Silver","#C0C0C0"],["SkyBlue","#87CEEB"],["SlateBlue","#6A5ACD"],["SlateGray","#708090"],["Snow","#FFFAFA"],["SpringGreen","#00FF7F"],["SteelBlue","#4682B4"],["Tan","#D2B48C"],["Teal","#008080"],["Thistle","#D8BFD8"],["Tomato","#FF6347"],["Turquoise","#40E0D0"],["Violet","#EE82EE"],["Wheat","#F5DEB3"],["White","#FFFFFF"],["WhiteSmoke","#F5F5F5"],["Yellow","#FFFF00"],["YellowGreen","#9ACD32"]]});
ludo.color.RgbColors=new Class({Extends:ludo.color.Boxes,colors:["rgb","grayScale"],getColorsIn:function(j){switch(j){case"rgb":var d=[];for(var h=15;h>=0;h-=3){for(var f=0;f<16;f+=3){for(var a=0;a<16;a+=3){d.push(this.getColorFrom(h,f,a))}}}return d;default:return this.parent(j)}},getColorFrom:function(f,d,a){return"#"+this.getHexColor(f)+this.getHexColor(d)+this.getHexColor(a)},getHexColor:function(a){a=a.toString(16).toUpperCase();return a+a}});ludo.layout.Table=new Class({Extends:ludo.layout.Base,table:undefined,tbody:undefined,countChildren:undefined,cols:undefined,currentRow:undefined,fixedWidth:undefined,totalWeight:undefined,countCellsInNextRow:undefined,simple:false,rowHeight:undefined,onCreate:function(){this.parent();this.countChildren=0;this.cols=this.view.layout.columns;if(this.view.layout.rowHeight!=undefined){this.rowHeight=this.view.layout.rowHeight}this.fixedWidth=0;this.totalWeight=0;this.simple=this.view.layout.simple||this.simple;var g=[];for(var b=0;b<this.cols.length;b++){var a=this.cols[b];var f=a.width!=undefined?a.width:0;this.fixedWidth+=f;this.totalWeight+=(a.weight!=undefined?a.weight:0);var d=f!=undefined&&f>0?' width="'+f+'"':"";g.push("<col"+d+">")}this.table=jQuery('<table style="padding:0;margin:0;border-collapse: collapse"><colgroup>'+(g.join(""))+"</table>");this.tbody=jQuery("<tbody></tbody>");this.table.append(this.tbody);this.view.$b().append(this.table)},addChild:function(d,a,b){return this.parent(d,a,b)},getParentForNewChild:function(g){if(this.countChildren==0||g.layout.row||(this.simple&&this.countChildren%this.cols.length==0)){g.layout.row=true;this.currentRow=jQuery('<tr style="border:none;padding:0;margin:0"></tr>');this.tbody.append(this.currentRow);this.countCellsInNextRow=this.cols.length}var f=g.layout.colspan?g.layout.colspan:1;var b=g.layout.rowspan?g.layout.rowspan:1;var d=g.layout.vAlign?g.layout.vAlign:"top";var a=jQuery('<td style="vertical-align:'+d+';margin:0;padding:0" colspan="'+f+'" rowspan="'+b+'"></td>');this.currentRow.append(a);this.countChildren+=f;return a},resize:function(){var g=this.view.children;var b=0;for(var d=0;d<g.length;d++){var f=g[d];if(f.layout.row){b=0}var a={};if(this.rowHeight!=undefined){a.height=this.rowHeight}if(f.layout.height!=undefined){a.height=f.layout.height}a.width=this.getWidthOfChild(f,b);f.resize(a);f.saveState();b+=f.layout.colspan?f.layout.colspan:1}},getWrappedHeight:function(){return this.parent()+this.table.outerHeight()},getWidthOfChild:function(j,b){var h=j.layout.colspan?j.layout.colspan:1;if(j.layout.width){return j.layout.width}var f=0;var a=this.view.$b().width();var g=a-this.fixedWidth;for(var d=b;d<b+h;d++){if(this.cols[d].width){f+=this.cols[d].width}else{if(this.cols[d].weight){f+=(g*this.cols[d].weight/this.totalWeight)}}}return f}});ludo.layout.Accordion=new Class({Extends:ludo.layout.Base,easing:"swing",titleEls:undefined,titleHeight:undefined,expandedView:undefined,expandedChild:undefined,expandedTitle:undefined,childIndex:0,duration:200,busy:false,onCreate:function(){this.parent();var a=this.view.layout;if(a.easing!=undefined){this.easing=a.easing}if(a.duration!=undefined){this.duration=a.duration}this.titleEls=[]},addChild:function(d,a,b){if(d.layout==undefined){d.layout={}}d.layout.index=this.childIndex++;return this.parent(d,a,b)},addChildEvents:function(a){a.addEvent("show",this.onShowHide.bind(this));a.addEvent("hide",this.onShowHide.bind(this))},onShowHide:function(d){var b=d.id;var a=d.hidden?"none":"";jQuery("#accordion-title-"+b).css("display",a);jQuery("#accordion-"+b).css("display",a);this.measureTitleHeight();this.resize();if(!d.hidden){this.expandChild(b)}if(b==this.expandedChild){this.expandedChild=this.firstExpanded();this.expandChild(this.expandedChild)}},onNewChild:function(a){this.parent(a);if(this.hasBeenRendered()){this.measureTitleHeight();this.resize()}},getParentForNewChild:function(g){var d=jQuery('<div class="ludo-framed-view-titlebar ludo-accordion-titlebar"></div>');var f=jQuery('<div class="ludo-framed-view-titlebar-title ludo-accordion-title"></div>');var b=jQuery('<div class="ludo-accordion-collapsed"></div>');b.attr("id","accordion-expand-"+g.id);d.attr("id","accordion-title-"+g.id);d.attr("data-accordion-for",g.id);d.on("click",this.getExpandFn(g));d.attr("data-child-index",g.layout.index);d.append(b);d.append(f);if(g.title){f.html(g.title)}this.view.$b().append(d);this.titleEls.push(d);var a=jQuery('<div class="ludo-accordion-container" style="height:0"></div>');a.attr("id","accordion-"+g.id);this.view.$b().append(a);if(g.hidden){d.css("display","none");a.css("display","none")}return a},getExpandFn:function(a){return function(){this.expandChild(a.id)}.bind(this)},expandChild:function(m){if(this.busy){return}var a=jQuery("#accordion-"+m);var j=jQuery("#accordion-expand"+m);if(m==this.expandedChild){return}var g=this.viewport.height-this.titleHeight;if(this.expandedView){var f=this.expandedView;var b=this.onAnimationComplete.bind(this);var l=this.duration;var k=this.easing;
a.height(0);jQuery(function(){f.animate({height:0,easing:k},l,b);a.animate({height:g,easing:k},l)});this.busy=true}else{a.animate({height:g},200)}this.expandedView=a;this.expandedChild=m;this.toggleTitle(m)},titleNextOfOpened:undefined,expandIcon:undefined,toggleTitle:function(d){if(this.expandIcon){this.expandIcon.removeClass("ludo-accordion-expanded")}this.expandIcon=jQuery("#accordion-expand-"+d);this.expandIcon.addClass("ludo-accordion-expanded");this.expandedTitle=jQuery("#accordion-title-"+d);if(this.titleNextOfOpened){this.titleNextOfOpened.removeClass("ludo-accordion-titlebar-below-expanded")}var a=parseInt(this.expandedTitle.attr("data-child-index"));var b=this.nextVisible(a);if(b>=0){this.titleNextOfOpened=this.titleEls[b];this.titleNextOfOpened.addClass("ludo-accordion-titlebar-below-expanded")}},nextVisible:function(a){for(var b=a+1;b<this.view.children.length;b++){if(!this.view.children[b].hidden){return b}}return -1},measureTitleHeight:function(){this.titleHeight=0;for(var a=0;a<this.titleEls.length;a++){if(!this.view.children[a].hidden){this.titleHeight+=this.titleEls[a].outerHeight()}}},onAnimationComplete:function(){this.busy=false},beforeFirstResize:function(){this.measureTitleHeight();this.expandedChild=this.firstExpanded().id;this.expandedView=jQuery("#accordion-"+this.expandedChild);this.expandedView.css("height",this.viewport.height-this.titleHeight);this.toggleTitle(this.expandedChild)},firstExpanded:function(){var a=undefined;var d=this.view.children;for(var b=0;b<d.length;b++){if(d[b].layout.expanded&&!d[b].hidden){a=d[b];break}}if(!a){for(b=0;b<d.length;b++){if(!d[b].hidden){a=d[b];break}}}return a},resize:function(){var f=this.view.children;var d=this.viewport.height-this.titleHeight;if(this.expandedView){this.expandedView.css("height",d)}var b={width:this.viewport.width,height:d};for(var a=0;a<f.length;a++){f[a].resize(b)}}});ludo.layout.Linear=new Class({Extends:ludo.layout.Base,onCreate:function(){this.view.$b().css("overflow","hidden");this.view.$b().css("position","relative");this.parent()},onNewChild:function(a){this.parent(a);this.updateLayoutObject(a);a.addEvent("collapse",this.minimize.bind(this));a.addEvent("expand",this.clearTemporaryValues.bind(this));a.addEvent("minimize",this.minimize.bind(this));a.addEvent("maximize",this.clearTemporaryValues.bind(this));a.addEvent("show",this.clearTemporaryValues.bind(this))},updateLayoutObject:function(a){a.layout=a.layout||{};a.layout.width=a.layout.width||a.width;a.layout.height=a.layout.height||a.height;a.layout.weight=a.layout.weight||a.weight;a.layout.resizable=a.layout.resizable||a.resizable;a.layout.minWidth=a.layout.minWidth||a.minWidth;a.layout.maxWidth=a.layout.maxWidth||a.maxWidth;a.layout.minHeight=a.layout.minHeight||a.minHeight;a.layout.maxHeight=a.layout.maxHeight||a.maxHeight},isResizable:function(a){return a.layout.resizable?true:false},beforeResize:function(a,b){if(a.orientation==="horizontal"){a.setMinWidth(b.layout.minWidth||10);a.setMaxWidth(b.layout.maxWidth||this.view.$b().width())}else{a.setMinHeight(b.layout.minHeight||10);a.setMaxHeight(b.layout.maxHeight||this.view.$b().height())}},getResizableFor:function(d,b){var a=(b==="left"||b==="right")?"width":"height";return new ludo.layout.Resizer({name:"resizer-"+d.name,orientation:(b==="left"||b==="right")?"horizontal":"vertical",pos:b,hidden:d.isHidden(),renderTo:this.view.$b(),layout:{width:5,height:5},lm:d.getLayout(),view:d,listeners:{resize:function(f){d.layout[a]+=f;this.resize()}.bind(this),before:this.beforeResize.bind(this)}})}});ludo.layout.LinearHorizontal=new Class({Extends:ludo.layout.Linear,type:"layout.Linear",resize:function(){var k=this.viewport.width;var m=this.hasDynamicHeight()?"auto":this.viewport.height;if(m==0){return}var j=0;var g=0;for(var h=0;h<this.view.children.length;h++){if(this.view.children[h].isVisible()){if(!this.hasLayoutWeight(this.view.children[h])){var d=this.getWidthOf(this.view.children[h]);if(d){j+=d}}else{g+=this.view.children[h].layout.weight}}}g=Math.max(1,g);var a;k=a=k-j;var b=this.viewport.left;for(h=0;h<this.view.children.length;h++){var l=this.view.children[h];if(l.isVisible()){var f={height:m,left:b};if(this.hasLayoutWeight(l)){if(l.id==this.idLastDynamic){f.width=a}else{f.width=Math.round(k*l.layout.weight/g);a-=f.width}}else{f.width=this.getWidthOf(l)}this.resizeChild(l,f);b+=f.width}}for(h=0;h<this.resizables.length;h++){this.resizables[h].colResize()}},resizeChild:function(b,a){b.layout.width=a.width;b.layout.left=a.left;b.resize(a);b.saveState()},onNewChild:function(d){this.parent(d);d.getEl().css("position","absolute");if(this.isResizable(d)){var a=this.isLastSibling(d);var b=this.getResizableFor(d,a?"left":"right");this.addChild(b,d,a?"before":"after")}},hasDynamicHeight:function(){return this.view.layout.height&&this.view.layout.height=="dynamic"}});ludo.layout.LinearVertical=new Class({Extends:ludo.layout.Linear,onCreate:function(){this.parent()},resize:function(){var o=this.viewport.height;var r={width:this.viewport.width,height:o};
var j=0;var g=0;var q;var p=this.viewport.top;for(var h=0;h<this.view.children.length;h++){if(!this.hasLayoutWeight(this.view.children[h])){q=this.view.children[h].isHidden()?0:this.getHeightOf(this.view.children[h],r);j+=q}else{if(!this.view.children[h].isHidden()){g+=this.view.children[h].layout.weight}}}g=Math.max(1,g);var n;var b=n=(o-j);var a=this.view.$b().width();for(h=0;h<this.view.children.length;h++){var k=this.view.children[h];if(!k.isHidden()){var m=k.layout.width;var l=m&&!isNaN(m)?m:a;var f={width:k.type=="layout.Resizer"?a:l};if(f.width<this.viewport.width&&k.layout.anchor!=undefined){var d=this.viewport.width;f.left=d*k.layout.anchor-(f.width*k.layout.anchor)}if(m&&k.layout.align){switch(k.layout.align){case"right":f.left=this.viewport.width-k.layout.width;break;case"center":f.left=(this.viewport.width/2)-(k.layout.width/2);break}}if(this.hasLayoutWeight(k)){if(k.id==this.idLastDynamic){f.height=n}else{f.height=Math.round(b*k.layout.weight/g);n-=f.height}}else{f.height=this.getHeightOf(k,f)}if(f.height<0){f.height=undefined}if(p>0){f.top=p}this.resizeChild(k,f);p+=k.getEl().outerHeight(true)}}},resizeChild:function(b,a){b.layout.height=a.height;b.resize(a);b.saveState()},getWrappedHeight:function(){var b=this.parent();for(var a=0;a<this.view.children.length;a++){b+=this.view.children[0].getEl().outerHeight(true)}return b},onNewChild:function(f){this.parent(f);if(this.isResizable(f)){var b=this.isLastSibling(f);var a;if(f.layout&&f.layout.resizePos){a=f.layout.resizePos}else{a=b?"above":"below"}var d=this.getResizableFor(f,a);this.addChild(d,f,a=="above"?"before":"after")}f.getEl().css("position","absolute")}});ludo.layout.ViewPager=new Class({Extends:ludo.layout.Base,lastIndex:undefined,selectedIndex:undefined,animate:true,initialAnimate:false,animationDuration:250,touch:{},dragging:true,orientation:"horizontal",parentDiv:undefined,count:undefined,onCreate:function(){this.parent();var a=this.view.layout;if(a.animate!==undefined){this.animate=a.animate}if(a.dragging!==undefined){this.dragging=a.dragging}if(a.animationDuration!==undefined){this.animationDuration=a.animationDuration}if(a.orientation!==undefined){this.orientation=a.orientation}this.initialAnimate=this.animate;this.view.getEventEl().on(ludo.util.getDragMoveEvent(),this.touchMove.bind(this));this.view.getEventEl().on(ludo.util.getDragEndEvent(),this.touchEnd.bind(this))},getParentForNewChild:function(){if(this.parentDiv==undefined){this.parentDiv=jQuery('<div style="position:absolute"></div>');this.view.$b().append(this.parentDiv);this.parentDiv.on(ludo.util.getDragStartEvent(),this.touchStart.bind(this))}return this.parentDiv},beforeFirstResize:function(){this.resizeParentDiv();var a=0;for(var b=0;b<this.view.children.length;b++){if(this.view.children[b].layout.visible){a=b}}this.makeViewsVisible(a);this.setVisiblePageIndex(a)},afterRendered:function(){this.triggerEvents()},makeViewsVisible:function(a){this.view.children[a].show();if(a>0){this.view.children[a-1].show()}if(a<this.view.children.length-1){this.view.children[a+1].show()}},resizeParentDiv:function(){if(this.parentDiv==undefined){return}var a=this.viewport.width*(this.orientation=="horizontal"?this.view.children.length:1);var b=this.viewport.height*(this.orientation=="vertical"?this.view.children.length:1);this.parentDiv.css({width:a,height:b})},addChild:function(f,b,d){f.layout=f.layout||{};if(!f.layout.visible){f.hidden=true}f.layout.width=this.viewport.width;f.layout.height=this.viewport.height;f.layout.viewPagerIndex=this.view.children.length;var a=this.parent(f,b,d);this.resizeParentDiv();return a},onNewChild:function(a){a.getEl().css("position","absolute");a.addEvent("show",this.onChildShow.bind(this));a.addEvent("render",this.onPageRender.bind(this));a.applyTo=this.view;if(this.dragging){this.addDragEvents(a)}},onChildShow:function(a){this.positionPage(a);this.count=this.view.children.length},addDragEvents:function(a){},resize:function(){for(var b=0;b<this.view.children.length;b++){var a=this.view.children[b];if(!a.hidden){this.positionPage(a);a.resize({height:this.viewport.height,width:this.viewport.width})}}this.parentDiv.css(this.getAnimation(this.selectedIndex))},getVisiblePage:function(){return this.view.children[this.selectedIndex]},previousPage:function(a){return this.goToPage(this.selectedIndex-1,a)},goToPage:function(a,b){if(b==undefined){b=this.animate}if(!b){this.temporaryDisableAnimation()}if(a<0||a>=this.view.children.length){return false}this.setVisiblePageIndex(a);this.animateToSelected();this.makeViewsVisible(a);this.resetAnimation();return true},animateToSelected:function(){this.animateTo(this.selectedIndex)},animateTo:function(a){this.parentDiv.animate(this.getAnimation(a),this.animationDuration)},getAnimation:function(d){var a={};var b=this.orientation=="horizontal"?"left":"top";a[b]=this.getParentPos(d);return a},getParentPos:function(a){return this.orientation=="horizontal"?this.viewport.width*a*-1:this.viewport.height*a},nextPage:function(a){return this.goToPage(this.selectedIndex+1)
},temporaryDisableAnimation:function(){this.animate=false;this.resetAnimation.delay(500,this)},resetAnimation:function(){this.animate=this.initialAnimate},showPage:function(a){var d=this.view.child[a];if(d!=undefined){var b=this.view.children.indexOf(d);this.setVisiblePageIndex(b);this.animateToSelected();return true}return false},onPageRender:function(a){a.resize({width:this.viewport.width,height:this.viewport.height})},positionPage:function(b){var f=this.orientation=="horizontal"?"left":"top";var a=this.orientation=="horizontal"?this.viewport.width:this.viewport.height;var d=a*b.layout.viewPagerIndex;b.getEl().css(f,d)},setVisiblePageIndex:function(a){this.removeValidationEvents();this.lastIndex=this.selectedIndex||0;this.selectedIndex=a;this.addValidationEvents();if(this.hasBeenRendered()){this.triggerEvents()}},triggerEvents:function(){var b=this.getVisiblePage();var d=[this,this.view,b];var a=this.selectedIndex-this.lastIndex;if(a>0){this.fireEvent("higherpage",d)}else{if(a<0){this.fireEvent("lowerpage",d)}}this.fireEvent("showpage",d);if(this.selectedIndex==this.count-1){this.fireEvent("lastpage",d)}else{this.fireEvent("notlastpage",d)}if(this.selectedIndex==0){this.fireEvent("firstpage",d)}else{this.fireEvent("notfirstpage",d)}},removeValidationEvents:function(){if(this.selectedIndex!=undefined&&this.validFn){var a=this.getVisiblePage().getForm();if(a!=undefined){a.off("invalid",this.validFn);a.off("valid",this.invalidFn)}}},validFn:undefined,invalidFn:undefined,addValidationEvents:function(){if(this.validFn==undefined){this.validFn=this.setValid.bind(this);this.invalidFn=this.setInvalid.bind(this)}var a=this.getVisiblePage().getForm();a.on("invalid",this.invalidFn);a.on("valid",this.validFn);a.validate()},setInvalid:function(){console.log("set invalid",arguments);this.fireEvent("invalid",[this,this.view,this.view.children[this.selectedIndex]])},setValid:function(){console.log("set valid",arguments);this.fireEvent("valid",[this,this.view,this.view.children[this.selectedIndex]])},isFormValid:function(){var a=this.getVisiblePage();if(a==undefined){return true}var b=a.getForm();if(b!=undefined){return b.isValid()}return true},showFirstPage:function(){if(this.count>0){this.goToPage(0)}},showLastPage:function(){this.goToPage(this.count-1)},animationComplete:function(a){a.css({left:0,top:0,borderWidth:0})},touchStart:function(g){if(this.isOnFormElement(g.target)){return undefined}var f=this.view.children[this.selectedIndex].getForm().isValid();if(!f&&this.selectedIndex==0){return undefined}var d=this.orientation=="horizontal";var h=d?this.viewport.width:this.viewport.height;var b=0;if(this.selectedIndex<this.view.children.length-1&&f){b=(h*-1)}var a=this.selectedIndex>0?h:0;this.touch={active:true,pos:d?this.touchPosParent(g).pageX:this.touchPosParent(g).pageY,animateX:d,min:b,max:a,currentPos:this.parentDiv.position(),previousPos:0};if(g.target.tagName.toLowerCase()=="img"){return false}return false},touchMove:function(b){if(this.touch&&this.touch.active){var d;var a;if(this.touch.animateX){d=this.touchPosParent(b).pageX-this.touch.pos;a="left"}else{d=this.touchPosParent(b).pageY-this.touch.pos;a="top"}d=Math.min(d,this.touch.max);d=Math.max(d,(this.touch.min));this.setZIndexOfOtherPages(d);this.touch.previousPos=d;d+=this.touch.currentPos[a];this.parentDiv.css(a,d+"px");return false}return undefined},touchPosParent:function(a){return a.pageX!=undefined?a:a.originalEvent.touches[0]},setZIndexOfOtherPages:function(a){},touchEnd:function(){if(this.touch.active){this.touch.active=false;var a=this.touch.previousPos;if(a>0&&this.touch.max&&a>(this.touch.max/2)){this.previousPage()}else{if(a<0&&a<(this.touch.min/2)){this.nextPage()}else{this.animateToSelected()}}}},isOnFormElement:function(b){var a=b.tagName.toLowerCase();return a=="input"||a=="textarea"||a==="select"}});ludo.layout.Tabs=new Class({Extends:ludo.View,type:"layout.Tabs",tabPos:"left",lm:undefined,tabs:{},svgTexts:{},currentPos:-1,activeTab:undefined,currentZIndex:3,activeTabId:undefined,css:{overflow:"hidden"},tabParent:undefined,tabPositions:undefined,tabMenuEl:undefined,elLine:undefined,maxPos:undefined,maxSize:undefined,hiddenTabs:undefined,menu:undefined,tabTitles:undefined,alwaysInFront:true,__construct:function(a){this.parent(a);this.setConfigParams(a,["tabPos"]);this.lm=a.lm;this.hiddenTabs=[];this.tabTitles={}},ludoEvents:function(){this.parent();this.lm.addEvent("addChild",this.registerChild.bind(this));this.lm.addEvent("addChildRuntime",this.resizeTabs.bind(this));this.lm.addEvent("showChild",this.activateTabFor.bind(this));this.lm.addEvent("hideChild",this.hideTabFor.bind(this));this.lm.addEvent("removeChild",this.removeTabFor.bind(this));this.addEvent("resize",this.resizeTabs.bind(this))},__rendered:function(){this.parent();this.resizeTabs();this.$b().css("overflow","hidden")},registerChild:function(b,a,d){if(!this.lm.isTabs(d)){this.createTabFor(d)}},resizeTabs:function(){this.showAllTabs();if(this.tabPositions==undefined){this.tabPositions={}
}this.resizeTabsDom();if(this.tabPos==="top"||this.tabPos==="bottom"){this.findHiddenTabs()}},showAllTabs:function(){jQuery.each(this.tabs,function(a){this.tabs[a].show()}.bind(this))},resizeTabsDom:function(){var b=0;var a;jQuery.each(this.tabs,function(d){var f=this.tabs[d];if(this.tabPos==="top"||this.tabPos==="bottom"){a=f.outerWidth(true)}else{a=f.outerHeight(true)}this.tabPositions[d]={pos:b,size:a};f.css(this.getPosAttribute(),b+"px");b+=a;this.maxPos=b}.bind(this))},findHiddenTabs:function(){if(!this.tabParent){return}this.tabParent.css("left",0);if(!this.haveTabsOutOfView()){if(this.tabMenuEl){this.tabMenuEl.hide()}return}this.moveCurrentIntoView();this.hiddenTabs=[];var a=this.$b().width();var b=this.getMenuIcon();a-=b.outerWidth(true);var d=Math.abs(this.tabParent.position().left);jQuery.each(this.tabPositions,function(g,f){if(f.pos<d||f.pos+f.size>d+a){this.hiddenTabs.push(g);if(f.pos>=d){this.tabs[g].hide()}}else{this.tabs[g].show()}}.bind(this));b.html(this.hiddenTabs.length);b.css("visibility",this.hiddenTabs.length>0?"visible":"hidden");if(this.hiddenTabs.length>0){this.maxSize=a-b.outerWidth(true);this.moveCurrentIntoView();this.getMenuIcon().show()}this.resizeTabsDom()},moveCurrentIntoView:function(){var d=this.$b().width();var g=this.getMenuIcon();d-=g.outerWidth(true);var j=Math.abs(this.tabParent.position().left);var a=this.tabPositions[this.activeTabId];var h=a.pos-j;var f=(a.pos+a.size)-(j+d);if(h<0){this.tabParent.css("left",h)}else{if(f>0){var b=j-f;this.tabParent.css("left",b)}}},haveTabsOutOfView:function(){return this.maxPos>this.$b().width()},getMenuIcon:function(){if(this.tabMenuEl==undefined){if(this.tabPos=="left"||this.tabPos=="right"){this.tabMenuEl=this.$b();return this.tabMenuEl}this.tabMenuEl=jQuery('<div class="ludo-tab-expand-box ludo-tab-expand-box-'+this.tabPos+'"></div>');this.$b().append(this.tabMenuEl);var b=this.$b().outerHeight()-this.elLine.height();var a=this.tabPos=="top"||this.tabPos=="bottom"?"height":"width";this.tabMenuEl.css(a,b);if(this.tabPos=="bottom"){this.tabMenuEl.css("top",this.elLine.outerHeight())}this.tabMenuEl.css("line-height",b+"px");this.tabMenuEl.on("click",this.toggleMenu.bind(this));this.tabMenuEl.css("visibility","hidden");this.tabMenuEl.mouseenter(this.enterMenuIcon.bind(this));this.tabMenuEl.mouseleave(this.leaveMenuIcon.bind(this))}return this.tabMenuEl},enterMenuIcon:function(a){jQuery(a.target).addClass("ludo-tab-expand-box-"+this.tabPos+"-over")},leaveMenuIcon:function(a){jQuery(a.target).removeClass("ludo-tab-expand-box-"+this.tabPos+"-over")},getMenu:function(){if(this.menu==undefined){var a={type:"menu",orientation:"vertical",alignLeft:this.tabMenuEl,height:"wrap",width:"wrap"};if(this.tabPos=="top"){a.below=this.tabMenuEl}else{a.above=this.tabMenuEl}this.menu=new ludo.menu.Menu({renderTo:document.body,hidden:true,alwaysInFront:true,layout:a,listeners:{click:function(b){if(b.action&&this.tabs[b.action]!=undefined){ludo.$(b.action).show();this.menu.hide();this.resizeTabs()}}.bind(this)}});this.menu.getEl().mousedown(ludo.util.cancelEvent);ludo.EffectObject.on("start",this.hideMenu.bind(this));jQuery(document.documentElement).mousedown(this.domClick.bind(this))}return this.menu},menuShown:false,domClick:function(a){if(this.menu==undefined){return}if(a.target==this.tabMenuEl[0]){return}this.hideMenu()},autoHide:function(){this.hideMenu()},hideMenu:function(){this.getMenu().hide()},toggleMenu:function(){var a=this.getMenu();if(a.isHidden()){this.showMenu()}else{this.menu.hide()}},showMenu:function(){this.menuShown=true;var a=this.getMenu();a.show();a.disposeAllChildren();jQuery.each(this.hiddenTabs,function(b,d){a.addChild({label:this.tabTitles[d],action:d})}.bind(this));this.menu.getLayout().resize()},createTabFor:function(b){if(this.tabParent==undefined){this.tabParent=jQuery('<div style="position:absolute" class="ludo-tab-layout-parent-for-tabs ludo-tab-layout-parent-for-tabs-'+this.tabPos+'"></div>');if(this.tabPos=="top"||this.tabPos=="bottom"){this.tabParent.css({height:this.$b().height(),width:10000})}else{this.tabParent.css({width:this.$b().width(),height:10000})}this.$b().append(this.tabParent)}var a;if(this.tabPos==="top"||this.tabPos=="bottom"){a=this.getPlainTabFor(b)}else{a=this.getSVGTabFor(b)}a.on("click",b.show.bind(b,false));this.tabParent.append(a);if(b.layout.closable){this.addCloseButton(a,b)}a.css(this.getPosAttribute(),this.currentPos);a.addClass("ludo-tab-strip-tab");a.addClass("ludo-tab-strip-tab-"+this.tabPos);this.tabs[b.getId()]=a;if(!b.isHidden()){this.activateTabFor(b)}},addCloseButton:function(b,f){var a=jQuery("<div>");a.addClass("ludo-tab-close ludo-tab-close-"+this.tabPos);a.mouseenter(this.enterCloseButton.bind(this));a.mouseleave(this.leaveCloseButton.bind(this));a.attr("id","tab-close-"+f.id);a.on("click",this.removeChild.bind(this));b.append(a);var d;switch(this.tabPos){case"top":case"bottom":d=b.css("padding-right");b.css("paddingRight",(parseInt(d)+a.outerWidth()));break;case"right":d=b.css("padding-right");
b.css("paddingBottom",(parseInt(d)+a.outerHeight()));break;case"left":d=b.css("padding-right");b.css("paddingTop",(parseInt(d)+a.outerHeight()));break}},removeChild:function(a){var b=a.target.id.replace("tab-close-","");ludo.get(b).remove();return false},removeTabFor:function(a){this.tabs[a.getId()].remove();if(this.svgTexts[a.getId()]){this.svgTexts[a.getId()].remove();delete this.svgTexts[a.getId()]}delete this.tabs[a.getId()];this.tabPositions[a.getId()]=undefined;this.resizeTabs()},enterCloseButton:function(a){jQuery(a.target).addClass("ludo-tab-close-"+this.tabPos+"-over")},leaveCloseButton:function(a){jQuery(a.target).removeClass("ludo-tab-close-"+this.tabPos+"-over")},getPosAttribute:function(){if(!this.posAttribute){switch(this.tabPos){case"top":case"bottom":this.posAttribute="left";break;case"left":case"right":this.posAttribute="top";break}}return this.posAttribute},getPlainTabFor:function(b){var a=jQuery("<div>");this.$b().append(a);a.className="ludo-tab-strip-tab ludo-tab-strip-tab-"+this.tabPos;a.html('<div class="ludo-tab-strip-tab-bg"></div><span style="z-index:2">'+this.getTitleFor(b)+"</span>");return a},getSVGTabFor:function(g){var b=jQuery('<div><div class="ludo-tab-strip-tab-bg"></div></div>');this.$b().append(b);var f=jQuery('<div style="z-index:2;position:relative">');b.append(f);var d=new ludo.layout.TextBox({renderTo:f,width:1000,height:1000,className:"ludo-tab-strip-tab-txt-svg",classNameOver:"ludo-tab-strip-tab-txt-svg-active",text:this.getTitleFor(g),rotation:this.getRotation()});var a=d.getSize();f.css({width:a.x,height:a.y});this.svgTexts[g.getId()]=d;return b},getRotation:function(){if(this.rotation===undefined){switch(this.tabPos){case"left":this.rotation=270;break;case"right":this.rotation=90;break;case"bottom":this.rotation=180;break;default:this.rotation=0;break}}return this.rotation},getTitleFor:function(b){var a=(b.title||b.layout.title||b.getTitle());this.tabTitles[b.id]=a;return a},hideTabFor:function(){if(this.activeTab!=undefined){this.activeTab.removeClass("ludo-tab-strip-tab-active");this.svgTextMethod(this.activeTabId,"leave")}},svgTextMethod:function(b,d){var a=this.svgTexts[b];if(a!=undefined&&a[d]!=undefined){a[d]()}},activateTabFor:function(a){this.hideTabFor();if(this.tabs[a.id]!==undefined){this.svgTextMethod(a.id,"enter");this.tabs[a.id].addClass("ludo-tab-strip-tab-active");this.activeTab=this.tabs[a.id];this.activeTab.css("zIndex",this.currentZIndex);this.currentZIndex++;this.activeTabId=a.id;if(this.hiddenTabs.length>0){this.resizeTabs()}}},ludoDOM:function(){this.parent();this.getEl().addClass("ludo-tab-strip");this.getEl().addClass("ludo-tab-strip-"+this.tabPos);var a=jQuery("<div>");a.addClass("ludo-tab-strip-line");this.elLine=a;this.$b().append(a);this.getMenuIcon()},getTabFor:function(a){return this.tabs[a.id]},getChangedViewport:function(){var a;if(this.tabPos==="top"||this.tabPos==="bottom"){a=this.getEl().outerHeight(true)}else{a=this.getEl().outerWidth(true)}return{key:this.tabPos,value:a}},getCount:function(){return Object.keys(this.tabs).length},resize:function(a){this.parent(a)}});ludo.layout.Relative=new Class({Extends:ludo.layout.Base,children:undefined,type:"layout.Relative",layoutFnProperties:["bottom","right","top","left","width","height","alignParentTop","alignParentBottom","alignParentLeft","alignParentRight","leftOf","rightOf","below","above","alignLeft","alignRight","alignTop","alignBottom","sameWidthAs","sameHeightAs","centerInParent","centerHorizontal","centerVertical","fillLeft","fillRight","fillUp","fillDown","absBottom","absWidth","absHeight","absLeft","absTop","absRight","offsetX","offsetY","widthOffset","heightOffset"],newChildCoordinates:{},lastChildCoordinates:{},onCreate:function(){this.parent();this.view.$b().css("position","relative")},resize:function(){if(this.children===undefined){this.prepareResize()}for(var a=0;a<this.children.length;a++){if(!this.children[a].layoutResizeFn){this.children[a].layoutResizeFn=this.getResizeFnFor(this.children[a])}this.children[a].layoutResizeFn.call(this.children[a],this)}},prepareResize:function(){this.fixLayoutReferences();this.arrangeChildren();this.createResizeFunctions()},createResizeFunctions:function(){for(var a=0;a<this.children.length;a++){this.children[a].layoutResizeFn=this.getResizeFnFor(this.children[a])}},fixLayoutReferences:function(){for(var d=0;d<this.view.children.length;d++){var f=this.view.children[d];var a=this.depKeys;for(var b=0;b<a.length;b++){if(f.layout[a[b]]!==undefined){f.layout[a[b]]=this.getReference(f.layout[a[b]])}}}},getResizeFnFor:function(b){var a=this.getLayoutFnsFor(b);return function(d){for(var f=0;f<a.length;f++){a[f].call(b,d)}}},getLayoutFnsFor:function(g){var a=[];var f=this.layoutFnProperties;for(var b=0;b<f.length;b++){if(g.layout[f[b]]!==undefined&&g.layout[f[b]]!==false){var d=this.getLayoutFn(f[b],g);if(d){a.push(d)}}}a.push(this.getLastLayoutFn(g));return a},getLayoutFn:function(b,f){var d=this.newChildCoordinates[f.id];var a;switch(b){case"top":case"left":case"bottom":case"right":return function(){d[b]=f.layout[b]
}.bind(f);case"offsetX":return function(){d.left+=f.layout[b]}.bind(f);case"offsetY":return function(){d.top+=f.layout[b]}.bind(f);case"width":case"height":return this.getPropertyFn(f,b);case"absLeft":return function(){d.left=0};case"absRight":return function(){d.right=0};case"absBottom":return function(){d.bottom=0};case"absWidth":return function(g){d.width=g.viewport.absWidth};case"absHeight":return function(g){d.height=g.viewport.absHeight};case"alignParentLeft":return function(g){d.left=g.viewport.left};case"alignParentRight":return function(g){d.right=g.viewport.right};case"alignParentTop":return function(g){d.top=g.viewport.top};case"alignParentBottom":return function(g){d.bottom=g.viewport.bottom};case"leftOf":a=this.lastChildCoordinates[f.layout.leftOf.id];return function(){d.right=a.right+a.width};case"rightOf":a=this.lastChildCoordinates[f.layout.rightOf.id];return function(){d.left=a.left+a.width};case"below":a=this.lastChildCoordinates[f.layout.below.id];return function(){d.top=a.top+a.height};case"above":a=this.lastChildCoordinates[f.layout.above.id];return function(){d.bottom=a.bottom+a.height};case"sameHeightAs":a=this.lastChildCoordinates[f.layout.sameHeightAs.id];return function(){d.height=a.height};case"sameWidthAs":a=this.lastChildCoordinates[f.layout.sameWidthAs.id];return function(){d.width=a.width};case"centerInParent":return function(g){d.top=parseInt(g.viewport.height/2-d.height/2);d.left=parseInt(g.viewport.width/2-d.width/2)};case"centerHorizontal":return function(g){d.left=parseInt(g.viewport.width/2-d.width/2)};case"centerVertical":return function(g){d.top=parseInt(g.viewport.height/2-d.height/2)};case"fillLeft":return function(g){if(d.right!==undefined){d.width=g.viewport.absWidth-d.right}};case"fillRight":return function(g){if(d.left===undefined){d.left=0}d.width=g.viewport.absWidth-d.left-g.viewport.right};case"fillDown":return function(g){if(d.top===undefined){d.top=0}d.height=g.viewport.absHeight-d.top-g.viewport.bottom};case"fillUp":return function(g){if(d.bottom!==undefined){d.height=g.viewport.absHeight-d.bottom-g.viewport.top}};case"alignLeft":return this.getAlignmentFn(f,b,"left");case"alignRight":return this.getAlignmentFn(f,b,"right");case"alignTop":return this.getAlignmentFn(f,b,"top");case"alignBottom":return this.getAlignmentFn(f,b,"bottom")}return undefined},getAlignmentFn:function(g,f,b){var d=this.newChildCoordinates[g.id];var a=this.lastChildCoordinates[g.layout[f].id];return function(){d[b]=a[b]}},getPropertyFn:function(h,f){var g=this.newChildCoordinates[h.id];if(isNaN(h.layout[f])){switch(h.layout[f]){case"matchParent":return function(j){var k=h.layout[f+"Offset"]||0;g[f]=j.viewport[f]+k};case"wrap":var a=ludo.dom.getWrappedSizeOfView(h);var d=f==="width"?"x":"y";return function(){g[f]=a[d]};default:if(h.layout[f].indexOf!==undefined&&h.layout[f].indexOf("%")>=0){var b=parseInt(h.layout[f].replace(/[^0-9]/g));return function(j){g[f]=parseInt(j.viewport[f]*b/100)}}return undefined}}else{return function(){g[f]=h.layout[f]}.bind(h)}},posProperties:["left","right","bottom","top"],getLastLayoutFn:function(a){return function(j){var l=j.newChildCoordinates[a.id];var g=j.lastChildCoordinates[a.id];var k=j.posProperties;if(a.layout.above&&a.layout.below){l.height=j.viewport.height-l.bottom-l.top}if(a.layout.leftOf&&a.layout.rightOf){l.width=j.viewport.width-l.right-l.left}if(a.isHidden()){l.width=0;l.height=0}a.resize({width:l.width!==g.width?l.width:undefined,height:l.height!==g.height?l.height:undefined});if(l.right!==undefined&&l.width){l.left=j.viewport.absWidth-l.right-l.width;l.right=undefined}if(l.bottom!==undefined&&l.height){l.top=j.viewport.absHeight-l.bottom-l.height;l.bottom=undefined}if(l.bottom!==undefined){var f=j.viewport.absHeight-l.bottom-(l.top||0);if(f!=g.height){a.resize({height:j.viewport.absHeight-l.bottom-(l.top||0)})}l.bottom=undefined}for(var d=0;d<k.length;d++){var b=k[d];if(l[b]!==undefined){j.positionChild(a,b,l[b])}g[b]=l[b]}g.width=l.width;g.height=l.height;j.updateLastCoordinatesFor(a)}},updateLastCoordinatesFor:function(f){var b=this.lastChildCoordinates[f.id];var a=f.getEl();var d=a.position==undefined?{left:a.offsetLeft,top:a.offsetTop}:a.position();if(b.left===undefined){b.left=d.left>0?d.left:0}if(b.top===undefined){b.top=d.top>0?d.top:0}if(b.width===undefined){b.width=a.width!=undefined?a.width():a.offsetWidth}if(b.height===undefined){b.height=a.height!=undefined?a.height():a.offsetHeight}if(b.right===undefined){b.right=this.viewport.width-b.left-b.width}if(b.bottom===undefined){b.bottom=this.viewport.height-b.top-b.height}},positionChild:function(d,b,a){d.getEl().css(b,a);d[b]=a},assignDefaultCoordinates:function(a){this.newChildCoordinates[a.id]={};this.lastChildCoordinates[a.id]={}},arrangeChildren:function(){this.children=[];for(var f=0;f<this.view.children.length;f++){var k=this.view.children[f];this.children.push(k);this.assignDefaultCoordinates(k);if(k.isHidden()){this.setTemporarySize(k,{width:0,height:0})}}this.createResizables();
var h=this.getWronglyArrangedChild();var a=0;while(h&&a<30){var g=this.getDependencies(h);if(g.length>0){for(var d=0;d<g.length;d++){if(this.isArrangedBefore(h,g[d])){var b=this.children.indexOf(h);this.children.splice(b,1);this.children.push(h)}}}h=this.getWronglyArrangedChild();a++}if(a===30){ludo.util.log("Possible circular layout references defined for children in Relative layout")}},resizeKeys:{left:"leftOf",right:"rightOf",above:"above",below:"below"},resizables:{},createResizables:function(){for(var b=this.children.length-1;b>=0;b--){var h=this.children[b];if(this.isChildResizable(h)){this.resizables[h.id]={};for(var a=0;a<h.layout.resize.length;a++){var d=h.layout.resize[a];var g=this.resizables[h.id][d]=this.getResizableFor(h,d);this.assignDefaultCoordinates(g);this.updateReference(this.resizeKeys[d],h,g);var f=d=="left"||d==="above"?b:b+1;this.children.splice(f,0,g)}}}},getResizable:function(b,a){return this.resizables[b.id][a]},getResizableFor:function(d,b){var a=(b==="left"||b==="right")?"width":"height";return new ludo.layout.Resizer({name:"resizer-"+d.name,hidden:d.isHidden(),orientation:(b==="left"||b==="right")?"horizontal":"vertical",pos:b,renderTo:this.view.$b(),sibling:this.getSiblingForResize(d,b),layout:this.getResizerLayout(d,b),lm:this,view:d,listeners:{resize:function(f){d.layout[a]+=f;this.resize()}.bind(this),before:this.beforeResize.bind(this)}})},getSiblingForResize:function(b,a){switch(a){case"left":return b.layout.rightOf;case"right":return b.layout.leftOf;case"above":return b.layout.below;case"below":return b.layout.above}return undefined},beforeResize:function(b,g){if(b.orientation==="horizontal"){var d=this.toPixels(g.layout.minWidth||10);b.setMinWidth(d);var a=g.layout.maxWidth||this.view.$b().width();a=this.toPixels(a,true);b.setMaxWidth(a)}else{var f=this.toPixels(g.layout.minHeight||10);b.setMinHeight(f);b.setMaxHeight(g.layout.maxHeight||this.view.$b().height())}},toPixels:function(b,a){if(jQuery.type(b)=="string"&&b.indexOf("%")>0){var d=parseInt(b);return d/100*(a?this.viewport.width:this.viewport.height)}return b},getResizerLayout:function(d,b){var a={};switch(b){case"left":case"right":a.sameHeightAs=d;a.alignTop=d;a.width=5;break;default:a.sameWidthAs=d;a.alignLeft=d;a.height=5}return a},updateReference:function(b,f,d){for(var a=0;a<this.children.length;a++){if(this.children[a].layout[b]===f){this.children[a].layout[b]=d;d.layout.affectedSibling=this.children[a]}}d.layout[b]=f},isChildResizable:function(a){return a.layout&&a.layout.resize&&a.layout.resize.length>0},getWronglyArrangedChild:function(){for(var b=0;b<this.children.length;b++){var f=this.children[b];var d=this.getDependencies(f);if(d.length>0){for(var a=0;a<d.length;a++){if(this.isArrangedBefore(f,d[a])){return f}}}}return undefined},isArrangedBefore:function(b,a){return this.children.indexOf(b)<this.children.indexOf(a)},depKeys:["above","below","leftOf","rightOf","alignLeft","alignBottom","alignRight","alignTop","sameWidthAs","sameHeightAs"],getDependencies:function(f){var a=[];for(var b=0;b<this.depKeys.length;b++){if(f.layout[this.depKeys[b]]!==undefined){var d=f.layout[this.depKeys[b]];if(d!==undefined){a.push(d)}}}return a},getReference:function(a){if(a.getId!==undefined){return a}if(this.view.child[a]!==undefined){return this.view.child[a]}return ludo.get(a)},clearChildren:function(){this.children=undefined},getChildren:function(){return this.children},onNewChild:function(b){this.parent(b);if(b.getEl().css!=undefined){b.getEl().css("position","absolute")}var a=b.layout;if(a.centerInParent!==undefined){a.centerHorizontal=undefined;a.centerVertical=undefined}if(a.fillRight===undefined){if(a.width===undefined){a.width=b.width?b.width:undefined}}if(a.height===undefined){a.height=b.height?b.height:undefined}if(a.leftOf){a.right=undefined}if(a.rightOf){a.left=undefined}if(a.below){a.top=undefined}if(a.above){a.bottom=undefined}},addChildEvents:function(a){a.addEvent("hide",this.hideChild.bind(this));a.addEvent("show",this.clearTemporaryValues.bind(this));a.addEvent("collapse",this.minimize.bind(this));a.addEvent("minimize",this.minimize.bind(this));a.addEvent("expand",this.clearTemporaryValues.bind(this));a.addEvent("maximize",this.clearTemporaryValues.bind(this))}});ludo.layout.Tab=new Class({Extends:ludo.layout.Relative,visibleChild:undefined,tabStrip:undefined,type:"layout.Tab",onCreate:function(){this.parent();this.view.getEl().addClass("ludo-layout-tab");this.addChild(this.getTabs());this.updateViewport(this.tabStrip.getChangedViewport())},afterCreate:function(){},addChild:function(d,a,b){if(!this.isTabs(d)&&(!d.layout||!d.layout.visible)){d.hidden=true}return this.parent(d,a,b)},onNewChild:function(b){if(!this.isTabs(b)){var a=b.layout;if(!b.isHidden()){this.setVisibleChild(b)}a.alignParentLeft=true;a.alignParentTop=true;a.fillRight=true;a.fillDown=true}this.parent(b)},setTemporarySize:function(){},addChildEvents:function(a){if(!this.isTabs(a)){a.addEvent("show",this.showTab.bind(this));a.addEvent("remove",this.onChildDispose.bind(this))
}},getTabPosition:function(){return this.view.layout.tabs||"top"},canHaveNoActiveTabs:false,getTabs:function(){if(this.tabStrip===undefined){this.tabStrip=new ludo.layout.Tabs({lm:this,parentComponent:this.view,tabPos:this.getTabPosition(),renderTo:this.view.$b(),layout:this.getTabsLayout(),canHaveNoActiveTabs:this.canHaveNoActiveTabs})}return this.tabStrip},setVisibleChild:function(a){if(this.visibleChild){this.visibleChild.hide()}this.visibleChild=a;this.fireEvent("showChild",a)},showTab:function(a){if(a!==this.visibleChild){if(this.visibleChild){this.visibleChild.getEl().css("visibility","hidden")}a.getEl().css("visibility","visible");this.setVisibleChild(a);this.resize()}},resize:function(){if(this.visibleChild===undefined&&this.autoShowFirst()){if(this.view.children.length>1){this.view.children[1].show()}}else{if(this.children===undefined||(this.visibleChild&&!this.visibleChild.layoutResizeFn)){this.prepareResize()}this.tabStrip.layoutResizeFn.call(this.visibleChild,this);if(this.visibleChild){if(!this.visibleChild.layoutResizeFn){this.prepareResize()}this.visibleChild.layoutResizeFn.call(this.visibleChild,this)}}},autoShowFirst:function(){return true},getTabsLayout:function(){switch(this.getTabPosition()){case"top":return{absTop:true,absLeft:true,absWidth:true};case"left":return{absTop:true,absLeft:true,absHeight:true};case"right":return{absTop:true,absRight:true,absHeight:true};case"bottom":return{absBottom:true,absLeft:true,absWidth:true}}return undefined},isTabs:function(a){return a.type==="layout.Tabs"},onChildDispose:function(b){if(this.visibleChild&&this.visibleChild.id===b.id){var a=this.view.children.indexOf(this.visibleChild);if(a>1){this.view.children[a-1].show()}else{if(this.view.children.length>2){this.view.children[a+1].show()}}}this.fireEvent("removeChild",b)}});ludo.layout.Docking=new Class({Extends:ludo.layout.Tab,type:"layout.Docking",storedSize:undefined,collapsed:true,tabSize:undefined,tabSizeKey:undefined,prepareForChildrenOnCreate:function(a){jQuery.each(a,function(b,d){if(d.layout&&d.layout.visible){this.collapsed=false}}.bind(this));if(this.collapsed){this.storedSize={key:this.getTabSizeKey(),value:this.view.layout[this.getTabSizeKey()]};this.view.layout[this.getTabSizeKey()]=this.pixelSize()}},addChildEvents:function(a){this.parent(a);if(!this.isTabs(a)){a.addEvent("hide",this.hideTab.bind(this))}},hideTab:function(a){if(a==this.visibleChild){this.collapse();this.fireEvent("hideChild",a)}},setVisibleChild:function(a){if(!this.collapsed){this.visibleChild=a;this.fireEvent("showChild",a)}},collapse:function(){this.fireEvent("collapse",this);if(this.visibleChild){this.visibleChild.getEl().css("visibility","hidden");this.fireEvent("hideChild",this.visibleChild)}this.visibleChild=undefined;this.collapsed=true;this.storeSize();switch(this.getTabPosition()){case"top":case"bottom":this.view.resize({height:this.pixelSize()});break;case"left":case"right":this.view.layout.width=this.pixelSize();this.view.resize({width:this.pixelSize()})}this.resizeParentView()},storeSize:function(){switch(this.getTabPosition()){case"top":case"bottom":if(this.storedSize==undefined){this.storedSize={key:"height",value:this.viewport.height}}break;case"left":case"right":if(this.storedSize==undefined){this.storedSize={key:"width",value:this.viewport.width}}}},showTab:function(b){if(b==this.visibleChild){this.visibleChild.getEl().css("visibility","hidden");this.collapse();this.fireEvent("hideChild",b)}else{if(this.collapsed){this.fireEvent("expand");this.collapsed=false;this.updateViewport(this.storedSize);var a={};a[this.storedSize.key]=this.storedSize.value;this.view.resize(a);this.resize();this.resizeParentView()}this.parent(b)}},tabPixelSize:undefined,isHorizontal:function(){var a=this.getTabPosition();return a=="top"||a=="bottom"},pixelSize:function(){if(this.tabPixelSize==undefined){if(this.isHorizontal()){this.tabPixelSize=this.view.children[0].$b().height()}else{this.tabPixelSize=this.view.children[0].$b().width()}}return this.tabPixelSize},getTabSize:function(){if(this.tabSize==undefined){if(this.isHorizontal()){this.tabSize={key:"height",value:this.pixelSize()}}else{this.tabSize={key:"width",value:this.pixelSize()}}}return this.tabSize},getTabSizeKey:function(){if(this.tabSizeKey==undefined){switch(this.getTabPosition()){case"top":case"bottom":this.tabSizeKey="height";break;case"left":case"right":this.tabSizeKey="width"}}return this.tabSizeKey},autoShowFirst:function(){return false},resizeParentView:function(){if(this.view.parentComponent){this.view.parentComponent.getLayout().resize()}},beforeFirstResize:function(){if(this.collapsed){this.fireEvent("collapse")}},resizeChildren:function(){this.parent();if(!this.collapsed){var a=this.getTabSizeKey();var b=this.viewport[a];if(b>this.getTabSize().value){this.storedSize={key:a,value:b}}}}});ludo.layout.Fill=new Class({Extends:ludo.layout.Relative,addChild:function(d,a,b){if(d.layout==undefined){d.layout={}}d.layout.width=d.layout.height="matchParent";d.layout.alignParentTop=true;
d.layout.alignParentLeft=true;return this.parent(d,a,b)}});ludo.layout.Grid=new Class({Extends:ludo.layout.Base,columns:undefined,rows:undefined,colWidth:undefined,rowHeight:undefined,padX:undefined,padY:undefined,onCreate:function(){var a=this.view.layout;this.columns=a.columns||5;this.rows=a.rows||5;this.padX=a.padX||0;this.padY=a.padY||0;this.view.$b().css("position","relative")},addChild:function(d,a,b){d.layout=d.layout||{};if(d.layout.x==undefined&&d.layout.y==undefined){d.layout.x=this.view.children.length%this.columns;d.layout.y=Math.floor(this.view.children.length/this.columns)}d.layout.colspan=d.layout.colspan||1;d.layout.rowspan=d.layout.rowspan||1;d.layout.x=d.layout.x||0;d.layout.y=d.layout.y||0;return this.parent(d,a,b)},resize:function(){this.storeSize();for(var a=0;a<this.view.children.length;a++){var d=this.view.children[a];var b=this.pos(d);b.width=this.widthOfView(d);b.height=this.heightOfView(d);d.resize(b)}},pos:function(a){return{left:a.layout.x*this.colWidth,top:a.layout.y*this.rowHeight}},widthOfView:function(d){var b=d.layout.colspan||1;var a=b*this.colWidth;return a-this.padX},heightOfView:function(b){var a=b.layout.rowspan||1;return(a*this.rowHeight)-this.padY},storeSize:function(){this.colWidth=this.viewport.width/this.columns;this.rowHeight=this.viewport.height/this.rows},onNewChild:function(a){a.getEl().css("position","absolute")}});ludo.layout.Popup=new Class({Extends:ludo.layout.Base,visibleChild:undefined,addChild:function(d,a,b){if(!d.layout||!d.layout.visible){d.hidden=true}return this.parent(d,a,b)},onNewChild:function(a){if(!a.isHidden()){this.setVisibleChild(a)}a.getEl().css("position","absolute");a.addEvent("show",this.setVisibleChild.bind(this));this.parent(a)},setVisibleChild:function(a){if(this.visibleChild&&this.shouldToggle()){this.visibleChild.hide()}this.visibleChild=a;this.fireEvent("showChild",a)},getParentForNewChild:function(){return document.body},shouldToggle:function(){return this.view.layout.toggle},resize:function(){var b=this.view.children;for(var a=0;a<b.length;a++){if(!b[a].isHidden()){b[a].getLayout().getRenderer().resize()}}}});ludo.layout.Canvas=new Class({Extends:ludo.layout.Relative,type:"layout.Canvas",addChild:function(b){b=this.getValidChild(b);b=this.getNewComponent(b);this.view.children.push(b);var a=b.parentNode?this.view:this.view.svg();a.append(b);this.onNewChild(b);this.addChildEvents(b);this.fireEvent("addChild",[b,this]);return b},addChildEvents:function(a){a.addEvent("hide",this.hideChild.bind(this));a.addEvent("show",this.clearTemporaryValues.bind(this))},positionChild:function(d,b,a){d[b]=a;this.currentTranslate[b]=a;d.position(this.currentTranslate.left,this.currentTranslate.top)},currentTranslate:{left:0,top:0},zIndexAdjusted:false,_rendered:false,resize:function(){this.parent();if(!this.zIndexAdjusted){this.zIndexAdjusted=true;for(var a=0;a<this.children.length;a++){if(this.children[a].layout.zIndex!=undefined){var b=this.view.parentNode?this.view.parentNode:this.view.svg();b.append(this.children[a])}}}if(!this._rendered){this._rendered=true;jQuery.each(this.view.children,function(d,f){if(f.__rendered!=undefined){f.__rendered()}})}},getAvailWidth:function(){if(!this.view.parentNode){return this.parent()}return this.view.width},getAvailHeight:function(){if(!this.view.parentNode){return this.parent()}return this.view.height},getParentForNewChild:function(){return this.view.node}});ludo.layout.NavBar=new Class({Extends:ludo.layout.Base,slideEl:undefined,onCreate:function(){this.view.$b().css("overflowX","hidden")},onNewChild:function(a){this.parent(a);a.getEl().css("position","absolute")},resize:function(){var a=this.getWidthOfMenu();this.view.children[0].resize({width:a,height:this.viewport.height});this.slideEl.css({width:(this.viewport.absWidth+a),left:this.view.layout.active?0:(a*-1)});this.view.children[1].getEl().css("left",a+"px");this.view.children[1].resize({width:this.viewport.absWidth,height:this.viewport.height})},show:function(){if(!this.isMenuOpen()){if(this.view.children[0].hidden){this.view.children[0].show()}this.view.layout.active=true;this.slideEl.animate({left:0},this.getDuration(),this.getEasing())}},hide:function(){if(this.isMenuOpen()){this.view.layout.active=false;var a=this.getWidthOfMenu();this.slideEl.animate({left:a*-1},this.getDuration(),this.getEasing())}},isMenuOpen:function(){return this.view.layout.active},toggle:function(){this[this.view.layout.active?"hide":"show"]()},effect:function(){if(this.effectObject===undefined){this.effectObject=new ludo.effect.Effect}return this.effectObject},getDuration:function(){return this.view.layout.duration||150},getEasing:function(){return this.view.layout.easing||"swing"},getWidthOfMenu:function(){var a=this.view.children[0].layout.width;if(isNaN(a)){switch(a){case"matchParent":return this.viewport.width;default:return parseInt(a)*this.viewport.width/100}}else{return a}},getParentForNewChild:function(){if(!this.slideEl){this.slideEl=jQuery('<div style="height:100%;position:absolute"></div>');
this.view.$b().append(this.slideEl)}return this.slideEl}});ludo.layout.MenuContainer=new Class({Extends:Events,type:"layout.MenuContainer",lm:undefined,layout:{width:"wrap",height:"wrap"},children:[],alwaysInFront:true,initialize:function(a){this.lm=a;this.setLayout();this.createDom()},setLayout:function(){var a=this.layout;if(this.lm.view.parentComponent){var d=this.getSubMenuVAlign();var b=this.getSubMenuHAlign();if(this.getParentLayoutOrientation()==="horizontal"){a[d]=this.lm.view.getParent().getEl();a.alignLeft=this.lm.view}else{a[b]=this.lm.view.getEl();a[d==="above"?"alignBottom":"alignTop"]=this.lm.view;a.offsetY=-3}this.lm.view.layout.alignSubMenuV=this.lm.view.layout.alignSubMenuV||d;this.lm.view.layout.alignSubMenuH=this.lm.view.layout.alignSubMenuH||b;a.height="wrap"}a.fitVerticalViewPort=true},getSubMenuVAlign:function(){var a=["above","below"];var b=this.lm.view.parentComponent;return b&&b.layout.alignSubMenuV&&a.indexOf(b.layout.alignSubMenuV)!==-1?b.layout.alignSubMenuV:"below"},getSubMenuHAlign:function(){var a=["leftOrRightOf","rightOrLeftOf","leftOf","rightOf"];var b=this.lm.view.parentComponent;return b&&b.layout.alignSubMenuH&&a.indexOf(b.layout.alignSubMenuH)!==-1?b.layout.alignSubMenuH:"rightOrLeftOf"},getParentLayoutOrientation:function(){var a=this.lm.view.parentComponent;return a?a.layout.orientation:""},createDom:function(){this.el=jQuery('<div style="position:absolute;display:none"></div>');jQuery(document.body).append(this.el);this.el.addClass("ludo-menu-vertical-"+this.getSubMenuVAlign());if(this.getSubMenuHAlign().indexOf("left")===0){this.el.addClass("ludo-menu-vertical-to-left")}if(this.getParentLayoutOrientation()==="horizontal"&&this.getSubMenuVAlign().indexOf("above")===0){this.lm.view.parentComponent.getEl().addClass("ludo-menu-horizontal-up")}this.body=jQuery("<div>");this.el.append(this.body)},getEl:function(){return this.el},$b:function(){return this.body},resize:function(a){if(a.width){this.getEl().css("width",a.width+"px")}},isHidden:function(){return false},show:function(){this.getEl().css("zIndex",(ludo.util.getNewZIndex(this)+100));if(this.getEl().css("display")===""){return}this.getEl().css("display","");this.resizeChildren();this.getRenderer().resize();if(!this.layout.width||this.layout.width==="wrap"){this.setFixedRenderingWidth()}this.fireEvent("show",this)},setFixedRenderingWidth:function(){this.layout.width=undefined;var d=this.getRenderer();d.clearFn();d.setValue("width",d.getSize().x);d.resize();for(var a=0;a<this.lm.view.children.length;a++){var b=this.lm.view.children[a].getLayout().getRenderer();b.clearFn();b.setValue("width",d.getValue("width"))}this.resizeChildren()},childrenResized:false,resizeChildren:function(){if(this.childrenResized){return}for(var a=0;a<this.lm.view.children.length;a++){this.lm.view.children[a].getLayout().getRenderer().resize()}this.fireEvent("resize")},hide:function(){this.getEl().css("display","none");this.fireEvent("hide",this)},renderer:undefined,getRenderer:function(){if(this.renderer===undefined){this.renderer=new ludo.layout.Renderer({view:this})}return this.renderer}});ludo.layout.Menu=new Class({Extends:ludo.layout.Base,active:false,alwaysActive:false,type:"layout.Menu",onCreate:function(){this.menuContainer=new ludo.layout.MenuContainer(this);if(this.view.layout.active){this.alwaysActive=true}if(this.view.id===this.getTopMenuComponent().id){jQuery(document.documentElement).on("click",this.autoHideMenus.bind(this));ludo.EffectObject.addEvent("start",this.hideAllMenus.bind(this))}},getMenuContainer:function(){return this.menuContainer},getValidChild:function(a){if(ludo.util.isString(a)){a={html:a}}a.layout=a.layout||{};if(a.children&&!a.layout.type){a.layout.type="menu";a.layout.orientation="vertical"}a.type=a.type||"menu.Item";if(a.type==="menu.Item"){a.orientation=this.view.layout.orientation}else{a.layout.height=a.layout.height||a.height}return a},parentForNewChild:undefined,getParentForNewChild:function(){if(this.parentForNewChild===undefined){var a=!this.hasMenuLayout(this.view.parentComponent);var b=a?this.parent():this.getMenuContainer().$b();b.parent().addClass("ludo-menu");b.parent().addClass("ludo-menu-"+this.view.layout.orientation);if(a&&!this.view.layout.isContext){b.parent().addClass("ludo-menu-top")}this.parentForNewChild=b;if(a){this.view.addEvent("show",this.resize.bind(this))}}return this.parentForNewChild},onNewChild:function(a){this.assignMenuItemFns(a);if(this.hasMenuLayout(a)){a.addEvent("addChild",this.assignMenuItemFns.bind(this))}},hasMenuLayout:function(a){return a&&a.layout&&a.layout.type&&a.layout.type.toLowerCase()==="menu"},parentContainers:undefined,getTopMenuComponent:function(){var a=this.view;while(a.parentComponent&&this.hasMenuLayout(a.parentComponent)){a=a.getParent()}return a},assignMenuItemFns:function(g){var d=this;var f=d.view.getParent();var b=this.getTopMenuComponent();var a=b.getLayout();if(g.mouseOver===undefined){g.getEl().mouseenter(function(){this.mouseOver()}.bind(g));g.mouseOver=function(){this.fireEvent("enterMenuItem",this)
}.bind(g)}g.getMenuLayoutManager=function(){return this.parentComponent&&this.parentComponent.getMenuLayoutManager?this.parentComponent.getMenuLayoutManager():d}.bind(g);g.getParentMenuItem=function(){return d.hasMenuLayout(f)?d.view:undefined}.bind(g);g.isTopMenuItem=function(){return !d.hasMenuLayout(f)}.bind(g);g.getMenuContainer=function(){return d.getMenuContainer()}.bind(g);g.getMenuContainerToShow=function(){if(this.containerToShow===undefined){if(d.hasMenuLayout(this)&&this.children.length>0){if(!this.children[0].lifeCycleComplete){this.children[0].remainingLifeCycle()}this.containerToShow=this.children[0].getMenuContainer()}else{this.containerToShow=undefined}}return this.containerToShow}.bind(g);g.getMenuContainersToShow=function(){if(!this.menuContainersToShow){var j=[];var h=this.getParent();while(h&&h.layout.orientation==="vertical"){if(h.getMenuContainerToShow){j.unshift(h.getMenuContainerToShow())}h=h.getParent()}var k=this.getMenuContainerToShow();if(k){j.push(k)}this.menuContainersToShow=j}return this.menuContainersToShow}.bind(g);g.getMenuComponent=function(){return b}.bind(g);g.getParentMenuItems=function(){if(!this.parentMenuItems){this.parentMenuItems=[];var h=this.getParent();while(h&&h.getMenuContainer){this.parentMenuItems.push(h);h=h.getParent()}}return this.parentMenuItems}.bind(g);g.addEvent("click",function(){b.fireEvent("click",this)}.bind(g));if(this.view.layout.orientation==="horizontal"&&g.children.length>0){g.addEvent("click",function(){a.activate(g)}.bind(this))}else{g.addEvent("click",a.hideAllMenus.bind(a))}g.addEvent("enterMenuItem",function(){a.showMenusFor(g);a.highlightItemPath(g)}.bind(this))},shownMenus:[],activate:function(a){this.active=!this.active;if(this.shownMenus.length===0){ludo.EffectObject.fireEvents()}this.showMenusFor(a)},showMenusFor:function(d){if(!this.active&&!this.alwaysActive){this.hideMenus()}else{var a=d.getMenuContainersToShow();this.hideMenus(a);this.shownMenus=a;for(var b=0;b<this.shownMenus.length;b++){this.shownMenus[b].show()}}},hideAllMenus:function(){this.hideMenus();this.clearHighlightedPath();if(this.view.layout.isContext){this.view.getEl().css("display","none")}this.shownMenus=[]},hideMenus:function(b){b=b||[];for(var a=0;a<this.shownMenus.length;a++){if(b.indexOf(this.shownMenus[a])===-1){this.shownMenus[a].hide()}}},highlightedItems:[],highlightItemPath:function(d){var a=d.getParentMenuItems();this.clearHighlightedPath(a);for(var b=0;b<a.length;b++){a[b].getEl().addClass("ludo-menu-item-active")}this.highlightedItems=a},clearHighlightedPath:function(d){d=d||[];var a=this.highlightedItems;for(var b=0;b<a.length;b++){if(d.indexOf(a[b])===-1){a[b].getEl().removeClass("ludo-menu-item-active")}}},autoHideMenus:function(b){if(this.active||this.alwaysActive){var a=jQuery(b.target).parents(".ludo-menu");if(b.target.className&&b.target.className.indexOf&&b.target.className.indexOf("ludo-menu-item")===-1&&a.length==0){this.hideAllMenus();if(this.view.layout.orientation==="horizontal"){this.active=false}}}}});ludo.layout.MenuHorizontal=new Class({Extends:ludo.layout.Menu,getValidChild:function(a){a=this.parent(a);a.layout.width=a.layout.width||"wrap";return a},onNewChild:function(a){a.getEl().css("position","absolute");this.parent(a)},resized:false,resize:function(){this.resized=false;if(!this.resized){this.resized=true;var b=0;for(var a=0;a<this.view.children.length;a++){this.view.children[a].resize({left:b,height:this.viewport.height});b+=this.view.children[a].getEl().outerWidth(true)}}}});ludo.layout.MenuVertical=new Class({Extends:ludo.layout.Menu,active:true,getValidChild:function(a){a=this.parent(a);if(!a.layout.width){a.layout.width="matchParent"}return a},resize:function(){for(var a=0;a<this.view.children.length;a++){this.view.children[a].getLayout().getRenderer().resize()}}});ludo.layout.CollapseBar=new Class({Extends:ludo.View,orientation:undefined,position:undefined,views:[],viewportCoordinates:{},buttons:{},currentPos:0,__construct:function(a){this.parent(a);this.position=a.position||"left";this.setLayout()},ludoDOM:function(){this.parent();this.getEl().addClass("ludo-collapse-bar");this.getEl().addClass("ludo-collapse-bar-"+this.orientation);this.getEl().addClass("ludo-collapse-bar-"+this.position)},setLayout:function(){this.orientation=(this.position==="left"||this.position==="right")?"vertical":"horizontal";this.layout={};switch(this.position){case"left":this.layout.absLeft=true;this.layout.alignParentTop=true;this.layout.fillDown=true;this.layout.width=25;break;case"right":this.layout.absRight=true;this.layout.alignParentTop=true;this.layout.fillDown=true;this.layout.width=25;break;case"top":this.layout.absTop=true;this.layout.absLeft=true;this.layout.absWidth=true;this.layout.height=25;break;case"bottom":this.layout.absBottom=true;this.layout.absLeft=true;this.layout.absWidth=true;this.layout.height=25;break}},getChangedViewport:function(){var a=0;if(!this.isHidden()){switch(this.position){case"left":case"right":a=this.layout.width;
break;case"top":case"bottom":a=this.layout.height;break}}return{key:this.position,value:a}},addView:function(a){this.views.push(a);this.addButton(a)},addButton:function(a){var d=this.buttons[a.id]=jQuery("<div>");d.attr("id","button-"+a.id);d.mouseenter(this.enterButton.bind(this));d.mouseleave(this.leaveButton.bind(this));d.on("click",this.toggleView.bind(this));this.$b().append(d);d.html('<div class="collapse-bar-button-bg-first"></div><div class="collapse-bar-button-bg-last"></div>');d.addClass("collapse-bar-button collapse-bar-button-"+this.position);var f=new ludo.layout.TextBox({renderTo:d,text:a.title,rotation:this.getRotation(),className:"ludo-view-collapsed-title"});var b=f.getSize();d.css({width:b.x+"px",height:b.y+"px"});if(this.position==="top"||this.position==="bottom"){d.css("left",this.currentPos+"px");this.currentPos+=b.x+ludo.dom.getMBPW(d)}else{d.css("top",this.currentPos+"px");this.currentPos+=b.y+ludo.dom.getMBPH(d)}if(!a.isHidden()){this.activateButton(a)}a.addEvent("show",this.activateButton.bind(this));a.addEvent("hide",this.deactivateButton.bind(this))},getRotation:function(){switch(this.position){case"left":return 270;case"right":return 90;default:return 0}},toggleView:function(d){var b=this.getButtonByDom(d.target);var f=b.attr("id").replace("button-","");var a=ludo.get(f);if(a.isHidden()){a.show()}else{a.hide()}},enterButton:function(a){this.getButtonByDom(a.target).addClass("collapse-bar-button-over")},leaveButton:function(a){this.getButtonByDom(a.target).removeClass("collapse-bar-button-over")},activateButton:function(a){if(a.getParent().isHidden()){a.getParent().show()}this.buttons[a.id].addClass("collapse-bar-button-active")},toggleParent:function(a){if(this.allHidden(a)){a.getParent().hide()}},allHidden:function(a){var d=a.getParent();for(var b=0;b<d.children.length;b++){if(d.children[b].isHidden()||!d.children[b].title){}else{return false}}return true},deactivateButton:function(a){this.buttons[a.id].removeClass("collapse-bar-button-active");this.toggleParent.delay(50,this,a)},getButtonByDom:function(b){b=jQuery(b);var a=b.prop("tagName").toLowerCase();while(a==="svg"||a==="text"||!b.hasClass("collapse-bar-button")){b=b.parent();a=b.prop("tagName").toLowerCase()}return b},getViews:function(){return this.views}});ludo.CollectionView=new Class({Extends:ludo.View,emptyText:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["emptyText"])},ludoEvents:function(){this.parent();if(this.emptyText&&!this.getDataSource().hasRemoteSearch()){this.getDataSource().getSearcher().addEvents({matches:this.hideEmptyText.bind(this),noMatches:this.showEmptyText.bind(this)})}},hideEmptyText:function(){this.emptyEl().css("display","none")},showEmptyText:function(){var a=this.emptyEl();a.css("display","");a.html(this.getEmptyText());a.css({top:this.getEl().height()/2-(a.height()/2)})},emptyEl:function(){if(this._emptyEl===undefined){this._emptyEl=jQuery('<div class="ludo-empty-text" style="width:100%;position:absolute">'+this.getEmptyText()+"</div>");this._emptyEl.css("z-index",2000);this.getEl().append(this._emptyEl)}return this._emptyEl},getEmptyText:function(){return ludo.util.isFunction(this.emptyText)?this.emptyText.call():this.emptyText},_nodeContainer:undefined,nodeContainer:function(){if(this._nodeContainer===undefined){this._nodeContainer=jQuery('<div style="position:relative">');this.$b().append(this._nodeContainer)}return this._nodeContainer},render:function(){if(this.emptyText){var b=this.getDataSource();var a=b.isWaitingData()||b.getCount()>0;this[a?"hideEmptyText":"showEmptyText"]()}},JSON:function(){}});ludo.ListView=new Class({type:"ListView",Extends:ludo.CollectionView,defaultDS:"dataSource.JSONArray",overflow:"auto",highlighted:undefined,recordMap:{},dragAttr:undefined,swipable:false,itemHeight:0,availHeight:undefined,scrollTop:0,lastScrollTop:0,indexFirstVisible:0,indexLastVisible:0,outOfBounds:false,itemsRendered:false,itemRenderer:undefined,backSideLeft:undefined,backSideRight:undefined,backSideUndo:undefined,undoTimeout:2000,didUndo:false,scrollId:undefined,renderedMap:undefined,swipeEnded:0,__construct:function(a){this.parent(a);this.setConfigParams(a,["swipable","itemRenderer","backSideLeft","backSideRight","backSideUndo","undoTimeout"]);this.renderedMap={};this.on("rendered",this.render.bind(this))},ludoEvents:function(){this.parent();this.$b().on("click",this.onClick.bind(this))},__rendered:function(){this.parent();if(this.swipable){jQuery(document.body).on(ludo.util.getDragMoveEvent(),this.drag.bind(this));jQuery(document.body).on(ludo.util.getDragEndEvent(),this.dragEnd.bind(this))}this.getEl().addClass("ludo-list-view");this.$b().addClass("ludo-list-view-body");this.$b().css("overflow-x","hidden");this.$b().on("scroll",this.onScroll.bind(this));if(this.dataSource){this.getDataSource().addEvents({change:this.render.bind(this),select:this.select.bind(this),deselect:this.deselect.bind(this),update:this.update.bind(this),"delete":this.remove.bind(this)})}},onScroll:function(){this.lastScrollTop=this.scrollTop;
this.scrollTop=this.$b().scrollTop();this.lazyRender()},lazyRender:function(){var g=this.getDataSource().getCount();var a;this.outOfBounds=false;var k=this.getDataSource().getData();var j,h,b;var f=(Math.round(this.availHeight/this.itemHeight)*3);a=Math.max(0,this.indexFirstVisible+1);while(this.outOfBounds!=1&&a<g){j=k[a];if(!this.renderedMap[j.uid]){h=this.getRecordContainer(j);this.checkOutOfBounds(h);if(!this.outOfBounds){b=this.itemRenderer!=undefined?this.itemRenderer.call(this,j):this.getTplParser().getCompiled(j,this.tpl)[0];this.addInnerDOM(h,j,b);this.indexLastVisible=a;this.indexFirstVisible=a-f}}a++}this.outOfBounds=false;a=this.indexLastVisible-1;while(this.outOfBounds!=-1&&a>=0){j=k[a];if(!this.renderedMap[j.uid]){h=this.getRecordContainer(j);this.checkOutOfBounds(h);if(!this.outOfBounds){b=this.itemRenderer!=undefined?this.itemRenderer.call(this,j):this.getTplParser().getCompiled(j,this.tpl)[0];this.addInnerDOM(h,j,b);this.indexFirstVisible=a;this.indexLastVisible=Math.min(g,a+f)}}a--}},startDrag:function(h){var d=this.getDragDom(h.target);var g=ludo.util.pageXY(h);var j=d.position();var b=d.outerWidth(true);this.swipeEnded=0;var a=this.backSideRight!=undefined?-b+j.left:j.left;var f=this.backSideLeft!=undefined?b-j.left:j.left;this.dragAttr={backLeft:d.parent().find(".ludo-list-item-back-left"),backRight:d.parent().find(".ludo-list-item-back-right"),backUndo:d.parent().find(".ludo-list-item-back-undo"),recordUid:this.getRecordId(d),elPos:j,mouse:g,el:d,parent:this.getRecordDOM(h.target),minX:a,maxX:f,lastX:j.left,dragged:false};d.parent().find(".ludo-list-item-back-undo").css("z-index",0)},drag:function(g){if(this.dragAttr==undefined){return}var f=ludo.util.pageXY(g);var a=f.x-this.dragAttr.mouse.x+this.dragAttr.elPos.left;var h=f.y-this.dragAttr.mouse.y+this.dragAttr.elPos.top;if(!this.dragAttr.dragged&&Math.abs(h)>Math.abs(a)){this.dragAttr=undefined;return undefined}a=ludo.util.clamp(a,this.dragAttr.minX,this.dragAttr.maxX);var b,d;if(a>0&&this.dragAttr.lastX<=0){b=2;d=1}else{if(a<0&&this.dragAttr.lastX>=0){b=1;d=2}}this.dragAttr.backLeft.css("z-index",b);this.dragAttr.backRight.css("z-index",d);this.dragAttr.lastX=a;this.dragAttr.el.css("left",a);this.dragAttr.dragged=true;if(this.swipeEnded>0||Math.abs(f.x-this.dragAttr.mouse.x)>5){this.swipeEnded=new Date().getTime()}return false},onUndoTimeout:function(a,b){if(!this.didUndo){this.fireEvent("swipe",b);this.fireEvent(a,b)}},dragEnd:function(){if(this.dragAttr==undefined){return}if(this.swipeEnded){this.swipeEnded=new Date().getTime()}var a=this.dragAttr.el.outerWidth(true)/2;var k=this.dragAttr.el.position();if(k.left>a*1.2||k.left<-a*1.2){var b=this.dragAttr.parent;var g=this.dragAttr.recordUid;var f=k.left>0?1:-1;var d=this.getDataSource().find({uid:g});var h=f<0?"swipeLeft":"swipeRight";this.didUndo=false;var l=this.dragAttr.backUndo;var j;if(l.length){j=function(){l.css("z-index",3);this.onUndoTimeout.delay(this.undoTimeout,this,[h,d])}.bind(this)}else{j=function(){this.fireEvent("swipe",d);this.fireEvent(h,d)}.bind(this)}this.dragAttr.el.animate({left:b.outerWidth(true)*f},{duration:100,complete:j})}else{this.dragAttr.el.animate({left:0},{duration:100})}this.dragAttr=undefined},remove:function(d){var a=d.uid!=undefined?d.uid:d;var b=this.getDOMForRecord(a);if(b==undefined){return}b.css("visibility","hidden");b.animate({height:0},{complete:function(){b.remove();this.indexLastVisible--;this.lazyRender()}.bind(this)});this.recordMap[a]=undefined;if(!this.dataSourceObj||!this.dataSourceObj.hasData()){this.showEmptyText()}},resize:function(a){this.parent(a);this.availHeight=this.$b().height();if(this.itemsRendered){this.lazyRender()}},render:function(){this.parent();if(this.availHeight==undefined){this.availHeight=this.$b().height()}var h=new Date().getTime();this.parent();var a=this.nodeContainer();a.html("");this.recordMap={};if(!this.dataSourceObj||!this.dataSourceObj.hasData()){this.showEmptyText();return}this.hideEmptyText();var j=this.getDataSource().getData();var g=this.getTplParser().getCompiled(j,this.tpl);this.indexFirstVisible=undefined;this.indexLastVisible=undefined;this.outOfBounds=false;jQuery.each(j,function(d,k){var b=this.itemsRendered!=undefined?this.itemRenderer.call(this,k):g[d];this.renderItem(d,k,b,a)}.bind(this));var f=this.getDataSource().getSelectedRecord();if(f){this.select(f)}this.itemsRendered=true;ludo.util.log("time to render list "+(new Date().getTime()-h))},renderItem:function(b,d,a){if(this.indexFirstVisible==undefined){this.indexFirstVisible=b}var f=this.itemDOM(d,a);if(this.itemHeight==0){this.itemHeight=f.outerHeight(true)}if(!this.outOfBounds){this.checkOutOfBounds(f)}if(!this.outOfBounds){this.indexLastVisible=b}},checkOutOfBounds:function(b){var a=b[0].offsetTop!=undefined?b[0].offsetTop:b.position().top;if(a<this.scrollTop-this.itemHeight){this.outOfBounds=-1}else{this.outOfBounds=a>this.scrollTop+this.availHeight?1:false}},getRecordContainer:function(a){var d="list-"+a.uid;if(this.recordMap[a.uid]==undefined){var b=jQuery('<div class="ludo-list-item" style="cursor:pointer" id="'+d+'"></div>');
this.recordMap[a.uid]=d;this._nodeContainer.append(b);return b}return jQuery("#"+d)},itemDOM:function(d,a){var b=this.getRecordContainer(d);if(!this.outOfBounds){this.addInnerDOM(b,d,a)}else{b.css("height",this.itemHeight)}return b},undoSwipe:function(a){this.didUndo=true;var b=this.getDOMForRecord(a);b.find(".ludo-list-item-front").animate({left:0},{duration:100})},addInnerDOM:function(o,g,f){this.renderedMap[g.uid]=true;if(this.backSideLeft!=undefined){var d=this.backSideLeft(g);if(d!=undefined){var m=jQuery('<div class="ludo-list-item-back-left"></div>');m.append(jQuery(d));o.append(m)}}if(this.backSideRight!=undefined){var a=this.backSideRight(g);var k=jQuery('<div class="ludo-list-item-back-right"></div>');k.append(jQuery(a));o.append(k)}if(this.backSideUndo!=undefined){var q=this.backSideUndo(g);var h=jQuery('<div class="ludo-list-item-back-undo"></div>');h.append(jQuery(q));o.append(h);var p=this.id;var j=g.uid;var n=function(){var l=ludo.$(p);l.undoSwipe(j);return false};h.on("click",n)}var b=jQuery("<div></div>");b.addClass("ludo-list-item-front");b.append(jQuery(f));o.append(b);o.mouseenter(this.enter.bind(this));o.mouseleave(this.leave.bind(this));if(this.swipable){b.on(ludo.util.getDragStartEvent(),this.startDrag.bind(this))}o.css("height","auto")},enter:function(b){var a=this.getRecordDOM(b.target);if(a){a.addClass("ludo-list-item-highlighted")}},leave:function(b){var a=this.getRecordDOM(b.target);if(a){a.removeClass("ludo-list-item-highlighted")}},getDragDom:function(a){a=jQuery(a);if(!a.hasClass("ludo-list-item-front")){a=a.closest(".ludo-list-item-front")}return a},getRecordDOM:function(a){a=jQuery(a);if(!a.hasClass("ludo-list-item")){a=a.closest(".ludo-list-item")}return a.length>0?a:undefined},getRecordId:function(a){a=this.getRecordDOM(a);if(a){return a.attr("id").replace("list-","")}return undefined},getDOMForRecord:function(a){var b=a.uid||a;return this.recordMap[b]?jQuery("#"+this.recordMap[b]):undefined},select:function(a){var b=this.getDOMForRecord(a);if(b){b.addClass("ludo-list-item-selected")}},deselect:function(a){var b=this.getDOMForRecord(a);if(b){b.removeClass("ludo-list-item-selected")}},update:function(a){var d=this.getDOMForRecord(a);if(d){var b=this.itemRenderer!=undefined?this.itemRenderer.call(this,a):this.getTplParser().asString(a,this.tpl);d.find(".ludo-list-item-front").html(b)}},onClick:function(b){var d=new Date().getTime();if(d-this.swipeEnded<50){return}var a=this.getRecordId(jQuery(b.target));if(a){this.getDataSource().getRecord(a).select()}}});ludo.Notification=new Class({Extends:ludo.View,alwaysInFront:true,duration:3,showEffect:undefined,hideEffect:undefined,effect:"fade",effectDuration:0.4,autoRemove:true,__construct:function(a){a.renderTo=a.renderTo||document.body;this.setConfigParams(a,["autoRemove","showEffect","hideEffect","effect","effectDuration","duration"]);this.showEffect=this.showEffect||this.effect;this.hideEffect=this.hideEffect||this.effect;if(!a.layout&&!this.layout){a.layout={centerIn:a.renderTo}}this.parent(a)},ludoEvents:function(){this.parent();if(this.autoRemove){this.addEvent("hide",this.remove.bind(this))}},ludoDOM:function(){this.parent();this.getEl().addClass("ludo-notification")},__rendered:function(){if(!this.layout.width||!this.layout.height){var a=ludo.dom.getWrappedSizeOfView(this);if(!this.layout.width){this.layout.width=a.x}if(!this.layout.height){this.layout.height=a.y}}this.parent();this.show()},hide:function(){if(this.hideEffect){var a=new ludo.effect.Effect();a[this.getEndEffectFn()](this.getEl(),this.effectDuration,this.onHideComplete.bind(this),this.getLayout().getRenderer().position())}else{this.parent()}},show:function(a){if(arguments.length==1){this.html(a)}this.parent();if(this.showEffect){var b=new ludo.effect.Effect();b[this.getStartEffectFn()](this.getEl(),this.effectDuration,this.autoHide.bind(this),this.getLayout().getRenderer().position())}},getStartEffectFn:function(){switch(this.showEffect){case"fade":return"fadeIn";case"slide":return"slideIn";default:return this.showEffect}},getEndEffectFn:function(){switch(this.hideEffect){case"fade":return"fadeOut";case"slide":return"slideOut";default:return this.hideEffect}},autoHide:function(){this.hide.delay(this.duration*1000,this)},onHideComplete:function(){this.getEl().css("display","none");this.fireEvent("hide",this)}});ludo.effect.DraggableNode=new Class({id:undefined,el:undefined,handle:undefined,minX:undefined,maxX:undefined,minY:undefined,maxY:undefined,directions:undefined});ludo.effect.Effect=new Class({Extends:ludo.Core,fadeOut:function(a,b,d){a.animate({opacity:0},{duration:b*1000,complete:d})},slideIn:function(a,b,g,f){f=f||a.getPosition();var d={x:f.left,y:-a.height()};this.slide(a,d,f,b,g)},slideOut:function(a,b,g,f){f=f||a.getPosition();var d={x:f.left,y:-a.height()};this.slide(a,f,d,b,g)},slide:function(a,g,f,b,d){if(g.x!=undefined&&g.left==undefined){g.left=g.x}if(f.x!=undefined&&f.left==undefined){f.left=f.x}g.top=g.top||g.y;f.top=f.top||f.y;if(g.left==undefined){g.left=f.left
}this.show(a);a.css(g);a.animate({left:f.left,top:f.top},{duration:b*1000,complete:d})},fadeIn:function(a,b,d){a.css("opacity",0);a.css("visibility","visible");a.animate({opacity:1},{duration:b*1000,complete:d})},show:function(a){if(a.css("visibility")==="hidden"){a.css("visibility","visible")}}});ludo.effect.Drag=new Class({Extends:ludo.effect.Effect,handle:undefined,el:undefined,minX:undefined,minY:undefined,maxX:undefined,maxY:undefined,minPos:undefined,maxPos:undefined,directions:"XY",unit:"px",dragProcess:{active:false},coordinatesToDrag:undefined,delay:0,inDelayMode:false,els:{},useShim:false,autoHideShim:true,shimCls:undefined,mouseYOffset:undefined,mouseXOffset:undefined,fireEffectEvents:true,__construct:function(a){this.parent(a);if(a.el!==undefined){this.add({el:a.el,handle:a.handle})}this.setConfigParams(a,["useShim","autoHideShim","directions","delay","minX","maxX","minY","maxY","minPos","maxPos","unit","shimCls","mouseYOffset","mouseXOffset","fireEffectEvents"])},ludoEvents:function(){this.parent();this.getEventEl().on(ludo.util.getDragMoveEvent(),this.drag.bind(this));this.getEventEl().on(ludo.util.getDragEndEvent(),this.endDrag.bind(this));if(this.useShim){this.addEvent("start",this.showShim.bind(this));if(this.autoHideShim){this.addEvent("end",this.hideShim.bind(this))}}},add:function(b){b=this.getValidNode(b);var a=jQuery(b.el);this.setPositioning(a);var d=b.handle?jQuery(b.handle):a;d.attr("id",d.id||"ludo-"+String.uniqueID());d.addClass("ludo-drag");d.on(ludo.util.getDragStartEvent(),this.startDrag.bind(this));d.attr("forId",b.id);this.els[b.id]=Object.merge(b,{el:jQuery(a),handle:d});return this.els[b.id]},remove:function(b){if(this.els[b]!==undefined){var a=jQuery("#"+this.els[b].handle);a.off(ludo.util.getDragStartEvent(),this.startDrag.bind(this));this.els[b]=undefined;return true}return false},removeAll:function(){var b=Object.keys(this.els);for(var a=0;a<b.length;a++){this.remove(b[a])}this.els={}},getValidNode:function(a){if(!this.isElConfigObject(a)){a={el:jQuery(a)}}if(typeof a.el==="string"){if(a.el.substr(0,1)!="#"){a.el="#"+a.el}a.el=jQuery(a.el)}a.id=a.id||a.el.attr("id")||"ludo-"+String.uniqueID();if(!a.el.attr("id")){a.el.attr("id",a.id)}a.el.attr("forId",a.id);return a},isElConfigObject:function(a){return a.el!==undefined||a.handle!==undefined},setPositioning:function(a){if(!this.useShim){a.css("position","absolute")}else{var b=a.css("position");if(!b||(b!="relative"&&b!="absolute")){a.css("position","relative")}}},getById:function(a){return this.els[a]},getIdByEvent:function(b){var a=jQuery(b.target);if(!a.hasClass("ludo-drag")){a=a.closest(".ludo-drag")}return a.attr("forId")},getDragged:function(){return this.els[this.dragProcess.dragged]},getEl:function(){return this.els[this.dragProcess.dragged].el},getShimOrEl:function(){return this.useShim?this.getShim():this.getEl()},getSizeOf:function(a){return a.outerWidth!==undefined?{x:a.outerWidth(),y:a.outerHeight()}:{x:0,y:0}},getPositionOf:function(a){return jQuery(a).position()},setDragCoordinates:function(){this.coordinatesToDrag={x:"x",y:"y"}},startDrag:function(g){var b=this.getIdByEvent(g);var d=this.getById(b).el;var m=this.getSizeOf(d);var h;if(this.useShim){h=d.position()}else{var l=this.getPositionedParent(d);h=l?d.getPosition(l):this.getPositionOf(d)}var k=h.left;var j=h.top;var a=ludo.util.pageXY(g);this.dragProcess={active:true,dragged:b,currentX:k,currentY:j,elX:k,elY:j,width:m.x,height:m.y,mouseX:a.pageX,mouseY:a.pageY};var f=this.dragProcess;f.el=this.getShimOrEl();this.fireEvent("before",[this.els[b],this,{x:k,y:j}]);if(!this.isActive()){return undefined}f.minX=this.getMinX();f.maxX=this.getMaxX();f.minY=this.getMinY();f.maxY=this.getMaxY();f.dragX=this.canDragAlongX();f.dragY=this.canDragAlongY();if(this.delay){this.setActiveAfterDelay()}else{this.fireEvent("start",[this.els[b],this,{x:k,y:j}]);if(this.fireEffectEvents){ludo.EffectObject.start()}}if(!ludo.util.isTabletOrMobile()){return false}},getPositionedParent:function(b){var a=b.parentNode;while(a){var d=a.getStyle("position");if(d==="relative"||d==="absolute"){return a}a=a.getParent()}return undefined},cancelDrag:function(){this.dragProcess.active=false;this.dragProcess.el=undefined;if(this.fireEffectEvents){ludo.EffectObject.end()}},getShimFor:function(a){return a},setActiveAfterDelay:function(){this.inDelayMode=true;this.dragProcess.active=false;this.startIfMouseNotReleased.delay(this.delay*1000,this)},startIfMouseNotReleased:function(){if(this.inDelayMode){this.dragProcess.active=true;this.inDelayMode=false;this.fireEvent("start",[this.getDragged(),this,{x:this.getX(),y:this.getY()}]);ludo.EffectObject.start()}},drag:function(a){if(this.dragProcess.active&&this.dragProcess.el){var b={x:undefined,y:undefined};if(this.dragProcess.dragX){b.x=this.getXDrag(a)}if(this.dragProcess.dragY){b.y=this.getYDrag(a)}this.move(b);this.fireEvent("drag",[b,this.els[this.dragProcess.dragged],this]);return false}return undefined},move:function(a){if(a.x!==undefined){this.dragProcess.currentX=a.x;
this.dragProcess.el.css("left",a.x+this.unit)}if(a.y!==undefined){this.dragProcess.currentY=a.y;this.dragProcess.el.css("top",a.y+this.unit)}},getX:function(){return this.dragProcess.currentX},getY:function(){return this.dragProcess.currentY},getXDrag:function(b){var d;var a=ludo.util.pageXY(b);if(this.mouseXOffset){d=a.pageX+this.mouseXOffset}else{d=a.pageX-this.dragProcess.mouseX+this.dragProcess.elX}if(d<this.dragProcess.minX){d=this.dragProcess.minX}if(d>this.dragProcess.maxX){d=this.dragProcess.maxX}return d},getYDrag:function(b){var d;var a=ludo.util.pageXY(b);if(this.mouseYOffset){d=a.pageY+this.mouseYOffset}else{d=a.pageY-this.dragProcess.mouseY+this.dragProcess.elY}if(d<this.dragProcess.minY){d=this.dragProcess.minY}if(d>this.dragProcess.maxY){d=this.dragProcess.maxY}return d},endDrag:function(){if(this.dragProcess.active){this.cancelDrag();this.fireEvent("end",[this.getDragged(),this,{x:this.getX(),y:this.getY()}])}if(this.inDelayMode){this.inDelayMode=false}},setMaxX:function(a){this.maxX=a},setMinX:function(a){this.minX=a},setMinY:function(a){this.minY=a},setMaxY:function(a){this.maxY=a},setMinPos:function(a){this.minPos=a},setMaxPos:function(a){this.maxPos=a},getMaxX:function(){return this.getMaxPos("maxX")},getMaxY:function(){return this.getMaxPos("maxY")},getMaxPos:function(b){var a=this.getConfigProperty(b);return a!==undefined?a:this.maxPos!==undefined?this.maxPos:100000},getMinX:function(){var a=this.getConfigProperty("minX");return a!==undefined?a:this.minPos},getMinY:function(){var a=this.getDragged();return a&&a.minY!==undefined?a.minY:this.minY!==undefined?this.minY:this.minPos},getDraggedX:function(){return this.getX()-this.dragProcess.elX},getDraggedY:function(){return this.getY()-this.dragProcess.elY},canDragAlongX:function(){return this.getConfigProperty("directions").indexOf("X")>=0},canDragAlongY:function(){return this.getConfigProperty("directions").indexOf("Y")>=0},getConfigProperty:function(b){var a=this.getDragged();return a&&a[b]!==undefined?a[b]:this[b]},getWidth:function(){return this.dragProcess.width},getHeight:function(){return this.dragProcess.height},getLeft:function(){return this.dragProcess.currentX},getTop:function(){return this.dragProcess.currentY},getShim:function(){if(this.shim===undefined){this.shim=jQuery("<div>");this.shim.addClass("ludo-shim");this.shim.css({position:"absolute","z-index":50000,display:"none"});jQuery(document.body).append(this.shim);if(this.shimCls){for(var a=0;a<this.shimCls.length;a++){this.shim.addClass(this.shimCls[a])}}this.fireEvent("createShim",this.shim)}return this.shim},showShim:function(){this.getShim().css({display:"",left:this.getShimX(),top:this.getShimY(),width:this.getWidth()+this.getShimWidthDiff(),height:this.getHeight()+this.getShimHeightDiff()});this.fireEvent("showShim",[this.getShim(),this])},getShimY:function(){if(this.mouseYOffset){return this.dragProcess.mouseY+this.mouseYOffset}else{return this.getTop()+ludo.dom.getMH(this.getEl())-ludo.dom.getMW(this.shim)}},getShimX:function(){if(this.mouseXOffset){return this.dragProcess.mouseX+this.mouseXOffset}else{return this.getLeft()+ludo.dom.getMW(this.getEl())-ludo.dom.getMW(this.shim)}},getShimWidthDiff:function(){return ludo.dom.getMW(this.getEl())-ludo.dom.getMBPW(this.shim)},getShimHeightDiff:function(){return ludo.dom.getMH(this.getEl())-ludo.dom.getMBPH(this.shim)},hideShim:function(){this.getShim().css("display","none")},setShimText:function(a){this.getShim().html(a)},isActive:function(){return this.dragProcess.active}});ludo.effect.Resize=new Class({Extends:ludo.Core,useShim:true,component:undefined,els:{shim:undefined,applyTo:undefined,handle:{}},minX:undefined,maxX:undefined,minWidth:undefined,maxWidth:undefined,minY:undefined,maxY:undefined,minHeight:undefined,maxHeight:undefined,preserveAspectRatio:false,aspectRatio:undefined,resizeKeys:{e:["width"],s:["height"],w:["left","width"],n:["top","height"],nw:["top","left","height","width"],ne:["top","width","height"],se:["width","height"],sw:["left","height","width"]},aspectRatioKeys:undefined,dragProperties:{active:false},xRegions:[["w","nw","sw"],["e","ne","se"]],yRegions:[["n","nw","ne"],["s","sw","se"]],aspectRatioMinMaxSet:false,__construct:function(a){this.setConfigParams(a,["useShim","minX","maxX","minY","maxY","maxWidth","minWidth","minHeight","maxHeight","preserveAspectRatio"]);if(a.component){this.component=a.component;this.els.applyTo=this.component.getEl()}else{this.els.applyTo=a.applyTo}if(a.listeners){this.addEvents(a.listeners)}this.addDragEvents();this.setDisplayPropertyOfEl.delay(100,this)},setDisplayPropertyOfEl:function(){var a=this.getEl().css("display");if(a!=="absolute"&&a!=="relative"){if(Browser.ie&&Browser.version<9){return}this.getEl().css("display","relative")}},addDragEvents:function(){jQuery(document.body).on(ludo.util.getDragEndEvent(),this.stopResize.bind(this));jQuery(document.body).on(ludo.util.getDragMoveEvent(),this.resize.bind(this))},addHandle:function(d,a){var b=this.els.handle[d]=jQuery("<div>");
b.addClass("ludo-view-resize-el");b.addClass(this.getCssFor(d));if(a){b.addClass(a)}b.html("<span></span>");b.css("cursor",this.cursor(d)+"-resize");b.attr("region",d);b.on(ludo.util.getDragStartEvent(),this.startResize.bind(this));this.els.applyTo.append(b)},startResize:function(d){var b=jQuery(d.target).attr("region");this.fireEvent("start",b);ludo.EffectObject.start();var a=ludo.util.pageXY(d);this.dragProperties={a:1,active:true,region:b,start:{x:a.pageX,y:a.pageY},current:{x:a.pageX,y:a.pageY},el:this.getShimCoordinates(),minWidth:this.minWidth,maxWidth:this.maxWidth,minHeight:this.minHeight,maxHeight:this.maxHeight,area:this.getScalingFactors(),preserveAspectRatio:this.preserveAspectRatio?this.preserveAspectRatio:d.shift?true:false};if(this.preserveAspectRatio||d.shift){this.setMinAndMax()}this.dragProperties.minX=this.getDragMinX();this.dragProperties.maxX=this.getDragMaxX();this.dragProperties.minY=this.getDragMinY();this.dragProperties.maxY=this.getDragMaxY();this.setBodyCursor();if(this.useShim){this.showShim()}return ludo.util.isTabletOrMobile()?false:undefined},setMinAndMax:function(){var h=this.getAspectRatio();var g=this.dragProperties;if(h===0){return}var a,k,m,l;if(this.maxWidth!==undefined){l=this.maxWidth/h}if(this.minWidth!==undefined){m=this.minWidth/h}if(this.maxHeight!==undefined){k=this.maxHeight*h}if(this.minHeight!==undefined){a=this.minHeight*h}var j=this.getEl().offset();var b=this.$bWidth()-j.left;var f=this.$bHeight()-j.top;g.minWidth=Math.max(a||0,this.minWidth||0);g.maxWidth=Math.min(k||b,this.maxWidth||b);g.minHeight=Math.max(m||0,this.minHeight||0);g.maxHeight=Math.min(l||f,this.maxHeight||f);if(g.maxWidth/h>g.maxHeight){g.maxWidth=g.maxHeight*h}if(g.maxHeight*h>g.maxWidth){g.maxHeight=g.maxWidth/h}},getDragMinX:function(){var a,f=this.dragProperties,b=f.region;if(f.maxWidth!==undefined&&this.xRegions[0].indexOf(b)>=0){a=f.el.left+f.el.width-f.maxWidth}else{if(f.minWidth!==undefined&&this.xRegions[1].indexOf(b)>=0){a=f.el.left+f.minWidth}}if(this.minX!==undefined){if(a==undefined){a=this.minX}else{a=Math.max(a,this.minX)}}return a},getDragMaxX:function(){var a,f=this.dragProperties,b=f.region;if(f.minWidth!==undefined&&this.xRegions[0].indexOf(b)>=0){a=f.el.left+f.el.width-f.minWidth}else{if(f.maxWidth!==undefined&&this.xRegions[1].indexOf(b)>=0){a=f.el.left+f.maxWidth}}if(this.maxX!==undefined){if(a==undefined){a=this.maxX}else{a=Math.min(a,this.maxX)}}return a},getDragMinY:function(){var a,f=this.dragProperties,b=f.region;if(f.maxHeight!==undefined&&this.yRegions[0].indexOf(b)>=0){a=f.el.top+f.el.height-f.maxHeight}else{if(f.minHeight!==undefined&&this.yRegions[1].indexOf(b)>=0){a=f.el.top+f.minHeight}}if(this.minY!==undefined){if(a==undefined){a=this.minY}else{a=Math.max(a,this.minY)}}return a},getDragMaxY:function(){var a,f=this.dragProperties,b=f.region;if(f.minHeight!==undefined&&this.yRegions[0].indexOf(b)>=0){a=f.el.top+f.el.height-f.minHeight}else{if(f.maxHeight!==undefined&&this.yRegions[1].indexOf(b)>=0){a=f.el.top+f.maxHeight}}if(this.maxY!==undefined){if(a==undefined){a=this.maxY}else{a=Math.min(a,this.maxY)}}return a},cursor:function(b){var a=b;if(a=="n"||a=="s"){a="ns"}if(a=="w"||a=="e"){a="we"}if(a=="se"||a=="nw"){a="nwse"}if(a=="ne"||a=="sw"){a="nesw"}return a},setBodyCursor:function(){jQuery(document.body).css("cursor",this.cursor(this.dragProperties.region)+"-resize")},revertBodyCursor:function(){jQuery(document.body).css("cursor","default")},resize:function(a){if(this.dragProperties.active){this.dragProperties.current=this.getCurrentCoordinates(a);var b=this.getCoordinates();this.fireEvent("resize",b);if(this.useShim){this.els.shim.css(b)}else{this.getEl().css(b)}}},getCurrentCoordinates:function(f){var b=ludo.util.pageXY(f);var a={x:b.pageX,y:b.pageY};var g=this.dragProperties;if(g.preserveAspectRatio&&g.region.length===2){return a}if(g.minX!==undefined&&a.x<g.minX){a.x=g.minX}if(g.maxX!==undefined&&a.x>g.maxX){a.x=g.maxX}if(g.minY!==undefined&&a.y<g.minY){a.y=g.minY}if(g.maxY!==undefined&&a.y>g.maxY){a.y=g.maxY}return a},getCoordinates:function(){var h=this.dragProperties;var g=this.resizeKeys[h.region];var a={};if(!h.preserveAspectRatio||h.region.length===1){for(var b=0;b<g.length;b++){a[g[b]]=this.getCoordinate(g[b])}}if(h.preserveAspectRatio){switch(h.region){case"e":case"w":a.height=a.width/this.aspectRatio;break;case"n":case"s":a.width=a.height*this.aspectRatio;break;default:var f=this.getScaleFactor();a.width=h.el.width*f;a.height=h.el.height*f;if(h.region=="ne"||h.region=="nw"){a.top=h.el.top+h.el.height-a.height}if(h.region=="nw"||h.region=="sw"){a.left=h.el.left+h.el.width-a.width}a.width+=this.getBWOfShim();a.height+=this.getBHOfShim();break}}return a},getScaleFactor:function(){var g=this.dragProperties;var f=g.region;var b;var a=(g.current.x-g.start.x)*g.area.xFactor/g.area.sum;var h=(g.current.y-g.start.y)*g.area.yFactor/g.area.sum;switch(f){case"se":b=1+a+h;break;case"ne":b=1+a+h*-1;break;case"nw":b=1+a*-1+h*-1;break;case"sw":b=1+a*-1+h;break
}if(g.minWidth){b=Math.max(b,g.minWidth/g.el.width)}if(g.minHeight){b=Math.max(b,g.minHeight/g.el.height)}if(g.maxWidth){b=Math.min(b,g.maxWidth/g.el.width)}if(g.maxHeight){b=Math.min(b,g.maxHeight/g.el.height)}return b},getCoordinate:function(a){var b=this.dragProperties.region;var f=this.dragProperties;switch(a){case"width":if(b=="e"||b=="ne"||b=="se"){return f.el.width-f.start.x+f.current.x+this.getBWOfShim()}else{return f.el.width+f.start.x-f.current.x+this.getBWOfShim()}break;case"height":if(b=="s"||b=="sw"||b=="se"){return f.el.height-f.start.y+f.current.y+this.getBHOfShim()}else{return f.el.height+f.start.y-f.current.y+this.getBHOfShim()}case"top":if(b=="n"||b=="nw"||b=="ne"){return f.el.top-f.start.y+f.current.y}else{return f.el.top+f.start.y-f.current.y}case"left":if(b=="w"||b=="nw"||b=="sw"){return f.el.left-f.start.x+f.current.x}else{return f.el.left+f.start.x-f.current.x}}return undefined},getBWOfShim:function(){if(this.useShim){return ludo.dom.getBW(this.getShim())}return 0},getBHOfShim:function(){if(this.useShim){return ludo.dom.getBH(this.getShim())}return 0},stopResize:function(){if(this.dragProperties.active){this.dragProperties.active=false;this.fireEvent("stop",this.getCoordinates());ludo.EffectObject.end();this.revertBodyCursor();if(this.useShim){this.hideShim()}}},getCssFor:function(a){return"ludo-view-resize-region-"+a},showShim:function(){var b=this.getShim();var a=this.getShimCoordinates();b.css({display:"",left:a.left,top:a.top,width:a.width,height:a.height})},hideShim:function(){this.getShim().css("display","none")},getShimCoordinates:function(){var a=this.getEl();var b=a.offset();b.width=a.outerWidth();b.height=a.outerHeight();if(this.useShim){var d=this.getShim();b.width-=ludo.dom.getBW(d);b.height-=ludo.dom.getBH(d)}return b},getShim:function(){if(!this.els.shim){var a=this.els.shim=jQuery("<div>");a.addClass("ludo-shim-resize");a.css({position:"absolute","z-index":50000});jQuery(document.body).append(a)}return this.els.shim},getEl:function(){return this.els.applyTo},hideAllHandles:function(){this.setHandleDisplay("none")},showAllHandles:function(){this.setHandleDisplay("")},setHandleDisplay:function(b){for(var a in this.els.handle){if(this.els.handle.hasOwnProperty(a)){this.els.handle[a].css("display",b)}}},getAspectRatio:function(){if(this.aspectRatio===undefined){this.aspectRatio=this.getEl().width()/this.getEl().height()}return this.aspectRatio},$bWidth:function(){return jQuery(document.documentElement).width()},$bHeight:function(){return jQuery(document.documentElement).height()},getScalingFactors:function(){var a={x:this.getEl().width(),y:this.getEl().height()};return{xFactor:a.x/a.y,yFactor:a.y/a.x,sum:a.x+a.y}}});ludo.view.ButtonBar=new Class({Extends:ludo.View,type:"ButtonBar",layout:{type:"linear",orientation:"horizontal",width:"matchParent",height:"matchParent"},elCss:{height:"100%"},align:"right",cls:"ludo-view-button-container",overflow:"hidden",component:undefined,buttonBarCss:undefined,__construct:function(a){this.setConfigParams(a,["align","component","buttonBarCss"]);a.children=this.getValidChildren(a.children);if(this.align=="right"||a.align=="center"){a.children=this.getItemsWithSpacer(a.children);if(a.align=="center"){a.children.push(this.emptyChild())}}else{a.children[0].elCss=a.children[0].elCss||{};if(!a.children[0].elCss["margin-left"]){a.children[0].elCss["margin-left"]=2}}this.parent(a)},ludoDOM:function(){this.parent();this.$b().addClass("ludo-content-buttons")},__rendered:function(){this.parent();this.component.addEvent("resize",this.resizeRenderer.bind(this));if(this.buttonBarCss){this.getEl().parent().css(this.buttonBarCss)}},resizeRenderer:function(){this.getLayout().getRenderer().resize()},getValidChildren:function(b){for(var a=0;a<b.length;a++){if(b[a].value&&!b[a].type){b[a].type="form.Button"}}return b},getButtons:function(){var a=[];for(var b=0;b<this.children.length;b++){if(this.children[b].isButton&&this.children[b].isButton()){a.push(this.children[b])}}return a},getButton:function(b){var d=this.children;for(var a=0;a<d.length;a++){if(d[a].id==b||d[a].name==b||(d[a].val&&d[a].val().toLowerCase()==b.toLowerCase())){return d[a]}}return undefined},getItemsWithSpacer:function(a){a.splice(0,0,this.emptyChild());return a},emptyChild:function(){return{layout:{weight:1},elCss:{"background-color":"transparent"},css:{"background-color":"transparent"}}},getView_250_40:function(){return this.component}});ludo.view.TitleBar=new Class({Extends:ludo.Core,view:undefined,els:{el:undefined,icon:undefined,title:undefined,buttons:{},buttonArray:[]},toggleStatus:{},__construct:function(a){this.parent(a);this.setConfigParams(a,["view","buttons"]);if(!this.buttons){this.buttons=this.getDefaultButtons()}this.view.on("setTitle",this.setTitle.bind(this));this.view.on("resize",this.resizeDOM.bind(this));this.createDOM();this.setSizeOfButtonContainer()},getDefaultButtons:function(){var b=[];var a=this.view;if(a.minimizable){b.push("minimize")}if(a.closable){b.push("close")
}return b},createDOM:function(){var a=this.els.el=jQuery("<div>");a.addClass(this.view.boldTitle?"ludo-framed-view-titlebar":"ludo-view-titlebar");var b=0;if(this.view.icon){this.createIconDOM();b+=a.width()}this.createTitleDOM();a.append(this.getButtonContainer());this.resizeButtonContainer.delay(20,this);this.els.title.css("left",b);a.on("selectstart",ludo.util.cancelEvent)},createIconDOM:function(){this.els.icon=ludo.dom.create({renderTo:this.els.el,cls:"ludo-framed-view-titlebar-icon",css:{backgroundImage:"url("+this.view.icon+")"}})},setTitle:function(a){this.els.title.html(a)},createTitleDOM:function(){this.els.title=jQuery('<div class="ludo-framed-view-titlebar-title"></div>');this.els.el.append(this.els.title);this.setTitle(this.view.title)},cancelTextSelection:function(){return false},getButtonContainer:function(){var b=this.els.controls=jQuery('<div class="ludo-title-bar-button-container"></div>');b.css("cursor","pointer");this.createEdge("left",b);this.createEdge("right",b);for(var a=0;a<this.buttons.length;a++){b.append(this.getButtonDOM(this.buttons[a]))}this.addBorderToButtons();return b},createEdge:function(d,b){var a=jQuery('<div class="ludo-title-bar-button-container-'+d+'-edge"></div>');b.append(a);a.attr("style","position:absolute;z-index:1;"+d+":0;top:0;width:55%;height:100%;background-repeat:no-repeat;background-position:top "+d);return a},resizeButtonContainer:function(){this.els.controls.css("width",this.getWidthOfButtons())},button:function(a){return this.els.buttons[a]},getButtonDOM:function(d){d=ludo.util.isString(d)?{type:d}:d;var a=this.els.buttons[d.type]=jQuery("<div>");a.id="b-"+String.uniqueID();a.attr("class","ludo-title-bar-button ludo-title-bar-button-"+d.type);a.on("click",this.getButtonClickFn(d.type));if(d.listener){a.on("click",d.listener.bind(this))}a.mouseenter(this.enterButton.bind(this));a.mouseleave(this.leaveButton.bind(this));a.attr("title",d.title?d.title:d.type.capitalize());a.attr("buttonType",d.type);if(d.icon){a.css("background-image","url("+d.icon+")")}this.els.buttonArray.push(a);return a},getButtonClickFn:function(d){var b=ludo.view.getTitleBarButton(d);var a=b&&b.toggle?b.toggle:undefined;return function(h){this.leaveButton(h);var f=jQuery(h.target);var g=d;if(a){if(this.toggleStatus[d]){g=this.toggleStatus[d];ludo.dom.removeClass(h.target,"ludo-title-bar-button-"+g);g=this.getNextToggle(a,g)}f.removeClass("ludo-title-bar-button-"+g);this.toggleStatus[d]=g;f.addClass("ludo-title-bar-button-"+this.getNextToggle(a,g))}this.fireEvent(g)}.bind(this)},getNextToggle:function(a,d){var b=a.indexOf(d)+1;return a[b>=a.length?0:b]},addBorderToButtons:function(){var b=false;for(var a=0;a<this.els.buttonArray.length;a++){this.els.buttonArray[a].removeClass("ludo-title-bar-button-with-border");if(b){this.els.buttonArray[a].addClass("ludo-title-bar-button-with-border")}b=true}},enterButton:function(d){var b=jQuery(d.target);var a=b.attr("buttonType");b.addClass("ludo-title-bar-button-"+a+"-over")},leaveButton:function(b){var a=jQuery(b.target);a.removeClass("ludo-title-bar-button-"+a.attr("buttonType")+"-over")},getWidthOfButtons:function(){var a=0;var d=this.els.buttonArray;for(var b=0,g=d.length;b<g;b++){var f=d[b].outerWidth();if(f){a+=f}else{a+=d[b].width()}}return a?a:d.length*10},getEl:function(){return this.els.el},setSizeOfButtonContainer:function(){if(this.els.controls){var a=this.getWidthOfButtons();this.els.controls.css("width",a+"px");this.els.controls.css("display",a>0?"":"none")}if(this.icon){this.els.title.css("left",jQuery(this.els.icon).css("width"))}},getWidthOfIconAndButtons:function(){var a=this.view.icon?this.els.icon.width():0;return a+this.els.controls.width()},resizeDOM:function(){var a=(this.view.width-this.getWidthOfIconAndButtons());if(a>0){this.els.title.css("width",a)}},height:undefined,getHeight:function(){if(this.height===undefined){this.height=this.els.el.outerHeight()}return this.height}});ludo.view.registerTitleBarButton=function(b,a){ludo.registry.set("titleBar-"+b,a)};ludo.view.getTitleBarButton=function(a){return ludo.registry.get("titleBar-"+a)};ludo.view.registerTitleBarButton("minimize",{toggle:["minimize","maximize"]});ludo.FramedView=new Class({Extends:ludo.View,type:"FramedView",layout:{minWidth:100,minHeight:100},minimized:false,title:"",movable:false,minimizable:false,resizable:false,closable:false,width:null,height:200,preserveAspectRatio:false,icon:undefined,titleBar:undefined,titleBarHidden:false,boldTitle:true,hasMenu:false,buttons:[],buttonBar:undefined,menuConfig:null,menuObj:null,state:{isMinimized:false},__construct:function(a){this.parent(a);if(a.buttons){a.buttonBar={children:a.buttons}}this.setConfigParams(a,["buttonBar","hasMenu","menuConfig","icon","titleBarHidden","titleBar","buttons","boldTitle","minimized"])},getTitleBarConfig:function(){return undefined},getButtonBarConfig:function(){return undefined},ludoDOM:function(){this.parent();this.els.container.addClass("ludo-framed-view");if(this.hasTitleBar()){this.getTitleBar().getEl().insertBefore(this.$b())
}this.$b().addClass("ludo-framed-view-body");if(!this.getParent()&&this.isResizable()){this.getResizer().addHandle("s")}},__rendered:function(){if(!this.buttonBar){this.buttonBar=this.getButtonBarConfig()}if(this.buttonBar&&!this.buttonBar.children){this.buttonBar={children:this.buttonBar}}if(this.buttonBar){this.getButtonBar()}else{this.els.container.addClass("ludo-view-no-buttonbar")}this.parent();if(this.minimized){this.minimize()}},resizer:undefined,getResizer:function(){if(this.resizer===undefined){var a=this.getLayout().getRenderer();this.resizer=this.createDependency("resizer",new ludo.effect.Resize({component:this,preserveAspectRatio:this.layout.preserveAspectRatio,minWidth:a.getMinWidth(),minHeight:a.getMinHeight(),maxHeight:a.getMaxHeight(),maxWidth:a.getMaxWidth(),listeners:{stop:a.setSize.bind(a)}}));this.resizer.addEvent("stop",this.saveState.bind(this))}return this.resizer},resizeDOM:function(){var a=this.getHeight();a-=(ludo.dom.getMBPH(this.els.container)+ludo.dom.getMBPH(this.els.body)+this.getHeightOfTitleAndButtonBar());if(a>=0){this.els.body.css("height",a);if(this.buttonBarComponent){this.buttonBarComponent.resize()}}},heightOfTitleAndButtonBar:undefined,getHeightOfTitleAndButtonBar:function(){if(this.isHidden()){return 0}if(!this.heightOfTitleAndButtonBar){this.heightOfTitleAndButtonBar=this.getHeightOfTitleBar()+this.getHeightOfButtonBar()}return this.heightOfTitleAndButtonBar},getHeightOfButtonBar:function(){if(!this.buttonBar){return 0}return this.els.buttonBar.el.outerHeight()},getHeightOfTitleBar:function(){if(!this.hasTitleBar()){return 0}return this.titleBarObj.getHeight()},hasTitleBar:function(){return !this.titleBarHidden},titleBarButton:function(a){return this.getTitleBar().button(a)},getTitleBar:function(){if(this.titleBarObj===undefined){if(!this.titleBar){this.titleBar=this.getTitleBarConfig()||{}}this.titleBar.view=this;this.titleBar.type="view.TitleBar";this.titleBarObj=this.createDependency("titleBar",this.titleBar);this.titleBarObj.addEvents({close:this.close.bind(this),minimize:this.minimize.bind(this),maximize:this.maximize.bind(this),collapse:this.hide.bind(this)});if(this.movable&&!this.getParent()){this.drag=this.createDependency("drag",new ludo.effect.Drag({handle:this.titleBarObj.getEl(),el:this.getEl(),listeners:{start:this.increaseZIndex.bind(this),end:this.stopMove.bind(this)}}));this.titleBarObj.getEl().css("cursor","move")}}return this.titleBarObj},getHeight:function(){return this.isMinimized()?this.getHeightOfTitleBar():this.parent()},close:function(){this.hide();this.fireEvent("close",this)},isMinimized:function(){return this.state.isMinimized},maximize:function(){this.state.isMinimized=false;if(!this.hidden){this.resize({height:this.layout.height});this.els.body.css("visibility","visible");this.showResizeHandles();this.fireEvent("maximize",this)}},showResizeHandles:function(){if(this.isResizable()){this.getResizer().showAllHandles()}},hideResizeHandles:function(){if(this.isResizable()){this.getResizer().hideAllHandles()}},minimize:function(){this.state.isMinimized=true;if(!this.hidden){var a=this.layout.height;var b=this.getHeightOfTitleBar();this.els.container.css("height",this.getHeightOfTitleBar());this.els.body.css("visibility","hidden");this.hideResizeHandles();this.layout.height=a;this.fireEvent("minimize",[this,{height:b}])}},getHtml:function(){return this.els.body.html()},getButtonBar:function(){if(!this.els.buttonBar){this.els.buttonBar=this.els.buttonBar||{};var a=this.els.buttonBar.el=jQuery('<div class="ludo-view-buttonbar"></div>');this.els.container.append(a);this.getEl().addClass("ludo-view-with-buttonbar");this.buttonBar.renderTo=a;this.buttonBar.component=this;this.buttonBarComponent=this.createDependency("buttonBar",new ludo.view.ButtonBar(this.buttonBar))}return this.els.buttonBar.el},getButton:function(a){return this.getButtonByKey(a)},hideButton:function(a){return this.buttonEffect(a,"hide")},showButton:function(a){return this.buttonEffect(a,"show")},getButtons:function(){return this.buttonBarComponent?this.buttonBarComponent.getButtons():[]},disableButton:function(a){return this.buttonEffect(a,"disable")},enableButton:function(a){return this.buttonEffect(a,"enable")},buttonEffect:function(d,b){var a=this.getButtonByKey(d);if(a){a[b]();return true}return false},getButtonByKey:function(b){if(this.buttonBarComponent){return this.buttonBarComponent.getButton(b)}for(var a=0;a<this.buttons.length;a++){if(this.buttons[a].getId()===b||this.buttons[a].val()==b||this.buttons[a].getName()==b){return this.buttons[a]}}return null},isResizable:function(){return this.resizable},stopMove:function(b,a){this.getLayout().getRenderer().setPosition(a.getX(),a.getY());this.fireEvent("stopmove",this)}});ludo.Application=new Class({Extends:ludo.View,type:"Application",layout:{width:"matchParent",height:"matchParent"},__construct:function(a){a.renderTo=document.body;this.parent(a);this.setBorderStyles()},__rendered:function(){this.parent();this.getEl().addClass("ludo-application");
this.$b().addClass("ludo-application-content")},setBorderStyles:function(){var a={width:"100%",height:"100%",overflow:"hidden",margin:0,padding:0,border:0};jQuery(document.body).css(a);jQuery(document.documentElement).css(a)}});ludo.Window=new Class({Extends:ludo.FramedView,type:"Window",cssSignature:"ludo-window",movable:true,resizable:true,closable:true,top:undefined,left:undefined,width:300,height:200,resizeTop:true,resizeLeft:true,hideBodyOnMove:false,preserveAspectRatio:false,statefulProperties:["layout"],__construct:function(a){a=a||{};a.renderTo=document.body;var b=["resizeTop","resizeLeft","hideBodyOnMove","preserveAspectRatio"];this.setConfigParams(a,b);this.parent(a)},ludoEvents:function(){this.parent();if(this.hideBodyOnMove){this.addEvent("startmove",this.hideBody.bind(this));this.addEvent("stopmove",this.showBody.bind(this))}this.addEvent("stopmove",this.saveState.bind(this))},hideBody:function(){this.$b().css("display","none");if(this.els.buttonBar){this.els.buttonBar.el.css("display","none")}},showBody:function(){this.$b().css("display","");if(this.els.buttonBar){this.els.buttonBar.el.css("display","")}},__rendered:function(){this.parent();this.getEl().addClass("ludo-window");this.focusFirstFormField();this.fireEvent("activate",this)},ludoDOM:function(){this.parent();if(this.isResizable()){var a=this.getResizer();if(this.resizeTop){if(this.resizeLeft){a.addHandle("nw")}a.addHandle("n");a.addHandle("ne")}if(this.resizeLeft){a.addHandle("w");a.addHandle("sw")}a.addHandle("e");a.addHandle("se")}},show:function(){this.parent();this.focusFirstFormField()},focusFirstFormField:function(){var b=this.$b().children("input");for(var a=0,f=b.length;a<f;a++){if(b[a].type&&b[a].type.toLowerCase()==="text"){b[a].focus();return}}var d=this.$b().find("textarea");if(d){d.focus()}},isUsingShimForResize:function(){return true},showAt:function(a,b){this.setXY(a,b);this.show()},setXY:function(a,d){this.layout.left=a;this.layout.top=d;var b=this.getLayout().getRenderer();b.clearFn();b.resize()},center:function(){var d=jQuery(document.body);var f={x:d.width(),y:d.height()};var a=Math.round((f.x/2)-(this.getWidth()/2));var g=Math.round((f.y/2)-(this.getHeight()/2));this.setXY(a,Math.max(0,g))},showCentered:function(){this.center();this.show()},isWindow:function(){return true}});ludo.dataSource.SearchParser=new Class({searches:undefined,parsedSearch:{items:[]},branches:[],compiled:undefined,getSearchFn:function(a){this.parse(a);this.compiled=this.parsedSearch;this.compiled=this.compile(Object.clone(this.parsedSearch));return this.compiled},clear:function(){this.parsedSearch={items:[]};this.branches=[]},parse:function(f){this.clear();this.branches.push(this.parsedSearch);for(var a=0;a<f.length;a++){if(this.isBranchStart(f[a])){var b={items:[]};this.appendToCurrentBranch(b);this.branches.push(b)}else{if(this.isBranchEnd(f[a])){this.setOperatorIfEmpty();if(this.branches.length>1){this.branches.pop()}}else{if(this.isOperator(f[a])){if(!this.hasOperator()){this.setOperator(f[a])}else{if(this.shouldCreateBranchOfPrevious(f[a])){this.createBranchOfPrevious();this.setOperator(f[a])}else{if(this.shouldCreateNewBranch(f[a])){var d={operator:f[a],items:[]};d.items.push(this.branches[this.branches.length-1].items.pop());this.appendToCurrentBranch(d);this.branches.push(d)}}}}else{this.appendToCurrentBranch(f[a])}}}}this.setOperatorIfEmpty()},compile:function(d){var b=this.getIndexOfInnerBranch(d);var a=0;while(b>=0&&a<100){d.items[b]={fn:this.compile(d.items[b])};a++;b=this.getIndexOfInnerBranch(d)}return d.operator==="&"?this.getAndFn(d):this.getOrFn(d)},getAndFn:function(b){var a=b.items;return function(d){for(var f=0;f<a.length;f++){if(a[f].txt!==undefined){if(d.searchIndex.indexOf(a[f].txt)===-1){return false}}else{if(a[f].fn!==undefined){if(!a[f].fn.call(this,d)){return false}}}}return true}},getOrFn:function(b){var a=b.items;return function(d){for(var f=0;f<a.length;f++){if(a[f].txt!==undefined){if(d.searchIndex.indexOf(a[f].txt)>-1){return true}}else{if(a[f].fn!==undefined){if(a[f].fn.call(this,d)){return true}}}}return false}},getIndexOfInnerBranch:function(b){for(var a=0;a<b.items.length;a++){if(b.items[a].operator!==undefined){return a}}return -1},setOperatorIfEmpty:function(){var a=this.branches[this.branches.length-1];a.operator=a.operator||"&"},isBranchStart:function(a){return a==="("},isBranchEnd:function(a){return a===")"},shouldCreateBranchOfPrevious:function(a){return a==="|"&&this.getCurrentOperator()==="&"},createBranchOfPrevious:function(){var a=this.branches[this.branches.length-1];var b={operator:a.operator,items:a.items};a.operator=undefined;a.items=[b]},shouldCreateNewBranch:function(a){return a==="&"&&this.isDifferentOperator(a)},appendToCurrentBranch:function(a){this.branches[this.branches.length-1].items.push(a)},isOperator:function(a){return a==="|"||a==="&"},hasOperator:function(){return this.branches[this.branches.length-1].operator!==undefined},isDifferentOperator:function(a){return a!==this.getCurrentOperator()
},getCurrentOperator:function(){return this.branches[this.branches.length-1].operator},setOperator:function(a){this.branches[this.branches.length-1].operator=a}});ludo.dataSource.JSONArraySearch=new Class({Extends:ludo.Core,dataSource:undefined,searchResult:undefined,searchIndexCreated:false,delay:0,searches:undefined,searchBranches:undefined,searchFn:undefined,currentBranch:undefined,index:undefined,searchParser:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["dataSource","index","delay"]);this.searchParser=new ludo.dataSource.SearchParser();this.clear()},ludoEvents:function(){this.parent();if(!this.dataSource.hasRemoteSearch()){this.dataSource.addEvent("beforeload",this.clearSearchIndex.bind(this));this.dataSource.addEvent("beforeload",this.deleteSearch.bind(this));this.dataSource.addEvent("update",this.clearSearchIndex.bind(this));this.dataSource.addEvent("delete",this.onDelete.bind(this))}},search:function(b){if(!b&&this.searches.length==0){return}this.clear();this.where(b);this.endBranch();var a=this.getSearchDelay();if(a===0){this.executeSearch(this.searches[0].txt)}else{this.executeSearch.delay(a*1000,this,this.searches[0].txt)}},executeSearch:function(a){if(a==this.searches[0].txt){this.execute()}},clear:function(){this.searches=[];return this},deleteSearch:function(){this.fireEvent("deleteSearch");this.searchResult=undefined;this.clear()},where:function(a){this.clear();this.appendSearch(Array.from(arguments));return this},or:function(a){this.appendOperator("|");this.appendSearch(Array.from(arguments));return this},appendSearch:function(b){this.preCondition(b);var d=this.getActualArgument(b);var a;if(typeof d==="function"){a={fn:d}}else{a={txt:d.toLowerCase()}}this.searches.push(a);this.postCondition(b)},and:function(a){this.appendOperator("&");this.appendSearch(Array.from(arguments));return this},preCondition:function(a){if(a.length==2&&a[0]==="("){this.branch()}},postCondition:function(a){if(a.length==2&&a[1]===")"){this.endBranch()}},getActualArgument:function(a){if(a.length===2){if(a[0]==")"||a[0]=="("){return a[1]}return a[0]}return a[0]},withIn:function(b){for(var a=0;a<b.length;a++){this.or(b[a])}return this},branch:function(){this.appendOperator("(");return this},endBranch:function(){this.appendOperator(")");return this},appendOperator:function(a){if(a!="("&&this.searches.length==0){return}if(a==="|"&&this.searches.getLast()==="("){return}this.searches.push(a)},execute:function(){if(!this.searchIndexCreated){this.createSearchIndex()}if(!this.hasSearchTokens()){this.deleteSearch()}else{this.fireEvent("initSearch");this.searchResult=[];this.compileSearch();this.performSearch()}this.fireEvent("search");return this},performSearch:function(){var b=this.getDataFromSource();for(var a=0;a<b.length;a++){if(this.isMatchingSearch(b[a])){this.searchResult.push(b[a])}}},isMatchingSearch:function(a){return this.searchFn.call(this,a)},compileSearch:function(){this.searchFn=this.searchParser.getSearchFn(this.searches)},hasSearchTokens:function(){return this.hasContentInFirstSearch()||this.searches.length>1},hasContentInFirstSearch:function(){if(this.searches.length===0){return false}var a=this.searches[0];return(ludo.util.isArray(a)||a.fn!==undefined||(a.txt!==undefined&&a.txt.length>0))},hasData:function(){return this.searchResult!==undefined},getData:function(){return this.searchResult},getDataFromSource:function(){return this.dataSource.getLinearData()},getSearchDelay:function(){return this.delay||0},onDelete:function(a){if(this.searchResult&&this.searchResult.length>0){for(var b=0;b<this.searchResult.length-1;b++){var d=this.searchResult[b];if(d.uid==a.uid){this.clearSearchIndex();this.searchResult.splice(b,1);console.log(this.searchResult.length)}}}},clearSearchIndex:function(){this.searchIndexCreated=false},createSearchIndex:function(){this.indexBranch(this.getDataFromSource());this.searchIndexCreated=true},indexBranch:function(h,d){d=d||[];var g=this.getSearchIndexKeys();var b;for(var f=0;f<h.length;f++){b=[];for(var a=0;a<g.length;a++){if(h[f][g[a]]!==undefined){b.push((h[f][g[a]]+"").toLowerCase())}}h[f].searchIndex=b.join(" ");for(a=0;a<d.length;a++){d[a].searchIndex=[d[a].searchIndex,h[f].searchIndex].join(" ")}if(h[f].children){this.indexBranch(h[f].children,d.concat(h[f]))}}},getSearchIndexKeys:function(){if(this.index!==undefined){return this.index}var g=["children","searchIndex","uid"];var f=this.getDataFromSource();if(f.length>0){var a=Object.clone(f[0]);var b=[];for(var d in a){if(a.hasOwnProperty(d)){if(g.indexOf(d)===-1){b.push(d)}}}return b}return["NA"]},getCount:function(){return this.searchResult?this.searchResult.length:0},searchToString:function(){return this.hasData()?"":""}});ludo.dataSource.JSONArray=new Class({Extends:ludo.dataSource.JSON,sortFn:{},selectedRecords:[],primaryKey:"id",paging:undefined,dataCache:{},sortedBy:{column:undefined,order:undefined},searchConfig:undefined,statefulProperties:["sortedBy","paging"],index:undefined,searcherType:"dataSource.JSONArraySearch",uidMap:{},selected:undefined,__construct:function(a){this.parent(a);
this.setConfigParams(a,["searchConfig","sortFn","primaryKey","sortedBy","paging","selected"]);if(this.primaryKey&&!ludo.util.isArray(this.primaryKey)){this.primaryKey=[this.primaryKey]}if(this.paging){this.paging.offset=this.paging.offset||0;this.paging.initialOffset=this.paging.offset;if(this.paging.initialOffset!==undefined){this.fireEvent("page",(this.paging.initialOffset/this.paging.size)+1)}if(this.isCacheEnabled()){this.addEvent("load",this.populateCache.bind(this))}}this.addEvent("parsedata",this.createIndex.bind(this));if(this.selected){this.addEvent("firstLoad",this.setInitialSelected.bind(this))}if(this.data&&!this.index){this.createIndex()}},hasRemoteSearch:function(){return this.paging&&this.paging.remotePaging},setInitialSelected:function(){this.selectRecord(this.selected)},getCount:function(){if(this.paging&&this.paging.rows){return this.paging.rows}if(this.searcher&&this.searcher.hasData()){return this.searcher.getCount()}return this.data?this.data.length:0},isCacheEnabled:function(){return this.paging&&this.paging.remotePaging&&this.paging.cache},sort:function(){if(this.sortedBy.column&&this.sortedBy.order){this.sortBy(this.sortedBy.column,this.sortedBy.order)}},by:function(a){this.sortedBy.column=a;this.sortedBy.order=this.getSortOrderFor(a);return this},ascending:function(){this.sortedBy.order="asc";return this},descending:function(){this.sortedBy.order="desc";return this},sortBy:function(b,a){a=a||this.getSortOrderFor(b);this.sortedBy={column:b,order:a};if(this.paging){this.paging.offset=this.paging.initialOffset||0;this.fireEvent("page",Math.round(this.paging.offset/this.paging.size)+1)}if(this.shouldSortOnServer()){this.loadOrGetFromCache()}else{var d=this._getData();if(!d){return this}d.sort(this.getSortFnFor(b,a));this.fireEvent("change")}this.fireEvent("sort",this.sortedBy);if(this.paging){this.firePageEvents()}this.fireEvent("state");return this},getSortedBy:function(){return this.sortedBy.column},getSortOrder:function(){return this.sortedBy.order},shouldSortOnServer:function(){return this.paging&&this.paging.remotePaging},setSortFn:function(b,a){this.sortFn[b]=a},getSortFnFor:function(b,a){if(this.sortFn[b]!==undefined){return this.sortFn[b][a]}if(a==="asc"){return function(f,d){return f[b]+"_"+f[this.primaryKey]<d[b]+"_"+d[this.primaryKey]?-1:1}}else{return function(f,d){return f[b]+"_"+f[this.primaryKey]<d[b]+"_"+d[this.primaryKey]?1:-1}}},getSortOrderFor:function(a){if(this.sortedBy.column===a){return this.sortedBy.order==="asc"?"desc":"asc"}return"asc"},addRecord:function(a){this.data=this.data||[];this.data.push(a);if(!this.index){this.createIndex()}this.fireEvent("add",a);return this.createRecord(a)},find:function(a){return this.findRecord(a)},findRecord:function(b){if(!this.data){return undefined}if(b.getUID!==undefined){b=b.getUID()}if(b.uid){b=b.uid}var f=this.getById(b);if(f){return f}var d=ludo.util.isObject(b)?"isRecordMatchingSearch":"hasMatchInPrimaryKey";for(var a=0;a<this.data.length;a++){if(this[d](this.data[a],b)){return this.data[a]}}return undefined},isRecordMatchingSearch:function(a,d){for(var b in d){if(d.hasOwnProperty(b)){if(a[b]!=d[b]){return false}}}return true},hasMatchInPrimaryKey:function(a,d){if(this.primaryKey){for(var b=0;b<this.primaryKey.length;b++){if(a[this.primaryKey[b]]===d){return true}}}return false},findRecords:function(d){var a=[];for(var b=0;b<this.data.length;b++){if(this.isRecordMatchingSearch(this.data[b],d)){a.push(this.data[b])}}return a},getLinearData:function(){return this.data},selectRecord:function(a){var b=this.findRecord(a);if(b){this._setSelectedRecord(b);return b}return undefined},selectRecords:function(b){this.selectedRecords=this.findRecords(b);for(var a=0;a<this.selectedRecords.length;a++){this.fireSelect(this.selectedRecords[a])}return this.selectedRecords},selectRecordIndex:function(a){var b=this._getData();if(b.length&&a>=0&&a<b.length){var d=b[a];this._setSelectedRecord(d);return d}return undefined},_getData:function(){if(this.hasSearchResult()){return this.searcher.getData()}return this.data},getRecordByIndex:function(a){if(this.data.length&&a>=0&&a<this.data.length){return this.data[a]}return undefined},previous:function(){var a=this.getPreviousOf(this.getSelectedRecord());if(a){this._setSelectedRecord(a)}return a},getPreviousOf:function(a){var d=this._getData();if(a){var b=d.indexOf(a);return b>0?d[b-1]:undefined}else{return d.length>0?d[0]:undefined}},next:function(){var a=this.getNextOf(this.getSelectedRecord());if(a){this._setSelectedRecord(a)}return a},getNextOf:function(a){var d=this._getData();if(a){var b=d.indexOf(a);return b<d.length-1?d[b+1]:undefined}else{return d.length>0?d[0]:undefined}},_setSelectedRecord:function(a){if(this.selectedRecords.length){this.fireEvent("deselect",this.selectedRecords[0])}this.selectedRecords=[a];this.fireSelect(Object.clone(a))},getSelectedRecord:function(){return this.selectedRecords.length>0?this.selectedRecords[0]:undefined},getSelectedRecords:function(){return this.selectedRecords
},deleteRecords:function(d){var a=this.findRecords(d);for(var b=0;b<a.length;b++){this.data.erase(a[b]);this.fireEvent("delete",a[b])}this.onChange()},remove:function(a){var b=this.findRecord(a);if(b){this.data.erase(b);this.fireEvent("delete",b);this.onChange()}},deleteRecord:function(a){this.remove(a)},onChange:function(){this.fireEvent("count",this.searcher!=undefined?this.searcher.getCount():this.getCount())},selectTo:function(f){var g=this.getSelectedRecord();if(!g){this.selectRecord(f);return}var h=this.findRecord(f);if(h){this.selectedRecords=[];var b=this.data.indexOf(h);var a=this.data.indexOf(g);var d;if(b>a){for(d=a;d<=b;d++){this.selectedRecords.push(this.data[d]);this.fireSelect(this.data[d])}}else{for(d=a;d>=b;d--){this.selectedRecords.push(this.data[d]);this.fireSelect(this.data[d])}}}},updateRecord:function(a,b){var d=this.getRecord(a);if(d){d.setProperties(b)}return d},getPostData:function(){if(!this.paging){return this.parent()}var a=this.postData||{};a._paging={size:this.paging.size,offset:this.paging.offset};a._sort=this.sortedBy;return a},previousPage:function(){if(!this.paging||this.isOnFirstPage()){return}this.paging.offset-=this.paging.size;this.onPageChange("previousPage")},nextPage:function(){if(!this.paging||this.isOnLastPage()){return}this.paging.offset+=this.paging.size;this.onPageChange("nextPage")},lastPage:function(){if(!this.paging||this.isOnLastPage()){return}var b=this.getCount();var a=b%this.paging.size;if(a===0){a=this.paging.size}this.paging.offset=b-a;this.onPageChange("lastPage")},firstPage:function(){if(!this.paging||this.isOnFirstPage()){return}this.paging.offset=0;this.onPageChange("firstPage")},isOnFirstPage:function(){if(!this.paging){return true}return this.paging.offset===undefined||this.paging.offset===0},isOnLastPage:function(){return this.paging.size+this.paging.offset>=this.getCount()},onPageChange:function(a){if(this.paging.remotePaging){this.loadOrGetFromCache()}this.fireEvent("change");this.fireEvent(a);this.firePageEvents()},loadOrGetFromCache:function(){if(this.isDataInCache()){this.data=this.dataCache[this.getCacheKey()].data;this.fireEvent("change")}else{this.load()}},populateCache:function(){if(this.isCacheEnabled()){this.dataCache[this.getCacheKey()]={data:this.data,time:new Date().getTime()}}},isDataInCache:function(){return this.dataCache[this.getCacheKey()]!==undefined&&!this.isCacheOutOfDate()},clearCache:function(){this.dataCache={}},isCacheOutOfDate:function(){if(!this.paging.cacheTimeout){return false}var a=this.dataCache[this.getCacheKey()].time;return a+(this.paging.cacheTimeout*1000)<(new Date().getTime())},getCacheKey:function(){var a=["key",this.paging.offset,this.sortedBy.column,this.sortedBy.order];if(this.searcher!==undefined&&this.searcher.hasData()){a.push(this.searcher.searchToString())}return a.join("|")},hasData:function(){return this.data!=undefined&&this.data.length>0},firePageEvents:function(a){if(this.isOnLastPage()){this.fireEvent("lastPage")}else{this.fireEvent("notLastPage")}if(this.isOnFirstPage()){this.fireEvent("firstPage")}else{this.fireEvent("notFirstPage")}this.fireEvent("page",this.getPageNumber());if(a===undefined){this.fireEvent("state")}},toPage:function(a){if(a>0&&a<=this.getPageCount()&&!this.isOnPage(a)){this.paging.offset=(a-1)*this.paging.size;this.onPageChange("toPage");return true}return false},setPageSize:function(a){if(this.paging){this.dataCache={};this.paging.size=parseInt(a);this.paging.offset=0;this.onPageChange("toPage")}},isOnPage:function(a){return a==this.getPageNumber()},getPageNumber:function(){return this.paging?Math.floor(this.paging.offset/this.paging.size)+1:1},getPageCount:function(){return this.paging?Math.ceil(this.getCount()/this.paging.size):1},getData:function(){if(this.hasSearchResult()){if(this.paging&&this.paging.size){return this.getDataForPage(this.searcher.getData())}return this.searcher.getData()}if(!this.paging||this.paging.remotePaging){return this.parent()}return this.getDataForPage(this.data)},getDataForPage:function(a){if(!a||a.length==0){return[]}var b=this.paging.initialOffset||this.paging.offset;if(b>a.length){this.toPage(this.getPageCount());b=(this.getPageCount()-1)*this.paging.size}this.resetInitialOffset.delay(200,this);return a.slice(b,Math.min(a.length,b+this.paging.size))},resetInitialOffset:function(){this.paging.initialOffset=undefined},parseNewData:function(b,a){if(a!=undefined&&this.paging&&a.rows!==undefined){this.paging.rows=a.rows}if(a!=undefined&&this.paging&&a.response&&a.response.rows!==undefined){this.paging.rows=a.response.rows}this.parent(b,a);this.fireEvent("count",this.getCount());if(this.shouldSortAfterLoad()){this.sort()}else{this.fireEvent("change")}if(this.paging!==undefined){this.firePageEvents(true)}},createIndex:function(){this.index={};this.indexBranch(this.data)},indexBranch:function(d,b){for(var a=0;a<d.length;a++){this.indexRecord(d[a],b);if(d[a].children&&d[a].children.length){this.indexBranch(d[a].children,d[a])}}},indexRecord:function(a,b){if(!this.index){this.createIndex()
}if(b){a.parentUid=b.uid}var d=this.getPrimaryKeyIndexFor(a);if(d){this.index[d]=a}if(!a.uid){a.uid=["uid_",String.uniqueID()].join("")}this.index[a.uid]=a},shouldSortAfterLoad:function(){if(this.paging&&this.paging.remotePaging){return false}return this.sortedBy!==undefined&&this.sortedBy.column&&this.sortedBy.order},search:function(a){this.getSearcher().search(a)},remoteSearch:function(a){this.postData=this.postData||{};this.postData.search=a;this.toPage(1);this.load()},afterSearch:function(){var a=this.getSearcher();this.fireEvent("count",a.hasData()?a.getCount():this.getCount());if(this.paging!==undefined){this.paging.offset=0;this.firePageEvents(true);this.fireEvent("pageCount",this.getPageCount())}this.fireEvent("change")},searcher:undefined,getSearcher:function(){if(this.searcher===undefined){this.searchConfig=this.searchConfig||{};var a=Object.merge({type:this.searcherType,dataSource:this},this.searchConfig);this.searcher=ludo._new(a);this.addSearcherEvents()}return this.searcher},addSearcherEvents:function(){this.searcher.addEvent("search",this.afterSearch.bind(this));this.searcher.addEvent("deleteSearch",this.afterSearch.bind(this))},hasSearchResult:function(){return this.searcher!==undefined&&this.searcher.hasData()},getById:function(d){if(this.index[d]!==undefined){return this.index[d]}if(this.primaryKey.length===1){return this.index[d]}else{var b=[];for(var a=0;a<this.primaryKey.length;a++){b.push(d[this.primaryKey[a]])}return this.index[b.join("")]}},recordObjects:{},getRecord:function(a){var b=this.findRecord(a);if(b){return this.createRecord(b)}return undefined},createRecord:function(a){var b=a.uid;if(!this.recordObjects[b]){this.recordObjects[b]=this.recordInstance(a,this);this.addRecordEvents(this.recordObjects[b])}return this.recordObjects[b]},recordInstance:function(a){return new ludo.dataSource.Record(a,this)},addRecordEvents:function(a){a.addEvent("update",this.onRecordUpdate.bind(this));a.addEvent("remove",this.onRecordDispose.bind(this));a.addEvent("select",this.selectRecord.bind(this))},fireSelect:function(a){this.fireEvent("select",a)},onRecordUpdate:function(a){this.indexRecord(a);this.fireEvent("update",a)},onRecordDispose:function(a){var d=this.getBranchFor(a);if(d){var b=d.indexOf(a);if(b!==-1){d.splice(b,1)}this.removeFromIndex(a);this.fireEvent("remove",a)}},getBranchFor:function(a){if(a.parentUid){var b=this.findRecord(a.parentUid);return b?b.children:undefined}else{return this.data}},removeFromIndex:function(a){this.recordObjects[a.uid]=undefined;this.index[a.uid]=undefined;var b=this.getPrimaryKeyIndexFor(a);if(b){this.index[b]=undefined}},getPrimaryKeyIndexFor:function(a){if(this.primaryKey){var d=[];for(var b=0;b<this.primaryKey.length;b++){d.push(a[this.primaryKey[b]])}return d.join("")}return undefined}});ludo.factory.registerClass("dataSource.JSONArray",ludo.dataSource.JSONArray);ludo.effect.DropPoint=new Class({id:undefined,el:undefined,captureRegions:undefined});ludo.effect.DragDrop=new Class({Extends:ludo.effect.Drag,useShim:false,currentDropPoint:undefined,onValidDropPoint:undefined,captureRegions:false,mouseYOffset:undefined,__construct:function(a){this.parent(a);if(a.captureRegions!==undefined){this.captureRegions=a.captureRegions}},ludoEvents:function(){this.parent();this.addEvent("start",this.setStartProperties.bind(this));this.addEvent("end",this.drop.bind(this))},getDropIdByEvent:function(b){var a=jQuery(b.target);if(!a.hasClass("ludo-drop")){a=a.getParent(".ludo-drop")}return a.attr("forId")},remove:function(b){if(this.els[b]!==undefined){var a=jQuery(this.els[b].el);a.unbind("mouseenter",this.enterDropTarget.bind(this));a.unbind("mouseleave",this.leaveDropTarget.bind(this));return this.parent(b)}return false},addDropTarget:function(a){a=this.getValidNode(a);a.el.addClass("ludo-drop");if(a.el.mouseenter!=undefined){a.el.mouseenter(this.enterDropTarget.bind(this));a.el.mouseleave(this.leaveDropTarget.bind(this))}else{a.el.on("mouseenter",this.enterDropTarget.bind(this));a.el.on("mouseleave",this.leaveDropTarget.bind(this))}var b=a.captureRegions!==undefined?a.captureRegions:this.captureRegions;if(b){a.el.on("mousemove",this.captureRegion.bind(this))}a=this.els[a.id]=Object.merge(a,{el:a.el,captureRegions:b});return a},enterDropTarget:function(a){if(this.isActive()){this.setCurrentDropPoint(a);this.onValidDropPoint=true;this.fireEvent("enterDropTarget",this.getDropEventArguments(a));if(this.onValidDropPoint){if(this.shouldCaptureRegionsFor(this.currentDropPoint)){this.setMidPoint()}this.fireEvent("validDropTarget",this.getDropEventArguments(a))}else{this.fireEvent("invalidDropTarget",this.getDropEventArguments(a))}return false}return undefined},setCurrentDropPoint:function(a){this.currentDropPoint=this.getById(this.getDropIdByEvent(a))},leaveDropTarget:function(a){if(this.isActive()&&this.currentDropPoint){this.fireEvent("leaveDropTarget",this.getDropEventArguments(a));this.onValidDropPoint=false;this.currentDropPoint=undefined}},getDropEventArguments:function(a){return[this.getDragged(),this.currentDropPoint,this,a.target]
},setInvalid:function(){this.onValidDropPoint=false},getCurrentDropPoint:function(){return this.currentDropPoint},drop:function(a){if(this.onValidDropPoint){this.fireEvent("drop",this.getDropEventArguments(a))}},setStartProperties:function(){this.onValidDropPoint=false},shouldCaptureRegionsFor:function(a){return this.els[a.id].captureRegions===true},getDropPointCoordinates:function(){if(this.currentDropPoint){var b=this.currentDropPoint.el;var a=b.position();a.width=b.width();a.height=b.height();return a;return this.currentDropPoint.el.getCoordinates()}return undefined},previousRegions:{h:undefined,v:undefined},captureRegion:function(a){if(this.isActive()&&this.onValidDropPoint&&this.shouldCaptureRegionsFor(this.currentDropPoint)){var b=this.midPoint;if(a.pageY<b.y&&this.previousRegions.v!=="n"){this.fireEvent("north",this.getDropEventArguments(a));this.previousRegions.v="n"}else{if(a.pageY>=b.y&&this.previousRegions.v!=="s"){this.fireEvent("south",this.getDropEventArguments(a));this.previousRegions.v="s"}}if(a.pageX<b.x&&this.previousRegions.h!=="w"){this.fireEvent("west",this.getDropEventArguments(a));this.previousRegions.h="w"}else{if(a.pageX>=b.x&&this.previousRegions.h!=="e"){this.fireEvent("east",this.getDropEventArguments(a));this.previousRegions.h="e"}}}},midPoint:undefined,setMidPoint:function(){var a=this.getDropPointCoordinates();this.midPoint={x:a.left+(a.width/2),y:a.top+(a.height/2)};this.previousRegions={h:undefined,v:undefined}}});ludo.grid.ColumnMove=new Class({Extends:ludo.effect.DragDrop,gridHeader:undefined,columnManager:undefined,shimCls:["ludo-grid-movable-shim"],insertionMarker:undefined,arrowHeight:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["gridHeader","columnManager"])},ludoEvents:function(){this.parent();this.addEvent("createShim",this.setZIndex.bind(this))},setZIndex:function(a){jQuery(a).css("zIndex",50000)},getMarker:function(){if(this.insertionMarker===undefined){this.insertionMarker=ludo.dom.create({cls:"ludo-grid-movable-insertion-marker",css:{display:"none"},renderTo:document.body});ludo.dom.create({cls:"ludo-grid-movable-insertion-marker-bottom",renderTo:this.insertionMarker})}return this.insertionMarker},hideMarker:function(){this.getMarker().css("display","none")},showMarkerAt:function(a,d){var b=a.offset();b.width=a.outerWidth();b.height=a.outerHeight();this.getMarker().css({display:"",left:(b.left+(d=="after"?b.width:0)),top:(b.top-this.getArrowHeight()),height:b.height})},setMarkerHeight:function(a){this.getMarker().css("height",(a+(this.getArrowHeight()*2)))},getArrowHeight:function(){if(!this.arrowHeight){this.arrowHeight=this.getMarker().find(".ludo-grid-movable-insertion-marker-bottom").first().outerHeight()}return this.arrowHeight}});ludo.Scroller=new Class({Extends:Events,els:{applyTo:null,el:null,elInner:null,parent:null},active:0,wheelSize:5,type:"horizontal",currentSize:0,renderTo:undefined,initialize:function(a){this.type=a.type||this.type;if(a.applyTo){this.setApplyTo(a.applyTo)}this.renderTo=a.parent?jQuery(a.parent):null;if(a.mouseWheelSizeCls){this.determineMouseWheelSize(a.mouseWheelSizeCls)}this.createElements();this.createEvents()},setApplyTo:function(a){if(!ludo.util.isArray(a)){a=[a]}this.els.applyTo=a},determineMouseWheelSize:function(a){var b=jQuery("<div>");b.addClass(a);b.css("visibility","hidden");jQuery(document.body).append(b);this.wheelSize=b.height();if(!this.wheelSize){this.wheelSize=25}b.remove()},createElements:function(){this.els.el=jQuery("<div>");this.els.el.addClass("ludo-scroller");this.els.el.addClass("ludo-scroller-"+this.type);this.els.el.css({position:"relative","z-index":1000,overflow:"hidden"});var a="auto";if(this.type=="horizontal"){this.els.el.css({"overflow-x":a,width:"100%",height:Browser.ie?"21px":"17px"})}else{this.els.el.css({"overflow-y":a,height:"100%",width:Browser.ie?"21px":"17px",right:"0px",top:"0px",position:"absolute"})}this.els.el.scroll(this.performScroll.bind(this));this.els.elInner=jQuery("<div>");this.els.elInner.css("position","relative");this.els.elInner.html("&nbsp;");this.els.el.append(this.els.elInner)},createEvents:function(){this.els.elInner.on("resize",this.toggle.bind(this));if(this.type=="vertical"){for(var a=0;a<this.els.applyTo.length;a++){this.els.applyTo[a].on("mousewheel",this.eventScroll.bind(this))}}jQuery(window).on("resize",this.resize.bind(this))},resize:function(){if(this.type=="horizontal"){this.els.el.css("width",this.renderTo.outerWidth())}else{var a=this.renderTo.outerHeight();if(a==0){return}this.els.el.css("height",a)}this.toggle()},getEl:function(){return this.els.el},setContentSize:function(a){if(this.type=="horizontal"){this.currentSize=a||this.getWidthOfScrollableElements();this.els.elInner.css("width",this.currentSize)}else{this.currentSize=a||this.getHeightOfScrollableElements();if(this.currentSize<=0){var b=this.els.applyTo.getChildren(".ludo-grid-data-column");if(b.length){this.currentSize=b[0].outerHeight()}}this.els.elInner.css("height",this.currentSize)
}if(this.currentSize<=0){this.setContentSize.delay(1000,this)}this.resize();this.toggle()},getWidthOfScrollableElements:function(){return this.getTotalSize("outerWidth")},getHeightOfScrollableElements:function(){return this.getTotalSize("outerHeight")},getTotalSize:function(d){var a=0;for(var b=0;b<this.els.applyTo.length;b++){a+=this.els.applyTo[b][d]()}return a},eventScroll:function(b){var a=this.els.el.scrollTop();this.els.el.scrollTop(a-b.originalEvent.wheelDelta);return false},performScroll:function(){if(this.type=="horizontal"){this.scrollTo(this.els.el.scrollLeft())}else{this.scrollTo(this.els.el.scrollTop())}},scrollBy:function(b){var a=this.type==="horizontal"?"scrollLeft":"scrollTop";this.els.el[a]+=b;this.scrollTo(this.els.el[a])},scrollTo:function(d){var b=this.type==="horizontal"?"left":"top";for(var a=0;a<this.els.applyTo.length;a++){this.els.applyTo[a].css(b,(d*-1))}this.fireEvent("scroll",this)},getHeight:function(){return this.active?this.els.el.height():0},getWidth:function(){return this.active?this.els.el.width():0},toggle:function(){this.shouldShowScrollbar()?this.show():this.hide()},shouldShowScrollbar:function(){var b=this.type==="horizontal"?"width":"height";var a=this.getParentEl()[b]();return this.currentSize>a&&a>0},getParentEl:function(){return this.renderTo?this.renderTo:this.els.el},show:function(){this.active=true;this.els.el.css("display","")},hide:function(){this.active=false;this.scrollTo(0);this.els.el.css("display","none")}});ludo.grid.GridHeader=new Class({Extends:ludo.Core,columnManager:undefined,grid:undefined,cells:{},cellHeight:undefined,spacing:{},headerMenu:false,__construct:function(a){this.parent(a);this.setConfigParams(a,["columnManager","headerMenu","grid"]);this.measureCellHeight();this.createDOM()},ludoEvents:function(){this.parent();var a=this.columnManager;a.addEvent("resize",this.renderColumns.bind(this));a.addEvent("stretch",this.renderColumns.bind(this));a.addEvent("movecolumn",this.renderColumns.bind(this));a.addEvent("hidecolumn",this.renderColumns.bind(this));a.addEvent("showcolumn",this.renderColumns.bind(this));this.grid.addEvent("render",this.renderColumns.bind(this));this.grid.getDataSource().addEvent("sort",this.updateSortArrow.bind(this))},createDOM:function(){this.el=jQuery("<div>");this.el.addClass("ludo-header");this.el.addClass("testing");this.el.insertBefore(this.grid.$b().first());var a=this.columnManager.getCountRows();this.el.css("height",this.cellHeight*a+ludo.dom.getMBPH(this.el));this.renderColumns()},renderColumns:function(){var f=this.columnManager.getCountRows();this.measureCellHeight();for(var h=0;h<f;h++){var d=this.columnManager.getColumnsInRow(h);var b=0;for(var g=0;g<d.length;g++){var a=this.columnManager.getWidthOf(d[g]);if(h==this.columnManager.getStartRowOf(d[g])){var l=this.getCell(d[g]);l.css("display","");l.css("left",b);l.css("top",h*this.cellHeight);var m=(this.columnManager.getRowSpanOf(d[g])*this.cellHeight)-this.spacing.height;var k=(g==d.length-1)?this.spacing.width-1:this.spacing.width;l.css("width",a-k);l.css("height",m);l.css("line-height",m+"px");this.resizeCellBackgrounds(d[g]);l.removeClass("last-header-cell");if(g==d.length-1){l.addClass("last-header-cell")}}b+=a}}this.hideHiddenColumns()},hideHiddenColumns:function(){var b=this.columnManager.getHiddenColumns();for(var a=0;a<b.length;a++){if(this.cellExists(b[a])){this.cells[b[a]].css("display","none")}}},cellExists:function(a){return this.cells[a]!==undefined},measureCellHeight:function(){if(this.grid.isHidden()){return}var a=jQuery("<div>");a.addClass("ludo-grid-header-cell");this.grid.$b().append(a);this.cellHeight=a.height()+ludo.dom.getMH(a);this.spacing={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()};a.remove()},menuButtons:{},getCell:function(a){if(this.cells[a]){return this.cells[a]}var d=this.cells[a]=jQuery("<div>");d.attr("col",a);d.addClass("ludo-grid-header-cell");d.addClass("ludo-header-"+this.columnManager.getHeaderAlignmentOf(a));var b=jQuery('<span class="ludo-cell-text">'+this.columnManager.getHeadingFor(a)+"</span>");d.append(b);this.createTopAndBottomBackgrounds(a);this.addDOMForDropTargets(d,a);if(this.columnManager.isSortable(a)){d.on("click",this.sortByDOM.bind(this))}d.on("mouseover",this.mouseoverHeader.bind(this));d.on("mouseout",this.mouseoutHeader.bind(this));if(this.headerMenu){this.menuButtons[a]=new ludo.menu.Button({renderTo:d,id:this.getMenuButtonId(a),menu:this.getMenu(a),listeners:{beforeShow:this.validateButtonDisplay.bind(this)}})}this.el.append(d);this.getMovable().add({el:d,column:a});return d},validateButtonDisplay:function(a){if(this.columnMove&&this.columnMove.isActive()){a.cancelShow()}},cellBg:{},createTopAndBottomBackgrounds:function(b){var d=jQuery("<div>");d.addClass("ludo-grid-header-cell-top");this.cells[b].append(d);var a=jQuery("<div>");a.addClass("ludo-grid-header-cell-bottom");this.cells[b].append(a);this.cellBg[b]={top:d,bottom:a}},resizeCellBackgrounds:function(b){var d=(this.columnManager.getRowSpanOf(b)*this.cellHeight)-this.spacing.height;
var a=Math.round(d)/2;this.cellBg[b].top.css("height",a);a=d-a;this.cellBg[b].bottom.css("height",a)},getMenu:function(a){return{singleton:true,id:this.getMenuId(),type:"menu.Menu",direction:"vertical",children:this.getColumnMenu(a)}},getColumnMenu:function(f){var a=[];var d=this.columnManager.getLeafKeys();for(var b=0;b<d.length;b++){a.push({type:"form.Checkbox",disabled:!(this.columnManager.isRemovable(d[b])),checked:this.columnManager.isVisible(d[b]),label:this.columnManager.getHeadingFor(d[b]),action:d[b],height:25,width:150,listeners:{change:this.getColumnToggleFn(d[b],f)}})}a.push({html:ludo.language.get("Sort ascending"),listeners:{click:function(){this.sort("ascending")}.bind(this)}});a.push({html:ludo.language.get("Sort descending"),listeners:{click:function(){this.sort("descending")}.bind(this)}});return a},sort:function(a){this.grid.getDataSource().by(this.currentColumn)[a]().sort();ludo.get(this.getMenuButtonId(this.currentColumn)).hideMenu()},getColumnToggleFn:function(b,a){return function(d){if(d){this.columnManager.showColumn(b)}else{this.columnManager.hideColumn(b)}ludo.get(this.getMenuButtonId(a)).hideMenu()}.bind(this)},getMenuId:function(){return"header-menu-"+this.getId()},getMenuButtonId:function(a){return this.getMenuId()+"-"+a},currentColumn:undefined,mouseoverHeader:function(b){var a=this.getColByDOM(b.target);if(!this.grid.colResizeHandler.isActive()&&!this.grid.isColumnDragActive()&&this.columnManager.isSortable(a)){this.currentColumn=a;this.cells[a].addClass("ludo-grid-header-cell-over")}},mouseoutHeader:function(b){if(!this.grid.colResizeHandler.isActive()){var a=this.getColByDOM(b.target);if(!a){return}this.cells[a].removeClass("ludo-grid-header-cell-over")}},getColByDOM:function(b){b=jQuery(b);var a=b.attr("col");if(!a&&a!="0"){a=b.parent().attr("col")}return a},getHeight:function(){if(this.cachedHeight===undefined){this.cachedHeight=this.columnManager.getCountRows()*this.cellHeight;this.cachedHeight+=ludo.dom.getMBPH(this.el)}return this.cachedHeight},getEl:function(){return this.el},sortByDOM:function(b){var a=this.getColByDOM(b.target);this.grid.getDataSource().sortBy(a)},addDOMForDropTargets:function(d,b){var f=jQuery("<div>");f.css({position:"absolute","z-index":15,left:"0px",top:"0px",width:"50%",height:"100%"});d.append(f);var a=jQuery("<div>");a.css({position:"absolute","z-index":15,right:"0px",top:"0px",width:"50%",height:"100%"});d.append(a);this.getMovable().addDropTarget({el:f,column:b,position:"before"});this.getMovable().addDropTarget({el:a,column:b,position:"after"})},columnMove:undefined,getMovable:function(){if(this.columnMove===undefined){this.columnMove=new ludo.grid.ColumnMove({useShim:true,delay:0.5,mouseYOffset:15,mouseXOffset:15,listeners:{before:this.validateMove.bind(this),start:this.grid.hideResizeHandles.bind(this.grid),end:this.grid.showResizeHandles.bind(this.grid),enterDropTarget:this.validateDrop.bind(this),leaveDropTarget:this.leaveDropTarget.bind(this),showShim:this.setColumnTextOnMove.bind(this),drop:this.moveColumn.bind(this)}})}return this.columnMove},setColumnTextOnMove:function(d,a){var b=a.getDragged().column;d.html(this.columnManager.getHeadingFor(b));d.css("line-height",d.css("height"))},validateMove:function(b,a){if(!this.columnManager.isMovable(b.column)){a.cancelDrag()}},validateDrop:function(f,g){var d=this.columnManager;if(d.canBeMovedTo(f.column,g.column,g.position)){var b=this.getMovable();b.showMarkerAt(this.getCell(g.column),g.position);var a=(d.getChildDepthOf(g.column)+d.getRowSpanOf(g.column))*this.cellHeight;b.setMarkerHeight(a)}},leaveDropTarget:function(){this.getMovable().hideMarker()},moveColumn:function(a,b){if(b.position=="before"){this.columnManager.insertColumnBefore(a.column,b.column)}else{this.columnManager.insertColumnAfter(a.column,b.column)}this.getMovable().hideMarker()},clearSortClassNameFromHeaders:function(){var d=this.columnManager.getLeafKeys();for(var a=0;a<d.length;a++){if(this.cells[d[a]]!==undefined){var b=this.cells[d[a]].find("span");b.removeClass("ludo-cell-text-sort-asc");b.removeClass("ludo-cell-text-sort-desc")}}},updateSortArrow:function(a){this.clearSortClassNameFromHeaders();if(this.cells[a.column]){this.cells[a.column].find("span").addClass("ludo-cell-text-sort-"+a.order)}}});ludo.ColResize=new Class({Extends:ludo.Core,component:undefined,resizeHandles:{},resizeProperties:{},minPos:0,maxPos:10000,__construct:function(a){this.parent(a);this.component=a.component;this.createEvents()},createEvents:function(){this.getEventEl().on(ludo.util.getDragMoveEvent(),this.moveColResizeHandle.bind(this));this.getEventEl().on(ludo.util.getDragEndEvent(),this.stopColResize.bind(this))},setPos:function(a,b){this.resizeHandles[a].css("left",b)},hideHandle:function(a){this.resizeHandles[a].css("display","none")},showHandle:function(a){this.resizeHandles[a].css("display","")},hideAllHandles:function(){for(var a in this.resizeHandles){if(this.resizeHandles.hasOwnProperty(a)){this.hideHandle(a)}}},showAllHandles:function(){for(var a in this.resizeHandles){if(this.resizeHandles.hasOwnProperty(a)){this.showHandle(a)
}}},getHandle:function(b,a){var d=jQuery("<div>");d.addClass("ludo-column-resize-handle");d.css({top:0,position:"absolute",height:"100%",cursor:"col-resize","z-index":15000,display:a?"":"none"});d.attr("col-reference",b);d.on(ludo.util.getDragStartEvent(),this.startColResize.bind(this));if(!ludo.util.isTabletOrMobile()){d.on("mouseenter",this.mouseOverResizeHandle.bind(this));d.on("mouseleave",this.mouseOutResizeHandle.bind(this))}this.resizeHandles[b]=d;return d},startColResize:function(d){var a=jQuery(d.target).attr("col-reference");this.fireEvent("startresize",a);jQuery(d.target).addClass("ludo-resize-handle-active");var f=this.getLeftOffsetOfColResizeHandle();var b=this.resizeProperties;b.min=this.getMinPos()-f;b.max=this.getMaxPos()-f;b.mouseX=this.resizeProperties.currentX=d.pageX;b.elX=parseInt(jQuery(d.target).css("left").replace("px",""));b.currentX=this.resizeProperties.elX;b.active=true;b.el=jQuery(d.target);b.index=a;return false},getLeftOffsetOfColResizeHandle:function(){if(!this.resizeHandles[0]){return 3}if(!this.handleOffset){var a=Math.ceil(this.resizeHandles[0].getSize().x/2);if(a>0){this.handleOffset=a}else{return 3}}return this.handleOffset},moveColResizeHandle:function(a){if(this.resizeProperties.active){var b=this.resizeProperties.elX-this.resizeProperties.mouseX+a.pageX;b=Math.max(b,this.resizeProperties.min);b=Math.min(b,this.resizeProperties.max);this.resizeProperties.el.css("left",b);this.resizeProperties.currentX=b;return false}return undefined},stopColResize:function(){if(this.resizeProperties.active){this.resizeProperties.active=false;this.resizeProperties.el.removeClass("ludo-resize-handle-active");var a=this.resizeProperties.currentX-this.resizeProperties.elX;this.fireEvent("resize",[this.resizeProperties.index,a]);return false}return undefined},getMinPos:function(){return this.minPos},getMaxPos:function(){return this.maxPos},setMinPos:function(a){this.minPos=a},setMaxPos:function(a){this.maxPos=a},mouseOverResizeHandle:function(a){jQuery(a.target).addClass("ludo-grid-resize-handle-over")},mouseOutResizeHandle:function(a){jQuery(a.target).removeClass("ludo-grid-resize-handle-over")},isActive:function(){return this.resizeProperties.active}});ludo.grid.ColumnManager=new Class({Extends:ludo.Core,type:"grid.ColumnManager",fill:true,columns:{},columnKeys:[],statefulProperties:["columns","columnKeys"],columnLookup:{},__construct:function(a){this.parent(a);this.setConfigParams(a,["fill","columns"]);this.createColumnLookup();if(a.columnKeys!==undefined&&this.hasValidColumnKeys(a.columnKeys)){this.columnKeys=a.columnKeys}else{this.columnKeys=this.getLeafKeysFromColumns()}},getLeafKeysFromColumns:function(f){var a=[];f=f||this.columns;for(var d in f){if(f.hasOwnProperty(d)){a.push(d);if(f[d].columns!==undefined){var g=this.getLeafKeysFromColumns(f[d].columns);for(var b=0;b<g.length;b++){a.push(g[b])}}}}return a},createColumnLookup:function(b,d){b=b||this.columns;for(var a in b){if(b.hasOwnProperty(a)){this.columnLookup[a]=b[a];this.columnLookup[a].group=d;if(b[a].columns!==undefined){this.createColumnLookup(b[a].columns,a)}}}},hasValidColumnKeys:function(b){for(var a=0;a<b.length;a++){if(this.columnLookup[b[a]]===undefined){return false}}return true},hasLastColumnDynamicWidth:function(){return this.fill},getColumns:function(){return this.columns},getColumn:function(a){return this.columnLookup[a]},getLeafKeys:function(){var a=[];for(var b=0;b<this.columnKeys.length;b++){if(this.columnLookup[this.columnKeys[b]].columns===undefined){a.push(this.columnKeys[b])}}return a},getVisibleColumns:function(){var a={};var f=this.getLeafKeys();for(var d=0;d<f.length;d++){var b=f[d];if(!this.isHidden(b)){a[b]=this.columnLookup[b]}}return a},getHeadingFor:function(a){return this.getColumnKey(a,"heading")||""},getMinWidthOf:function(f){if(this.isGroup(f)){var d=this.getIdOfChildren(f);var a=0;for(var b=0;b<d.length;b++){a+=this.getMinWidthOf(d[b])}return a}return this.getColumnKey(f,"minWidth")||50},getMaxWidthOf:function(a){return this.getColumnKey(a,"maxWidth")||1000},getWidthOf:function(f){var a=this.getStrechedWithOf(f);if(a){return a}if(this.isGroup(f)){var b=this.getColumnsInGroup(f);var d=0;Object.each(b,function(h,g){if(!this.isHidden(g)){d+=this.getWidthOf(g)}}.bind(this));return d}else{return this.getColumnKey(f,"width")||100}},isGroup:function(a){return this.columnLookup[a]!==undefined&&this.columnLookup[a].columns!==undefined},getColumnsInGroup:function(a){return this.columnLookup[a].columns},getStrechedWithOf:function(a){return this.getColumnKey(a,"stretchWidth")},isRemovable:function(a){return this.getColumnKey(a,"removable")?true:false},isInAGroup:function(a){return this.getColumnKey(a,"group")!==undefined},getGroupIdOf:function(a){return this.getColumnKey(a,"group")},getGroupFor:function(a){var b=this.getGroupIdOf(a);return b?this.columnLookup[b]:undefined},getChildCount:function(a){var b=this.getColumn(a);if(b.columns!==undefined){return ludo.util.lengthOfObject(b.columns)}return 0},getIdOfChildren:function(a){var b=this.getColumn(a);
if(b){return Object.keys(b.columns)}return 0},isInSameGroup:function(b,a){return this.isInAGroup(b)&&this.getGroupIdOf(b)==this.getGroupIdOf(a)},isSortable:function(a){return this.getColumnKey(a,"sortable")?true:false},isHidden:function(a){var b=this.getColumnKey(a,"hidden");if(b){return true}var d;if(d=this.getGroupIdOf(a)){return this.isHidden(d)}return b},isVisible:function(a){return !this.isHidden(a)},isResizable:function(b){var a=this.getColumnKey(b,"resizable")!==false;if(a&&this.hasLastColumnDynamicWidth()&&this.isLastVisibleColumn(b)){a=false}return a},isMovable:function(b){var a=this.getGroupIdOf(b);if(a&&this.getChildCount(a)==1){return false}return this.getColumnKey(b,"movable")||false},hasMovableColumns:function(){for(var a=0;a<this.columnKeys.length;a++){if(this.isMovable(this.columnKeys[a])){return true}}return false},getAlignmentOf:function(a){return this.getColumnKey(a,"align")||"left"},getHeaderAlignmentOf:function(a){return this.getColumnKey(a,"headerAlign")||"left"},setLeft:function(a,b){this.columnLookup[a].left=b},getLeftPosOf:function(a){return this.getColumnKey(a,"left")||0},getRendererFor:function(a){return this.getColumnKey(a,"renderer")},setWidth:function(b,a){this.columnLookup[b].width=a},setStretchedWidth:function(a){this.columnLookup[this.getLastVisible()].stretchWidth=a;this.fireEvent("stretch")},clearStretchedWidths:function(){for(var a=0;a<this.columnKeys.length;a++){this.columnLookup[this.columnKeys[a]].stretchWidth=undefined}},increaseWithFor:function(b,d){var a=this.getWidthOf(b);this.columnLookup[b].width=a+d;this.fireEvent("resize");this.fireEvent("state")},getColumnKey:function(b,a){if(this.columnLookup[b]!==undefined){return this.columnLookup[b][a]}return null},getTotalWidth:function(){var d=this.getVisibleColumns();var b=0;for(var a in d){if(d.hasOwnProperty(a)){b+=this.getWidthOf(a)}}return b},getMinPosOf:function(a){return this.getTotalWidthOfPreviousOf(a)+this.getMinWidthOf(a)},getMaxPosOf:function(a){return this.getTotalWidthOfPreviousOf(a)+this.getMaxWidthOf(a)},getTotalWidthOfPreviousOf:function(d){var f=this.getLeafKeys();var a=0;for(var b=0;b<f.length;b++){if(f[b]==d){return a}if(!this.isHidden(f[b])){a+=this.getWidthOf(f[b])}}return 0},insertColumnBefore:function(a,b){this.moveColumn(a,b,"before")},insertColumnAfter:function(a,b){this.moveColumn(a,b,"after")},moveColumn:function(d,b,l){var n=this.getInsertionPoint(b,l);var m=this.columnKeys.indexOf(d);if(this.isInAGroup(d)&&!this.isInSameGroup(d,b)){this.removeFromGroup(d)}var g,f;var h=[m];if(this.isGroup(d)){var a=this.getIdOfChildren(d);for(g=0;g<a.length;g++){h.push(this.columnKeys.indexOf(a[g]))}}if(this.isInAGroup(b)){this.insertIntoSameGroupAs(d,b)}var k=[];for(g=0;g<this.columnKeys.length;g++){if(g==n&&l=="before"){for(f=0;f<h.length;f++){k.push(this.columnKeys[h[f]])}}if(h.indexOf(g)==-1){k.push(this.columnKeys[g])}if(g==n&&l=="after"){for(f=0;f<h.length;f++){k.push(this.columnKeys[h[f]])}}}this.columnKeys=k;this.fireEvent("movecolumn",[d,this.columnKeys[n],l]);this.fireEvent("state")},getInsertionPoint:function(f,g){var a=this.columnKeys.indexOf(f);if(g==="after"&&this.isGroup(f)){var d=Object.keys(this.getColumnsInGroup(f));for(var b=0;b<d.length;b++){a=Math.max(a,this.columnKeys.indexOf(d[b]))}}return a},insertIntoSameGroupAs:function(b,a){var d=this.columnLookup[a].group;this.columnLookup[b].group=d;this.columnLookup[d].columns[b]=this.columnLookup[b];this.clearCache()},isLastVisibleColumn:function(d){var f=this.getLeafKeys();for(var b=f.length-1;b>=0;b--){var a=f[b];if(!this.isHidden([a])){return a===d}}return false},removeFromGroup:function(a){var b=this.getGroupFor(a);if(b){delete b.columns[a];this.getColumn(a).group=undefined;this.clearCache();return true}return false},hideColumn:function(a){if(this.columnExists(a)&&!this.isHidden(a)){this.columnLookup[a].hidden=true;this.fireEvent("hidecolumn",a);this.fireEvent("state")}},columnExists:function(a){return this.columnLookup[a]!==undefined},hideAllColumns:function(){var b=this.getLeafKeys();for(var a=0;a<b.length;a++){this.columnLookup[b[a]].hidden=true}},showColumn:function(a){if(this.columnExists(a)&&this.isHidden([a])){this.columnLookup[a].hidden=false;this.fireEvent("showcolumn",a);this.fireEvent("state")}},getIndexOfLastVisible:function(){var b=this.getLeafKeys();for(var a=b.length-1;a>=0;a--){if(!this.isHidden(b[a])){return a}}return null},getLastVisible:function(){return this.getLeafKeys()[this.getIndexOfLastVisible()]},countHeaderRows:undefined,getCountRows:function(){if(this.countHeaderRows===undefined){var a=0;var d=this.getLeafKeys();for(var b=0;b<d.length;b++){a=Math.max(a,this.getStartRowOf(d[b]))}this.countHeaderRows=a+1}return this.countHeaderRows},countParentCache:{},getStartRowOf:function(d){if(this.countParentCache[d]===undefined){var b=0;if(this.columnLookup[d].group!==undefined){var a=this.columnLookup[d].group;while(a){b++;a=this.columnLookup[a].group}}this.countParentCache[d]=b}return this.countParentCache[d]},clearCache:function(){this.countParentCache={};
this.columnDepthCache={}},getColumnsInRow:function(a){var f=[];for(var g=0;g<this.columnKeys.length;g++){if(!this.isHidden(this.columnKeys[g])){var d=this.columnKeys[g];var b=this.getStartRowOf(d);if(b<=a&&!this.isGroup(d)){f.push(d)}else{if(b==a){f.push(d)}}}}return f},getRowSpanOf:function(a){var b=this.getCountRows();return b-this.getStartRowOf(a)-(this.isGroup(a)?this.getChildDepthOf(a):0)},columnDepthCache:{},getChildDepthOf:function(f){if(this.columnDepthCache[f]===undefined){if(this.isGroup(f)){var a=0;var d=this.getIdOfChildren(f);for(var b=0;b<d.length;b++){a=Math.max(a,this.getChildDepthOf(d[b]))}a++;this.columnDepthCache[f]=a}else{this.columnDepthCache[f]=0}}return this.columnDepthCache[f]},getHiddenColumns:function(){var a=[];for(var b=0;b<this.columnKeys.length;b++){if(this.isHidden(this.columnKeys[b])){a.push(this.columnKeys[b])}}return a},canBeMovedTo:function(a,b){return a!==b}});ludo.grid.RowManager=new Class({Extends:ludo.Core,type:"grid.RowManager",rowCls:undefined,__construct:function(a){this.parent(a);if(a.rowCls){this.rowCls=a.rowCls}}});ludo.grid.Grid=new Class({Extends:ludo.View,type:"Grid",hasMenu:true,colMovable:null,menu:true,menuConfig:[],scrollbar:{},highlightRecord:true,uniqueId:"",activeRecord:{},headerMenu:true,mouseOverEffect:true,columnManager:undefined,columns:undefined,rowManager:undefined,emptyText:"No data",defaultDS:"dataSource.JSONArray",__construct:function(a){this.parent(a);this.setConfigParams(a,["columns","fill","headerMenu","columnManager","rowManager","mouseOverEffect","emptyText","highlightRecord"]);if(this.columns==undefined){this.columns=this.__columns()}if(this.columnManager){ludo.util.warn("Deprecated columnManager used, use columns instead")}if(!this.columnManager){this.columnManager={columns:this.columns,fill:this.fill}}if(this.columnManager){if(!this.columnManager.type){this.columnManager.type="grid.ColumnManager"}this.columnManager.stateful=this.stateful;this.columnManager.id=this.columnManager.id||this.id+"_cm";this.columnManager=this.createDependency("colManager",this.columnManager);this.columnManager.addEvents({hidecolumn:this.refreshData.bind(this),showcolumn:this.refreshData.bind(this),movecolumn:this.onColumnMove.bind(this),resize:this.resizeColumns.bind(this)})}if(this.rowManager){if(!this.rowManager.type){this.rowManager.type="grid.RowManager"}this.rowManager=this.createDependency("rowManager",this.rowManager)}if(this.stateful&&this.dataSource!==undefined&&ludo.util.isObject(this.dataSource)){this.dataSource.id=this.dataSource.id||this.id+"_ds";this.dataSource.stateful=this.stateful}this.uniqueId=String.uniqueID()},__columns:function(){return undefined},ludoDOM:function(){this.parent();this.getEl().addClass("ludo-grid-Grid");var a=this.$b();var d=this.els.dataContainerTop=jQuery("<div>");d.addClass("ludo-grid-data-container");d.css({overflow:ludo.util.isTabletOrMobile()?"auto":"hidden",position:"relative"});a.append(d);a.css("overflow","visible");this.els.dataContainer=jQuery("<div>");d.append(this.els.dataContainer);this.els.dataContainer.css("position","relative");this.gridHeader=this.createDependency("gridHeader",{type:"grid.GridHeader",headerMenu:this.headerMenu,columnManager:this.columnManager,grid:this});this.createDataColumnElements();this.createScrollbars();this.createColResizeHandles()},ludoEvents:function(){this.parent();if(this.dataSource){if(this.dataSourceObj&&this.dataSourceObj.hasData()){this.populateData()}this.getDataSource().addEvents({change:this.populateData.bind(this),select:this.setSelectedRecord.bind(this),deselect:this.deselectDOMForRecord.bind(this),update:this.showUpdatedRecord.bind(this),"delete":this.removeDOMForRecord.bind(this)});this.getDataSource().addEvent("select",this.selectDOMForRecord.bind(this))}this.$b().on("selectstart",ludo.util.cancelEvent);this.$b().on("click",this.cellClick.bind(this));this.$b().on("dblclick",this.cellDoubleClick.bind(this));if(this.mouseOverEffect){this.els.dataContainer.on("mouseleave",this.mouseLeavesGrid.bind(this))}},__rendered:function(){this.parent();this.ifStretchHideLastResizeHandles();if(this.highlightRecord){this.els.dataContainer.css("cursor","pointer")}this.positionVerticalScrollbar.delay(100,this);if(this.getParent()){this.getParent().$b().css({padding:0});ludo.dom.clearCache();this.getParent().resize.delay(100,this.getParent())}this.toggleEmptyText()},currentOverRecord:undefined,mouseoverDisabled:false,enterCell:function(b){if(this.mouseoverDisabled){return}var a=this.getRecordByDOM(b);if(a){if(this.currentOverRecord){this.deselectDOMForRecord(this.currentOverRecord,"ludo-grid-record-over")}this.currentOverRecord=a;this.selectDOMForRecord(a,"ludo-grid-record-over")}},mouseLeavesGrid:function(){if(this.currentOverRecord){this.deselectDOMForRecord(this.currentOverRecord,"ludo-grid-record-over");this.currentOverRecord=undefined}},cellClick:function(b){var a=this.getRecordByDOM(b.target);if(a){this.getDataSource().selectRecord(a);this.fireEvent("click",[a,this.getColumnByDom(b.target)])
}},getColumnByDom:function(a){a=jQuery(a);if(!a.hasClass("ludo-grid-data-cell")){a=a.closest(".ludo-grid-data-cell")}if(a){return a.attr("col")}return undefined},setSelectedRecord:function(a){this.fireEvent("selectrecord",a);this.highlightActiveRecord()},highlightActiveRecord:function(){if(this.highlightRecord){var a=this.getDataSource().getSelectedRecord();if(a&&a.uid){this.selectDOMForRecord(a,"ludo-active-record")}}},selectDOMForRecord:function(b,a){a=a||"ludo-active-record";var d=this.getDOMCellsForRecord(b);for(var f in d){if(d.hasOwnProperty(f)){d[f].addClass(a)}}},deselectDOMForRecord:function(b,a){a=a||"ludo-active-record";var d=this.getDOMCellsForRecord(b);for(var f in d){if(d.hasOwnProperty(f)){d[f].removeClass(a)}}},showUpdatedRecord:function(a){var b=this.getDOMCellsForRecord(a);var f;var g;for(var d in b){if(b.hasOwnProperty(d)){g=this.columnManager.getRendererFor(d);if(g){f=g(a[d],a)}else{f=a[d]}b[d].getElement("span").html(f)}}},removeDOMForRecord:function(a){var b=this.getDOMCellsForRecord(a);for(var d in b){if(b.hasOwnProperty(d)){b[d].dispose()}}},getDOMCellsForRecord:function(b){var f={};var j,a;var h=this.columnManager.getLeafKeys();for(var g=0;g<h.length;g++){var d=this.$b().find("#ludo-grid-column-"+h[g]+"-"+this.uniqueId);a="cell-"+h[g]+"-"+b.uid+"-"+this.uniqueId;j=d.find("#"+a);if(j){f[h[g]]=j}}return f},selectRecord:function(a){if(ludo.util.isString(a)){a={id:a}}this.getDataSource().selectRecord(a)},cellDoubleClick:function(b){var a=this.getRecordByDOM(b.target);if(a){this.getDataSource().selectRecord(a);this.fireEvent("dblclick",[a,this.getColumnByDom(b.target)])}},getRecordByDOM:function(b){b=jQuery(b);if(!b.hasClass("ludo-grid-data-cell")){b=b.parent(".ludo-grid-data-cell")}if(b&&b.hasClass("ludo-grid-data-cell")){var a=b.attr("uid");return this.getDataSource().findRecord({uid:a})}return undefined},isColumnDragActive:function(){return this.colMovable&&this.colMovable.isActive()},hideResizeHandles:function(){this.colResizeHandler.hideAllHandles()},showResizeHandles:function(){this.colResizeHandler.showAllHandles();this.ifStretchHideLastResizeHandles()},resizeChildren:function(){this.parent();if(this.colResizeHandler&&this.columnManager.hasLastColumnDynamicWidth()){this.resizeColumns()}},onColumnMove:function(a,b,d){if(d=="before"){this.els.dataColumns[a].insertBefore(this.els.dataColumns[b])}else{this.els.dataColumns[a].insertAfter(this.els.dataColumns[b])}this.cssColumns();this.resizeColumns()},cssColumns:function(){var b=Object.keys(this.els.dataColumns);for(var a=0;a<b.length;a++){var d=this.els.dataColumns[b[a]];d.removeClass("ludo-grid-data-last-column");d.removeClass("ludo-grid-data-last-column-left");d.removeClass("ludo-grid-data-column-left");d.removeClass("ludo-grid-data-last-column-center");d.removeClass("ludo-grid-data-column-center");d.removeClass("ludo-grid-data-last-column-right");d.removeClass("ludo-grid-data-column-right");ludo.dom.addClass(d,this.getColumnCssClass(b[a]))}},refreshData:function(){if(!this.isRendered){return}this.createDataColumnElements();this.resizeColumns();this.populateData();this.showResizeHandles()},JSON:function(){},addRecord:function(a){this.getDataSource().addRecord(a)},resizeDOM:function(){this.resizeColumns();var a=this.getHeight()-ludo.dom.getMBPH(this.els.container)-ludo.dom.getMBPH(this.els.body);a-=this.scrollbar.horizontal.getHeight();if(a<0){return}this.$b().css("height",a-this.gridHeader.getHeight());var b=this.$b().height();if(b==0){this.resizeDOM.delay(100,this);return}this.els.dataContainerTop.css("height",b);this.scrollbar.vertical.resize();this.scrollbar.horizontal.resize()},createScrollbars:function(){this.scrollbar.horizontal=this.createDependency("scrollHorizontal",new ludo.Scroller({type:"horizontal",applyTo:this.$b(),parent:this.$b()}));this.scrollbar.horizontal.getEl().insertAfter(this.$b());this.scrollbar.vertical=this.createDependency("scrollVertical",new ludo.Scroller({type:"vertical",applyTo:this.els.dataContainer,parent:this.els.dataContainerTop,mouseWheelSizeCls:"ludo-grid-data-cell"}));this.getEl().append(this.scrollbar.vertical.getEl());this.positionVerticalScrollbar()},positionVerticalScrollbar:function(){var a=this.gridHeader.getHeight();if(a==0){this.positionVerticalScrollbar.delay(100,this);return}this.scrollbar.vertical.getEl().css("top",a)},sortBy:function(a){this.getDataSource().sortBy(a)},createColResizeHandles:function(){this.colResizeHandler=new ludo.ColResize({component:this,listeners:{startresize:this.setResizePos.bind(this),resize:this.resizeColumn.bind(this)}});var d=this.columnManager.getLeafKeys();for(var a=0;a<d.length;a++){var b=this.colResizeHandler.getHandle(d[a],this.columnManager.isResizable(d[a]));this.$b().append(b);b.addClass("ludo-grid-resize-handle")}},setResizePos:function(a){this.colResizeHandler.setMinPos(this.columnManager.getMinPosOf(a));this.colResizeHandler.setMaxPos(this.columnManager.getMaxPosOf(a));this.mouseoverDisabled=true;this.mouseLeavesGrid()},mouseOverResizeHandle:function(a){jQuery(a.target).addClass("ludo-grid-resize-handle-over")
},mouseOutResizeHandle:function(a){jQuery(a.target).removeClass("ludo-grid-resize-handle-over")},resizeColumns:function(){this.mouseoverDisabled=false;var f=0;this.stretchLastColumn();var d=this.columnManager.getLeafKeys();for(var b=0;b<d.length;b++){if(this.columnManager.isHidden(d[b])){this.colResizeHandler.hideHandle(d[b])}else{var g=this.columnManager.getWidthOf(d[b]);var h=ludo.dom.getBW(this.els.dataColumns[d[b]])-(b===d.length-1)?1:0;this.els.dataColumns[d[b]].css("left",f);this.els.dataColumns[d[b]].css("width",(g-ludo.dom.getPW(this.els.dataColumns[d[b]])-h));this.columnManager.setLeft(d[b],f);f+=g;this.colResizeHandler.setPos(d[b],f);if(this.columnManager.isResizable(d[b])){this.colResizeHandler.showHandle(d[b])}else{this.colResizeHandler.hideHandle(d[b])}}}var a=this.columnManager.getTotalWidth();this.els.dataContainerTop.css("width",a);this.scrollbar.horizontal.setContentSize(a)},stretchLastColumn:function(){if(this.columnManager.hasLastColumnDynamicWidth()){this.columnManager.clearStretchedWidths();var a=this.columnManager.getTotalWidth();var f=this.$b().width();var b=f-a;if(b<=0){return}var d=this.columnManager.getWidthOf(this.columnManager.getLastVisible())+b;this.columnManager.setStretchedWidth(d)}},toggleEmptyText:function(){if(this.emptyText){this.emptyTextEl().css("display",(!this.currentData||this.currentData.length)>0?"none":"")}},populateData:function(){this.fireEvent("state");this.currentOverRecord=undefined;this.currentData=this.getDataSource().getData();this.toggleEmptyText();var h=[];var f=this.columnManager.getLeafKeys();for(var b=0;b<f.length;b++){var g="ludo-grid-column-"+f[b]+"-"+this.uniqueId;if(this.columnManager.isHidden(f[b])){h.push('<div id="'+g+'" class="ludo-grid-data-column" style="display:none"></div>')}else{h.push('<div id="'+g+'" col="'+f[b]+'" class="ludo-grid-data-column ludo-grid-data-column-'+b+" "+this.getColumnCssClass(f[b])+'">'+this.getHtmlTextForColumn(f[b])+"</div>")}}this.els.dataContainer.html(h.join(""));var a=this.els.dataContainer.find(".ludo-grid-data-column");this.els.dataColumns={};var d;for(b=0,d=a.length;b<d;b++){this.els.dataColumns[jQuery(a[b]).attr("col")]=jQuery(a[b])}this.fireEvent("renderdata",[this,this]);this.resizeColumns();this.resizeVerticalScrollbar();this.highlightActiveRecord()},emptyTextEl:function(){if(this.els.emptyText===undefined){this.els.emptyText=jQuery('<div class="ludo-grid-empty-text">'+this.emptyText+"</div>");this.getEl().append(this.els.emptyText)}return this.els.emptyText},getColumnCssClass:function(b){var a;if(this.columnManager.isLastVisibleColumn(b)){a="ludo-grid-data-last-column ludo-grid-data-last-column-"}else{a="ludo-grid-data-column-"}a+=this.columnManager.getAlignmentOf(b);return a},resizeVerticalScrollbar:function(){var b=this.els.dataColumns[this.columnManager.getLastVisible()];if(!b){return}var a=b.outerHeight();if(a===0){this.resizeVerticalScrollbar.delay(300,this)}else{this.els.dataContainer.css("height",a);this.scrollbar.vertical.setContentSize()}},createDataColumnElements:function(){this.els.dataColumns={};var d=this.columnManager.getLeafKeys();for(var a=0;a<d.length;a++){var b=jQuery("<div>");this.els.dataContainer.append(b);b.addClass("ludo-grid-data-column");b.attr("col",d[a]);b.addClass(this.getColumnCssClass(a));b.id="ludo-grid-column-"+d[a]+"-"+this.uniqueId;this.els.dataColumns[d[a]]=b}},getHtmlTextForColumn:function(b){var m=[];var f=["ludo-grid-data-odd-row","ludo-grid-data-even-row"];var l;var h=this.currentData;if(!h){return""}var n=this.columnManager.getRendererFor(b);var o=this.rowManager?this.rowManager.rowCls:undefined;var d="";for(var g=0,j=h.length;g<j;g++){l=h[g][b];if(n){l=n(l,h[g])}var a=["cell-",b,"-",h[g].uid,"-",this.uniqueId].join("");var k=this.mouseOverEffect?" onmouseover=\"ludo.get('"+this.id+"').enterCell(this)\"":"";if(o){d=o(h[g]);if(d){d=" "+d}}m.push('<div id="'+a+'" '+k+' col="'+b+'" class="ludo-grid-data-cell '+(f[g%2])+d+'" uid="'+h[g].uid+'"><span class="ludo-grid-data-cell-text">'+l+"</span></div>")}return m.join("")},resizeColumn:function(b,a){this.columnManager.increaseWithFor(b,a)},ifStretchHideLastResizeHandles:function(){if(this.columnManager.hasLastColumnDynamicWidth()){this.colResizeHandler.hideHandle(this.columnManager.getLastVisible())}},scrollBy:function(a,b){if(b){this.scrollbar.vertical.scrollBy(b)}if(a){this.scrollbar.horizontal.scrollBy(a)}},getSelectedRecord:function(){return this.getDataSource().getSelectedRecord()},getColumnManager:function(){return this.columnManager}});ludo.view.ViewPagerNav=new Class({Extends:ludo.View,viewPager:undefined,dotParents:undefined,dots:undefined,dotSizeSelected:undefined,dotSizeParent:undefined,dotSizeUnselected:undefined,selectedDot:undefined,spacing:0,__construct:function(a){this.parent(a);if(a.spacing!=undefined){this.spacing=a.spacing}},setViewPager:function(a){this.viewPager=a;this.renderDots()},renderDots:function(){this.dotParents=[];this.dots=[];this.$b().empty();for(var b=0;b<this.viewPager.count;b++){var d=jQuery('<div class="ludojs-viewpager-dot-parent" style="position:absolute"></div>');
var a=jQuery('<div class="ludojs-viewpager-dot" style="position:absolute"></div>');d.attr("data-index",b);d.append(a);this.$b().append(d);this.dotParents.push(d);this.dots.push(a);d.on("click",this.clickDot.bind(this))}},clickDot:function(b){var a=parseInt(jQuery(b.currentTarget).attr("data-index"));this.viewPager.goToPage(a)},resize:function(a){this.parent(a);this.resizeAndPositionDots()},resizeAndPositionDots:function(){this.dotSizeParent=this.$b().height();this.dotSizeSelected=this.dotSizeParent*0.8;this.dotSizeUnselected=this.dotSizeParent*0.5;var h=this.dotSizeParent*this.viewPager.count;var f=this.spacing*this.viewPager.count;var g=(this.$b().width()/2)-(h/2)-(f/2);for(var b=0;b<this.viewPager.count;b++){this.dotParents[b].css({left:g,width:this.dotSizeParent,height:this.dotSizeParent});var d=b==this.viewPager.selectedIndex;var a=d?this.dotSizeParent:this.dotSizeUnselected;var j=d?0:a/2;this.dots[b].css({width:a,height:a,top:j+"px",left:j+"px"});if(d){this.selectedDot=this.dots[b];this.selectedDot.addClass("ludojs-viewpager-dot-selected")}g+=this.dotSizeParent+this.spacing}},navigate:function(){if(this.selectedDot!=undefined){this.selectedDot.removeClass("ludojs-viewpager-dot-selected");var a=this.dotSizeUnselected;this.selectedDot.animate({width:a,height:a,top:(a/2)+"px",left:(a/2)+"px"},{duration:200,queue:false})}this.selectedDot=this.dots[this.viewPager.selectedIndex];this.selectedDot.addClass("ludojs-viewpager-dot-selected");this.selectedDot.animate({width:this.dotSizeParent,height:this.dotSizeParent,top:0,left:0},{duration:200,queue:false})}});ludo.calendar.Base=new Class({Extends:ludo.View,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthsLong:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["M","T","W","T","F","S","S"],headerWeek:"Week",__construct:function(a){this.parent(a);this.date=new Date();this.setConfigParams(a,["sundayFirst"]);this.translate()},translate:function(){for(var a=0;a<this.months.length;a++){this.months[a]=ludo.language.get(this.months[a]);this.monthsLong[a]=ludo.language.get(this.monthsLong[a])}for(a=0;a<this.days.length;a++){this.days[a]=ludo.language.get(this.days[a])}this.headerWeek=ludo.language.get(this.headerWeek)},setDate:function(a){this.date=a},getDate:function(){return this.date},sendSetDateEvent:function(){this.fireEvent("setdate",[this.date,this])},val:function(){}});ludo.calendar.Calendar=new Class({Extends:ludo.calendar.Base,layout:{type:"linear",orientation:"vertical"},value:undefined,inputFormat:"Y-m-d",date:undefined,minDate:undefined,maxDate:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["inputFormat","value","minDate","maxDate","date","sundayFirst"]);this.date=this.date||this.value;this.date=this.date?Date.parse(this.date):new Date();this.value=this.date;if(this.minDate){this.minDate=Date.parse(this.minDate)}if(this.maxDate){this.maxDate=Date.parse(this.maxDate)}},setYear:function(a){this.date.set("year",a);this.setDate(this.date)},setDate:function(a,d){this.date=a;for(var b=0;b<this.children.length;b++){if(!d||this.children[b].id!==d.id){this.children[b].setDate(this.date)}}},getDate:function(){return this.value},val:function(a,b){if(arguments.length==0){return this.value.format(this.inputFormat)}this.value=Date.parse(a);this.fireEvent("change",[this.value,this])},getValue:function(){console.warn("Use of deprecated calendar.getValue");console.trace();return this.value.format(this.inputFormat)},setValue:function(a){console.warn("Use of deprecated calendar.setValue");console.trace();this.value=Date.parse(a);this.fireEvent("change",[this.value,this])},setMonth:function(a){a=a-1;this.date.set("month",a);this.setDate(this.date)},__rendered:function(){this.parent();for(var a=0;a<this.children.length;a++){var b=this.children[a];b.setDate(this.date);b.val(this.date);b.addEvent("setdate",this.setDate.bind(this));b.addEvent("change",this.val.bind(this))}this.getLayout().resize()},__children:function(){return[{type:"calendar.NavBar",name:"info"},{type:"calendar.Days",name:"days",sundayFirst:this.sundayFirst},{type:"calendar.Today",name:"today"}]}});ludo.calendar.Days=new Class({Extends:ludo.calendar.Base,layout:{weight:1},date:undefined,colWidthFirst:16,colWidthRest:12,showWeeks:true,sundayFirst:false,overflow:"hidden",week:undefined,value:undefined,touch:{enabled:false},__rendered:function(){this.parent();this.createCalendarHeader();this.createCalendarView()},ludoDOM:function(){this.parent();this.$b().addClass("ludo-calendar-view")},ludoEvents:function(){this.parent();if(ludo.util.isTabletOrMobile()){var a=this.$b();a.on("touchstart",this.touchStart.bind(this));this.getEventEl().on("touchmove",this.touchMove.bind(this));this.getEventEl().on("touchend",this.touchEnd.bind(this))}},touchStart:function(b){var a=ludo.util.pageXY(b);this.touch={enabled:true,x1:a.pageX,x2:a.pageX,y1:a.pageY,y2:a.pageY};if(b.target.tagName.toLowerCase()=="window"){return false
}return undefined},touchMove:function(f){if(this.touch.enabled){var d=ludo.util.pageXY(f);this.touch.x2=d.pageX;this.touch.y2=d.pageY;var b=this.touch.x2-this.touch.x1;var a=this.touch.y2-this.touch.y1;if(Math.abs(b)>Math.abs(a)){if(b>100){b=100}if(b<-100){b=-100}this.els.monthView.css("left",b+"px");this.els.monthView.css("top","0px")}else{if(a>100){a=100}if(a<-100){a=-100}this.els.monthView.css("top",a+"px");this.els.monthView.css("left","0px")}return false}return undefined},touchEnd:function(){if(this.touch.enabled){this.touch.enabled=false;var b=this.touch.x2-this.touch.x1;var a=this.touch.y2-this.touch.y1;var f=Math.abs(b);var d=Math.abs(a);if(f>100||d>100){if(f>d){this.date[b>0?"decrement":"increment"]("month",1)}else{this.date[a>0?"decrement":"increment"]("year",1)}this.sendSetDateEvent();this.showMonth()}this.els.monthView.css("left","0");this.els.monthView.css("top","0")}},createCalendarHeader:function(){var d=this.els.daysHeader=jQuery("<div>");d.addClass("ludo-calendar-header");this.$b().append(d);var b=["<table ",'cellpadding="0" cellspacing="0" border="0" width="100%">'];b.push(this.getColGroup().join(""));b.push("<tr>");var f=this.getTextForHeader();for(var a=0;a<f.length;a++){b.push("<td>"+f[a]+"</td>")}b.push("</tr>");b.push("</table>");d.html(b.join(""))},resizeDOM:function(){if(!this.els.daysContainer){this.resizeDOM.delay(10,this);return}this.parent();var d=this.$b();var g=this.els.daysHeader;var f={x:d.width(),y:d.height()};var a=f.y-ludo.dom.getBH(d)-ludo.dom.getPH(d)-g.height()+ludo.dom.getMH(g);var j=this.els.daysContainer;a-=(ludo.dom.getMH(j)+ludo.dom.getPH(j)+ludo.dom.getBH(j));j.css("height",a+"px")},getColGroup:function(){var b=[];b.push("<colgroup>");b.push('<col width="'+this.colWidthFirst+'%" />');for(var a=0;a<7;a++){b.push('<col width="'+this.colWidthRest+'%" />')}b.push("</colgroup>");return b},getTextForHeader:function(){var a=[this.headerWeek];if(this.sundayFirst){a.push(this.days[this.days.length-1]);a=a.append(this.days.slice(0,this.days.length-1))}else{a=a.append(this.days)}return a},createCalendarView:function(){var a=this.els.daysContainer=jQuery("<div>");a.addClass("ludo-calendar-container-days");a.css({position:"relative",width:"100%",overflow:"hidden",left:0,top:0});this.$b().append(a)},showMonth:function(){if(this.els.monthView){this.els.monthView.remove()}var a=this.els.monthView=jQuery("<div>");a.on("click",this.selectDay.bind(this));a.addClass("ludo-calendar-body-days");this.resizeMonthView();a.css("position","absolute");this.els.daysContainer.append(a);var g=["<table ",'cellpadding="0" cellspacing="0" border="0" width="100%" style="height:100%">'];g.push(this.getColGroup().join(""));var m=this.getDaysForView();var n="";var b=0;if(this.isValueMonth()){b=this.value.get("date")}var j=0;if(this.isOnTodaysMonth()){j=new Date().get("date")}var k=false;var d=false;var l;for(var f=0;f<m.length;f++){n="calendar-day-cell ";l="";if(f%8==0){if(f){g.push("</tr>")}g.push("<tr>");n="calendar-week"}else{if(m[f]==1&&k){d=true}if(m[f]==1){k=true}n="calendar-day";if(!k||d){n=n+" calendar-day-inactive"}else{if((this.sundayFirst&&(f-1)%8==0)||(!this.sundayFirst&&(f+1)%8==0)){n=n+" calendar-sunday"}if(m[f]==b){n=n+" calendar-day-selected"}if(m[f]==j){l=" calendar-day-today"}n=n+" calendar-day-"+m[f]}}g.push('<td style="position:relative" class="calendar-day-c '+n+'"><div class="calendar-day-div'+l+'" style="position:absolute;left:0;top:0;width:100%;height:100%;"></div><span style="position:relative">'+m[f]+"</span></td>")}g.push("</table>");a.html(g.join(""));var h=a.find(".calendar-day-div");h.on("mouseover",this.mouseOverDays.bind(this));h.on("mouseout",this.removeClsFromMouseOverDay.bind(this));this.resizeMonthView.delay(20,this);this.resizeToday()},mouseOverDays:function(d){var a=jQuery(d.target);if(!a.hasClass("calendar-day-div")){return}this.removeClsFromMouseOverDay();if(this.els.mouseOverDay!=undefined&&c[0]==this.els.mouseOverDay[0]){return}var b=a.parent();if(b.hasClass("calendar-week")||b.hasClass("calendar-day-inactive")){return}this.resizeHighlighted(a);a.addClass("calendar-day-mouse-over");this.els.mouseOverDay=a},removeClsFromMouseOverDay:function(a){if(a&&a.target.className!="calendar-day-div"){return}if(this.els.mouseOverDay){this.resizeHighlighted(this.els.mouseOverDay);this.els.mouseOverDay.removeClass("calendar-day-mouse-over");this.els.mouseOverDay=undefined}},isValueMonth:function(){return this.value?this.value.get("month")==this.date.get("month")&&this.value.get("year")==this.date.get("year"):false},isOnTodaysMonth:function(){var a=new Date();return a.get("month")==this.date.get("month")&&a.get("year")==this.date.get("year")},resizeMonthView:function(){this.els.monthView.css("width","100%")},getDaysForView:function(){var k=[];var a=this.date.clone();a.setDate("1");var j=a.clone().decrement("day",1);var b=a.getLastDayOfMonth();var d=a.getUTCDay();if(this.sundayFirst){d++;if(d>6){d=0}}var f;if(d>0||b<31){this.setStartWeek(j.get("week"));var l=j.getLastDayOfMonth();
var h=d||7;k.push(this.getNextWeek());for(f=h-1;f>=0;f--){k.push(l-f)}if(k.length%8==0){k.push(this.getNextWeek())}}else{this.setStartWeek(a.get("week"));k.push(this.getNextWeek())}for(f=1;f<=b;f++){k.push(f);if(k.length%8==0){k.push(this.getNextWeek())}}var g=k.length;for(f=k.length;f<48;f++){if(k.length<48){if(k.length%8==0){k.push(this.getNextWeek())}k.push(f-g+1)}}return k},resizeHighlighted:function(f){var g=f.parent();var a=g.width();var d=g.height();var b=Math.min(d,a);b-=Math.floor(b/10);f.css({width:b,height:b,left:Math.max(0,(a-b)/2),top:Math.max(0,(d-b)/2)})},selectDay:function(b){var a=jQuery(b.target);if(!a.hasClass("calendar-day")){a=a.closest(".calendar-day");if(!a){return}}if(a.hasClass("calendar-day-inactive")){return}this.removeClsFromMouseOverDay();this.removeClsFromSelectedDay();a.addClass("calendar-day-td-selected");a.children("div").addClass("calendar-day-selected");this.resizeHighlighted(a.children("div"),a);this.value=this.date.clone();this.value.set("date",a.find("span").html());this.fireEvent("change",[this.value,this])},removeClsFromSelectedDay:function(){if(this.els.monthView&&this.isValueMonth()){var a=this.els.monthView.find(".calendar-day-"+this.value.get("date"));if(a){a.removeClass("calendar-day-td-selected");a.children("div").removeClass("calendar-day-selected");a.children("div").css({width:"100%",height:"100%"})}}},addClsForSelectedDay:function(){if(this.els.monthView&&this.isValueMonth()){var a=this.els.monthView.find(".calendar-day-"+this.value.get("date"));if(a){a.children("div").addClass("calendar-day-selected")}}},setStartWeek:function(a){this.week=a},getNextWeek:function(){var a=this.week;this.week++;if(this.week>53||(this.week>50&&this.date.get("month")==0)){this.week=1}return a},setDate:function(a){this.date=a;this.showMonth()},setValue:function(a){this.removeClsFromSelectedDay();this.value=a.clone();this.addClsForSelectedDay()},resizeSelected:function(){if(this.els.monthView&&this.isValueMonth()){var a=this.els.monthView.find(".calendar-day-"+this.value.get("date"));if(a){this.resizeHighlighted(a.children("div"))}}},resizeToday:function(){this.resizeCell(".calendar-day-today")},resizeMO:function(){this.resizeCell(".calendar-day-mouse-over")},resizeCell:function(a){var b=this.els.monthView.find(a);if(b.length>0){this.resizeHighlighted(b)}},resize:function(a){this.parent(a);this.els.monthView.find(".calendar-day-div").css({width:"100%",height:"100%"});this.resizeSelected();this.resizeToday();this.resizeMO()}});ludo.calendar.NavBar=new Class({Extends:ludo.calendar.Base,type:"calendar.NavBar",date:undefined,layout:{height:20,type:"linear",orientation:"horizontal"},cls:"ludo-calendar-info-panel",children:[{type:"form.Button",size:"s",value:"<<",name:"previousyear",width:25},{type:"form.Button",size:"s",value:"<",name:"previous",width:25},{weight:1,name:"info",type:"calendar.MonthYearSelector"},{type:"form.Button",size:"s",name:"next",value:">",width:25},{type:"form.Button",size:"s",name:"nextyear",value:">>",width:25}],__rendered:function(){this.parent();this.child.previous.addEvent("click",this.goToPreviousMonth.bind(this));this.child.next.addEvent("click",this.goToNextMonth.bind(this));this.child.nextyear.addEvent("click",this.goToNextYear.bind(this));this.child.previousyear.addEvent("click",this.goToPreviousYear.bind(this))},goToPreviousMonth:function(){this.setDate(this.date.decrement("month",1));this.sendSetDateEvent()},goToNextMonth:function(){this.setDate(this.date.increment("month",1));this.sendSetDateEvent()},goToPreviousYear:function(){this.setDate(this.date.decrement("year",1));this.sendSetDateEvent()},goToNextYear:function(){this.setDate(this.date.increment("year",1));this.sendSetDateEvent()},setDate:function(a){this.date=a;this.showDate();this.child.info.setDate(a)},sendDate:function(a){this.date=a;this.sendSetDateEvent()},showDate:function(){this.child.info.addEvent("setdate",this.sendDate.bind(this))}});ludo.calendar.Selector=new Class({Extends:ludo.calendar.Base,height:25,date:undefined,minDate:undefined,maxDate:undefined,overflow:"hidden",minDisplayedYear:undefined,maxDisplayedYear:undefined,fx:undefined,offsetOptions:13,calCls:"ludo-calendar-year-container",__construct:function(a){this.parent(a);this.els.options=[]},__rendered:function(){this.parent();this.createOptionsContainer();this.renderOptions();this.autoResize()},createOptionsContainer:function(){var a=this.els.calendarContainer=jQuery("<div>");a.addClass(this.calCls);a.css({position:"absolute",width:"3000px",left:0,top:0});this.$b().append(a)},autoResize:function(){var a=this.els.calendarContainer.height();a+=ludo.dom.getMH(this.els.calendarContainer);this.layout.height=a+ludo.dom.getMBPH(this.$b())+ludo.dom.getMBPH(this.getEl())},resizeDOM:function(){this.parent();if(this.els.activeOption){this.animateDomToCenter.delay(20,this,this.els.activeOption)}},removeOptions:function(){for(var a=0;a<this.els.options.length;a++){this.els.options[a].remove()}this.els.options=[]},centerDom:function(a){a.parent().css("marginLeft",this.getCenterPos(a)+"px")
},animateDomToCenter:function(a){if(a&&jQuery(a).parent()){this.els.calendarContainer.animate({"margin-left":this.getCenterPos(a)},200)}},getCenterPos:function(a){a=jQuery(a);return Math.round((this.$b().outerWidth()/2)-a.position().left-(a.outerWidth()/2))},setMinDate:function(a){this.minDate=a},setMaxDate:function(a){this.maxDate=a}});ludo.calendar.MonthSelector=new Class({Extends:ludo.calendar.Base,height:25,__rendered:function(){this.parent();this.createMonthContainer();this.renderMonths();this.autoResize()},autoResize:function(){var a=this.els.monthContainer.offsetHeight;a+=ludo.dom.getMH(this.els.monthContainer)+ludo.dom.getMBPH(this.$b())+ludo.dom.getMBPH(this.getEl());this.layout.height=a},createMonthTooltip:function(){var a=this.els.monthTip=jQuery("<div>");a.setStyles({position:"absolute",display:"none"});a.addClass("ludo-calendar-month-tip");a.addClass("ludo-calendar-month");a.addEvent("click",this.clickMonth.bind(this));this.els.monthContainer.append(a)},createMonthContainer:function(){var a=this.els.monthContainer=jQuery("<div>");a.addClass("ludo-calendar-month-container");a.setStyles({position:"absolute",width:"3000px",left:0,top:0});this.$b().append(a)},renderMonths:function(){this.els.monthContainer.html("");this.createMonthTooltip();var d=this.date.get("month");for(var a=0;a<this.months.length;a++){var b=jQuery("<div>");b.addClass("ludo-calendar-month");b.setProperty("month",a);this.els.monthContainer.append(b);if(a==d){b.addClass("ludo-calendar-month-selected");b.html("<span>"+this.months[a]+"</span>");b.mouseenter(this.hideTooltip.bind(this))}else{b.mouseenter(this.showTooltip.bind(this));b.setProperty("title",this.months[a]);b.addClass("ludo-calendar-month-inactive")}b.addEvent("click",this.clickMonth.bind(this))}this.els.monthContainer.addEvent("mouseleave",this.hideTooltip.bind(this))},clickMonth:function(b){var a=this.getMonthEl(b.target);this.setMonth(a.attr("month"));this.sendSetDateEvent()},setDate:function(a){this.parent(a);this.renderMonths()},showTooltip:function(f){var a=this.getMonthEl(f.target);var b=this.els.monthTip;b.setProperty("month",a.attr("month"));var d=this.months[a.attr("month")];b.html(d);b.css("left",Math.max(0,a.offsetLeft)+"px");b.css("display","")},hideTooltip:function(){this.els.monthTip.css("display","none")},getMonthEl:function(a){if(!a.hasClass("ludo-calendar-month")){a=a.getParent(".ludo-calendar-month")}return a}});ludo.calendar.Today=new Class({Extends:ludo.calendar.Base,layout:{type:"relative"},height:30,overflow:"hidden",css:{"margin-top":2},__rendered:function(){this.parent();this.child.today.addEvent("click",this.setToday.bind(this))},__children:function(){return[{name:"today",type:"form.Button",value:ludo.language.get("Today"),layout:{centerInParent:true}}]},setDate:function(){},setToday:function(){this.date=new Date();this.sendSetDateEvent()}});ludo.calendar.YearSelector=new Class({Extends:ludo.calendar.Selector,minDisplayedYear:undefined,maxDisplayedYear:undefined,resizeDOM:function(){this.parent();if(this.els.activeOption){this.animateDomToCenter(this.els.activeOption)}},renderOptions:function(){this.removeOptions();this.els.activeOption=undefined;var d=this.date.get("year");for(var a=d-this.offsetOptions;a<d+this.offsetOptions;a++){var b=this.getDomForAYear(a);this.els.calendarContainer.append(b);this.els.options.push(b)}this.setMinAndMaxDisplayed()},setMinAndMaxDisplayed:function(){this.minDisplayedYear=this.date.clone().decrement("year",this.offsetOptions).get("year");this.maxDisplayedYear=this.date.clone().increment("year",this.offsetOptions).get("year")},getDomForAYear:function(b){var a=jQuery("<div>");a.html("<span>"+b+"</span>");a.setProperty("year",b);a.addClass("ludo-calendar-year");if(b==this.date.get("year")){a.addClass("ludo-calendar-year-selected");this.els.activeOption=a}a.addEvent("click",this.clickYear.bind(this));return a},clickYear:function(b){var a=b.target;if(!a.hasClass("ludo-calendar-year")){a=a.getParent(".ludo-calendar-year")}this.date.set("year",a.attr("year"));this.setDate(this.date);this.sendSetDateEvent()},setDate:function(a){this.date=a;this.addAndRemoveOptions();if(this.els.activeOption){this.centerDom(this.els.activeOption);this.els.activeOption.removeClass("ludo-calendar-year-selected")}this.els.activeOption=this.getDomElForCurrentYear();if(this.els.activeOption){this.els.activeOption.addClass("ludo-calendar-year-selected");this.animateDomToCenter.delay(20,this,this.els.activeOption)}},addAndRemoveOptions:function(){var b=this.date.get("year");var a=Math.round((this.maxDisplayedYear+this.minDisplayedYear)/2);if(b<this.minDisplayedYear||b>this.maxDisplayedYear){this.renderOptions()}else{if(b<a){this.insertYearsBefore(a-b)}else{this.insertYearsAfter(b-a)}}this.setMinAndMaxDisplayed()},insertYearsBefore:function(g){var b=[];for(var a=g;a>0;a--){var f=this.minDisplayedYear-a;var d=this.getDomForAYear(f);d.inject(this.els.options[0],"before");b.push(d);this.els.options[this.els.options.length-1].dispose();this.els.options.length--
}this.els.options=b.append(this.els.options)},insertYearsAfter:function(f){for(var a=1;a<=f;a++){var d=this.maxDisplayedYear+a;var b=this.getDomForAYear(d);this.els.calendarContainer.append(b);this.els.options.push(b);this.els.options[a-1].dispose()}this.els.options=this.els.options.slice(f)},getDomElForCurrentYear:function(){var b=this.date.get("year");var d=this.els.options;for(var a=0;a<d.length;a++){if(d[a].attr("year")==b){return d[a]}}return undefined}});ludo.calendar.MonthYearSelector=new Class({Extends:ludo.calendar.Selector,height:25,minDisplayed:undefined,maxDisplayed:undefined,fx:undefined,date:undefined,calCls:"ludo-calendar-month-year-container",renderOptions:function(){this.removeOptions();this.els.activeOption=undefined;for(var a=this.offsetOptions*-1;a<=this.offsetOptions;a++){var b=this.getDomForAMonth(a);this.els.calendarContainer.append(b);this.els.options.push(b)}this.setMinAndMaxDisplayed()},setMinAndMaxDisplayed:function(){var a=this.date.clone();this.minDisplayed=a.decrement("month",this.offsetOptions);a=this.date.clone();this.maxDisplayed=a.increment("month",this.offsetOptions)},getDomForAMonth:function(f){var g=this.date.clone().increment("month",f);var a=this.months[g.get("month")];var b=jQuery("<div>");b.attr({year:g.get("year"),month:g.get("month")});b.addClass("ludo-calendar-month-year");if(f==0){b.addClass("ludo-calendar-month-year-selected");this.els.activeOption=b}b.html("<span>"+a+"</span>");b.on("click",this.clickMonth.bind(this));return b},clickMonth:function(b){var a=jQuery(b.currentTarget);this.setMonthAndYear(a.attr("month"),a.attr("year"));this.sendSetDateEvent()},setMonthAndYear:function(b,a){this.date.set("month",b);this.date.set("year",a);this.refreshView()},setDate:function(a){this.parent(a);this.refreshView()},refreshView:function(){this.addAndRemoveOptions();if(this.els.activeOption){this.centerDom(this.els.activeOption);this.els.activeOption.html(this.months[this.els.activeOption.attr("month")]);this.els.activeOption.removeClass("ludo-calendar-month-year-selected")}this.els.activeOption=this.getNewActiveOption();this.populateActiveMonth();this.animateDomToCenter.delay(20,this,this.els.activeOption)},populateActiveMonth:function(){this.els.activeOption.addClass("ludo-calendar-month-year-selected");this.els.activeOption.html(this.months[this.date.get("month")]+", "+this.date.get("year"))},addAndRemoveOptions:function(){var b=this.date.clone().decrement("month",this.offsetOptions);var a=this.date.clone().increment("month",this.offsetOptions);if(a<this.minDisplayed||b>this.maxDisplayed){this.renderOptions()}else{var d=this.date.diff(this.minDisplayed,"month")+this.offsetOptions;if(d>0){this.insertMonthBefore(d)}else{this.insertMonthAfter(d*-1)}}this.setMinAndMaxDisplayed()},insertMonthBefore:function(g){var d=[];for(var b=0;b<g;b++){var a=b-this.offsetOptions;var f=this.getDomForAMonth(a);f.insertBefore(this.els.options[0]);d.push(f);this.els.options[this.els.options.length-1].remove();this.els.options.length--}this.els.options=d.append(this.els.options)},insertMonthAfter:function(f){for(var b=f;b>0;b--){var a=this.offsetOptions-b+1;var d=this.getDomForAMonth(a);this.els.calendarContainer.append(d);this.els.options.push(d);this.els.options[b-1].remove()}this.els.options=this.els.options.slice(f)},getNewActiveOption:function(){var b=this.date.get("year"),d=this.date.get("month");for(var a=0;a<this.els.options.length;a++){if(this.els.options[a].attr("year")==b&&this.els.options[a].attr("month")==d){return this.els.options[a]}}return undefined}});ludo.geometry={deg2radians:Math.PI/180,rad2Degrees:180/Math.PI,toRadians:function(a){return a*this.deg2radians},toDegrees:function(a){return a*this.rad2Degrees},getPointDistanceFrom:function(b,a,d,h){var g=h*Math.cos(d);var f=h*Math.sin(d);return{x:b+g,y:a+f}},getPoint:function(b,a,d,f){return this.getPointDistanceFrom(b,a,this.toRadians(d),f)},distanceBetweenPoints:function(b,g,a,d){var h=Math.abs(a-b);var f=Math.abs(d-g);return this.distanceBetweenVectors(h,f)},distanceBetweenVectors:function(a,b){return Math.sqrt((a*a)+(b*b))},getAngleFrom:function(g,d,f,b){var a=this.toDegrees(Math.atan2(d-b,g-f));if(a<0){a+=360}a=((a-90)+360)%360;return a},cosSinBetween:function(j,h,g,f){var b=(f-h);var k=Math.sin(b)*Math.cos(g);var a=Math.cos(j)*Math.sin(g)-Math.sin(j)*Math.cos(g)*Math.cos(b);var d=Math.atan2(k,a);d-=this.toRadians(90);return{x:Math.cos(d),y:Math.sin(d)}},bearing:function(j,h,g,f){var b=(f-h);var k=Math.sin(b)*Math.cos(g);var a=Math.cos(j)*Math.sin(g)-Math.sin(j)*Math.cos(g)*Math.cos(b);var d=Math.atan2(k,a);d=this.toDegrees(d);d=(d+360)%360;d=360-d;return d},isWithinBox:function(a,h,f,d,b,g){return a>=f&&h>=d&&a<=f+b&&h<=d+g},isWithinBBox:function(a,d,b){return a>=b.left&&d>=b.top&&a<=b.left+b.width&&d<=b.top+b.height}};ludo.calendar.TimePicker=new Class({Extends:ludo.View,origo:undefined,hours:undefined,minutes:undefined,hourPrefixed:undefined,minutePrefixed:undefined,area:undefined,initialArea:undefined,hourGroupInner:undefined,hourGroup:undefined,frontGroup:undefined,hourElements:undefined,minuteEls:undefined,centerDot:undefined,needle:undefined,needleCircle:undefined,needleText:undefined,clipPath:undefined,mode:undefined,dragActive:false,drag:undefined,outerSize:0.85,hourInnerSize:0.65,handColor:"#669900",minuteDotColor:"#ffffff",clockBackground:"#DDDDDD",handTextColor:"#ffffff",hourColor:"#555555",minuteColor:"#555555",__construct:function(a){this.parent(a);
this.setConfigParams(a,["hours","minutes","handColor","minuteDotColor","clockBackground","handTextColor","hourColor","minuteColor"]);var b=new Date();if(this.hours==undefined){this.hours=b.getHours()}if(this.minutes==undefined){this.minutes=b.getMinutes()}this.mode="hours"},__rendered:function(){this.parent();this.renderClock();this.notify()},setTime:function(a,b){this.hours=a;this.minutes=b;this.setPrefixed();this.restart();this.notify();this.updateNeedle()},restart:function(){this.showHours()},setPrefixed:function(){this.hourPrefixed=this.hours<10?"0"+this.hours:this.hours;this.minutePrefixed=this.minutes<10?"0"+this.minutes:this.minutes},notify:function(){this.fireEvent("time",[this.hours,this.minutes,this.hourPrefixed+":"+this.minutePrefixed])},mouseDown:function(a){this.dragActive=true;var b=this.$b().offset();this.drag={elX:b.left+parseInt(this.$b().css("paddingLeft"))+parseInt(this.$b().css("border-left-width")),elY:b.top+parseInt(this.$b().css("paddingLeft"))+parseInt(this.$b().css("border-top-width"))};this.updateTimeByEvent(a)},mouseMove:function(a){if(!this.dragActive){return}this.updateTimeByEvent(a);return false},mouseUp:function(){if(this.dragActive){if(this.mode=="hours"){this.showMinutes()}}this.dragActive=false},updateTimeByEvent:function(k){var f=ludo.util.pageXY(k);var b=f.pageX-this.drag.elX;var a=f.pageY-this.drag.elY;var g=ludo.geometry.getAngleFrom(this.origo.x,this.origo.y,b,a);var d=ludo.geometry.distanceBetweenPoints(this.origo.x,this.origo.y,b,a);var j=this.hours;var h=this.minutes;if(this.mode=="hours"){var l=d<(this.area.size/2)*(this.hourInnerSize*1.05);j=g/360*12;if(l){j+=12}j=Math.round(j);if(!l&&j==0){j=12}if(l&&j==12){j=0}if(j==24){j=0}}else{h=g/360*60;h=Math.round(h)%60}if(j!=this.hours||h!=this.minutes){this.hours=j;this.minutes=h;this.setPrefixed();this.notify();this.updateNeedle()}},updateNeedle:function(){var o,k;if(this.mode=="hours"){var g=this.getHourAngle(this.hours);var d=this.getHourDistance(this.hours);o=ludo.geometry.getPointDistanceFrom(this.origo.x,this.origo.y,g,d);k=this.hourPrefixed;this.needleText.text(k);this.needleText.set("x",o.x);this.needleText.set("y",o.y)}else{var p=this.getMinuteAngle(this.minutes);var j=this.area.size*this.outerSize/2;o=ludo.geometry.getPointDistanceFrom(this.origo.x,this.origo.y,p,j);var h=Math.round(this.minutes/5)*5;if(h==60){h=0}var f=h<10?"0"+h:h;var b=this.getMinuteAngle(h);var n=ludo.geometry.getPointDistanceFrom(this.origo.x,this.origo.y,b,j);this.needleText.set("x",n.x);this.needleText.set("y",n.y);this.needleCircleInnerMinutes.set("cx",o.x);this.needleCircleInnerMinutes.set("cy",o.y);if(o.x!=n.x){this.needleCircleInnerMinutes.show()}else{this.needleCircleInnerMinutes.hide()}this.needleText.text(f)}this.clipCircle.set("cx",o.x);this.clipCircle.set("cy",o.y);this.needle.set("x2",o.x);this.needle.set("y2",o.y);this.needleCircle.set("cx",o.x);this.needleCircle.set("cy",o.y)},renderClock:function(){var d=this.svg();d.getNode().on(ludo.util.getDragStartEvent(),this.mouseDown.bind(this));jQuery(document.body).on(ludo.util.getDragMoveEvent(),this.mouseMove.bind(this));jQuery(document.body).on(ludo.util.getDragEndEvent(),this.mouseUp.bind(this));var g=Math.min(d.width,d.height);this.hourElements=[];this.minuteEls=[];this.origo={x:d.width/2,y:d.height/2};this.area={x:(d.width-g)/2,y:(d.height-g)/2,size:g};this.initialArea={x:this.area.x,y:this.area.y,size:this.area.size};this.clipPath=d.$("clipPath",{});d.append(this.clipPath);this.clipCircle=new d.$("circle",{cx:this.origo.x,cy:this.origo.y,r:5});this.clipPath.append(this.clipCircle);this.clockBackground=d.$("circle",{cx:this.origo.x,cy:this.origo.y,r:this.area.size/2,css:{fill:this.clockBackground}});d.append(this.clockBackground);this.hourGroup=new ludo.svg.Group({css:{fill:this.hourColor,"stroke-width":0}});var h={"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"};d.append(this.hourGroup);this.hourGroupInner=new ludo.svg.Group({css:{fill:this.hourColor,"stroke-width":0}});d.append(this.hourGroupInner);var f;for(f=1;f<=12;f++){var j=new ludo.svg.Text(""+f,{css:h});j.set("text-anchor","middle");j.set("alignment-baseline","middle");this.hourGroup.append(j);this.hourElements.push({hour:f,el:j})}for(f=13;f<=24;f++){var b=f==24?"00":""+f;j=new ludo.svg.Text(b,{css:h});j.set("text-anchor","middle");j.set("alignment-baseline","middle");this.hourElements.push({hour:f,el:j});this.hourGroupInner.append(j)}this.centerDot=d.$("circle",{cx:this.origo.x,cy:this.origo.y,r:2,css:{fill:this.handColor,"stroke-width":0}});this.needle=d.$("line",{x1:this.origo.x,y1:this.origo.y,x2:100,y2:100,css:{"stroke-linecap":"round",stroke:this.handColor,"stroke-width":2}});d.append(this.needle);this.minuteGroup=new ludo.svg.Group({css:{fill:this.minuteColor,"stroke-width":0}});d.append(this.minuteGroup);for(f=0;f<60;f+=5){var a=""+f;if(a.length=="1"){a="0"+a}j=new ludo.svg.Text(a,{css:h});j.set("text-anchor","middle");j.set("alignment-baseline","middle");this.minuteEls.push({minute:f,el:j});
this.minuteGroup.append(j)}this.needleCircle=d.$("circle",{cx:this.origo.x,cy:this.origo.y,r:10,css:{fill:this.handColor}});d.append(this.needleCircle);this.needleCircleInnerMinutes=d.$("circle",{cx:this.origo.x,cy:this.origo.y,r:1,css:{fill:this.minuteDotColor}});d.append(this.needleCircleInnerMinutes);this.needleText=new ludo.svg.Text("",{fill:this.handTextColor,css:h});this.needleText.set("text-anchor","middle");this.needleText.set("alignment-baseline","middle");d.append(this.needleText);this.needleText.clip(this.clipPath);this.showHours();d.append(this.centerDot);this.resizeSVG()},positionHour:function(d){var b=this.hourElements[d].hour;var g=this.getHourDistance(b);var f=this.getHourAngle(b);var a=Math.cos(f);var h=Math.sin(f);this.hourElements[d].el.set("x",(a*g)+this.origo.x);this.hourElements[d].el.set("y",(h*g)+this.origo.y)},getHourDistance:function(a){return a<=12&&a>0?this.area.size*this.outerSize/2:this.area.size*this.hourInnerSize/2},getHourAngle:function(a){a=a%12;var b=360/12*a;b-=(360*3/12);return ludo.geometry.toRadians(b)},getMinuteAngle:function(b){var a=360/60*b;a-=90;return ludo.geometry.toRadians(a)},positionMinute:function(b){var f=this.area.size*this.outerSize/2;var d=this.getMinuteAngle(this.minuteEls[b].minute);var a=Math.cos(d);var g=Math.sin(d);this.minuteEls[b].el.set("x",(a*f)+this.origo.x);this.minuteEls[b].el.set("y",(g*f)+this.origo.y)},resizeDOM:function(){this.parent();if(!this.hourGroup){return}this.resizeSVG()},resizeSVG:function(){var a=this.svg();a.fitParent();var b=Math.min(a.width,a.height);this.area={x:(a.width-b)/2,y:(a.height-b)/2,size:b};this.hourGroup.css({"font-size":this.area.size/20});this.hourGroupInner.css({"font-size":this.area.size/25});this.needleCircle.set("r",this.area.size/20);this.clipCircle.set("r",this.area.size/20);this.origo={x:a.width/2,y:a.height/2};for(i=0;i<this.hourElements.length;i++){this.positionHour(i);var d=i<12?this.area.size/20:this.area.size/25;this.hourElements[i].el.css("font-size",d)}for(i=0;i<this.minuteEls.length;i++){this.positionMinute(i);this.minuteEls[i].el.css("font-size",this.area.size/20)}this.clockBackground.set("cx",this.origo.x);this.clockBackground.set("cy",this.origo.y);this.clockBackground.set("r",this.area.size/2);this.centerDot.set("cx",this.origo.x);this.centerDot.set("cy",this.origo.y);this.centerDot.set("r",this.area.size/70);this.needleCircleInnerMinutes.set("r",this.area.size/150);this.needle.set("x1",this.origo.x);this.needle.set("y1",this.origo.y);this.needleText.css("font-size",this.area.size/20);this.updateNeedle()},showMinutes:function(){this.mode="minutes";this.hourGroup.hide();this.hourGroupInner.hide();this.minuteGroup.show();this.needleCircleInnerMinutes.show();this.updateNeedle();this.fireEvent("mode","minutes")},showHours:function(){this.mode="hours";this.hourGroup.show();this.hourGroupInner.show();this.minuteGroup.hide();this.needleCircleInnerMinutes.hide();this.updateNeedle();this.fireEvent("mode","hours")},getTimeString:function(){return this.hourPrefixed+":"+this.minutePrefixed},val:function(b){if(arguments.length>0){var a=b.split(/:/g);this.setTime(parseInt(a[0]),parseInt(a[1]))}return this.hourPrefixed+":"+this.minutePrefixed}});ludo.menu.Item=new Class({Extends:ludo.View,type:"menu.Item",menu:null,subMenu:null,menuItems:[],spacer:undefined,icon:undefined,orientation:"vertical",disabled:false,label:"",action:undefined,record:undefined,fire:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["orientation","icon","record","value","label","action","disabled","fire"]);this._html=this._html||this.label;if(this._html=="|"){this.spacer=true}if(this.spacer){this.layout.height=1}else{this.layout.height=this.layout.height||this.orientation==="vertical"?"wrap":"matchParent"}},ludoEvents:function(){this.parent();if(!this.isSpacer()){this.getEl().on("click",this.click.bind(this));this.getEl().mouseenter(this.mouseOver.bind(this));this.getEl().mouseleave(this.mouseOut.bind(this))}},resizeDOM:function(){this.parent();this.$b().css("lineHeight",this.$b().height+"px")},resizeParent:function(){},ludoDOM:function(){this.parent();this.getEl().addClass("ludo-menu-item");if(this.isSpacer()){if(this.orientation==="horizontal"){this.getEl().css("width",1)}this.getEl().addClass("ludo-menu-item-spacer-"+this.orientation)}this.getEl().addClass("ludo-menu-item-"+this.orientation);if(this.icon){this.createIcon()}if(this.disabled){this.disable()}if(this.children.length){var a=this.els.expand=jQuery("<div>");a.addClass("ludo-menu-item-expand");a.addClass("-expand");this.getEl().append(a)}},getLabel:function(){return this.label},getRecord:function(){return this.record},__rendered:function(){this.parent();if(this.isSpacer()){this.$b().css("visibility","hidden")}},click:function(){if(this.disabled){return}this.getEl().addClass("ludo-menu-item-down");this.fireEvent("click",this);if(this.fire){this.fireEvent(this.fire,this)}},select:function(){this.getEl().addClass("ludo-menu-item-selected")},deselect:function(){this.getEl().removeClass("ludo-menu-item-selected")
},disable:function(){this.disabled=true;this.getEl().addClass("ludo-menu-item-disabled")},isDisabled:function(){return this.disabled},enable:function(){this.disabled=false;this.getEl().removeClass("ludo-menu-item-disabled")},createIcon:function(){var a=this.els.icon=jQuery('<div class="ludo-menu-item-icon">');a.css({"background-position":"center center","background-repeat":"no-repeat",position:"absolute","text-align":"center",left:0,top:0,height:"100%"});if(this.icon.indexOf(".")>=0){a.css("background-image","url("+this.icon+")")}else{a.html(this.icon)}this.getEl().append(a)},mouseOver:function(){if(!this.disabled){this.getEl().addClass("ludo-menu-item-over")}this.fireEvent("enterMenuItem",this)},mouseOut:function(){if(!this.disabled){this.getEl().removeClass("ludo-menu-item-over");this.getEl().removeClass("ludo-menu-item-down");this.fireEvent("leaveMenuItem",this)}},isSpacer:function(){return this.spacer},showMenu:function(){this.menuHandler.showMenu(this)}});ludo.menu.Menu=new Class({Extends:ludo.View,type:"menu.Menu",layout:{type:"Menu",orientation:"vertical",width:"wrap",height:"wrap"},addCoreEvents:function(){}});ludo.menu.Context=new Class({Extends:ludo.View,type:"menu.Context",layout:{type:"Menu",orientation:"vertical",width:"wrap",height:"wrap",active:true,isContext:true},renderTo:undefined,selector:undefined,component:undefined,record:undefined,recordType:undefined,contextEl:undefined,__construct:function(a){this.renderTo=jQuery(document.body);this.parent(a);this.setConfigParams(a,["selector","recordType","record","applyTo","contextEl"]);if(this.recordType){this.record={type:this.recordType}}},ludoDOM:function(){this.parent();this.getEl().css("position","absolute")},ludoEvents:function(){this.parent();jQuery(document.documentElement).on("click",this.hideAfterDelay.bind(this));if(this.contextEl){jQuery(this.contextEl).on("contextmenu",this.show.bind(this))}},hideAfterDelay:function(){if(!this.isHidden()){this.hide.delay(50,this)}},__rendered:function(){this.parent();this.hide()},getSelectedRecord:function(){return this.selectedRecord},show:function(f){if(this.selector){var a=this.getValidDomElement(f.target);if(!a.length){return undefined}this.fireEvent("selectorclick",a)}if(this.record){var d=this.applyTo.getRecordByDOM(f.target);if(!d){return undefined}if(this.isContextMenuFor(d)){this.selectedRecord=d}}ludo.EffectObject.fireEvents();this.getLayout().hideAllMenus();this.parent();if(!this.getParent()){var b=this.getEl();var g=this.getXAndYPos(f);b.css({left:g.x+"px",top:g.y+"px"})}return false},isContextMenuFor:function(a){if(jQuery.type(a)=="string"&&this.record.type==a){return true}for(var b in this.record){if(this.record.hasOwnProperty(b)){if(!a[b]||this.record[b]!==a[b]){return false}}}return true},getXAndYPos:function(j){var g={x:j.pageX,y:j.pageY};var d=jQuery(document.body);var k=d.width();var f=d.height();var h={x:this.getEl().width(),y:this.getEl().height()};var a=g.x+h.x;var l=g.y+h.y;if(a>k){g.x-=(a-k)}if(l>f){g.y-=(l-f)}return g},addCoreEvents:function(){},getValidDomElement:function(d){d=jQuery(d);if(!this.selector){return true}var a=this.selector.replace(/[\.#]/g,"");if(d.hasClass(a)||d.id==a){return d}var b=d.closest(this.selector);if(b){return b}return false}});ludo.menu.DropDown=new Class({Extends:ludo.menu.Menu,type:"menu.DropDown",__construct:function(a){a.renderTo=document.body;this.parent(a);this.setConfigParams(a,["applyTo"]);this.layout.below=this.layout.below||this.applyTo;this.layout.alignLeft=this.layout.alignLeft||this.applyTo},ludoEvents:function(){this.parent();jQuery(document.documentElement).on("click",this.hideAfterDelay.bind(this))},hideAfterDelay:function(){if(!this.isHidden()){this.hide.delay(50,this)}},toggle:function(){if(this.isHidden()){this.show()}else{this.hide()}}});ludo.menu.Button=new Class({Extends:ludo.Core,width:15,renderTo:undefined,alwaysVisible:false,region:"ne",el:undefined,menu:undefined,menuCreated:false,autoPosition:true,toggleOnClick:false,__construct:function(a){this.parent(a);this.setConfigParams(a,["alwaysVisible","region","renderTo","menu","autoPosition","toggleOnClick"])},ludoEvents:function(){this.parent();this.ludoDOM();this.createButtonEvents()},ludoDOM:function(){var a=this.el=jQuery("<div>");a.id="ludo-menu-button-"+String.uniqueID();a.addClass("ludo-menu-button");jQuery(this.renderTo).append(a);a.css({position:"absolute",height:"100%"});this.createButtonEl();this.positionButton()},createButtonEvents:function(){this.buttonEl.on("click",this.toggle.bind(this));ludo.EffectObject.addEvent("start",this.hideMenu.bind(this));this.buttonEl.mouseenter(this.enterButton.bind(this));this.buttonEl.mouseleave(this.leaveButton.bind(this));if(!this.alwaysVisible){var a=jQuery(this.renderTo);a.on("mouseenter",this.show.bind(this));a.on("mouseleave",this.hide.bind(this));this.hide()}else{this.show()}},enterButton:function(){this.el.addClass("ludo-menu-button-over")},leaveButton:function(){this.el.removeClass("ludo-menu-button-over")},toggle:function(a){a.stopPropagation();
if(this.toggleOnClick&&this.menuCreated){this.menu[this.menu.isHidden()?"show":"hide"]()}else{this.showMenu()}},createButtonEl:function(){var a=this.buttonEl=jQuery("<div>");a.addClass("ludo-menu-button-arrow");this.getEl().append(a)},positionButton:function(){var b=this.getEl();var a=this.region;if(a=="ne"||a=="se"){b.css("right",0)}if(a=="nw"||a=="sw"){b.css("left",0)}if(a=="se"||a=="sw"){b.css("bottom",0)}if(a=="ne"||a=="nw"){b.css("top",0)}},getEl:function(){return this.el},showMenu:function(){if(!this.menuCreated){this.createMenuView()}if(this.menu._button&&this.menu._button!==this.id){var a=ludo.get(this.menu._button);if(a){a.hideButton()}}this.menu._button=this.id;this.menu.show();this.positionMenu();this.fireEvent("show",this)},cancelShow:function(){this.okToShowButton=false},hideMenu:function(){if(this.menu.hidden){return}if(this.menu.hide!==undefined){if(this.menu.getLayout().hideAllMenus){this.menu.getLayout().hideAllMenus()}this.menu.hide()}this.hide()},createMenuView:function(){if(this.menu.id){var a=ludo.get(this.menu.id);if(a){this.menu=a}}this.menuCreated=true;if(this.menu.getEl===undefined){this.menu.renderTo=document.body;this.menu.type=this.menu.type||"View";this.menu.hidden=true;this.menu=this.createDependency("menuForButton",this.menu);this.menu._button=this.getEl().id;jQuery(document.body).on("mouseup",this.autoHideMenu.bind(this))}else{jQuery(document.body).append(this.menu.getEl())}this.menu.addEvent("show",this.showIf.bind(this));this.menu.addEvent("hide",this.hideButton.bind(this));this.menu.getEl().css("position","absolute");this.menu.getEl().addClass("ludo-menu-button-menu")},positionMenu:function(){if(this.autoPosition){var a=this.el.offset();this.menu.resize({left:a.left,top:a.top+this.el.height()})}},showIf:function(){if(this.menu._button===this.id){this.show()}},okToShowButton:false,show:function(){this.okToShowButton=true;this.fireEvent("beforeShow",this);if(this.okToShowButton){this.buttonEl.css("display","");this.el.addClass("ludo-menu-button-active")}},hide:function(){if(this.menu===undefined||this.menu.isHidden===undefined||this.menu.isHidden()){this.hideButton()}else{if(this.menu._button!==this.id){this.hideButton()}}},hideButton:function(){if(this.alwaysVisible){return}this.buttonEl.css("display","none");this.el.removeClass("ludo-menu-button-active")},getMenuView:function(){return this.menu},autoHideMenu:function(a){if(!this.menu||this.menu.hidden){return}if(!ludo.dom.isInFamilies(a.target,[this.el.id,this.menu.getEl().id])){this.hideMenu();this.hideButton()}}});ludo.dataSource.JSONTree=new Class({Extends:ludo.dataSource.JSONArray,type:"dataSource.JSONTree",searcherType:"dataSource.JSONTreeSearch",getChildren:function(a){var b=this.findRecord(a);if(b){if(!b.children){b.children=[]}return b.children}return undefined},fireSelect:function(a){this.fireEvent("select",this.getRecord(a))},addRecordEvents:function(a){this.parent(a);a.addEvent("addChild",this.indexRecord.bind(this));a.addEvent("insertBefore",this.indexRecord.bind(this));a.addEvent("insertAfter",this.indexRecord.bind(this));var d=["insertBefore","insertAfter","addChild","removeChild"];for(var b=0;b<d.length;b++){a.addEvent(d[b],this.fireRecordEvent.bind(this))}},fireRecordEvent:function(a,d,b){this.fireEvent(b,[a,d])},addSearcherEvents:function(){this.searcher.addEvent("match",function(a){this.fireEvent("show",this.getRecord(a))}.bind(this));this.searcher.addEvent("mismatch",function(a){this.fireEvent("hide",this.getRecord(a))}.bind(this))}});ludo.tree.Tree=new Class({Extends:ludo.CollectionView,type:"tree.Tree",nodeCache:{},renderedRecords:{},tpl:'<span class="ludo-tree-node-spacer"></span> {title}',tplKey:undefined,dataSource:{},defaultDS:"dataSource.JSONTree",defaults:undefined,categoryKey:"type",categoryConfig:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["defaults","categoryConfig","categoryKey"])},ludoEvents:function(){this.parent();if(this.dataSource){this.getDataSource().addEvents({select:this.selectRecord.bind(this),deselect:this.deSelectRecord.bind(this),add:this.addRecord.bind(this),addChild:this.addChild.bind(this),remove:this.removeChild.bind(this),removeChild:this.removeChild.bind(this),show:this.showRecord.bind(this),hide:this.hideRecord.bind(this)})}},ludoDOM:function(){this.parent();this.$b().css("overflowY","auto");this.$b().on("click",this.onClick.bind(this));this.$b().on("dblclick",this.onDblClick.bind(this))},onClick:function(b){var a=this.getRecordByDOM(b.target);if(a){if(b.target.tagName.toLowerCase()==="span"&&this.isSelectable(a)){this.getDataSource().selectRecord(a)}if(jQuery(b.target).hasClass("ludo-tree-node-expand")){this.expandOrCollapse(a,b.target)}else{this.expand(a,b.target)}}},onDblClick:function(b){var a=this.getRecordByDOM(b.target);if(a){this.fireEvent("dblClick",a)}},selectRecord:function(a){if(!a.getPlainRecord){a=this.getDataSource().getRecord(a)}if(!a){return}if(!this.isRecordRendered(a)){this.showRecord(a)}var b=this.getDomElement(a,".ludo-tree-node-plain");
if(b){b.addClass("ludo-tree-selected-node")}},deSelectRecord:function(a){var b=this.getDomElement(a,".ludo-tree-node-plain");if(b){b.removeClass("ludo-tree-selected-node")}},getDomElement:function(b,a){var d=this.getDomByRecord(b);if(d){return jQuery(d).find(a).first()}return undefined},expandOrCollapse:function(a,b){b=this.getExpandEl(a);var d=b.hasClass("ludo-tree-node-collapse")?"collapse":"expand";this[d](a,b)},expand:function(a,b){b=this.getExpandEl(a);if(!this.areChildrenRendered(a)){this.renderChildrenOf(a)}b.addClass("ludo-tree-node-collapse");this.getCachedNode(a,"children","child-container-").css("display","")},collapse:function(a,b){b=this.getExpandEl(a);b.removeClass("ludo-tree-node-collapse");this.getCachedNode(a,"children","child-container-").css("display","none")},getExpandEl:function(a){return this.getCachedNode(a,"expand","expand-")},getChildContainer:function(a){return this.getCachedNode(a,"children","child-container-")},hideRecord:function(a){if(this.isRecordRendered(a)){this.getCachedNode(a,"node","").css("display","none")}},showRecord:function(a){if(!this.isRecordRendered(a)){this.showRecord(a.getParent());this.expand(a.getParent());this.showRecord(a.getParent())}this.getCachedNode(a,"node","").css("display","")},getDomByRecord:function(a){return a?this.getCachedNode(a,"node",""):undefined},isRecordRendered:function(a){return this.renderedRecords[a.getUID?a.getUID():a.uid]?true:false},areChildrenRendered:function(a){a=a.getUID?a.record:a;return a.children&&a.children.length?this.isRecordRendered(a.children[0]):false},getCachedNode:function(a,f,d){if(this.nodeCache[f]===undefined){this.nodeCache[f]={}}var b=a.getUID?a.getUID():a.uid;if(!this.nodeCache[f][b]){this.nodeCache[f][b]=this.$b().find("#"+d+b)}return this.nodeCache[f][b]},getRecordByDOM:function(d){var a=this.$b();while(d!==a&&(!d.className||d.className.indexOf("ludo-tree-a-node")===-1)){d=d.parentNode}if(d){return this.getDataSource().getRecord(d.id)}return undefined},JSON:function(){this.nodeCache={};this.renderedRecords={};this.nodeContainer().html("");this.render()},render:function(){this.parent();var a=this.getDataSource().getData();this.nodeContainer().html(this.getHtmlForBranch(a))},getHtmlForBranch:function(d){var b=[];for(var a=0;a<d.length;a++){b.push(this.getHtmlFor(d[a],(a===d.length-1),true))}return b.join("")},renderChildrenOf:function(a){var b=this.getChildContainer(a);if(b){var d=a.getChildren();if(d){b.html(this.getHtmlForBranch(d))}}},getHtmlFor:function(a,f,d){var b=[];this.renderedRecords[a.uid]=true;if(d){b.push('<div class="ludo-tree-a-node ludo-tree-node');if(f){b.push(" ludo-tree-node-last-sibling")}b.push('" id="'+a.uid+'">')}b.push('<div class="ludo-tree-node-plain">');b.push(this.isSelectable(a)?'<span class="ludo-tree-node-selectable">':"<span>");b.push(this.getNodeTextFor(a));b.push("</span>");b.push('<div class="ludo-tree-node-expand" id="expand-'+a.uid+'" style="position:absolute;display:'+(a.children&&a.children.length?"":"none")+'"></div>');b.push("</div>");b.push('<div class="ludo-tree-node-container" style="display:none" id="child-container-');b.push(a.uid);b.push('">');b.push("</div>");if(d){b.push("</div>")}this.fireEvent("createNode",[a.uid,a,this]);return b.join("")},isSelectable:function(a){if(this.categoryConfig){a=a.getUID?a.getData():a;var b=this.categoryConfig[a[this.categoryKey]];return b&&b.selectable!==undefined?b.selectable:true}return true},getNodeTextFor:function(a){var f=this.getTplFields(a);var b=this.getTpl(a);for(var d=0,g=f.length;d<g;d++){var h=f[d];b=b.replace("{"+h+"}",a[h]?a[h]:this.getDefaultValue(a,h))}b='<span class="ludo-tree-node-spacer"></span>'+b;return b},getDefaultValue:function(a,d){if(this.defaults){var b=this.categoryKey;return a[b]&&this.defaults&&this.defaults[a[b]]?this.defaults[a[b]][d]:""}return""},tpls:undefined,getTpl:function(a){return this.tpl.tplKey?this.tpl[a[this.tplKey]]:this.tpl},getTplFields:function(a){if(!this.tplFields){if(ludo.util.isString(this.tpl)){this.tplFields=this.getTplMatches(this.tpl)}else{this.tplFields={};var b=Object.clone(this.tpl);this.tplKey=b.tplKey;for(var d in b){if(b.hasOwnProperty(d)){if(d!="tplKey"){this.tplFields[d]=this.getTplMatches(b[d])}}}}}return this.tplKey?this.tplFields[a[this.tplKey]]:this.tplFields},getTplMatches:function(a){var d=a.match(/{([^}]+)}/g);for(var b=0;b<d.length;b++){d[b]=d[b].replace(/[{}]/g,"")}return d},addRecord:function(a){this.addChild(a)},addChild:function(b,d){var a=d?this.getChildContainer(d):this.$b();if(a){var f=this.getDomByRecord(b)||this.getNewNodeFor(b);a.appendChild(f);this.cssBranch(d?d.children:this.getDataSource().data);if(d){this.getExpandEl(d).style.display=""}}},getNewNodeFor:function(a){a=a.getUID?a.record:a;if(!a.uid){this.getDataSource().indexRecord(a)}return ludo.dom.create({cls:"ludo-tree-a-node ludo-tree-node",html:this.getHtmlFor(a,false,false),id:a.uid})},cssBranch:function(a){var f=a.length;for(var b=Math.max(0,f-2);b<f;b++){var d=this.getDomByRecord(a[b]);if(d){if(b<f-1){d.removeClass("ludo-tree-node-last-sibling")
}else{d.addClass("ludo-tree-node-last-sibling")}}}},removeChild:function(a){var b=this.getDomByRecord(a);if(b){b.parentNode.removeChild(b);delete this.renderedRecords[this.getUID(a)];if(a.parentUid){var d=this.dataSource.findRecord(a.parentUid);if(d){this.cssBranch(d.children)}}}},getUID:function(a){return a.getUID?a.getUID():a.uid}});ludo.dataSource.HTML=new Class({Extends:ludo.dataSource.Base,type:"dataSource.HTML",getSourceType:function(){return"HTML"},sendRequest:function(a){jQuery.ajax({url:this.url,data:a,success:function(b){this.parseNewData(b);this.fireEvent("success",[b,this]);this.fireEvent("complete")}.bind(this),fail:function(d,b){this.fireEvent("fail",[d,b,this]);this.fireEvent("complete")}.bind(this),dataType:"html"})},load:function(){this.parent();this.sendRequest(this.service,this.arguments,this.getPostData())},parseNewData:function(a){this.parent();this.data=a;this.fireEvent("load",this.data)},_request:undefined,requestHandler:function(){if(this._request===undefined){this._request=new ludo.remote.HTML({shim:this.shim,url:this.url,resource:this.resource,listeners:{beforeload:function(a){this.fireEvent("beforeload",a)},success:function(a){this.parseNewData(a.getResponseData(),a.getResponse())}.bind(this),error:function(a){this.fireEvent("servererror",[a.getResponseMessage(),a.getResponseCode()])}.bind(this)}})}return this._request}});ludo.dataSource.JSONTreeSearch=new Class({Extends:ludo.dataSource.JSONArraySearch,matchesFound:false,performSearch:function(){this.matchesFound=false;this.performSearchIn(this.getDataFromSource());if(!this.matchesFound){this.fireEvent("noMatches")}else{this.fireEvent("matches")}},performSearchIn:function(b){for(var a=0;a<b.length;a++){if(this.isMatchingSearch(b[a])){this.searchResult.push(b[a]);this.fireEvent("match",b[a]);this.matchesFound=true;if(b[a].children){this.performSearchIn(b[a].children)}}else{this.fireEvent("mismatch",b[a])}}}});ludo.controller.Manager=new Class({Extends:ludo.Core,controllers:[],components:[],registerController:function(a){this.controllers.push(a);for(var b=0;b<this.components.length;b++){var d=this.components[b];if(a.shouldBeControllerFor(d)){this.assignControllerTo(a,d)}}},registerComponent:function(b){if(!b.hasController()){this.components.push(b);var a=this.getControllerFor(b);if(a){this.assignControllerTo(a,b)}}},getControllerFor:function(a){for(var b=0;b<this.controllers.length;b++){if(this.controllers[b].shouldBeControllerFor(a)){return this.controllers[b]}}return undefined},assignSpecificControllerFor:function(a,b){if(typeof a==="string"){a=ludo.get(a);if(a){this.assignControllerTo(a,b)}return}a=b.createDependency("controller-"+String.uniqueID(),a);this.assignControllerTo(a,b)},assignControllerTo:function(a,b){b.setController(a);a.addBroadcastFor(b);a.addView(b)}});ludo.controllerManager=new ludo.controller.Manager();ludo.controller.Controller=new Class({Extends:ludo.Core,type:"controller.Controller",applyTo:undefined,id:undefined,components:[],controller:undefined,useController:false,broadcast:undefined,__construct:function(a){a=a||{};a.controller=undefined;a.useController=false;this.parent(a);if(a.broadcast){this.broadcast=a.broadcast}ludo.controllerManager.registerController(this);if(this["addView"]==undefined){alert("You need to implement an addView method for the controller ("+this.type+")")}},addBroadcastFor:function(a){if(this.broadcast&&this.broadcast[a.type]!==undefined){var d=this.broadcast[a.type];for(var b=0;b<d.length;b++){var f=this.getBroadcastEventNames(d[b]);a.addEvent(f.component,this.getBroadcastFn(f.controller).bind(this))}}},getBroadcastFn:function(a){return function(){this.fireEvent(a,arguments)}},getBroadcastEventNames:function(b){if(typeof b=="object"){for(var a in b){if(b.hasOwnProperty(a)){return{component:a,controller:b[a]}}}}return{component:b,controller:b}},shouldBeControllerFor:function(a){if(a===this){return false}if(!this.applyTo){return this.isInSameNamespaceAs(a)}var b=this.getModuleKeyFor(a);if(this.isAppliedDirectlyToModule(b)){return true}return this.isAppliedIndirectlyToModule(b)},getModuleKeyFor:function(a){return a.module+(a.submodule?"."+a.submodule:"")},isAppliedDirectlyToModule:function(a){return(this.applyTo.indexOf(a)===0)},isAppliedIndirectlyToModule:function(a){for(var b=0;b<this.applyTo.length;b++){if(a.indexOf(this.applyTo[b])===0){return true}}return false},isInSameNamespaceAs:function(a){return this.getNamespace()==a.getNamespace()}});ludo.getController=function(a){if(a.substr){a=ludo.get(a)}return a};ludo.progress.Bar=new Class({Extends:ludo.View,type:"progress.Bar",orientation:"horizontal",steps:10,progress:0,lastProgress:0,lastSteps:0,lastRatio:0,outerBorderWidth:0,innerBorderWidth:0,borderRadius:undefined,textSizeRatio:0.6,bgStyles:undefined,barStyles:undefined,textStyles:undefined,_text:undefined,animationDuration:100,debugRect:undefined,bgPattern:undefined,frontPattern:undefined,bgPatternSize:undefined,frontPatternSize:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["animationDuration","steps","progress","borderRadius","textSizeRatio","bgStyles","barStyles","textStyles","bgPattern","frontPattern","easing"]);
if(!this.layout.height){this.layout.height=25}this.lastSteps=this.steps;if(this.easing==undefined){this.easing=ludo.svg.easing.linear}if(a.text!=undefined){this._text=a.text}},__rendered:function(){this.parent();this.renderBar();if(this.progress!=0){this.onChange()}},increment:function(d,a){d=d!=undefined?d:1;a=a!=undefined?a:true;if(d!=0){this.lastProgress=this.progress}this.progress+=d;this.progress=Math.max(0,this.progress);this.progress=Math.min(this.progress,this.steps);if(this.progress!=this.lastProgress||this.steps!=this.lastSteps){var b=this.progress/this.steps;this.ratio(b,a)}},onChange:function(){var a=this.progress/this.steps;this.fireEvent("change",[a*100,this.progress,this.steps,this,a])},resize:function(a){this.parent(a);this.resizeItems()},setSteps:function(b,a){this.lastSteps=this.steps;this.steps=b;this.increment(0,a)},setProgress:function(b,a){this.increment(b-this.progress,a)},createClipPath:function(){var a=this.svg();this.els.clipPath=a.$("clipPath");a.appendDef(this.els.clipPath);this.els.clipRect=a.$("rect",{x:0,y:0,width:0,height:0});this.els.clipPath.append(this.els.clipRect);this.els.clipPathBg=a.$("clipPath");this.els.clipPathBgPath=a.$("path");this.els.clipPathBg.append(this.els.clipPathBgPath);a.append(this.els.clipPathBg)},getPattern:function(j,a,d){var f=this.svg();var h=f.$("pattern");h.set("x",0);h.set("y",0);var b=this.els[d]=f.$("image");var g=this;b.set("opacity",0);b.on("load",function(){var k=this.getBBox();g[a]={x:k.width,y:k.height};b.set("opacity",1);g.updatePatternSize()}.bind(b));b.set("xlink:href",j);h.append(b);f.appendDef(h);return h},createPattern:function(){if(this.bgPattern){this.els.bgPattern=this.getPattern(this.bgPattern,"bgPatternSize","bgPatternImage")}if(this.frontPattern){this.els.frontPattern=this.getPattern(this.frontPattern,"frontPatternSize","frontPatternImage")}},applyPattern:function(){var a=this.svg();if(this.bgPattern){this.els.patternRect=a.$("rect");a.append(this.els.patternRect);this.els.patternRect.setPattern(this.els.bgPattern);this.els.patternRect.set("x",0);this.els.patternRect.set("y",0);this.els.patternRect.clip(this.els.clipPathBg)}if(this.frontPattern){this.els.frontPatternPath=a.$("path");a.append(this.els.frontPatternPath);this.els.frontPatternPath.setPattern(this.els.frontPattern);this.els.frontPatternPath.clip(this.els.clipPath)}},updatePatternSize:function(){if(this.bgPatternSize!=undefined){this.els.bgPattern.set("width",Math.min(1,this.bgPatternSize.x/this.svg().width));this.els.bgPattern.set("height",Math.min(1,this.bgPatternSize.y/this.svg().height))}if(this.frontPatternSize){this.els.frontPattern.set("width",Math.min(1,this.frontPatternSize.x/this.svg().width));this.els.frontPattern.set("height",Math.min(1,this.frontPatternSize.y/this.svg().height))}},renderBar:function(){var f=this.svg();this.createClipPath();this.createPattern();this.applyPattern();var a="ludo-progress-bg";var g=ludo.svg.Util.pathStyles(a);this.outerBorderWidth=parseInt(g["stroke-width"]);f.addStyleSheet(a+"-svg",g);var b=this.els.bg=f.$("path");b.addClass(a+"-svg");f.append(b);if(this.bgStyles!=undefined){b.css(this.bgStyles);if(this.bgStyles["stroke-width"]!=undefined){this.outerBorderWidth=parseInt(this.bgStyles["stroke-width"])}}b.set("stroke-linecap","round");b.set("stroke-linejoin","round");if(this.els.patternRect){this.els.patternRect.toFront()}this.els.g=f.$("g");f.append(this.els.g);var d=this.els.bar=f.$("path");a="ludo-progress-pr";g=ludo.svg.Util.pathStyles(a);this.innerBorderWidth=parseInt(g["stroke-width"]);f.addStyleSheet(a+"-svg",g);d.addClass(a+"-svg");this.els.g.append(d);if(this.barStyles!=undefined){d.css(this.barStyles);if(this.barStyles["stroke-width"]!=undefined){this.innerBorderWidth=parseInt(this.barStyles["stroke-width"])}}d.set("stroke-linecap","round");d.set("stroke-linejoin","round");this.els.g.clip(this.els.clipPath);if(this._text!=undefined){this.text(this._text)}if(this.els.frontPatternPath){this.els.frontPatternPath.toFront()}},bar:function(){return this.els.bar},resizeItems:function(){this.els.bg.set("d",this.bgPath());if(this.els.patternRect){this.els.patternRect.set("width",this.svg().width);this.els.patternRect.set("height",this.svg().height)}var a=(this.outerBorderWidth/2)+(this.innerBorderWidth/2);this.els.bar.set("d",this.bgPath(a));if(this.els.frontPatternPath){this.els.frontPatternPath.set("d",this.bgPath(a))}this.els.clipPathBgPath.set("d",this.bgPath(a));this.positionTextNode();this.percent(this.progress/this.steps*100);this.els.clipRect.set("height",this.svg().height);this.els.clipRect.set("x",this.outerBorderWidth);this.updatePatternSize();this.ratio(this.progress/this.steps,false)},positionTextNode:function(){if(this.els.textNode){this.els.textNode.set("x",this.$b().width()/2);this.els.textNode.set("y",(this.svg().height/2));this.els.textNode.css("font-size",this.svg().height*this.textSizeRatio)}},bgPath:function(l){l=l||0;var j=(this.outerBorderWidth/2)+l;var b=this.svg().width;var d=this.svg().height;var a=this.borderRadius?this.borderRadius:this.orientation=="horizontal"?(d-j)/2:(b-j)/2;
if(this.orientation=="horizontal"){a=Math.min(a,(d-j)/2)}else{a=Math.min(a,(b-j)/2)}var k=a;var g;if(this.borderRadius||1==1){g=["M",k,j,"L",b-k,j,"A",a,a,90,0,1,b-j,j+a,"L",b-j,d-a,"A",a,a,90,0,1,b-k,d-j,"L",k,d-j,"A",a,a,90,0,1,j,d-j-a,"L",j,a,"A",a,a,90,0,1,k,j]}else{var f=0;g=["M",k,j,"L",b-k+f,j,"A",a,a,180,0,1,b-k+f,d-j,"L",k-f,d-j,"A",a,a,180,0,1,k-f,j]}return g.join(" ")},text:function(a){if(this.els.textNode==undefined){this.els.textNode=this.svg().$("text");var b=ludo.svg.Util.textStyles("ludo-progress-text");this.svg().addStyleSheet("ludo-progress-text-svg",b);this.els.textNode.addClass("ludo-progress-text-svg");this.els.textNode.set("text-anchor","middle");this.els.textNode.set("alignment-baseline","central");this.svg().append(this.els.textNode);if(this.textStyles!=undefined){this.els.textNode.css(this.textStyles)}this.positionTextNode()}this.els.textNode.text(a)},animate:function(a){this.percent(a,true)},percent:function(b,a){if(arguments.length==0){return(this.progress/this.steps*100).toFixed(0)}this.ratio(b/100,a)},ratio:function(d,b){if(arguments.length==0){return this.progress/this.steps}d=ludo.util.clamp(d,0,1);var a=(this.svg().width-this.outerBorderWidth)*d;if(b){var f=d-this.lastRatio;this.els.clipRect.animate({width:a},{duration:this.animationDuration,easing:this.easing,complete:function(){this.lastRatio=d;this.fireEvent("animate",this.lastRatio*100);this.onChange()}.bind(this),progress:function(g){var h=Math.min(100,(this.lastRatio+(f*g))*100);this.fireEvent("animate",h)}.bind(this)})}else{this.els.clipRect.set("width",a);if(d!=this.lastRatio){this.onChange()}this.lastRatio=d;this.fireEvent("animate",this.lastRatio*100)}}});ludo.progress.Donut=new Class({Extends:ludo.progress.Bar,steps:10,progress:0,textSizeRatio:0.3,outerBorderWidth:0,innerBorderWidth:0,startAngle:0,bgPattern2:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["innerRadius","outerRadius","startAngle","bgPattern2","outerPattern"])},applyPattern:function(){var a=this.svg();if(this.outerPattern){this.els.outerPatternPath=a.$("path");a.append(this.els.outerPatternPath);this.els.outerPatternPath.setPattern(this.els.outerPattern);this.els.outerPatternPath.set("fill-rule","evenodd")}if(this.bgPattern){this.els.bgPatternPath=a.$("path");a.append(this.els.bgPatternPath);this.els.bgPatternPath.setPattern(this.els.bgPattern);this.els.bgPatternPath.set("fill-rule","evenodd")}if(this.frontPattern){this.els.frontPatternPath=a.$("path");this.els.frontGroup.append(this.els.frontPatternPath);this.els.frontPatternPath.setPattern(this.els.frontPattern);this.els.frontPatternPath.clip(this.els.clipPath);this.els.frontPatternPath.set("fill-rule","evenodd")}if(this.bgPattern2){this.els.bgPatternPath2=a.$("circle");a.append(this.els.bgPatternPath2);this.els.bgPatternPath2.setPattern(this.els.bgPattern2)}},createPattern:function(){if(this.outerPattern){this.els.outerPattern=this.getPattern(this.outerPattern,"outerPatternSize","outerPatternImage")}this.parent();if(this.bgPattern2){this.els.bgPattern2=this.getPattern(this.bgPattern2,"bgPattern2Size","bgPatternImage2")}},renderBar:function(){var a=this.svg();this.createStyles();this.createClipPath();this.createPattern();this.els.bg=a.$("path");this.els.bg.addClass("ludo-progress-donut-bg-svg");a.append(this.els.bg);this.els.bg.set("fill-rule","evenodd");if(this.bgStyles){this.els.bg.css(this.bgStyles);if(this.bgStyles["stroke-width"]!=undefined){this.outerBorderWidth=parseInt(this.bgStyles["stroke-width"])}}this.els.frontGroup=a.$("g");a.append(this.els.frontGroup);this.els.bar=a.$("path");this.els.bar.addClass("ludo-progress-donut-bar-svg");this.els.frontGroup.append(this.els.bar);this.els.bar.set("fill-rule","evenodd");this.els.frontGroup.clip(this.els.clipPath);if(this.barStyles){this.els.bar.css(this.barStyles);if(this.barStyles["stroke-width"]!=undefined){this.outerBorderWidth=parseInt(this.barStyles["stroke-width"])}}if(this._text!=undefined){this.text(this._text)}this.applyPattern();this.els.frontGroup.toFront();this.els.debug=a.$("path");a.append(this.els.debug);this.els.debug.css("fill","#ff0000");if(this.els.frontPatternPath){this.els.frontPatternPath.toFront()}if(this.els.textNode){this.els.textNode.toFront()}if(this.els.outerPatternSize){this.els.outerPatternSize.toBack()}},createClipPath:function(){var a=this.svg();this.els.clipPath=a.$("clipPath");a.appendDef(this.els.clipPath);this.els.clip=a.$("path");this.els.clipPath.append(this.els.clip)},createStyles:function(){var b=this.svg();var a="ludo-progress-donut-bg";var d=ludo.svg.Util.pathStyles(a);this.outerBorderWidth=parseInt(d["stroke-width"]);b.addStyleSheet(a+"-svg",d);a="ludo-progress-donut-bar";d=ludo.svg.Util.pathStyles(a);this.innerBorderWidth=parseInt(d["stroke-width"]);b.addStyleSheet(a+"-svg",d)},resize:function(a){this.parent(a);this.resizeItems();this.ratio(this.progress/this.steps,false)},updatePatternSize:function(){var a=this.rect();if(this.bgPatternSize!=undefined){if(this.bgPatternSize.x>a){this.els.bgPatternImage.set("width",a);
this.els.bgPatternImage.set("height",a)}this.els.bgPattern.set("width",Math.min(1,this.bgPatternSize.x/a));this.els.bgPattern.set("height",Math.min(1,this.bgPatternSize.y/a))}if(this.frontPatternSize){if(this.frontPatternSize.x>a){this.els.frontPatternImage.set("width",a);this.els.frontPatternImage.set("height",a)}this.els.frontPattern.set("width",Math.min(1,this.frontPatternSize.x/a));this.els.frontPattern.set("height",Math.min(1,this.frontPatternSize.y/a))}if(this.bgPattern2Size){var b=this.innerRadius(a/2)*2;if(this.bgPattern2Size.x>b){this.els.bgPatternImage2.set("width",b);this.els.bgPatternImage2.set("height",b)}this.els.bgPattern2.set("width",Math.min(1,this.bgPattern2Size.x/b));this.els.bgPattern2.set("height",Math.min(1,this.bgPattern2Size.y/b))}if(this.outerPatternSize){if(this.outerPatternSize.x>a){this.els.outerPatternImage.set("width",a);this.els.outerPatternImage.set("height",a)}this.els.outerPattern.set("width",Math.min(1,this.outerPatternSize.x/a));this.els.outerPattern.set("height",Math.min(1,this.outerPatternSize.y/a))}},resizeItems:function(){var b=this.rect();var g=b/2;var a=this.outerRadius(g);var f=this.innerRadius(g);console.log(f);this.els.bg.set("d",this.bgPath(a,f));this.els.bar.set("d",this.bgPath(a-this.outerBorderWidth,f+this.outerBorderWidth));if(this.els.bgPatternPath){this.els.bgPatternPath.set("d",this.bgPath(a-this.outerBorderWidth,f+this.outerBorderWidth))}if(this.els.frontPatternPath){var d=this.bgPath(a-this.outerBorderWidth-this.innerBorderWidth,f+this.outerBorderWidth+this.innerBorderWidth);this.els.frontPatternPath.set("d",d)}if(this.els.bgPatternPath2){this.els.bgPatternPath2.set("cx",g);this.els.bgPatternPath2.set("cy",g);this.els.bgPatternPath2.set("r",f)}if(this.els.outerPatternPath){this.els.outerPatternPath.set("d",this.bgPath(g,a-this.outerBorderWidth))}this.updatePatternSize();this.positionTextNode()},outerRadius:function(a){return a-2},text:function(a){if(this.els.textNode==undefined){this.els.textNode=this.svg().$("text");var b=ludo.svg.Util.textStyles("ludo-progress-donut-text");this.svg().addStyleSheet("ludo-progress-donut-text-svg",b);this.els.textNode.addClass("ludo-progress-donut-text-svg");this.els.textNode.set("text-anchor","middle");this.els.textNode.set("alignment-baseline","central");this.svg().append(this.els.textNode);if(this.textStyles!=undefined){this.els.textNode.css(this.textStyles)}this.positionTextNode()}this.els.textNode.text(a)},positionTextNode:function(){if(this.els.textNode){var a=this.rect()/2;this.els.textNode.set("x",a);this.els.textNode.set("y",a);this.els.textNode.css("font-size",this.innerRadius(this.rect())*this.textSizeRatio)}},bgPath:function(a,b){return this.circlePath(a)+this.circlePath(b)},circlePath:function(b){var f=this.rect()/2;var a=f-b;var d=f+b;return["M",a,f,"A",b,b,90,0,1,f,a,"A",b,b,90,0,1,d,f,"A",b,b,90,0,1,f,d,"A",b,b,90,0,1,a,f].join(" ")},rect:function(){return Math.min(this.svg().width,this.svg().height)},ratio:function(g,d){if(arguments.length==0){return this.progress/this.steps}g=ludo.util.clamp(g,0,1);if(d){var k=this.clipArray(g).join(" ");var f=this.rect();var l=f/2;var b=this.startAngle;var j=g-this.lastRatio;this.els.clip.set("d",this.clipArray(this.lastRatio).join(" "));this.els.clip.animate({d:k},{easing:this.easing,duration:this.animationDuration,step:function(o,s,m){if(g==1&&m==1){o[9]=359.99999}var p=o[9]-90+b;var n=ludo.geometry.toRadians(p);var a=l+(Math.cos(n)*30000);var q=l+(Math.sin(n)*30000);o[12]=a;o[13]=q;return o},progress:function(a){var m=Math.min(100,(this.lastRatio+(j*a))*100);this.fireEvent("animate",m)}.bind(this),complete:function(){this.lastRatio=g;this.fireEvent("animate",this.lastRatio*100);this.onChange()}.bind(this)})}else{var h=this.clipArray(Math.min(g,0.9999999));this.els.clip.set("d",h.join(" "));if(g!=this.lastRatio){this.onChange()}this.fireEvent("animate",this.lastRatio*100);this.lastRatio=g}},clipArray:function(g){var a=360*g;var b=ludo.geometry.toRadians(a-90+this.startAngle);var n=this.rect();var h=n/2;var d=30000;var f=ludo.geometry.toRadians(-90+this.startAngle);var j=h+(Math.cos(f)*d);var m=h+(Math.sin(f)*d);var l=h+(Math.cos(b)*d);var k=h+(Math.sin(b)*d);return["M",h,h,"L",j,m,"A",d,d,a,1,1,l,k,"Z"]},innerRadius:function(a){return a*0.5}});ludo.form.validator.required=function(a,b){return !b||a.length>0};ludo.form.validator.minLength=function(b,a){return b.length===0||b.length>=a};ludo.form.validator.maxLength=function(b,a){return b.length===0||b.length<=a};ludo.form.validator.regex=function(b,a){return b.length===0||a.test(b)};ludo.form.validator.minValue=function(b,a){return b.length===0||parseInt(b)>=a};ludo.form.validator.maxValue=function(a,b){return a.length===0||parseInt(a)<=b};ludo.form.validator.twin=function(d,a){var b=ludo.get(a);return !b||(b&&d===b.value)};ludo.form.Element=new Class({Extends:ludo.View,value:undefined,onLoadMessage:"",name:undefined,formCss:undefined,stretchField:true,required:false,dirtyFlag:false,initialValue:undefined,constructorValue:undefined,isReady:true,overflow:"hidden",twin:undefined,linkWith:undefined,statefulProperties:["value"],validator:undefined,validatorFn:undefined,validators:[],submittable:true,__construct:function(b){this.parent(b);
var a=this.getInheritedFormConfig();var d=["label","suffix","formCss","validator","stretchField","required","twin","disabled","submittable","value","data"];this.setConfigParams(b,d);this.elementId=("el-"+this.name).trim();this.formCss=a.formCss||this.formCss;if(a.height&&b.height===undefined){this.layout.height=a.height}if(this.validator){this.createValidator()}if(b.linkWith!==undefined){this.setLinkWith(b.linkWith)}if(this.dataSource&&!this.dataSource.data){this.isReady=false}this.initialValue=this.constructorValue=this.value;if(!this.name){this.name="ludo-form-el-"+String.uniqueID()}ludo.Form.add(this);if(this.required){this.applyValidatorFns(["required"])}this.applyValidatorFns(["twin"])},ludoDOM:function(){this.parent();this.addInput()},applyValidatorFns:function(d){for(var b=0;b<d.length;b++){var a=d[b];if(this[a]!==undefined){this.validators.push({fn:ludo.form.validator[a],key:a})}}},createValidator:function(){var a;if(ludo.util.isFunction(this.validator)){a=this.validator}else{this.validator.applyTo=this;this.validator=ludo._new(this.validator);a=this.validator.isValid.bind(this.validator)}this.validators.push({fn:a,key:""})},ludoEvents:function(){this.parent();if(this.dataSource){this.getDataSource().addEvent("load",this.setReady.bind(this))}var a=this.getFormEl();if(a){a.on("keydown",this.keyDown.bind(this));a.on("keypress",this.keyPress.bind(this));a.on("keyup",this.keyUp.bind(this));a.on("focus",this.focus.bind(this));a.on("change",this.change.bind(this));a.on("blur",this.blur.bind(this))}},__rendered:function(){this.parent();if(this.disabled){this.disable()}if(this.els.formEl){this.els.formEl.attr("name",this.getName());if(this.value!==undefined){this.els.formEl.val(this.value)}}if(this.linkWith){this.createBackLink()}var a=this.getParentForm();if(a){a.registerFormElement(this)}this.validate()},setEnabled:function(a){if(a){this.enable()}else{this.disable()}},disable:function(){this.getFormEl().attr("disabled","1");this.fireEvent("disable",this)},enable:function(){this.getFormEl().removeAttr("disabled");this.fireEvent("enable",this)},getInheritedFormConfig:function(){var a=this.getParent();if(a){return a.formConfig||{}}return{}},ludoCSS:function(){this.parent();this.getEl().addClass("ludo-form-element");if(this.els.formEl){this.els.formEl.id=this.elementId;if(this.formCss){this.els.formEl.css(this.formCss)}}},getFormElId:function(){return this.elementId},getWidth:function(){var a=this.parent();return a?a:20},keyUp:function(a){this.fireEvent("key_up",[a.key,this.value,this])},keyDown:function(a){this.fireEvent("key_down",[a.key,this.value,this])},keyPress:function(a){this.fireEvent("key_press",[a.key,this.value,this])},focus:function(){this._focus=true;this.clearInvalid();this.fireEvent("focus",[this.value,this])},change:function(){if(this.els.formEl){this._set(this.els.formEl.val())}if(this.wasValid){this.fireEvent("change",[this._get(),this])}},blur:function(){this._focus=false;this.validate();if(this.getFormEl()){this.value=this.getValueOfFormEl()}this.toggleDirtyFlag();this.fireEvent("blur",[this.value,this])},getValueOfFormEl:function(){return this.getFormEl().val()},toggleDirtyFlag:function(){if(this.value!==this.initialValue){this.setDirty();this.fireEvent("dirty",[this.value,this])}else{this.setClean();this.fireEvent("clean",[this.value,this])}},hasFocus:function(){return this._focus},JSON:function(a){this.populate(a)},populate:function(){},getLabel:function(){return this.label},getValue:function(){console.warn("Use of deprecated getValue");console.trace();return this.els.formEl?this.els.formEl.val():this.value},val:function(a){if(arguments.length==0){return this._get()}this._set(a)},_get:function(){return this.els.formEl?this.els.formEl.val():this.value},_set:function(a){if(a==this.value){return a}this.setFormElValue(a);this.value=a;this.validate();if(this.wasValid){this.fireEvent("valueChange",[this._get(),this]);if(this.stateful){this.fireEvent("state")}if(this.linkWith){this.updateLinked()}}this.fireEvent("value",a);return a},setValue:function(a){console.warn("Use of deprecated setValue");console.trace();return this._set(a)},setFormElValue:function(a){if(this.els.formEl&&this.els.formEl.val()!==a){this.els.formEl.val(a);if(this.inlineLabel){this.els.formEl.removeClass("ludo-form-el-inline-label")}}},getFormEl:function(){return this.els.formEl},isValid:function(){if(this.validators.length===0){return true}var b=this.getFormEl()?this.getValueOfFormEl().trim():this.value;for(var a=0;a<this.validators.length;a++){if(!this.validators[a].fn.apply(this,[b,this[this.validators[a].key],this])){return false}}return true},clearInvalid:function(){this.getEl().removeClass("ludo-form-el-invalid")},wasValid:true,validate:function(){this.clearInvalid();if(this.isValid()){this.wasValid=true;this.fireEvent("valid",[this.value,this]);return true}else{this.wasValid=false;this.fireEvent("invalid",[this.value,this]);return false}},isFormElement:function(){return true},rollback:function(){this.reset()},reset:function(){this._set(this.initialValue)
},clear:function(){this._set(this.constructorValue)},commit:function(){if(!this.isReady){this.commit.delay(100,this);return}this.initialValue=this.value},isDirty:function(){return this.dirtyFlag},setDirty:function(){this.dirtyFlag=true;this.getEl().addClass("ludo-form-el-dirty")},setClean:function(){this.dirtyFlag=false;var a=this.getEl();if(a){a.removeClass("ludo-form-el-dirty")}},setReady:function(){this.isReady=true;var a=this.value;this.value=undefined;if(a){this._set(a)}},updateLinked:function(){var a=this.getLinkWith();if(a&&a.value!==this.value){a._set(this.value)}},setLinkWith:function(a){this.linkWith=a;this.addEvent("valueChange",this.updateLinked.bind(this))},createBackLink:function(a){a=a||0;var b=this.getLinkWith();if(b&&!b.linkWith){if(this.value===undefined){this.initialValue=this.constructorValue=b.value;this._set(b.value)}b.setLinkWith(this)}else{if(a<100){this.createBackLink.delay(50,this,a+1)}}},addInput:function(){if(!this.inputTag){return}this.els.inputCell=jQuery('<div class="input-cell"></div>');this.$b().append(this.els.inputCell);this.els.formEl=jQuery("<"+this.inputTag+">");if(this.inputType){this.els.formEl.attr("type",this.inputType)}if(this.maxLength){this.els.formEl.attr("maxlength",this.maxLength)}if(this.readonly){this.els.formEl.attr("readonly",true)}this.getInputCell().append(this.els.formEl);this.els.formEl.css("width","100%");this.els.formEl.attr("id",this.getFormElId())},getLinkWith:function(){var a=ludo.get(this.linkWith);return a?a:this.parentComponent?this.parentComponent.child[this.linkWith]:undefined},getInputCell:function(){return this.els.inputCell}});ludo.form.LabelElement=new Class({Extends:ludo.View,label:undefined,field:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["label","field"]);if(!this.label.type){this.label.type="form.Label"}this.label.labelFor=this.field.name;this.layout=this.layout||{};this.layout.type="linear";this.layout.orientation="horizontal"},__children:function(){return[this.label,this.field]},__rendered:function(){this.parent()}});ludo.form.Button=new Class({Extends:ludo.form.Element,type:"form.Button",defaultSubmit:false,inputType:"submit",cssSignature:"ludo-form-button",name:"",value:"",els:{el:null,txt:null},component:null,menu:undefined,submittable:false,toggle:false,toggleGroup:undefined,disableOnInvalid:false,disabled:false,selected:false,overflow:"hidden",icon:undefined,iconPressed:undefined,active:false,size:"m",iconWidths:{s:15,m:25,l:34,xl:44},heights:{s:15,m:25,l:35,xl:45},__construct:function(b){this.parent(b);var d=b.value||this.value;var a=d?d.length:5;this.layout.width=this.layout.width||Math.max(a*10,80);this.setConfigParams(b,["size","menu","icon","toggle","disableOnInvalid","defaultSubmit","disabled","selected","formView","iconPressed"]);if(b.toggleGroup!==undefined){if(ludo.util.type(b.toggleGroup)==="string"){b.toggleGroup={type:"form.ToggleGroup",id:"toggleGroup-"+b.toggleGroup}}b.toggleGroup.singleton=true;this.toggleGroup=ludo._new(b.toggleGroup);this.toggleGroup.addButton(this)}},ludoDOM:function(){this.parent();this.getEl().css("display",this.isHidden()?"none":"block");this.getEl().addClass("ludo-form-button-"+this.size);this.addLeftEdge();this.addRightEdge();this.addLabel();if(this.icon){this.addIcon()}var a=this.$b();a.css("padding-left",0);this.getEl().on("selectstart",ludo.util.cancelEvent)},ludoEvents:function(){this.parent();var a=this.$b();a.on("click",this.click.bind(this));a.mouseenter(this.mouseOver.bind(this));a.mouseleave(this.mouseOut.bind(this));a.on("mousedown",this.mouseDown.bind(this));this.mouseUpBound=this.mouseUp.bind(this);jQuery(document.body).on("mouseup",this.mouseUpBound);if(this.defaultSubmit){this.keyPressBound=this.keyPress.bind(this);jQuery(window).on("keypress",this.keyPressBound)}},__rendered:function(){this.parent();if(this.disabled){this.disable()}if(this.toggle&&this.active){this.$b().addClass("ludo-form-button-pressed")}this.component=this.getParentComponent();if(this.component&&this.disableOnInvalid){var a;if(this.formView!=undefined){a=ludo.get(this.formView)}else{a=this.component.getForm()}a.addEvent("valid",this.enable.bind(this));a.addEvent("invalid",this.disable.bind(this));if(!a.isValid()){this.disable()}}},remove:function(){this.parent();jQuery(document.body).off("mouseup",this.mouseUpBound);if(this.defaultSubmit){jQuery(window).off("keypress",this.keyPressBound)}},addLabel:function(){var a=this.els.txt=jQuery("<div>");a.addClass("ludo-form-button-value");a.css({width:"100%",height:this.heights[this.size]-2,position:"absolute",left:this.icon?this.iconWidths[this.size]+"px":"0px","text-align":this.icon?"left":"center","z-index":7});a.html(this.value);this.$b().append(a)},addIcon:function(){var a=this.els.icon=jQuery("<div>");a.css({position:"absolute",width:this.iconWidths[this.size],"z-index":8,left:0,top:0,height:"100%","background-image":"url("+this.icon+")","background-repeat":"no-repeat","background-position":"center center"});a.insertBefore(this.els.txt)
},setIcon:function(a){if(!this.els.icon){this.addIcon()}this.icon=a;this.els.icon.css("background-image","url("+a+")")},addLeftEdge:function(){var a=this.els.buttonLeftludo=jQuery("<div>");a.addClass("ludo-form-button-bg-left");a.addClass("ludo-form-button-"+this.size+"-bg-left");a.css({position:"absolute",left:0,"z-index":5});this.$b().append(a)},addRightEdge:function(){var a=jQuery("<div>");a.addClass("ludo-form-button-bg-right");a.addClass("ludo-form-button-"+this.size+"-bg-right");a.css({position:"absolute",right:0,"z-index":6});this.$b().append(a)},disable:function(){this.disabled=true;if(this.els.body){this.els.body.addClass("ludo-form-button-disabled");this.els.body.removeClass("ludo-form-button-over");this.els.body.removeClass("ludo-form-button-down")}},enable:function(){this.disabled=false;if(this.els.body){this.els.body.removeClass("ludo-form-button-disabled")}},isDisabled:function(){return this.disabled},setValue:function(a){console.warn("Use of deprecated setValue");console.trace();this.value=a;this.els.txt.html(a)},val:function(a){if(arguments.length!=0){this.value=a;this.els.txt.html(a)}else{return this.value}},getValue:function(){console.warn("Use of deprecated button.getValue");console.trace();return this.value},mouseOver:function(){if(!this.isDisabled()){this.$b().addClass("ludo-form-button-over");this.fireEvent("mouseover",this)}},mouseOut:function(){if(!this.isDisabled()){this.$b().removeClass("ludo-form-button-over");this.fireEvent("mouseout",this)}},isDown:false,mouseDown:function(){if(!this.isDisabled()){this.isDown=true;this.$b().addClass("ludo-form-button-down");this.fireEvent("mousedown",this);if(this.els.icon&&this.iconPressed){this.els.icon.css("background-image","url("+this.iconPressed+")")}}},mouseUp:function(){if(this.isDown&&!this.isDisabled()){this.$b().removeClass("ludo-form-button-down");this.fireEvent("mouseup",this)}if(this.els.icon&&this.icon){this.els.icon.css("background-image","url("+this.icon+")")}},clickAfterDelay:function(){this.click.delay(10,this)},click:function(){this.focus();if(!this.isDisabled()){this.getEl().focus();this.fireEvent("click",[this._get(),this]);if(this.toggle){if(!this.active){this.turnOn()}else{this.turnOff()}}return false}},getName:function(){return this.name},defaultBeforeClickEvent:function(){return true},isButton:function(){return true},borderSize:undefined,resizeDOM:function(){if(this.borderSize==undefined){this.borderSize=ludo.dom.getBH(this.$b())}this.$b().css("height",this.heights[this.size]-this.borderSize)},validate:function(){},getParentComponent:function(){var a=this.getParent();if(a&&a.type.indexOf("ButtonBar")>=0){return a.getView_250_40()}return a},select:function(){this.$b().addClass("ludo-form-button-selected")},deSelect:function(){this.$b().removeClass("ludo-form-button-selected")},turnOn:function(){this.active=true;this.fireEvent("on",[this._get(),this]);this.$b().addClass("ludo-form-button-pressed")},turnOff:function(){this.active=false;this.fireEvent("off",[this._get(),this]);this.$b().removeClass("ludo-form-button-pressed")},getToggleGroup:function(){return this.toggleGroup},isActive:function(){return this.active}});ludo.form.ToggleGroup=new Class({Extends:ludo.Core,type:"form.ToggleGroup",singleton:true,buttons:[],activeButton:undefined,__construct:function(a){this.parent(a)},addButton:function(a){this.buttons.push(a);a.addEvent("on",this.buttonClickEvent.bind(this));a.addEvent("off",this.buttonClickEvent.bind(this));if(a.isActive()){this.buttonClick(a)}},buttonClickEvent:function(b,a){this.buttonClick(a)},buttonClick:function(a){if(this.activeButton&&this.activeButton.isActive()){this.activeButton.turnOff()}if(a.isActive()){this.activeButton=a;this.fireEvent("on",[a.getValue(),a])}else{this.activeButton=undefined;this.fireEvent("off",[a.getValue(),a])}},turnOn:function(a){if(a=this.getButton(a)){a.turnOn()}},turnOff:function(a){if(a=this.getButton(a)){a.turnOff()}},getButton:function(b){if(ludo.util.type(b)==="String"){for(var a=0;a<this.buttons.length;a++){if(this.buttons[a].getValue()==b){return this.buttons[a]}}}return b},getValue:function(){return this.activeButton.getValue()}});ludo.form.Manager=new Class({Extends:ludo.Core,view:null,formComponents:[],map:{},fileUploadComponents:[],progressBar:undefined,invalidIds:[],dirtyIds:[],hiddenFields:undefined,hiddenValues:undefined,method:"post",url:undefined,currentId:undefined,autoLoad:false,listeners:undefined,configs:undefined,__construct:function(a){this.view=a.view;a.form=a.form||{};this.setConfigParams(a.form,["method","url","hiddenFields"]);this.hiddenValues={};this.configs={};this.configs.submit=a.form.submit||{};this.configs.read=a.form.read||{};this.addTypeEvents("submit");this.addTypeEvents("read");this.id=String.uniqueID();if(a.form.listeners!==undefined){this.addEvents(a.form.listeners)}this.getFormElements();if(this.configs.read.autoload){this.read()}},addTypeEvents:function(a){if(this.configs[a].listeners!=undefined){jQuery.each(this.configs[a].listeners,function(b,d){this.on(a+"."+b,d)
}.bind(this))}},getFormElements:function(){if(!this.view.isRendered){this.getFormElements.delay(100,this);return}var d=this.view.getAllChildren();d.push(this.view);var f;for(var b=0,a=d.length;b<a;b++){f=d[b];if(f.getProgressBarId!==undefined){this.registerProgressBar(f)}else{if(f.isFormElement()&&f.submittable){this.registerFormElement(f)}}}this.fireEvent((this.invalidIds.length==0)?"valid":"invalid",this);this.fireEvent((this.dirtyIds.length==0)?"clean":"dirty",this)},registerFormElement:function(a){if(this.formComponents.indexOf(a)>=0){return}this.map[a.name]=a;if(this.record&&this.record[a.name]){a.val(this.record[a.name])}if(a.isFileUploadComponent){this.fileUploadComponents.push(a)}this.formComponents.push(a);a.addEvents({valid:this.onValid.bind(this),invalid:this.onInvalid.bind(this),dirty:this.onDirty.bind(this),clean:this.onClean.bind(this),change:this.onChange.bind(this)});if(!a.isValid()){this.invalidIds.push(a.getId())}if(a.isDirty()){this.dirtyIds.push(a.getId())}},populate:function(a){jQuery.each(a,this.set.bind(this))},set:function(a,b){if(this.map[a]){this.map[a].val(b)}else{if(this.hiddenFields!=undefined&&this.hiddenFields.indexOf(a)!=-1){this.hiddenValues[a]=b}}},val:function(a,b){if(arguments.length==2){this.set(a,b)}return this.get(a)},values:function(){var a={};for(var b=0;b<this.formComponents.length;b++){var d=this.formComponents[b];a[d.getName()]=d.val()}return a},get:function(a){return this.map[a]?this.map[a].val():this.hiddenValues[a]!=undefined?this.hiddenValues[a]:undefined},registerProgressBar:function(a){if(!this.progressBar){this.progressBar=a}},onDirty:function(b,d){var a=d.getId();if(this.dirtyIds.indexOf(a)==-1){this.dirtyIds.push(a)}this.fireEvent("dirty",this.eventArguments(d))},onClean:function(a,b){this.dirtyIds.erase(b.getId());if(this.dirtyIds.length===0){this.fireEvent("clean")}},onChange:function(a,b){this.fireEvent("change",this.eventArguments(b))},eventArguments:function(a){var d=a?a.name:undefined;var b=a?a.val():undefined;return[d,b,this,a]},onValid:function(a,b){this.invalidIds.erase(b.getId());if(this.invalidIds.length==0){this.fireEvent("valid",this)}},onInvalid:function(b,d){var a=d.getId();if(this.invalidIds.indexOf(a)==-1){this.invalidIds.push(a)}this.fireEvent("invalid",this.eventArguments(d))},validate:function(){if(this.invalidIds.length>0){this.fireEvent("invalid",this)}else{this.fireEvent("valid",this)}},isValid:function(){return this.invalidIds.length===0},submit:function(){this.save()},getUnfinishedFileUploadComponent:function(){for(var a=0;a<this.fileUploadComponents.length;a++){if(this.fileUploadComponents[a].hasFileToUpload()){this.fileUploadComponents[a].addEvent("submit",this.save.bind(this));return this.fileUploadComponents[a]}}return undefined},getUrl:function(a){if(this.configs[a]&&this.configs[a].url){return this.configs[a].url}return this.url},dataFor:function(b){var d=this.configs[b]&&this.configs[b].keys?this.configs[b].keys:undefined;var f;if(d==undefined){f=this.values()}else{f={};for(var a=0;a<d.length;a++){f[d[a]]=this.get(d[a])}}return Object.merge(f,this.configDataFor(b))},configDataFor:function(a){return this.configs[a]&&this.configs[a].data?this.configs[a].data:{}},methodFor:function(a){return this.configs[a]&&this.configs[a].method?this.configs[a].method:this.method},save:function(){var a=this.getUrl("submit");if(a){var b;if(b=this.getUnfinishedFileUploadComponent()){b.upload();return}this.fireEvent("invalid");this.fireEvent("submit.init",this);this.beforeRequest();jQuery.ajax({url:a,method:this.methodFor("submit"),cache:false,dataType:"json",data:this.dataFor("submit"),success:function(d){this.fireEvent("submit.success",[d,this])}.bind(this),fail:function(f,d){this.fireEvent("submit.fail",[f,d,this])}.bind(this)})}},read:function(){this.fireEvent("read.init",this);this.beforeRequest();var a=this.getUrl("read");if(a!=undefined){jQuery.ajax({url:a,method:this.methodFor("read"),cache:false,dataType:"json",data:this.dataFor("read"),success:function(b){if(this.configs.read.populate){this.clear();this.populate(b);this.commit()}this.fireEvent("read.success",[b,this])}.bind(this),fail:function(d,b){this.fireEvent("read.fail",[d,b,this])}.bind(this)})}},afterRequest:function(){this.fireEvent("afterRequest")},beforeRequest:function(){this.fireEvent("beforeRequest")},getProgressBarId:function(){return this.progressBar?this.progressBar.getProgressBarId():undefined},commit:function(){for(var a=0;a<this.formComponents.length;a++){this.formComponents[a].commit()}},rollback:function(){this.reset()},reset:function(){for(var a=0;a<this.formComponents.length;a++){this.formComponents[a].reset()}this.dirtyIds=[];this.fireEvent("clean",this);this.fireEvent("reset",this)},newRecord:function(){this.fireEvent("new");this.currentId=undefined;this.clear()},clear:function(){for(var a=0;a<this.formComponents.length;a++){this.formComponents[a].clear()}this.dirtyIds=[];this.fireEvent("clean");this.fireEvent("clear")},isDirty:function(){return this.dirtyIds.length>0
}});ludo.form.SubmitButton=new Class({Extends:ludo.form.Button,type:"form.SubmitButton",value:"Submit",disableOnInvalid:true,applyTo:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["applyTo"])},__rendered:function(){this.parent();this.applyTo=this.applyTo?ludo.get(this.applyTo):this.getParentComponent();if(this.applyTo){var a=this.applyTo.getForm();a.addEvent("valid",this.enable.bind(this));a.addEvent("invalid",this.disable.bind(this));a.addEvent("clean",this.disable.bind(this));a.addEvent("dirty",this.enable.bind(this));this.checkValidity.delay(100,this)}this.addEvent("click",this.submit.bind(this))},checkValidity:function(){if(this.applyTo.getForm().isValid()){this.enable()}else{this.disable()}},submit:function(){if(this.applyTo){this.applyTo.getForm().submit()}}});ludo.form.CancelButton=new Class({Extends:ludo.form.Button,type:"form.CancelButton",value:"Cancel",applyTo:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["applyTo"])},__rendered:function(){this.parent();this.applyTo=this.applyTo?ludo.get(this.applyTo):this.getParentComponent();this.addEvent("click",this.hideComponent.bind(this))},hideComponent:function(){if(this.applyTo){this.applyTo.hide()}}});ludo.form.Text=new Class({Extends:ludo.form.Element,type:"form.Text",labelWidth:100,defaultValue:"",placeholder:"",maxLength:undefined,minLength:undefined,ucFirst:false,ucWords:false,inputType:"text",inputTag:"input",regex:undefined,validateKeyStrokes:false,formFieldWidth:undefined,readonly:false,selectOnFocus:false,autoComplete:true,__construct:function(b){this.parent(b);var d=["placeholder","selectOnFocus","regex","minLength","maxLength","defaultValue","autoComplete","validateKeyStrokes","ucFirst","ucWords","readonly"];this.setConfigParams(b,d);if(this.regex&&ludo.util.isString(this.regex)){var f=this.regex.split(/\//g);var a=f.length>1?f.pop():"";this.regex=new RegExp(f.join("/"),a)}this.applyValidatorFns(["minLength","maxLength","regex"]);if(this.layout.height==undefined){this.layout.height="wrap"}},ludoDOM:function(){this.parent();if(this.placeholder){this.getFormEl().attr("placeholder",this.placeholder)}if(!this.autoComplete){this.getFormEl().attr("x-autocompletetype",String.uniqueID());this.getFormEl().attr("autocomplete","false")}},ludoEvents:function(){this.parent();var a=this.getFormEl();if(this.ucFirst||this.ucWords){this.addEvent("blur",this.upperCaseWords.bind(this))}this.addEvent("blur",this.validate.bind(this));if(this.validateKeyStrokes){a.on("keydown",this.validateKey.bind(this))}a.parent().addClass("ludo-form-text-element");a.on("keyup",this.sendKeyEvent.bind(this));if(this.selectOnFocus){a.on("focus",this.selectText.bind(this))}},sendKeyEvent:function(){this.fireEvent("key",this.els.formEl.val())},validateKey:function(a){if(!a.control&&!a.alt&&this.regex&&a.key&&a.key.length==1){if(!this.regex.test(a.key)){return false}}return undefined},getFieldWidth:function(){return this.formFieldWidth},focus:function(){this.parent();if(!this.getFormEl().is(":focus")){this.getFormEl().focus()}},validate:function(){var a=this.parent();if(!a&&!this._focus){this.getEl().addClass("ludo-form-el-invalid")}return a},keyUp:function(a){this.parent(a);if(this.validateKeyStrokes){this.validate()}},upperCaseWords:function(){if(this.ucFirst||this.ucWords){var d=this.getValueOfFormEl();if(d.length==0){return}if(this.ucWords&&d.length>1){var b=d.split(/\s/g);for(var a=0;a<b.length;a++){if(b[a].length==1){b[a]=b[a].toUpperCase()}else{b[a]=b[a].substr(0,1).toUpperCase()+b[a].substr(1)}}this.getFormEl().val(b.join(" "))}else{d=d.substr(0,1).toUpperCase()+d.substr(1);this.getFormEl().val(d)}}},hasSelection:function(){var b=this.getSelectionStart();var a=this.getSelectionEnd();return a>b},select:function(){this.getFormEl().select()},selectText:function(){this.select()},getSelectionStart:function(){if(this.els.formEl.createTextRange){var a=document.selection.createRange().duplicate();a.moveEnd("character",this.els.formEl.val().length);if(a.text==""){return this.els.formEl.val().length}return this.els.formEl.val().lastIndexOf(a.text)}else{return this.els.formEl.selectionStart}},getSelectionEnd:function(){if(this.els.formEl.createTextRange){var a=document.selection.createRange().duplicate();a.moveStart("character",-this.els.formEl.val().length);return a.text.length}else{return this.els.formEl.selectionEnd}}});ludo.form.Combo=new Class({Extends:ludo.form.Text,type:"form.Combo",layout:{type:"popup"},menuButton:undefined,childLayout:undefined,__construct:function(a){this.parent(a);this.childLayout=a.childLayout||this.childLayout},__rendered:function(){this.parent();ludo.Form.addEvent("focus",this.autoHide.bind(this));var a=this.children[0];a.layout=a.layout||{};if(this.childLayout){a.layout=Object.merge(a.layout,this.childLayout)}a.layout.below=a.layout.below||this.$b();if(a.left===undefined){a.layout.alignLeft=a.layout.alignLeft||this.$b()}if(!a.layout.width){a.layout.sameWidthAs=a.layout.sameWidthAs||this.$b()}a.layout.height=a.layout.height||200;
a.alwaysInFront=true;a.cls=a.cls?a.cls+" form-combo-child":"form-combo-child";this.createDependency("menuButton",new ludo.menu.Button({type:"menu.Button",renderTo:this.getInputCell(),alwaysVisible:true,region:"ne",autoPosition:false,menu:this.children[0],toggleOnClick:true,listeners:{show:function(){this.fireEvent("showCombo");this.children[0].getLayout().getRenderer().resize()}.bind(this)}}));this.children[0].addEvent("show",this.focus.bind(this))},autoHide:function(a){if(a.isButton&&a.isButton()){return}if(a!==this&&!a.isChildOf(this.children[0])){this.children[0].hide()}},hideMenu:function(){this.children[0].hide()}});ludo.form.Date=new Class({Extends:ludo.form.Combo,children:[{type:"calendar.Calendar"}],displayFormat:"Y-m-d",inputFormat:"Y-m-d",childLayout:{width:250,height:250},__construct:function(a){this.parent(a);this.setConfigParams(a,["displayFormat","inputFormat"]);this.displayFormat=this.displayFormat.replace(/([a-z])/gi,"%$1");this.inputFormat=this.inputFormat.replace(/([a-z])/gi,"%$1");this.value=this.value?ludo.util.parseDate(this.value,this.inputFormat):undefined;this.initialValue=this.constructorValue=this.value},__rendered:function(){this.parent();this.setFormElValue(this.value)},addChild:function(a){a.value=this.value||new Date();this.parent(a);this.children[0].addEvent("change",function(b){this._set(ludo.util.parseDate(b,this.inputFormat));this.blur()}.bind(this))},ludoEvents:function(){this.parent();this.addEvent("showCombo",function(){this.children[0].setDate(this.value?ludo.util.parseDate(this.value,this.displayFormat):new Date())}.bind(this))},setValue:function(a){console.warn("Use of deprecated setValue");console.trace();a=a?ludo.util.parseDate(a,this.displayFormat):a;if(a&&a.getYear&&isNaN(a.getYear())){a=undefined}this.parent(a)},getValue:function(){console.warn("Use of deprecated getValue");console.trace();return this.value?ludo.util.parseDate(this.value,this.displayFormat).format(this.inputFormat):undefined},val:function(a){if(arguments.length==0){return this.value?ludo.util.parseDate(this.value,this.displayFormat).format(this.inputFormat):undefined}this._set(a)},_set:function(a){a=a?ludo.util.parseDate(a,this.displayFormat):a;if(a&&a.getYear&&isNaN(a.getYear())){a=undefined}this.parent(a)},setFormElValue:function(a){if(this.els.formEl&&this.els.formEl.val()!==a){a=a?ludo.util.isString(a)?a:a.format(this.displayFormat):"";this.els.formEl.val(a)}this.children[0].hide()}});ludo.form.Color=new Class({Extends:ludo.form.Combo,regex:/^#[0-9A-F]{6}$/i,childLayout:{width:290,height:250},__children:function(){return[{layout:{type:"tabs"},cls:"ludo-tabs-in-dropdown",bodyCls:"ludo-tabs-in-dropdown-body",children:[{title:ludo.language.get("RGB"),type:"color.RgbColors",name:"rgbColors",value:this.value,listeners:{setColor:this.receiveColor.bind(this),render:this.setInitialWidgetValue.bind(this)}},{title:ludo.language.get("Named Colors"),type:"color.NamedColors",name:"boxes",value:this.value,listeners:{setColor:this.receiveColor.bind(this),render:this.setInitialWidgetValue.bind(this)}}]}]},setInitialWidgetValue:function(a){a.setColor(this.value)},ludoEvents:function(){this.parent();this.addEvent("change",this.updateWidgets.bind(this))},updateWidgets:function(){var b=this.getColorWidgets();for(var a=0;a<b.length;a++){if(b[a].setColor){b[a].setColor(this.value)}}},receiveColor:function(a){this.val(a);this.hideMenu()},getColorWidgets:function(){return this.children[0].children}});ludo.form.ResetButton=new Class({Extends:ludo.form.Button,value:"Reset",applyTo:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["applyTo"])},__rendered:function(){this.parent();this.applyTo=this.applyTo?ludo.$(this.applyTo):this.getParentComponent();var a=this.applyTo.getForm();if(this.applyTo){a.addEvent("dirty",this.enable.bind(this));a.addEvent("clean",this.disable.bind(this))}if(!a.isDirty()){this.disable()}this.addEvent("click",this.reset.bind(this))},reset:function(){if(this.applyTo){this.applyTo.getForm().reset()}}});ludo.form.ComboTree=new Class({Extends:ludo.form.Element,type:"form.ComboTree",cssSignature:"form-combo",treeConfig:undefined,emptyText:"",width:400,height:26,inputConfig:{fieldWidth:440,labelWidth:1,width:350},selectedRecord:undefined,layout:{type:"cols"},treePanel:undefined,input:undefined,searchable:false,timeStamp:0,currentSearchValue:"",__construct:function(a){this.parent(a);this.setConfigParams(a,["searchable","inputConfig","treeConfig","emptyText"]);if(this.treeConfig.type===undefined){this.treeConfig.type="tree.Tree"}this.inputConfig.type="form.Text";this.inputConfig.stretchField=true},ludoEvents:function(){this.parent();jQuery(document.body).on("mousedown",this.autoHide.bind(this))},ludoDOM:function(){if(this.label){this.addChild({html:"<label>"+this.label+":</label>",width:this.labelWidth})}this.viewField=this.addChild({type:"form.ComboField",weight:1});this.viewField.addEvent("click",this.showTree.bind(this));this.input=this.addChild(this.inputConfig);this.input.addEvent("focus",this.showTree.bind(this));
this.input.addEvent("focus",this.selectInputText.bind(this));this.input.addEvent("blur",this.blurInput.bind(this));this.input.addEvent("key_up",this.filter.bind(this));this.input.addEvent("key_down",this.keyDown.bind(this));this.input.hide();this.treePanel=new ludo.Window({cls:"ludo-Filter-Tree-Window",width:this.treeConfig.width,alwaysInFront:true,resizeTop:false,resizeLeft:false,minWidth:this.fieldWidth,height:this.treeConfig.height,titleBar:false,renderTo:document.body,layout:"fill",children:[this.treeConfig]});this.treePanel.hide();this.treePanel.addEvent("beforeresize",this.setBusy.bind(this));this.treePanel.addEvent("afterresize",this.setNotBusy.bind(this));this.treePanel.children[0].getDataSource().addEvent("select",this.receiveSelectedRecord.bind(this));this.parent();this.getEl().addClass("ludo-filter-tree");this.resize.delay(100,this);this.resizeChildren()},__rendered:function(){this.parent();if(this.emptyText){this.setViewValue(this.emptyText)}},busyWithResize:false,setBusy:function(){this.busyWithResize=true},setNotBusy:function(){this.setNotBusyAfterDelay.delay(500,this)},setNotBusyAfterDelay:function(){this.busyWithResize=false},arrowClick:function(){if(this.treePanel.isHidden()){this.selectInputText();this.showTree()}else{this.hideTree()}},selectInputText:function(){this.input.getFormEl().select()},blurInput:function(){this.input.getFormEl().removeClass("ludo-filter-tree-input-active")},autoHide:function(d){if(this.busyWithResize){return}if(!this.treePanel.isVisible()){return}var a=d.target;if(a.id==this.input.getFormEl().id||a.hasClass("ludo-shim-resize")){return}var b=this.viewField.getEl();if(a.id==b.id||a.getParent("#"+b.id)){return}if(a.getParent(".ludo-shim-resize")){return}if(!a.getParent("#"+this.input.getFormEl().id)&&!a.getParent("#"+this.treePanel.id)){this.hideTree()}},hideTree:function(){this.treePanel.hide();if(this.searchable){this.input.hide();this.viewField.show()}},keyDown:function(a){if(a==="esc"||a=="tab"){this.hideTree()}},filter:function(a){if(a==="esc"){return}this.treePanel.show();var f=this.input._get();if(f==this.currentSearchValue){return}var b=new Date();this.timeStamp=b.getTime();this.filterAfterDelay(this.input._get());this.currentSearchValue=f},filterAfterDelay:function(b){var a=new Date();if(a.getTime()-this.timeStamp<200){this.filterAfterDelay.delay(100,this,b);return}this.timeStamp=a.getTime();if(b==this.input._get()){this.treePanel.children[0].filter(this.input.val())}},showTree:function(){if(this.searchable){this.viewField.hide();this.input.show();this.input.getFormEl().addClass("ludo-filter-tree-input-active");this.input.getFormEl().focus()}this.treePanel.show();this.positionTree();this.resizeChildren();this.treePanel.increaseZIndex()},setViewValue:function(a){this.input.val(a);this.viewField.setViewValue(a)},positionTree:function(){var a;if(this.searchable){a=this.input.getEl()}else{a=this.viewField.getEl()}var b=a.getCoordinates();this.treePanel.setPosition({left:b.left,top:b.top+a.getSize().y})},getFormEl:function(){return this.input.getFormEl()},selectRecord:function(a){this.treePanel.children[0].selectRecord(a)},receiveSelectedRecord:function(a){this.val(a.get("id"));this.setViewValue(a.get("title"));this.fireEvent("selectrecord",[this,a.getData()]);this.hideTree.delay(100,this)},val:function(a){if(arguments.length==0){return this.value}this.parent(a)},getValue:function(){console.warn("Use of deprecated getValue");console.trace();return this.value},getSelectedRecord:function(){return this.treePanel.children[0].getSelectedRecord()},getParentRecord:function(a){return this.treePanel.children[0].getParentRecord(a)}});ludo.form.ComboField=new Class({Extends:ludo.View,cls:"ludo-Filter-Tree-Combo-Field",ludoEvents:function(){this.parent();this.$b().on("click",this.clickEvent.bind(this))},clickEvent:function(){this.fireEvent("click")},setViewValue:function(a){this.els.valueField.html(a)},ludoDOM:function(){this.parent();var d=jQuery("<div>");d.addClass("ludo-Filter-Tree-Field-Arrow");this.$b().append(d);var f=jQuery("<div>");f.addClass("ludo-Filter-Tree-Bg-Left");this.$b().append(f);var b=jQuery("<div>");b.addClass("ludo-Filter-Tree-Bg-Right");this.$b().append(b);var a=this.els.valueField=jQuery("<div>");a.addClass("ludo-Filter-Tree-Combo-Value");this.$b().append(a)}});ludo.form.Label=new Class({Extends:ludo.View,labelFor:undefined,label:undefined,type:"form.Label",__construct:function(a){this.parent(a);this.setConfigParams(a,["label","labelFor"])},ludoDOM:function(){this.parent();this.els.label=jQuery('<label class="input-label" for="el-'+this.labelFor+'">'+this.label+"</label>");this.$b().append(this.els.label)},ludoEvents:function(){this.parent();this.addInvalidEvents.delay(40,this)},addInvalidEvents:function(){if(!this.labelFor){return}var a=ludo.get(this.labelFor);if(a){a.addEvent("valid",this.onValid.bind(this));a.addEvent("invalid",this.onInvalid.bind(this));a.addEvent("enable",this.onEnable.bind(this));a.addEvent("disable",this.onDisable.bind(this));if(!a.isValid()){this.onInvalid()
}}},resizeDOM:function(){this.parent();this.els.label.css("line-height",this.$b().height()+"px")},onEnable:function(){this.$b().removeClass("ludo-form-label-disabled")},onDisable:function(){this.$b().addClass("ludo-form-label-disabled")},onValid:function(){this.$b().removeClass("ludo-form-el-invalid")},onInvalid:function(){this.$b().removeClass("ludo-form-el-invalid");this.$b().addClass("ludo-form-el-invalid")}});ludo.form.Textarea=new Class({Extends:ludo.form.Text,type:"form.Textarea",inputType:undefined,inputTag:"textarea",overflow:"hidden",__construct:function(a){this.parent(a);this.ucWords=false},__rendered:function(){this.parent();this.els.formEl.css({paddingRight:0,paddingTop:0})},offX:undefined,offY:undefined,resizeDOM:function(){this.parent();if(this.offX==undefined){this.offX=(this.els.formEl.outerWidth()-this.els.formEl.width())+(this.getInputCell().outerWidth()-this.getInputCell().width());this.offY=(this.els.formEl.outerWidth()-this.els.formEl.width())+(this.getInputCell().outerHeight()-this.getInputCell().height())}this.els.formEl.css("width",this.$b().width()-this.offX);this.els.formEl.css("height",this.$b().height()-this.offY-2)}});ludo.form.DisplayField=new Class({Extends:ludo.form.Element,type:"form.DisplayField",inputTag:"span",inputType:"",tpl:"",setValue:function(a){console.warn("Use of deprecated setValue");console.trace();if(!a){this.getFormEl().html("");return}this.setTextContent(a)},val:function(a){if(arguments.length==0){return this._get()}if(a.length==0){this.getFormEl().html("");return}this.setTextContent(a)},__rendered:function(){this.parent();this.setTextContent(this.value)},setTextContent:function(b){var a=this.tpl?this.getTplParser().getCompiled({value:b}):b?b:"";this.getFormEl().html(a)},isValid:function(){return true},getValue:function(){return this.value},supportsInlineLabel:function(){return false}});ludo.form.Checkbox=new Class({Extends:ludo.form.Element,type:"form.Checkbox",inputTag:"input",inputType:"checkbox",stretchField:false,labelWidth:undefined,image:undefined,checked:false,height:undefined,labelSuffix:"",__construct:function(a){a=a||{};a.value=a.value||"1";this.parent(a);this.setConfigParams(a,["inputType","image","checked"]);this.initialValue=this.constructorValue=this.checked?this.value:""},ludoDOM:function(){this.parent();if(this.image){this.addRadioImage()}},addInput:function(){this.parent();this.els.formEl.on("click",this.toggleImage.bind(this));if(this.inputType==="checkbox"){this.els.formEl.on("click",this.valueChange.bind(this))}if(this.checked){this.getFormEl().prop("checked",true);this.toggleImage()}},addRadioImage:function(){var b=this.els.radioImageDiv=jQuery("<div>");var a=jQuery("<div>");a.addClass("ludo-radio-image-inner");a.setStyles({width:"100%",height:"100%",background:"url("+this.image+") no-repeat center center"});b.append(a);b.addClass("ludo-radio-image");b.addEvent("click",this.clickOnImage.bind(this));this.getImageCell().append(b);this.$b().getElement(".checkbox-image-row").style.display=""},getImageCell:function(){return this.getCell(".input-image","imageCell")},setWidthOfLabel:function(){},clickOnImage:function(){if(this.inputType==="checkbox"){this.setChecked(!this.isChecked())}else{this.check()}},isChecked:function(){return this.getFormEl().prop("checked")?true:false},check:function(){if(!this.isChecked()){this.setChecked(true)}},uncheck:function(){if(this.isChecked()){this.setChecked(false)}},focus:function(){},blur:function(){},getValue:function(){console.warn("Use of deprecated getValue");console.trace();return this.isChecked()?this.getFormEl().val():""},_get:function(){return this.isChecked()?this.getFormEl().val():""},setChecked:function(a){this.setCheckedProperty(a);this.fireEvent("change",[this._get(),this]);this.value=this._get();this.toggleImage();this.toggleDirtyFlag()},setCheckedProperty:function(a){if(a){this.getFormEl().prop("checked",true)}else{this.getFormEl().prop("checked",false)}},valueChange:function(){this.value=this.isChecked()?this.getFormEl().val():"";this.toggleDirtyFlag()},reset:function(){this.setCheckedProperty(this.initialValue?true:false);this.fireEvent("valueChange",[this._get(),this]);this.toggleImage()},toggleImage:function(){if(this.els.radioImageDiv){if(this.isChecked()){this.els.radioImageDiv.addClass("ludo-radio-image-checked")}else{this.els.radioImageDiv.removeClass("ludo-radio-image-checked")}}},supportsInlineLabel:function(){return false}});ludo.form.Radio=new Class({Extends:ludo.form.Checkbox,type:"form.Radio",inputType:"radio",getFormElId:function(){return this.elementId+"_"+this.value.replace(/[^0-9a-z]/g,"")}});if(typeof faultylabs=="undefined"){faultylabs={}}faultylabs.MD5=function(k){function d(v){var u=(v>>>0).toString(16);return"00000000".substr(0,8-u.length)+u}function b(w){var u=[];for(var v=0;v<w.length;v++){u=u.concat(r(w[v]))}return u}function t(v){var u=[];for(var w=0;w<8;w++){u.push(v&255);v=v>>>8}return u}function n(v,u){return((v<<u)&4294967295)|(v>>>(32-u))}function o(u,w,v){return(u&w)|(~u&v)
}function l(u,w,v){return(v&u)|(~v&w)}function g(u,w,v){return u^w^v}function f(u,w,v){return w^(u|~v)}function q(u,v){return(u[v+3]<<24)|(u[v+2]<<16)|(u[v+1]<<8)|(u[v])}function r(y){var u=[];for(var x=0;x<y.length;x++){if(y.charCodeAt(x)<=127){u.push(y.charCodeAt(x))}else{var w=encodeURIComponent(y.charAt(x)).substr(1).split("%");for(var v=0;v<w.length;v++){u.push(parseInt(w[v],16))}}}return u}function s(v,u,B,A){var z="";var y=0;var w=0;for(var x=3;x>=0;x--){w=arguments[x];y=(w&255);w=w>>>8;y=y<<8;y=y|(w&255);w=w>>>8;y=y<<8;y=y|(w&255);w=w>>>8;y=y<<8;y=y|w;z=z+d(y)}return z}function m(w){var u=new Array(w.length);for(var v=0;v<w.length;v++){u[v]=w[v]}return u}var j=null;var p=null;if(typeof k=="string"){j=r(k)}else{if(k.constructor==Array){if(k.length===0){j=k}else{if(typeof k[0]=="string"){j=b(k)}else{if(typeof k[0]=="number"){j=k}else{p=typeof k[0]}}}}else{if(typeof ArrayBuffer!="undefined"){if(k instanceof ArrayBuffer){j=m(new Uint8Array(k))}else{if((k instanceof Uint8Array)||(k instanceof Int8Array)){j=m(k)}else{if((k instanceof Uint32Array)||(k instanceof Int32Array)||(k instanceof Uint16Array)||(k instanceof Int16Array)||(k instanceof Float32Array)||(k instanceof Float64Array)){j=m(new Uint8Array(k.buffer))}else{p=typeof k}}}}else{p=typeof k}}}if(p){alert("MD5 type mismatch, cannot process "+p)}function a(v,u){return 4294967295&(v+u)}return h();function h(){function x(K,L,I,H){var J=A;A=C;C=E;E=a(E,n(a(G,a(K,a(L,I))),H));G=J}var v=j.length;j.push(128);var y=j.length%64;if(y>56){for(var w=0;w<(64-y);w++){j.push(0)}y=j.length%64}for(w=0;w<(56-y);w++){j.push(0)}j=j.concat(t(v*8));var F=1732584193;var D=4023233417;var B=2562383102;var z=271733878;var G=0,E=0,C=0,A=0;for(w=0;w<j.length/64;w++){G=F;E=D;C=B;A=z;var u=w*64;x(o(E,C,A),3614090360,q(j,u),7);x(o(E,C,A),3905402710,q(j,u+4),12);x(o(E,C,A),606105819,q(j,u+8),17);x(o(E,C,A),3250441966,q(j,u+12),22);x(o(E,C,A),4118548399,q(j,u+16),7);x(o(E,C,A),1200080426,q(j,u+20),12);x(o(E,C,A),2821735955,q(j,u+24),17);x(o(E,C,A),4249261313,q(j,u+28),22);x(o(E,C,A),1770035416,q(j,u+32),7);x(o(E,C,A),2336552879,q(j,u+36),12);x(o(E,C,A),4294925233,q(j,u+40),17);x(o(E,C,A),2304563134,q(j,u+44),22);x(o(E,C,A),1804603682,q(j,u+48),7);x(o(E,C,A),4254626195,q(j,u+52),12);x(o(E,C,A),2792965006,q(j,u+56),17);x(o(E,C,A),1236535329,q(j,u+60),22);x(l(E,C,A),4129170786,q(j,u+4),5);x(l(E,C,A),3225465664,q(j,u+24),9);x(l(E,C,A),643717713,q(j,u+44),14);x(l(E,C,A),3921069994,q(j,u),20);x(l(E,C,A),3593408605,q(j,u+20),5);x(l(E,C,A),38016083,q(j,u+40),9);x(l(E,C,A),3634488961,q(j,u+60),14);x(l(E,C,A),3889429448,q(j,u+16),20);x(l(E,C,A),568446438,q(j,u+36),5);x(l(E,C,A),3275163606,q(j,u+56),9);x(l(E,C,A),4107603335,q(j,u+12),14);x(l(E,C,A),1163531501,q(j,u+32),20);x(l(E,C,A),2850285829,q(j,u+52),5);x(l(E,C,A),4243563512,q(j,u+8),9);x(l(E,C,A),1735328473,q(j,u+28),14);x(l(E,C,A),2368359562,q(j,u+48),20);x(g(E,C,A),4294588738,q(j,u+20),4);x(g(E,C,A),2272392833,q(j,u+32),11);x(g(E,C,A),1839030562,q(j,u+44),16);x(g(E,C,A),4259657740,q(j,u+56),23);x(g(E,C,A),2763975236,q(j,u+4),4);x(g(E,C,A),1272893353,q(j,u+16),11);x(g(E,C,A),4139469664,q(j,u+28),16);x(g(E,C,A),3200236656,q(j,u+40),23);x(g(E,C,A),681279174,q(j,u+52),4);x(g(E,C,A),3936430074,q(j,u),11);x(g(E,C,A),3572445317,q(j,u+12),16);x(g(E,C,A),76029189,q(j,u+24),23);x(g(E,C,A),3654602809,q(j,u+36),4);x(g(E,C,A),3873151461,q(j,u+48),11);x(g(E,C,A),530742520,q(j,u+60),16);x(g(E,C,A),3299628645,q(j,u+8),23);x(f(E,C,A),4096336452,q(j,u),6);x(f(E,C,A),1126891415,q(j,u+28),10);x(f(E,C,A),2878612391,q(j,u+56),15);x(f(E,C,A),4237533241,q(j,u+20),21);x(f(E,C,A),1700485571,q(j,u+48),6);x(f(E,C,A),2399980690,q(j,u+12),10);x(f(E,C,A),4293915773,q(j,u+40),15);x(f(E,C,A),2240044497,q(j,u+4),21);x(f(E,C,A),1873313359,q(j,u+32),6);x(f(E,C,A),4264355552,q(j,u+60),10);x(f(E,C,A),2734768916,q(j,u+24),15);x(f(E,C,A),1309151649,q(j,u+52),21);x(f(E,C,A),4149444226,q(j,u+16),6);x(f(E,C,A),3174756917,q(j,u+44),10);x(f(E,C,A),718787259,q(j,u+8),15);x(f(E,C,A),3951481745,q(j,u+36),21);F=a(F,G);D=a(D,E);B=a(B,C);z=a(z,A)}return s(z,B,D,F).toUpperCase()}};ludo.form.Password=new Class({Extends:ludo.form.Text,type:"form.Password",inputType:"password",md5:false,__construct:function(a){this.parent(a);if(a.md5!==undefined){this.md5=a.md5}},getValue:function(){console.warn("Use of deprecated getValue");console.trace();return this._get()},_get:function(){var a=this.parent();if(a.length&&this.md5){return faultylabs.MD5(a)}return a},reset:function(){this._set("")}});ludo.form.StrongPassword=new Class({Extends:ludo.form.Password,regex:"(?=^.{_length_,}$)((?=.*[0-9])|(?=.*W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$",passwordLength:8,__construct:function(a){a=a||{};this.passwordLength=a.passwordLength||this.passwordLength;this.regex=new RegExp(this.regex.replace("_length_",this.passwordLength));this.parent(a)}});ludo.form.Number=new Class({Extends:ludo.form.Text,type:"form.Number",regex:/^[0-9]+$/,validateKeyStrokes:true,formCss:{"text-align":"right"},stretchField:false,disableWheel:false,reverseWheel:false,shiftIncrement:10,__construct:function(a){this.parent(a);
this.setConfigParams(a,["disableWheel","shiftIncrement","reverseWheel","minValue","maxValue"]);if(this.minValue!==undefined){this.minValue=parseInt(this.minValue)}if(this.maxValue!==undefined){this.maxValue=parseInt(this.maxValue)}this.applyValidatorFns(["minValue","maxValue"])},ludoEvents:function(){this.parent();if(!this.disableWheel){this.getFormEl().on("mousewheel",this._mouseWheel.bind(this))}this.getFormEl().on("keydown",this.keyIncrement.bind(this))},keyIncrement:function(a){if(a.key==="up"||a.key==="down"){if(a.key==="up"){this.incrementBy(1,a.shift)}if(a.key==="down"){this.incrementBy(-1,a.shift)}return false}return undefined},blur:function(){var a=this.getFormEl().val();if(!this.isValid(a)){if(this.minValue!==undefined&&parseInt(a)<this.minValue){a=this.minValue}if(this.maxValue!==undefined&&parseInt(a)>this.maxValue){a=this.maxValue}this._set(a)}this.parent()},setMinVal:function(a){this.minValue=a},setMaxValue:function(a){this.maxValue=a},_mouseWheel:function(a){var b=(a.originalEvent.wheelDelta||a.originalEvent.detail)/120;if(b==0){return}this.incrementBy(b>0?1:-1,a.shift);return false},incrementBy:function(b,a){if(!this.value){if(this.minValue){this._set(this.minValue);return}this._set(0)}if(this.reverseWheel){b=b*-1}b=parseInt(this.value)+(a?b*this.shiftIncrement:b);if(this.maxValue&&b>this.maxValue){b=this.maxValue}if(this.minValue!==undefined&&b<this.minValue){b=this.minValue}if(this.isValid(b)){this._set(b);this.fireEvent("change",[b,this])}},_get:function(){return parseFloat(this.parent())}});ludo.form.Email=new Class({Extends:ludo.form.Text,type:"form.Email",regex:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.(?:[A-Z]{2}|com|org|net|edu|gov|mil|biz|info|mobi|name|aero|asia|jobs|museum)$/i,validateKeyStrokes:false});ludo.form.Spinner=new Class({Extends:ludo.form.Number,type:"form.Spinner",inputTag:"input",inputType:"text",stretchField:false,regex:undefined,maxValue:100,minValue:0,increment:1,decimals:0,__construct:function(a){this.parent(a);this.setConfigParams(a,["increment","decimals"])},mode:{},__rendered:function(){this.parent();this.createSpinnerElements();if(!this.fieldWidth){this.getFormEl().css("width",(this.maxValue+"").length*15)}this._css();this._createEvents();this._clearMode();this.setSpinnerValue(this.value);this._setContainerSize()},createSpinnerElements:function(){this.createSpinnerContainer();var a=this.getFormEl();a.attr("maxlength",(this.maxValue+"").length);a.addClass("ludo-spinbox-input");var b=this.els.spinnerContainer;this.els.arrowsContainer=this._createContainer({cls:"ludo-spinbox-arrows-container",renderTo:b});this.els.upArrow=this._createContainer({cls:"ludo-spinbox-arrow-up",renderTo:this.els.arrowsContainer});this.els.downArrow=this._createContainer({cls:"ludo-spinbox-arrow-down",renderTo:this.els.arrowsContainer});this.els.arrowSeparator=this._createContainer({cls:"ludo-spinbox-arrow-separator",renderTo:this.els.arrowsContainer})},_clearMode:function(){this.mode={name:false,modeElement:null,shiftKey:false,timeout:false}},createSpinnerContainer:function(){var a=this.els.spinnerContainer=jQuery('<div class="ludo.spinbox-container"></div>');this.getFormEl().parent().append(a);a.append(this.getFormEl())},_createContainer:function(a){a=Object.merge({tag:"div",cls:""},a);var b=jQuery("<"+a.tag+">");b.addClass(a.cls);if(a.renderTo){a.renderTo.append(b)}return b},_css:function(){this.els.spinnerContainer.css("position","relative");this.getFormEl().css({border:"0px"});this.els.arrowsContainer.css({position:"absolute",top:"0px",height:"100%",right:"0px"});this.els.upArrow.css({position:"absolute","background-repeat":"no-repeat","background-position":"center center",height:" 50%",top:"0px"});this.els.downArrow.css({position:"absolute","background-repeat":"no-repeat","background-position":"center center",height:"50%",bottom:"0px"});this.els.arrowSeparator.css({position:"absolute",top:"50%"});this.els.spinnerContainer.css("width",this.fieldWidth)},_initNudge:function(a){this._startMode({name:"nudge",x:a.page.x,initValue:parseInt(this.getValue()),labelWidth:this.els.label.width()});return false},_nudge:function(g){if(this.mode.name=="nudge"){var b=g.page.x-this.mode.x;var a=(this.maxValue-this.minValue)/this.mode.labelWidth;var f=this.mode.initValue+(b*a);if(this.increment>1){f=Math.round(f);if(f>0&&(f%this.increment)){f=f-(f%this.increment)+this.increment;if(f>this.maxValue){f=this.maxValue}}}this.setSpinnerValue(f);var d=this.getValue();if(d==this.maxValue||d==this.minValue){this._initNudge(g)}}},_setContainerSize:function(){var a=this.getFormEl().width();if(!a){return}if(this.stretchField){a-=11}a++;this.els.spinnerContainer.width(a)},_createEvents:function(){if(!this.disableWheel){this.getFormEl().on("mousewheel",this._mouseWheel.bind(this))}this.getFormEl().on("keydown",this._validateKeyStroke.bind(this));this.els.upArrow.on("mouseover",this._arrowMouseOver.bind(this));this.els.upArrow.on("mouseout",this._arrowMouseOut.bind(this));this.els.upArrow.on("mousedown",this._arrowMouseDown.bind(this));
this.els.upArrow.on("mouseup",this._arrowMouseUp.bind(this));this.els.downArrow.on("mouseover",this._arrowMouseOver.bind(this));this.els.downArrow.on("mouseout",this._arrowMouseOut.bind(this));this.els.downArrow.on("mousedown",this._arrowMouseDown.bind(this));this.els.downArrow.on("mouseup",this._arrowMouseUp.bind(this));jQuery(document.documentElement).on("mouseup",this._clearMode.bind(this));if(this.els.label){this.els.label.css("cursor","w-resize");jQuery(this.els.label).on({mousedown:this._initNudge.bind(this),selectstart:function(){return false}});jQuery(document.documentElement).on("mousemove",this._nudge.bind(this))}},_arrowMode:function(){if(this.mode.name){switch(this.mode.mode){case"up":this.incrementBy(1,this.mode.shiftKey);break;case"down":this.incrementBy(-1,this.mode.shiftKey);break;default:}this.mode.timeout=Math.max(Math.round(this.mode.timeout*0.8),15);setTimeout(this._arrowMode.bind(this),this.mode.timeout)}},_startMode:function(a){this.mode=a;switch(this.mode.name){case"mousedown":this._arrowMode();break;default:}},_arrowMouseDown:function(b){jQuery(b.target).addClass("ludo-spinbox-arrow-downeffect");var a=jQuery(b.target).hasClass("ludo-spinbox-arrow-up")?"up":"down";this._startMode({name:"mousedown",mode:a,modeElement:b.target,shiftKey:b.shift,timeout:400})},_arrowMouseUp:function(a){jQuery(a.target).removeClass("ludo-spinbox-arrow-downeffect")},_arrowMouseOver:function(a){jQuery(a.target).addClass("ludo-spinbox-arrow-overeffect")},_arrowMouseOut:function(a){jQuery(a.target).removeClass("ludo-spinbox-arrow-overeffect")},incrementBy:function(b,a){b=b*(a?this.shiftIncrement:this.increment);this.setSpinnerValue(parseInt(this._get())+b)},validateSpinnerValue:function(a){a=a||0;if(a<this.minValue){a=this.minValue}if(a>this.maxValue){a=this.maxValue}return parseInt(a)},setSpinnerValue:function(a){this.value=this.validateSpinnerValue(a).toFixed(this.decimals);this.getFormEl().val(this.value);this.fireEvent("change",a,this)},_validateKeyStroke:function(a){if(a.key=="backspace"||a.key=="delete"||a.key=="tab"){return true}if(this.minValue<0&&this.html.el.value.indexOf("-")==-1&&a.key=="-"){return true}if(this.decimals&&(a.code==190||a.code==46)&&this.html.el.value.indexOf(".")==-1){return true}if(Event.Keys.hasOwnProperty(a.key)){return true}return Event.Keys.hasOwnProperty(a.key)?true:/[0-9]/.test(a.key)},resizeDOM:function(){this.parent();if(this.stretchField){this._setContainerSize()}}});ludo.form.Select=new Class({Extends:ludo.form.Element,type:"form.Select",emptyItem:undefined,valueKey:"value",textKey:"text",inputTag:"select",inputType:"",dataSource:{},options:undefined,defaultDS:"dataSource.JSONArray",__construct:function(a){this.parent(a);this.setConfigParams(a,["emptyItem","options","valueKey","textKey"]);if(!this.emptyItem&&this.inlineLabel){this.emptyItem={};this.emptyItem[this.textKey]=this.inlineLabel;this.inlineLabel=undefined}},ludoEvents:function(){this.parent();if(this.dataSource){if(this.options&&this.dataSourceObj){for(var a=0;a<this.options.length;a++){this.dataSourceObj.addRecord(this.options[a])}}this.populate();var b=this.getDataSource();b.addEvent("select",this.selectRecord.bind(this));b.addEvent("update",this.populate.bind(this));b.addEvent("delete",this.populate.bind(this));b.addEvent("sort",this.populate.bind(this))}},selectRecord:function(a){if(!jQuery.isPlainObject(a)){this.__set(a)}else{this._set(a[this.valueKey])}this.toggleDirtyFlag()},populate:function(){var b=this.dataSourceObj.getData()||[];this.getFormEl().find("option").remove();if(this.emptyItem){this.addOption(this.emptyItem[this.valueKey],this.emptyItem[this.textKey])}var a=b.length>0&&jQuery.isPlainObject(b[0]);jQuery.each(b,function(d,f){if(a){this.addOption(f[this.valueKey],f[this.textKey])}else{this.addOption(f,f)}}.bind(this));if(this.value){this._set(this.value);this.setFormElValue(this.value)}},addOption:function(b,d){var a=jQuery('<option value="'+b+'">'+d+"</option>");this.getFormEl().append(a)},resizeDOM:function(){this.parent()}});ludo.form.RadioGroup=new Class({Extends:ludo.form.Select,type:"form.RadioGroup",checkboxes:[],height:undefined,inputTag:"",ludoDOM:function(){this.parent();var b=jQuery("<table>");this.getInputCell().append(b);var a=this.els.tBody=jQuery("<tbody>");b.append(a)},populate:function(){var f=this.dataSource?this.getDataSource().getData()||[]:[];var g=jQuery("<tr>");this.els.tBody.html("");this.els.tBody.append(g);this.disposeCheckboxes();for(var d=0;d<f.length;d++){var a=jQuery("<td>");g.append(a);var b=new ludo.form.Checkbox({inputType:"radio",name:this.getName(),value:f[d][this.valueKey],label:f[d][this.textKey],image:f[d].image?f[d].image:null,listeners:{change:this.valueChange.bind(this)}});this.checkboxes.push(b);a.append(b.getEl())}if(this.value){this._set(this.value)}},disposeCheckboxes:function(){for(var a=0;a<this.checkboxes.length;a++){this.checkboxes[a].remove()}this.checkboxes=[]},valueChange:function(b){this.value=b;for(var a=0;a<this.checkboxes.length;a++){this.checkboxes[a].toggleImage()
}this.fireEvent("change",[this.value,this]);this.toggleDirtyFlag()},__rendered:function(){this.parent();if(this.checkboxes.length>0&&!this.isChecked()){this.checkboxes[0].check()}},isChecked:function(){for(var a=0;a<this.checkboxes.length;a++){if(this.checkboxes[a].isChecked()){return true}}return false},disable:function(){for(var a=0;a<this.checkboxes.length;a++){this.checkboxes[a].disable()}},enable:function(){for(var a=0;a<this.checkboxes.length;a++){this.checkboxes[a].enable()}},val:function(){var a=this.getCheckedRadio();if(a){return a._get()}return undefined},_get:function(){var a=this.getCheckedRadio();if(a){return a._get()}return undefined},getCheckedRadio:function(){for(var a=0;a<this.checkboxes.length;a++){if(this.checkboxes[a].isChecked()){return this.checkboxes[a]}}return undefined},val:function(a){if(arguments.length==0){return this._get()}this._set(a)},_set:function(b){for(var a=0;a<this.checkboxes.length;a++){if(this.checkboxes[a].getFormEl().get("value")==b){return this.checkboxes[a].check()}}this.parent(b)},supportsInlineLabel:function(){return false}});ludo.form.OnOff=new Class({Extends:ludo.form.Element,listener:undefined,trackBorderColor:undefined,checked:false,trackBorderWidth:1,textSizeRatio:0.45,trackColorOn:"#F57C00",trackColorOff:"#666",textColorOn:undefined,textColorOff:"#fff",el:undefined,track:undefined,thumb:undefined,thumbColor:undefined,onTextEl:undefined,offTextEl:undefined,onOffTrackContainer:undefined,textOn:"",textOff:"",minX:0,maxX:0,trackOn:undefined,trackOff:undefined,innerTrackWidth:0,dragCurrentX:0,borderSize:0,valOn:"1",valOff:"",__construct:function(a){this.parent(a);this.setConfigParams(a,["textOn","textOff","trackColorOn","trackColorOff","textColorOn","textColorOff","listeners","trackBorderColor","textSizeRatio","checked","valOn","valOff"])},ludoDOM:function(){this.parent();this.width=100;this.height=30;this.el=jQuery('<div class="on-off-switch"></div>');this.$b().append(this.el);this.renderTrack();this.renderThumb();this.el.on("selectStart",this.cancelEvent);this.track.on("click",this.toggle.bind(this));this.track.on("touchend",this.toggle.bind(this))},ludoEvents:function(){this.parent();this.thumb.on("mousedown",this.startDragging.bind(this));this.thumb.on("touchstart",this.startDragging.bind(this));this.thumb.on("mouseenter",this.enterThumb.bind(this));this.thumb.on("mouseleave",this.leaveThumb.bind(this));jQuery(document.documentElement).on("touchmove",this.drag.bind(this));jQuery(document.documentElement).on("mousemove",this.drag.bind(this));jQuery(document.documentElement).on("mouseup",this.endDrag.bind(this));jQuery(document.documentElement).on("touchend",this.endDrag.bind(this))},__rendered:function(){this.parent();this.setChecked(this.checked)},resizeDOM:function(){this.parent();var b=this.width=this.$b().width()-(this.trackBorderWidth*2);var l=this.height=this.$b().height()-(this.trackBorderWidth*2);var o=b-(this.trackBorderWidth*2);var k=o-(this.height/2);this.innerTrackWidth=o;var j=l-(this.trackBorderWidth*2);var d=l/2;this.el.css({width:b,height:l});this.track.css({width:o,height:j,borderRadius:d});this.onOffTrackContainer.css({height:j,width:(k*2)});this.trackOn.css({width:k,height:j});this.trackOff.css({width:this.width,height:j,left:(k-(this.height/2))});this.styleText(this.onTextEl);this.styleText(this.offTextEl);var a=this.height/2;var f=a/2;var h=f/2;var m=this.width-(h*2);this.whiteEl.css({top:this.height/2,left:h,width:m,height:a,borderRadius:f});this.whiteEl2.css({top:this.height/2,left:h,width:m,height:a,borderRadius:f});this.maxX=this.width-this.height;d=(this.height-this.height%2)/2;var g=this.getBorderSize();this.thumb.css({width:this.height+"px",height:this.height+"px",borderRadius:d});var n=this.height-(g*2);this.thumbShadow.css({width:this.height+"px",height:this.height+"px",borderRadius:d});this.thumbColor.css({width:n+"px",height:n+"px",borderRadius:d});this.applyStyles()},enterThumb:function(){this.thumbColor.addClass("on-off-switch-thumb-over")},leaveThumb:function(){this.thumbColor.removeClass("on-off-switch-thumb-over")},renderTrack:function(){this.track=jQuery('<div class="on-off-switch-track" style="border-width:'+this.trackBorderWidth+'px"></div>');if(this.trackBorderColor){this.track.css("border-color",this.trackBorderColor)}this.el.append(this.track);this.onOffTrackContainer=jQuery('<div style="position:absolute"></div>');this.track.append(this.onOffTrackContainer);this.trackOn=jQuery('<div class="on-off-switch-track-on" style="border-radius:'+0+"px;border-width:"+this.trackBorderWidth+'px"><div class="track-on-gradient"></div></div>');this.onOffTrackContainer.append(this.trackOn);this.onTextEl=jQuery('<div class="on-off-switch-text on-off-switch-text-on">'+this.textOn+"</div>");this.trackOn.append(this.onTextEl);if(this.textColorOn){this.onTextEl.css("color",this.textColorOn)}this.trackOff=jQuery('<div class="on-off-switch-track-off" style="overflow:hidden;border-radius:'+0+"px;border-width:"+this.trackBorderWidth+'px"><div class="track-off-gradient"></div></div>');
this.offTextEl=jQuery('<div class="on-off-switch-text on-off-switch-text-off">'+this.textOff+"</div>");this.onOffTrackContainer.append(this.trackOff);this.trackOff.append(this.offTextEl);if(this.textColorOff){this.offTextEl.css("color",this.textColorOff)}this.styleText(this.onTextEl);this.styleText(this.offTextEl);this.whiteEl=jQuery('<div class="on-off-switch-track-white"></div>');this.whiteEl2=jQuery('<div class="on-off-switch-track-white"></div>');this.trackOn.append(this.whiteEl);this.trackOff.append(this.whiteEl2);this.maxX=this.width-this.height},styleText:function(a){var d=Math.round(this.height*this.textSizeRatio);var b=Math.round(this.width-this.height);a.css({"line-height":(this.height-(this.trackBorderWidth*2))+"px","font-size":d+"px",left:(this.height/2),width:b})},renderThumb:function(){var a=this.getBorderSize();this.thumb=jQuery('<div class="on-off-switch-thumb" ></div>');var b=this.thumbShadow=jQuery('<div class="on-off-switch-thumb-shadow" style="border-width:'+a+'px;"></div>');this.thumb.append(b);this.thumbColor=jQuery('<div class="on-off-switch-thumb-color" style="left:'+a+"px;top:"+a+'px"></div>');this.thumb.append(this.thumbColor);if(this.trackColorOff){this.trackOff.css("background-color",this.trackColorOff)}if(this.trackColorOn){this.trackOn.css("background-color",this.trackColorOn)}this.el.append(this.thumb)},getBorderSize:function(){if(this.borderSize==0){this.borderSize=Math.round(this.height/40)}return this.borderSize},applyStyles:function(){var a=this.thumbColor;a.removeClass("on-off-switch-thumb-on");a.removeClass("on-off-switch-thumb-off");a.removeClass("on-off-switch-thumb-over");if(this.checked){a.addClass("on-off-switch-thumb-on");this.thumb.css("left",this.width-this.height);this.onOffTrackContainer.css("left",0)}else{this.onOffTrackContainer.css("left",this.getTrackPosUnchecked());a.addClass("on-off-switch-thumb-off");this.thumb.css("left",0)}},isDragging:false,hasBeenDragged:false,startDragging:function(a){this.isDragging=true;this.hasBeenDragged=false;this.startCoordinates={x:this.getX(a),elX:this.thumb.position().left};return false},drag:function(b){if(!this.isDragging){return}this.hasBeenDragged=true;var a=this.startCoordinates.elX+this.getX(b)-this.startCoordinates.x;if(a<this.minX){a=this.minX}if(a>this.maxX){a=this.maxX}this.onOffTrackContainer.css("left",a-this.width+(this.height));this.thumb.css("left",a);return false},getX:function(b){var a=b.pageX;if(b.type&&(b.type=="touchstart"||b.type=="touchmove")){a=b.originalEvent.touches[0].pageX}this.dragCurrentX=a;return a},endDrag:function(){if(!this.isDragging){return}if(!this.hasBeenDragged){this.toggle()}else{var a=this.startCoordinates.elX+this.dragCurrentX-this.startCoordinates.x;if(a<(this.width/2-(this.height/2))){this.animateLeft()}else{this.animateRight()}}this.isDragging=false},getTrackPosUnchecked:function(){return 0-this.width+this.height},animateLeft:function(){this.onOffTrackContainer.animate({left:this.getTrackPosUnchecked()},100);this.thumb.animate({left:0},100,"swing",this.uncheck.bind(this))},animateRight:function(){this.onOffTrackContainer.animate({left:0},100);this.thumb.animate({left:this.maxX},100,"swing",this.check.bind(this))},check:function(){this.setChecked(true);this.applyStyles()},uncheck:function(){this.setChecked(false);this.applyStyles()},setChecked:function(a){if(a!=this.checked){this.checked=a;this.fireEvent("change",[this._get(),this]);this._set(this.checked?this.valOn:this.valOff);this.change()}},_get:function(){return this.checked?this.valOn:this.valOff},toggle:function(){if(!this.checked){this.checked=true;this.animateRight()}else{this.checked=false;this.animateLeft()}this._set(this.checked?this.valOn:this.valOff);this.change()},val:function(a){if(arguments.length==1){if(a==this.valOn){this.setChecked(true)}else{this.setChecked(false)}}return this._get()}});ludo.form.Seekbar=new Class({Extends:ludo.form.Element,thumbAlpha:1,negativeColor:"#888",positiveColor:"#ccc",thumbColor:"#888",minValue:0,maxValue:10,value:0,barSize:2,el:undefined,thumb:undefined,thumbInner:undefined,thumbOuter:undefined,needleSize:0.2,area:{width:0,height:0,max:0},valueArea:{min:0,max:0,width:0},thumbSize:0,isActive:false,startCoordinates:undefined,valueListener:undefined,reverse:false,increments:undefined,orientation:"vertical",__construct:function(a){this.parent(a);this.setConfigParams(a,["increments","orientation","reverse","minValue","maxValue","value","valueListener","negativeColor","positiveColor","needleSize","barSize"]);if(a.thumbColor!=undefined){if(a.thumbColor.length==9){var b=a.thumbColor.substr(1,2);this.thumbAlpha=parseInt(b,16)/255;a.thumbColor="#"+a.thumbColor.substr(3)}this.thumbColor=a.thumbColor}},renderSeekbar:function(){this.el=jQuery('<div class="dhtmlgoodies-seekbar" style="position:relative;width:100%;height:100%"></div>');this.$b().append(this.el);this.els.negative=jQuery('<div class="seekbar-negative" style="position:absolute;z-index:1"></div>');this.els.positive=jQuery('<div class="seekbar-positive" style="position:absolute;z-index:1"></div>');
if(this.negativeColor!=undefined){this.els.negative.css("background-color",this.negativeColor)}if(this.positiveColor!=undefined){this.els.positive.css("background-color",this.positiveColor)}this.els.thumb=jQuery('<div style="position:absolute;z-index:4"></div>');this.els.thumbInner=jQuery('<div class="seekbar-thumb-needle" style="position:absolute;z-index:5;background-color:'+this.thumbColor+'"></div>');this.els.thumbOuter=jQuery('<div class="seekbar-thumb" style="position:absolute;z-index:5;width:100%;height:100%;background-color:'+this.thumbColor+'"></div>');if(this.thumbColor!=undefined){this.els.thumbInner.css("background-color",this.thumbColor);this.els.thumbOuter.css("background-color",this.thumbColor)}this.updateAlpha();this.els.thumb.append(this.els.thumbInner);this.els.thumb.append(this.els.thumbOuter);this.el.append(this.els.negative);this.el.append(this.els.positive);this.el.append(this.els.thumb);this.els.eventEl=jQuery('<div style="position:absolute;z-index:3;width:100%;height:100%"></div>');this.el.append(this.els.eventEl);this.els.eventEl.on("click",this.clickOnBar.bind(this));this.els.thumb.on(ludo.util.getDragStartEvent(),this.startDragging.bind(this));jQuery(document.documentElement).on(ludo.util.getDragMoveEvent(),this.drag.bind(this));jQuery(document.documentElement).on(ludo.util.getDragEndEvent(),this.endDrag.bind(this))},clickOnBar:function(b){var d=this.orientation=="vertical"?this.area.size-b.offsetY-b.currentTarget.offsetTop:b.offsetX;d-=(this.thumbSize/2);if(b.target&&b.target.className=="seekbar-thumb"){return}var a=this.minValue+(d/this.valueArea.size*(this.maxValue-this.minValue));if(this.reverse){a=this.maxValue-a}a=Math.min(this.maxValue,Math.max(this.minValue,a));this.val(a);if(this.valueListener!=undefined){this.valueListener.call(this,this.value)}},val:function(a){if(arguments.length!=0){this._set(a);this.change()}return this.value},_set:function(a){if(this.increments!=undefined){a-=(a%this.increments)}a=Math.max(this.minValue,a);a=Math.min(this.maxValue,a);a=this.parent(a);this.positionBars();this.positionThumb();return a},__rendered:function(){this.renderSeekbar();this.parent()},resizeDOM:function(){this.parent();this.positionItems()},positionItems:function(){this.area.width=this.el.width();this.area.height=this.el.height();this.area.size=Math.max(this.area.width,this.area.height);this.thumbSize=Math.min(this.area.height,this.area.width);this.thumbSize+=this.thumbSize%2;var b=Math.max(this.area.width,this.area.height);this.els.thumbOuter.css({width:this.thumbSize,height:this.thumbSize,"border-radius":this.thumbSize/2});this.els.thumb.css({width:this.thumbSize,height:this.thumbSize,"border-radius":this.thumbSize/2});var f=Math.round(this.thumbSize*this.needleSize);f+=f%2;var g=(this.thumbSize/2)-(f/2);this.els.thumbInner.css({width:f,height:f,borderRadius:f/2,left:g,top:g});this.valueArea.min=this.thumbSize/2;this.valueArea.max=b-this.thumbSize/2;this.valueArea.size=this.valueArea.max-this.valueArea.min;var d=(this.thumbSize/2)-(this.barSize/2);if(this.orientation=="horizontal"){this.els.negative.css({left:this.valueArea.min,top:d,height:this.barSize});this.els.positive.css({left:this.valueArea.min,top:d,height:this.barSize})}else{this.els.negative.css({top:0,width:this.barSize,left:d});this.els.positive.css({top:this.valueArea.min,width:this.barSize,left:d})}var a=Math.floor(this.barSize/2)+this.barSize%2;this.els.negative.css("border-radius",a);this.els.positive.css("border-radius",a);this.positionBars();this.positionThumb()},positionThumb:function(){var a=this.getValuePos();if(this.orientation=="horizontal"){this.els.thumb.css("left",a)}else{this.els.thumb.css("top",a)}},positionBars:function(){var a=this.getValuePos();if(this.orientation=="horizontal"){if(this.reverse){this.els.negative.css({left:a+this.valueArea.min,width:this.valueArea.size-a});this.els.positive.css({left:this.valueArea.min,width:a})}else{this.els.negative.css("width",a);this.els.positive.css({left:a+this.valueArea.min,width:this.valueArea.size-a})}}else{if(this.reverse){this.els.positive.css({height:this.valueArea.size-a,top:a+this.valueArea.min});this.els.negative.css({top:this.valueArea.min,height:a})}else{this.els.positive.css("height",a);this.els.negative.css({top:a+this.valueArea.min,height:this.valueArea.size-a})}}},getValuePos:function(){if(this.orientation=="horizontal"){var a=(this.value-this.minValue)/this.maxValue;var b=(this.valueArea.size*a);return this.reverse?this.valueArea.size-b:b}else{if(this.reverse){return(this.valueArea.min+(this.valueArea.size*(this.value-this.minValue)/this.maxValue))-this.valueArea.min}else{return this.valueArea.max-(this.valueArea.min+(this.valueArea.size*(this.value-this.minValue)/this.maxValue))}}},startDragging:function(d){this.els.thumbOuter.css("opacity","");this.els.thumbOuter.addClass("seekbar-thumb-over");this.active=true;var b=this.els.thumb.position();var a=d.pageX;var f=d.pageY;if(d.type&&d.type=="touchstart"){a=d.originalEvent.touches[0].pageX;f=d.originalEvent.touches[0].pageY
}this.startCoordinates={x:a,y:f,elX:b.left,elY:b.top};return false},drag:function(d){if(!this.active){return}var a=d.pageX;var g=d.pageY;if(d.type&&d.type=="touchmove"){a=d.originalEvent.touches[0].pageX;g=d.originalEvent.touches[0].pageY}var f=0;if(this.orientation=="horizontal"){f=this.startCoordinates.elX+a-this.startCoordinates.x}else{f=this.startCoordinates.elY+g-this.startCoordinates.y}if(f<0){f=0}if(f>this.area.size-this.thumbSize){f=this.area.size-this.thumbSize}var b=this.minValue+(f/this.valueArea.size*(this.maxValue-this.minValue));if((this.orientation=="vertical"&&!this.reverse)||(this.orientation=="horizontal"&&this.reverse)){b=this.maxValue-b}this.val(b);this.positionBars();if(this.orientation=="horizontal"){this.els.thumb.css("left",this.getValuePos())}else{this.els.thumb.css("top",this.getValuePos())}return false},updateAlpha:function(){if(this.thumbAlpha<1){this.els.thumbOuter.css("opacity",this.thumbAlpha)}},endDrag:function(){if(!this.active){return}this.updateAlpha();this.els.thumbOuter.removeClass("seekbar-thumb-over");this.active=false}});ludo.form.File=new Class({Extends:ludo.form.Element,type:"form.File",inputTag:"input",inputType:"file",labelButton:"Browse",labelRemove:"Remove",labelDelete:"Delete",valueForDisplay:"",instantUpload:true,uploadInProgress:false,fileUpparseNewData:true,isFileUploadComponent:true,buttonWidth:80,accept:undefined,resource:"FileUpload",__construct:function(a){this.parent(a);this.setConfigParams(a,["resource","instantUpload","labelButton","labelRemove","labelDelete","buttonWidth"]);if(a.accept){this.accept=a.accept.toLowerCase().split(/,/g)}if(a.value){this.valueForDisplay=a.value}this.value=""},__rendered:function(){this.parent();var a=jQuery("<div>");a.width(this.buttonWidth);a.css("textAlign","right");this.$b().append(a);a.append(this.getFormEl());var d=new ludo.form.Button({type:"form.Button",layout:{height:30,width:this.buttonWidth},value:this.labelButton,overflow:"hidden",renderTo:a});var b=this.getFormEl();b.css({opacity:0,"-moz-opacity":0,height:"100%",position:"absolute",right:0,top:0,"z-index":100000,cursor:"pointer",filter:"alpha(opacity=0)"});b.on("mouseover",d.mouseOver.bind(d));b.on("mouseout",d.mouseOut.bind(d));b.on("mousedown",d.mouseDown.bind(d));b.on("mouseup",d.mouseUp.bind(d));b.on("change",this.selectFile.bind(this));d.getEl().append(b);this.createIframe();this.createFormElementForComponent();if(this.valueForDisplay){this.displayFileName()}},createFormElementForComponent:function(){var a=this.els.form=jQuery('<form method="post action="'+this.getUploadUrl()+'" enctype="multipart/form-data" target="'+this.getIframeName()+'">');a.css({margin:0,padding:0,border:0});this.getEl().append(a);a.append(this.$b());this.addElToForm("ludo-file-upload-name",this.getName());this.addElToForm("request",this.getResource()+"/save")},getResource:function(){return this.resource||"FileUpload"},addElToForm:function(a,d){var b=jQuery('<input type="hidden" name="'+a+'">');b.val(d);this.els.form.append(b)},createIframe:function(){this.iframeName=this.getIframeName();var a=this.els.iframe=jQuery('<iframe name="'+this.iframeName+'">');a.css({width:1,height:1,visibility:"hidden",position:"absolute"});this.getEl().append(a);a.on("load",this.onUpparseNewData.bind(this))},getIframeName:function(){return"iframe-"+this.getId()},onUpparseNewData:function(){this.fileUpparseNewData=true;if(window.frames[this.iframeName].location.href.indexOf("http:")==-1){return}try{var b=JSON.parse(window.frames[this.iframeName].document.body.innerHTML);if(b.success){this.value=b.response;this.fireEvent("submit",[b.response,this])}else{this.fireEvent("submitfail",[b,this])}this.fireEvent("valid",["",this])}catch(d){var a="";try{a=window.frames[this.iframeName].document.body.innerHTML}catch(d){}this.fireEvent("fail",[d,a,this])}this.uploadInProgress=false;this.displayFileName();this.validate()},isValid:function(){if(this.required&&!this.getValue()&&!this.hasFileToUpload()){return false}if(!this.hasValidExtension()){return false}return !this.uploadInProgress},hasValidExtension:function(){if(!this.hasFileToUpload()||this.accept===undefined){return true}return this.accept.indexOf(this.getExtension())>=0},getExtension:function(){var a=this._get();var b=a.split(/\./g);return b.pop().toLowerCase()},getUploadUrl:function(){var a=ludo.config.getFileUploadUrl()||this.getUrl();if(!a){ludo.util.warn("No url defined for file upload. You can define it with the code ludo.config.setFileUploadUrl(url)")}return a},selectFile:function(){this.value=this.valueForDisplay=this.getFormEl().get("value");this.fileUpparseNewData=false;this.displayFileName();this.setDirty();if(this.instantUpload){this.upload()}},displayFileName:function(){var d=this.els.cellInput;d.html("");d.removeClass("ludo-input-file-name-new-file");d.removeClass("ludo-input-file-name-initial");d.removeClass("ludo-input-file-name-not-uploaded");if(this.valueForDisplay){var f=ludo.dom.create({tag:"span",html:this.valueForDisplay+" ",renderTo:d});
var b=new Element("a");b.addEvent("click",this.removeFile.bind(this));b.set("href","#");var a=this.labelRemove;if(this.valueForDisplay==this.initialValue){a=this.labelDelete;d.addClass("ludo-input-file-name-initial")}else{d.addClass("ludo-input-file-name-new-file")}if(!this.fileUpparseNewData){d.addClass("ludo-input-file-name-not-uploaded")}b.html(a);d.append(b)}},resizeDOM:function(){},upload:function(){if(!this.hasValidExtension()){return}this.fireEvent("invalid",["",this]);this.uploadInProgress=true;this.els.form.submit()},getValue:function(){console.warn("Use of deprecated getValue");console.trace();return this.value},_get:function(){return this.value},setValue:function(a){console.warn("Use of deprecated setValue");this.valueForDisplay=a;this.displayFileName();this.validate()},val:function(a){if(arguments.length==0){return this._get()}this.valueForDisplay=a;this.displayFileName();this.validate()},commit:function(){this.initialValue=this.valueForDisplay;this.displayFileName()},removeFile:function(){this.valueForDisplay=this.valueForDisplay===this.initialValue?"":this.initialValue;this.value="";this.displayFileName();this.validate();return false},hasFileToUpload:function(){return !this.fileUpparseNewData},blur:function(){},supportsInlineLabel:function(){return false}});ludo.form.Slider=new Class({Extends:ludo.form.Element,cssSignature:"ludo-form-slider",type:"form.Slider",fieldTpl:["<table ",'cellpadding="0" cellspacing="0" border="0" width="100%">',"<tbody>",'<tr class="input-row">','<td class="label-cell"><label class="input-label"></label></td>','<td class="input-cell"></td>','<td class="suffix-cell" style="display:none"></td>','<td class="help-cell" style="display:none"></td>',"</tr>","</tbody>","</table>"],inputTag:undefined,inputType:undefined,sliderSize:100,direction:"horizontal",minValue:1,maxValue:10,height:undefined,reverse:false,__construct:function(a){this.parent(a);this.setConfigParams(a,["direction","minValue","maxValue","reverse"])},__rendered:function(){this.parent();this.moveSliderBackgrounds()},moveSliderBackgrounds:function(){var b=Math.round(this.getHandleSize()/2);var a=this.getDirection()=="horizontal"?["left","right"]:["top","bottom"];this.els.bgfirst.css(a[0],b+"px");this.els.bglast.css(a[1],b+"px")},addInput:function(){this.parent();var a=this.els.slider=jQuery("<div>");this.els.slider.on("click",this.sliderClick.bind(this));a.addClass("ludo-form-slider-container");a.addClass("ludo-form-slider-"+this.getDirection());this.$b().append(a);this.addSliderBg("first");this.addSliderBg("last");this.createSliderHandle()},createSliderHandle:function(){this.els.sliderHandle=jQuery('<div class="ludo-form-slider-handle"></div>');this.els.slider.append(this.els.sliderHandle);this.drag=new ludo.effect.Drag(this.getDragConfig())},addSliderBg:function(a){this.els["bg"+a]=jQuery('<div class="ludo-form-slider-bg-'+a+'"></div>');this.els.slider.append(this.els["bg"+a])},getDragConfig:function(){return{el:this.els.sliderHandle,fireEffectEvents:false,directions:this.getDirection()=="horizontal"?"X":"Y",listeners:{drag:this.receivePosition.bind(this)},minPos:0,maxPos:this.getSliderSize()}},sliderClick:function(a){if(!jQuery(a.target).hasClass("ludo-form-slider-handle")){var d=this.els.slider.position();var b=Math.round(this.getHandleSize()/2);this.receivePosition({x:a.pageX-d.left-b,y:a.pageY-d.top-b})}},receivePosition:function(a){this._set(this.pixelToValue(this.getDirection()=="horizontal"?a.x:a.y));this.fireEvent("change",[this.value,this])},pixelToValue:function(g){var f=this.getMinValue();var a=this.getMaxValue();var b=this.getSliderSize();var d=Math.round(g/b*(a-f))+f;if(this.shouldReverseAxis()){d=a-d}return d},getDirection:function(){if(this.direction===undefined){var a=this.$b().getSize();if(a.x>=a.y){this.direction="horizontal"}else{this.direction="vertical"}}return this.direction},getMinValue:function(){return this.minValue},getMaxValue:function(){return this.maxValue},setValue:function(a){console.warn("Use of deprecated setValue");console.trace()},_set:function(a){if(a>this.getMaxValue()){a=this.getMaxValue()}else{if(a<this.getMinValue()){a=this.getMinValue()}}this.parent(a);this.positionSliderHandle();this.toggleDirtyFlag()},resizeDOM:function(){this.parent();if(this.direction=="horizontal"){this.sliderSize=this.els.slider.width()}else{this.sliderSize=this.$b().height()-ludo.dom.getMH(this.els.slider);this.els.slider.css("height",this.getHeight()+"px")}this.sliderSize-=this.getHandleSize();this.positionSliderHandle();this.drag.setMaxPos(this.sliderSize)},positionSliderHandle:function(){this.els.sliderHandle.css(this.handleCssProperty,this.getHandlePos()+"px")},getHandlePos:function(){var a=Math.round((this.value-this.minValue)/(this.maxValue-this.minValue)*this.sliderSize);if(this.shouldReverseAxis()){a=this.sliderSize-a}return a},_shouldReverse:undefined,shouldReverseAxis:function(){if(this._shouldReverse==undefined){this._shouldReverse=(this.direction=="horizontal"&&this.reverse)||(this.direction=="vertical"&&!this.reverse)
}return this._shouldReverse},getSliderSize:function(){return this.sliderSize},getHandleSize:function(){if(this.handleSize===undefined){var a="height";this.handleCssProperty="top";if(this.getDirection()=="horizontal"){a="width";this.handleCssProperty="left"}this.handleSize=parseInt(this.els.sliderHandle.css(a).replace("px",""))}return this.handleSize},supportsInlineLabel:function(){return false}});ludo.form.SearchField=new Class({Extends:ludo.form.Text,type:"form.SearchField",searchIn:undefined,delay:0,lastValue:undefined,searchFn:undefined,remote:false,lastSearch:undefined,__construct:function(a){this.parent(a);this.setConfigParams(a,["searchIn","delay","searchFn","remote"]);if(this.searchFn!==undefined){this.searchFn=this.searchFn.bind(this)}this.addEvent("key",this.queue.bind(this));this.setDataSource()},setDataSource:function(){if(ludo.util.isString(this.searchIn)){var a=ludo.get(this.searchIn);if(!a){this.setDataSource.delay(100,this)}else{this.searchIn=ludo.get(this.searchIn)}}},queue:function(a){this.value=a;if(this.delay===0){this.search()}else{this.lastValue=a;this.execute.delay(this.delay*1000,this,a)}},execute:function(a){if(a!=this.lastValue||a==this.lastSearch){return undefined}this.lastSearch=this._get();return this.search()},search:function(){if(this.remote){this.searchIn.remoteSearch(this._get());return undefined}else{return this.searchIn.getSearcher().search(this.searchFn?this.searchFn:this._get())}}});ludo.form.validator.Base=new Class({Extends:ludo.Core,value:undefined,applyTo:undefined,__construct:function(a){this.parent(a);if(a.value!==undefined){this.value=a.value}if(a.applyTo!==undefined){this.applyTo=a.applyTo}if(!this.value){this.loadValue()}},loadValue:function(){new ludo.remote.JSON({url:this.getUrl,data:{request:["Md5Validation",this.applyTo.getName(),"read"].join("/"),data:{md5Validation:true,getValidatorValueFor:this.applyTo.getName()}},listeners:{success:function(a){this.value=a.getData().value;this.fireEvent("loadValue",this)}.bind(this)}})},isValid:function(a){return a==this.value}});ludo.form.validator.Md5=new Class({Extends:ludo.form.validator.Base,type:"form.validator.Md5",value:undefined,isValid:function(a){return faultylabs.MD5(a)==this.value}});ludo.paging.Button=new Class({Extends:ludo.form.Button,type:"grid.paging.Next",width:25,buttonCls:"",tpl:undefined,onLoadMessage:undefined,ludoDOM:function(){this.parent();this.$b().addClass(this.buttonCls)},ludoEvents:function(){this.parent();this.dataSourceEvents()},dataSourceEvents:function(){var a=ludo.get(this.dataSource);if(a){this.addDataSourceEvents()}else{this.dataSourceEvents.delay(100,this)}},addDataSourceEvents:function(){},JSON:function(){}});ludo.paging.Next=new Class({Extends:ludo.paging.Button,type:"grid.paging.Next",buttonCls:"ludo-paging-next",addDataSourceEvents:function(){this.addEvent("click",this.nextPage.bind(this));var a=this.getDataSource();a.addEvent("lastPage",this.disable.bind(this));a.addEvent("notLastPage",this.enable.bind(this))},nextPage:function(){this.getDataSource().nextPage()}});ludo.paging.Previous=new Class({Extends:ludo.paging.Button,type:"grid.paging.Previous",buttonCls:"ludo-paging-previous",addDataSourceEvents:function(){this.addEvent("click",this.nextPage.bind(this));var a=this.getDataSource();a.addEvent("firstPage",this.disable.bind(this));a.addEvent("notFirstPage",this.enable.bind(this));if(a.isOnFirstPage()){this.disable()}},nextPage:function(){this.getDataSource().previousPage()}});ludo.paging.Last=new Class({Extends:ludo.paging.Button,type:"grid.paging.Last",buttonCls:"ludo-paging-last",addDataSourceEvents:function(){this.addEvent("click",this.nextPage.bind(this));var a=this.getDataSource();a.addEvent("lastPage",this.disable.bind(this));a.addEvent("notLastPage",this.enable.bind(this))},nextPage:function(){this.getDataSource().lastPage()}});ludo.paging.First=new Class({Extends:ludo.paging.Button,type:"grid.paging.First",buttonCls:"ludo-paging-first",addDataSourceEvents:function(){this.addEvent("click",this.firstPage.bind(this));var a=this.getDataSource();a.addEvent("firstPage",this.disable.bind(this));a.addEvent("notFirstPage",this.enable.bind(this));if(a.isOnFirstPage()){this.disable()}},firstPage:function(){this.getDataSource().firstPage()}});ludo.paging.PageInput=new Class({Extends:ludo.form.Number,type:"grid.paging.PageInput",width:35,fieldWidth:30,minValue:1,reverseWheel:true,ludoEvents:function(){this.parent();this.dataSourceEvents()},dataSourceEvents:function(){if(ludo.get(this.dataSource)){var a=this.getDataSource();if(a){a.addEvent("page",this.setPageNumber.bind(this));a.addEvent("load",this.updateMaxValue.bind(this));this.setPageNumber(a.getPageNumber());this.addEvent("change",this.updateDataSourcePageNumber.bind(this));this.updateMaxValue()}}else{this.dataSourceEvents.delay(100,this)}},setPageNumber:function(a){this.value=a;this.els.formEl.val(a)},updateDataSourcePageNumber:function(){this.getDataSource().toPage(this.val())},updateMaxValue:function(){this.maxValue=this.getDataSource().getPageCount()
},JSON:function(){}});ludo.paging.CurrentPage=new Class({Extends:ludo.View,type:"grid.paging.CurrentPage",width:25,onLoadMessage:"",tpl:"{page}",ludoDOM:function(){this.parent();this.getEl().addClass("ludo-paging-text");this.getEl().addClass("ludo-paging-current-page")},ludoEvents:function(){this.parent();this.dataSourceEvents()},dataSourceEvents:function(){if(ludo.get(this.dataSource)){var a=this.getDataSource();if(a){a.addEvent("page",this.setPageNumber.bind(this));this.setPageNumber(a.getPageNumber())}}else{this.dataSourceEvents.delay(100,this)}},resize:function(a){this.parent(a);this.$b().css("line-height",(this.$b().height()*0.8)+"px")},setPageNumber:function(){this.html(this.tpl.replace("{page}",this.getDataSource().getPageNumber()))},JSON:function(){}});ludo.paging.TotalPages=new Class({Extends:ludo.View,type:"grid.paging.TotalPages",width:25,onLoadMessage:"",tpl:"/{pages}",ludoDOM:function(){this.parent();this.getEl().addClass("ludo-paging-text");this.getEl().addClass("ludo-paging-total-pages")},ludoEvents:function(){this.parent();this.dataSourceEvents()},resize:function(a){this.parent(a);this.$b().css("line-height",(this.$b().height()*0.8)+"px")},dataSourceEvents:function(){if(ludo.get(this.dataSource)){var a=this.getDataSource();if(a){a.addEvent("load",this.setPageNumber.bind(this));a.addEvent("pageCount",this.setPageNumber.bind(this));this.setPageNumber(a.getPageNumber())}}else{this.dataSourceEvents.delay(100,this)}},setPageNumber:function(){this.html(this.tpl.replace("{pages}",this.getDataSource().getPageCount()))},JSON:function(){}});ludo.paging.NavBar=new Class({Extends:ludo.View,type:"paging.NavBar",layout:"cols",height:25,children:[{type:"paging.First"},{type:"paging.Previous"},{type:"paging.PageInput"},{type:"paging.TotalPages"},{type:"paging.Next"},{type:"paging.Last"}],__construct:function(a){this.parent(a);if(a.dataSource){for(var b=0;b<a.children.length;b++){a.children[b].dataSource=a.dataSource}this.dataSource=undefined}},JSON:function(){}});ludo.paging.PageSize=new Class({Extends:ludo.form.Select,options:[{value:10,text:"10"},{value:25,text:"25"},{value:50,text:"50"},{value:100,text:"100"}],label:"Page size",applyTo:undefined,__construct:function(a){this.applyTo=ludo.get(a.dataSource||this.applyTo);a.dataSource=undefined;this.parent(a)},ludoEvents:function(){this.parent();this.addEvent("change",this.setPageSize.bind(this))},setPageSize:function(){if(this.applyTo){this.applyTo.setPageSize(this.val())}}});ludo.Panel=new Class({Extends:ludo.View,tagBody:"fieldset",_createDOM:function(){this.parent();this.getEl().addClass("ludo-panel");this.els.legend=jQuery("<legend>");this.els.body.append(this.els.legend);this.getEl().addClass("ludo-panel")},ludoDOM:function(){this.parent();this.setTitle(this.title)},__rendered:function(){this.parent();this.$b().css("display","block")},autoSetHeight:function(){this.parent();var a=this.els.legend.measure(function(){return this.getSize()});this.layout.height+=a.y},heightOfLegend:undefined,getHeightOfLegend:function(){if(this.layout.heightOfLegend===undefined){this.layout.heightOfLegend=this.els.legend.offsetHeight}return this.layout.heightOfLegend},resizeDOM:function(){this.parent();return;var a=this.getHeight();if(a==0){return}a-=(ludo.dom.getMBPH(this.$b())+ludo.dom.getMBPH(this.getEl()));if(a>0&&!isNaN(a)){this.$b().css("height",a)}var b=this.getWidth();b-=(ludo.dom.getMBPW(this.$b())+ludo.dom.getMBPW(this.getEl()));if(b>0&&!isNaN(b)){this.$b().css("width",b)}},setTitle:function(a){this.parent(a);this.els.legend.html(a)}});ludo.dialog.Dialog=new Class({Extends:ludo.Window,type:"dialog.Dialog",modal:true,autoRemove:true,autoHideOnBtnClick:true,buttonConfig:undefined,movable:true,closable:false,minimizable:false,__construct:function(a){a.buttonConfig=a.buttonConfig||this.buttonConfig;if(a.buttonConfig){var d=a.buttonConfig.replace(/([A-Z])/g," $1");d=d.trim();d=d.split(/\s/g);a.buttons=[];for(var b=0;b<d.length;b++){a.buttons.push({value:d[b]})}}this.parent(a);this.setConfigParams(a,["modal","autoRemove","autoHideOnBtnClick"])},ludoDOM:function(){this.parent();this.getEl().addClass("ludo-dialog")},getShim:function(){if(this.els.shim===undefined){var a=this.els.shim=jQuery("<div>");jQuery(document.body).append(a);a.addClass("ludo-dialog-shim");a.css("display","none")}return this.els.shim},ludoEvents:function(){this.parent();if(this.isModal()){this.getEventEl().on("resize",this.resizeShim.bind(this))}},__rendered:function(){this.parent();if(!this.isHidden()){this.showShim()}var b=this.getButtons();for(var a=0;a<b.length;a++){b[a].addEvent("click",this.buttonClick.bind(this))}},isModal:function(){return this.modal},show:function(){this.showShim();this.parent()},hide:function(){this.parent();this.hideShim();if(this.autoRemove){this.remove.delay(1000,this)}},showShim:function(){if(!this.layout){this.center()}if(this.isModal()){this.getShim().css({display:"","z-index":this.getEl().css("z-index")-1});this.resizeShim()}},resizeShim:function(){var a=jQuery(document.body);
var d={x:a.width(),y:a.height()};this.getShim().css("width",d.x);this.getShim().css("height",d.y+"px")},hideShim:function(){if(this.isModal()){this.getShim().css("display","none")}},buttonClick:function(b,a){this.fireEvent(a._get().replace(/\s/g,"").toLowerCase(),this);if(this.autoHideOnBtnClick){this.hide()}}});ludo.dialog.Confirm=new Class({Extends:ludo.dialog.Dialog,type:"dialog.Confirm",__construct:function(a){if(!a.buttons&&!a.buttonConfig&&!a.buttonBar){a.buttons=[{value:"OK",width:60,defaultSubmit:true,type:"form.Button"},{value:"Cancel",width:60}]}this.parent(a)}});ludo.dialog.Alert=new Class({Extends:ludo.dialog.Dialog,type:"dialog.Alert",buttonConfig:undefined,width:300,height:150,resizable:false,__construct:function(a){if(a.substr){a={html:a}}if(!a.buttons){a.buttons=[{value:"OK",width:60}]}this.parent(a)}});ludo.dialog.Prompt=new Class({Extends:ludo.dialog.Dialog,type:"dialog.Prompt",input:undefined,inputConfig:{},label:"",value:"",__construct:function(a){if(!a.buttons&&!a.buttonConfig&&!a.buttonBar){a.buttons=[{value:"OK",width:60,defaultSubmit:true,type:"form.Button"},{value:"Cancel",width:60}]}this.setConfigParams(a,["label","value","inputConfig"]);this.parent(a)},__rendered:function(){this.parent();var a=Object.merge(this.inputConfig,{type:"form.Text",label:this.label,value:this.value});this.input=this.addChild(a);this.input.focus()},val:function(){return this.input.val()},getValue:function(){return this.input.val()},buttonClick:function(b,a){this.fireEvent(a.value.toLowerCase(),[this.val(),this]);if(this.autoHideOnBtnClick){this.hide()}}});ludo.video.Video=new Class({Extends:ludo.View,type:"video.Video",movieId:undefined,__construct:function(a){this.parent(a);if(a.movieId){this.movieId=a.movieId}},setContent:function(){var a=this.els.body;var d=jQuery("<object>");d.attr({width:"100%",height:"100%"});a.append(d);var f=jQuery("<param>");f.attr({name:"movie",value:this.getUrl()});d.append(f);var b=jQuery("<param>");b.attr({name:"wmode",value:"transparent"});d.append(b);var g=this.els.embed=jQuery("<embed>");g.attr({src:this.getVideoUrl(),type:"application/x-shockwave-flash",wmode:"transparent",width:"100%",height:"100%"});d.append(g);a.css("overflow","hidden");return a},loadMovie:function(a){this.movieId=a;this.els.embed.attr("src",this.getVideoUrl())}});ludo.video.YouTube=new Class({Extends:ludo.video.Video,type:"video.YouTube",getVideoUrl:function(){return"http://www.youtube.com/v/"+this.movieId}});ludo.svg.Gradient=new Class({Extends:ludo.svg.NamedNode,tagName:"linearGradient",stopTags:[],addStop:function(f,b,d){var a={offset:f,"stop-color":b};if(d!==undefined){if(d>1){d=d/100}a["stop-opacity"]=d}var g=new ludo.svg.Stop(a);this.append(g);this.stopTags.push(g);return g},getStop:function(a){return this.stopTags[a]}});ludo.svg.RadialGradient=new Class({Extends:ludo.svg.Gradient,tagName:"radialGradient",initialize:function(a){a=a||{};a.gradientUnits=a.gradientUnits||"userSpaceOnUse";this.parent(a)},setCx:function(a){this.set("cx",a)},setCy:function(a){this.set("cy",a)},setR:function(a){this.set("r",a)},setFx:function(a){this.set("fx",a)},setFy:function(a){this.set("fy",a)}});ludo.svg.Stop=new Class({Extends:ludo.svg.Node,initialize:function(a){this.parent("stop",a)},setOffset:function(a){this.set("offset",a)},setStopColor:function(a){this.set("stop-color",a)},getOffset:function(){return this.get("offset")},getStopColor:function(){return this.get("stop-color")},setStopOpacity:function(a){this.set("stop-opacity",a)},getStopOpacity:function(){return this.get("stop-opacity")}});ludo.svg.Drag=new Class({Extends:ludo.effect.Drag,ludoEvents:function(){this.parent();this.addEvent("before",this.setStartTranslate.bind(this))},setStartTranslate:function(a){this.dragProcess.startTranslate=this.getPositionOf(a.el)},add:function(a){a=this.getValidNode(a);if(!a.handle){a.handle=a.el}var b=a.el.getEl().id;this.els[b]=Object.merge(a,{handle:a.handle});this.els[b].handle.on(ludo.util.getDragStartEvent(),this.startDrag.bind(this));return this.els[b]},getValidNode:function(a){if(!this.isElConfigObject(a)){a={el:a}}a.el.set("forId",a.el.getEl().id);return a},isElConfigObject:function(a){return a.getEl===undefined},getPositionedParent:function(){return undefined},getIdByEvent:function(b){var a=b.target||b.event.srcElement.correspondingUseElement;var d=a.id;while(!this.els[d]&&a.parentNode){a=a.parentNode;d=a.id}return d},startDrag:function(a){this.parent(a);this.dragProcess.startTranslate=this.els[this.dragProcess.dragged].el.getTranslate()},move:function(d){var a=this.els[this.dragProcess.dragged].el;var b={x:this.dragProcess.startTranslate[0],y:this.dragProcess.startTranslate[1]};if(d.x!==undefined){b.x=d.x;this.dragProcess.currentX=d.x}if(d.y!==undefined){b.y=d.y;this.dragProcess.currentY=d.y}a.setTranslate(b.x,b.y)},endDrag:function(a){if(this.dragProcess.active){this.parent(a)}},getPositionOf:function(b){var a=b.getTranslate();return{left:a[0],top:a[1]}}});ludo.svg.EventManager=new Class({nodes:{},currentNodeId:undefined,currentNodeFn:undefined,currentNode:undefined,addMouseEnter:function(b,a){b.on("mouseover",this.getMouseOverFn(a))
},addMouseLeave:function(b,a){b.on("mouseout",this.getMouseOutFn(a))},getMouseOverFn:function(a){return function(d,b){if(!d.event.relatedTarget||!this.contains(b.getEl(),d.event.relatedTarget)){a.call(b,d,b)}}.bind(this)},contains:function(a,b){if(a.childNodes&&a.childNodes.length>0){return this._contains(a.childNodes,b)}return false},_contains:function(d,h){for(var b=0,a=d.length;b<a;b++){var g=d[b];if(g==h){return true}if(g.childNodes&&g.childNodes.length>0){var f=this._contains(g.childNodes,h);if(f){return true}}}return false},getMouseOutFn:function(a){return function(d,b){if(!d.event.relatedTarget||!this.contains(b.getEl(),d.event.relatedTarget)){a.call(b,d,b)}}.bind(this)}});ludo.canvasEventManager=new ludo.svg.EventManager();ludo.svg.Text=new Class({Extends:ludo.svg.NamedNode,tagName:"text",initialize:function(b,a){this.parent(a,b);this.fireSize()},fireSize:function(){if(this.getEl().parentNode){this.fireEvent("textSize",this.getSize())}},textAnchor:function(a){this.set("text-anchor",a)}});ludo.svg.Filter=new Class({Extends:ludo.svg.NamedNode,tagName:"filter",mergeTags:{},mergeTagsOrder:["dropShadow","SourceGraphic"],effectNodes:{dropShadow:["feGaussianBlur","feOffset"]},nodes:{dropShadow:undefined},initialize:function(a){a=a||{};if(a.x===undefined){a.x="-40%"}if(a.y===undefined){a.y="-40%"}a.width=a.width||"180%";a.height=a.height||"180%";this.parent(a)},setDropShadow:function(b){var a=this.getNodesForEffect("dropShadow");var f=a.feGaussianBlur;f.set("in","SourceAlpha");f.set("result","dropShadowBlur");f.set("stdDeviation",b.deviation);var d=a.feOffset;d.set("dx",b.x||2);d.set("dy",b.y||2);d.set("in","dropShadowBlur");d.set("result","dropShadow")},getNodesForEffect:function(b){var f=this.nodes[b];if(f===undefined){f={};var d=this.effectNodes[b];for(var a=0;a<d.length;a++){f[d[a]]=new ludo.svg.Node(d[a]);this.append(f[d[a]])}this.addFeMergeNode("SourceGraphic");this.addFeMergeNode(b)}return f},updateMergeTag:function(){var a=this.getMergeTag();var d=this.mergeTagsOrder;for(var b=0;b<d.length;b++){if(this.mergeTags[d[b]]!==undefined){this.mergeTags[d[b]].toFront()}}a.toFront()},mergeTag:undefined,getMergeTag:function(){if(this.mergeTag===undefined){this.mergeTag=new ludo.svg.Node("feMerge");this.append(this.mergeTag)}return this.mergeTag},addFeMergeNode:function(a){if(this.mergeTags[a]===undefined){this.mergeTags[a]=new ludo.svg.Node("feMergeNode",{"in":a});this.getMergeTag().append(this.mergeTags[a]);this.updateMergeTag()}return this.mergeTags[a]}});ludo.svg.Mask=new Class({Extends:ludo.svg.NamedNode,tagName:"mask"});ludo.svg.Animation=new Class({animationRate:13,color:undefined,_queue:undefined,_animationIds:undefined,testing:false,initialize:function(){this._queue={};this._animationIds={}},colorUtil:function(){if(this.color==undefined){this.color=new ludo.color.Color()}return this.color},getPathSegments:function(b){if(b.substr==undefined){return b}b=b.replace(/,/g," ");b=b.replace(/\s+/g," ");var a=b.split(/\s/g);jQuery.each(a,function(d,f){if(!isNaN(f)){a[d]=parseFloat(f)}});return a},animate:function(d,b,a){if(this.color==undefined){this.colorUtil()}this.queue({node:d,properties:b,options:a})},queue:function(a){a.__finish=this.next.bind(this);a.id=a.node.id;a.animationId=String.uniqueID();this._animationIds[a.id]=a.animationId;var b=this.hasQueue(a);var d=a.options.queue!=undefined?a.options.queue:true;if(this._queue[a.id]==undefined){this._queue[a.id]=[]}if(d){this._queue[a.id].push(a)}if(!d||!b){this.fn.call(this,a)}},hasQueue:function(a){return this._queue[a.id]!=undefined&&this._queue[a.id].length>0},fn:function(j){var g=j.node;var m=j.properties;var q=j.options;var h=q.duration||400;var l=q.easing||ludo.svg.easing.inSine;var o={};var f={};var k={};var d=j.__finish;jQuery.each(m,function(z,x){k[z]=true;switch(z){case"d":var r=g.attr("d");f[z]=this.getPathSegments(r);o[z]=this.getPathSegments(x);jQuery.each(o[z],function(u,D){if(!isNaN(D)){o[z][u]=D-f[z][u]}});break;case"fill":case"stroke":case"stop-color":var C=g.attr(z)||"#000000";if(C.length==4){C=C+C.substr(1)}var A=this.colorUtil();var v=A.rgbColors(C);var w=A.rgbColors(x);o[z]=[w.r-v.r,w.g-v.g,w.b-v.b];f[z]=v;break;case"translate":var B=jQuery.type(x[0])=="string"&&(/[+\-]/.test(x[0]));x[0]=parseInt(x[0]);x[1]=x[1]?parseInt(x[1]):0;var y=B?[0,0]:g.getTranslate();o[z]=[x[0]-y[0],x[1]-y[1]];f[z]=g.getTranslate();k[z]=true;break;case"rotate":var t=g.getRotate();o[z]=[x[0]-t[0],x[1],x[2]];f[z]=t[0];break;case"scale":default:var s=parseFloat(g.get(z));if(isNaN(s)){s=1}o[z]=x-s;f[z]=s;k[z]=false}}.bind(this));var b=q.progress;var p=q.start;var a=q.step;var n=function(M,B){if(q.validate!=undefined){var L=q.validate.call(this,j.animationId,this._animationIds[j.id]);if(!L){d.call(ludo.svgAnimation,j);return}}var u=M>=B;if(!u&&!this.testing){n.delay(this.animationRate,this,[M+1,B])}var F;if(M==0&&p){p.call(g)}if(u){M=B}var K=l(M,0,1,B);var G,E;for(var J in o){if(o.hasOwnProperty(J)){var H=o[J];if(k[J]){switch(J){case"d":var I=[];jQuery.each(f[J],function(r,t){if(isNaN(t)){I.push(t)
}else{I.push(t+(H[r]*K))}});if(a!=undefined){H=a.call(this,I,K,M/B)||H}g.set("d",I.join(" "));break;case"stroke":case"fill":case"stop-color":var s=Math.round(f[J].r+(K*H[0]));var A=Math.round(f[J].g+(K*H[1]));var D=Math.round(f[J].b+(K*H[2]));var C=this.color.toRGB(s,A,D);g.el.setAttribute(J,C);g._attr[J]=C;g.dirty=true;break;case"translate":G=f[J][0]+(K*H[0]);E=f[J][1]+(K*H[1]);g._getMatrix().setTranslate(G,E);break;case"rotate":var z=f[J]+(K*H[0]);G=H[1];E=H[2];z=z%360;g._getMatrix().setRotation(z,G,E);break}}else{var w=f[J]+(H*K);if(a!=undefined){w=a.call(this,w,K,M/B)||w}g.el.setAttribute(J,w);g._attr[J]=w;g.dirty=true;if(b){if(F==undefined){F={}}F[J]=w}}}}if(b!=undefined){b.call(g,M/B,F)}if(u){if(q.complete!=undefined){q.complete.call(g)}d.call(ludo.svgAnimation,j)}if(this.testing&&!u){n.call(this,M+1,B)}}.bind(this);j.startTime=new Date().getTime();n.call(this,1,Math.ceil(h/this.animationRate))},next:function(b){var a=this._queue[b.id].indexOf(b);if(a>=0){this._queue[b.id].splice(a,1)}if(this._queue[b.id].length>0){this.fn(this._queue[b.id][0])}}});ludo.svgAnimation=new ludo.svg.Animation();ludo.svg.easing={linear:function(f,a,h,g){return h*f/g+a},inQuad:function(f,a,h,g){f/=g;return h*f*f+a},outQuad:function(f,a,h,g){f/=g;return -h*f*(f-2)+a},inOutQuad:function(f,a,h,g){f/=g/2;if(f<1){return h/2*f*f+a}f--;return -h/2*(f*(f-2)-1)+a},inCubic:function(f,a,h,g){f/=g;return h*f*f*f+a},outCubic:function(f,a,h,g){f/=g;f--;return h*(f*f*f+1)+a},inOutCubic:function(f,a,h,g){f/=g/2;if(f<1){return h/2*f*f*f+a}f-=2;return h/2*(f*f*f+2)+a},inQuart:function(f,a,h,g){f/=g;return h*f*f*f*f+a},outQuart:function(f,a,h,g){f/=g;f--;return -h*(f*f*f*f-1)+a},inOutQuart:function(f,a,h,g){f/=g/2;if(f<1){return h/2*f*f*f*f+a}f-=2;return -h/2*(f*f*f*f-2)+a},inQuint:function(f,a,h,g){f/=g;return h*f*f*f*f*f+a},outQuint:function(f,a,h,g){f/=g;f--;return h*(f*f*f*f*f+1)+a},inOutQuint:function(f,a,h,g){f/=g/2;if(f<1){return h/2*f*f*f*f*f+a}f-=2;return h/2*(f*f*f*f*f+2)+a},inSine:function(f,a,h,g){return -h*Math.cos(f/g*(Math.PI/2))+h+a},outSine:function(f,a,h,g){return h*Math.sin(f/g*(Math.PI/2))+a},inOutSine:function(f,a,h,g){return -h/2*(Math.cos(Math.PI*f/g)-1)+a},inExpo:function(f,a,h,g){return h*Math.pow(2,10*(f/g-1))+a},outExpo:function(f,a,h,g){return h*(-Math.pow(2,-10*f/g)+1)+a},inOutExpo:function(f,a,h,g){f/=g/2;if(f<1){return h/2*Math.pow(2,10*(f-1))+a}f--;return h/2*(-Math.pow(2,-10*f)+2)+a},inCirc:function(f,a,h,g){f/=g;return -h*(Math.sqrt(1-f*f)-1)+a},outCirc:function(f,a,h,g){f/=g;f--;return h*Math.sqrt(1-f*f)+a},inOutCirc:function(f,a,h,g){f/=g/2;if(f<1){return -h/2*(Math.sqrt(1-f*f)-1)+a}f-=2;return h/2*(Math.sqrt(1-f*f)+1)+a},bounce:function(g,a,j,h){var f=g/h;f=1-ludo.svg.easing._bounce(1-f);return j*f+a},bow:function(g,a,j,h){var f=ludo.svg.easing._bow(g/h,1.5);return j*f+a},elastic:function(g,a,j,h){var f=ludo.svg.easing._elastic(g/h,1.5);return j*f+a},_elastic:function(b,a){return Math.pow(2,10*(b-1))*Math.cos(20*Math.PI*a/3*b)},_bounce:function(g){for(var f=0,d=1;1;f+=d,d/=2){if(g>=(7-4*f)/11){return -Math.pow((11-6*f-11*g)/4,2)+Math.pow(d,2)}}},_bow:function(b,a){return Math.pow(b,2)*((a+1)*b-a)}};