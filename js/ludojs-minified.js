/* Generated Fri Sep 16 16:48:25 CEST 2016 */
/************************************************************************************************************
@fileoverview
ludoJS - Javascript framework
Copyright (C) 2012-2016  ludoJS.com, Alf Magne Kalleland
This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.
This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.
You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
ludoJS.com., hereby disclaims all copyright interest in this script
written by Alf Magne Kalleland.
Alf Magne Kalleland, 2016
Owner of ludoJS.com
************************************************************************************************************/
window.ludo={form:{validator:{}},color:{},dialog:{},remote:{},tree:{},model:{},tpl:{},video:{},storage:{},grid:{},effect:{},paging:{},calendar:{},layout:{},progress:{},keyboard:{},chart:{},dataSource:{},controller:{},card:{},canvas:{},socket:{},menu:{},view:{},audio:{},ludoDB:{}};if(Browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}}ludo.SINGLETONS={};ludo.CmpMgrClass=new Class({Extends:Events,components:{},formElements:{},activeComponent:undefined,activeButton:undefined,availableButtons:undefined,initialize:function(){document.id(document.documentElement).addEvent("keypress",this.autoSubmit.bind(this))},autoSubmit:function(b){if(b.key=="enter"){if(b.target.tagName.toLowerCase()!=="textarea"){if(this.activeButton){this.activeButton.click()}}}if(b.key=="tab"){var a=b.target.tagName.toLowerCase();if(a!=="input"&&a!=="textarea"){this.selectNextButton()}}},registerComponent:function(a){this.components[a.id]=a;if(a.buttonBar||a.buttons){a.addEvent("activate",this.selectFirstButton.bind(this));a.addEvent("hide",this.clearButtons.bind(this))}if(a.singleton&&a.type){ludo.SINGLETONS[a.type]=a}},selectFirstButton:function(c){if(c.isHidden()||!c.getButtons){return}this.activeComponent=c;if(this.activeButton){this.activeButton.deSelect()}this.activeButton=undefined;var b=this.availableButtons=c.getButtons();var a;for(a=0;a<b.length;a++){if(!b[a].isHidden()&&b[a].selected){this.activeButton=b[a];b[a].select();return}}for(a=0;a<b.length;a++){if(!b[a].isHidden()&&b[a].type=="form.SubmitButton"){this.activeButton=b[a];b[a].select();return}}for(a=0;a<b.length;a++){if(!b[a].isHidden()&&b[a].type=="form.CancelButton"){this.activeButton=b[a];b[a].select();return}}},selectNextButton:function(){if(this.activeButton){this.activeButton.deSelect()}var a=this.availableButtons.indexOf(this.activeButton);a++;if(a>=this.availableButtons.length){a=0}this.activeButton=this.availableButtons[a];this.activeButton.select()},clearButtons:function(a){if(this.activeComponent&&this.activeComponent.getId()==a.getId()){this.activeComponent=undefined;this.activeButton=undefined;this.activeButton=undefined}},deleteComponent:function(a){this.clearButtons(a);delete this.components[a.getId()]},get:function(a){return a.initialize!==undefined?a:this.components[a]},zIndex:1,getNewZIndex:function(){this.zIndex++;return this.zIndex},newComponent:function(cmpConfig,parentComponent){console.log("old code");cmpConfig=cmpConfig||{};if(!this.isConfigObject(cmpConfig)){if(parentComponent){if(cmpConfig.getParent()&&cmpConfig.getParent().removeChild){cmpConfig.getParent().removeChild(cmpConfig)}cmpConfig.setParentComponent(parentComponent)}return cmpConfig}else{if(parentComponent){cmpConfig.els=cmpConfig.els||{};if(!cmpConfig.renderTo&&parentComponent.getEl()){cmpConfig.renderTo=parentComponent.getEl()}cmpConfig.parentComponent=parentComponent}var ret;var cmpType=this.getViewType(cmpConfig,parentComponent);if(cmpType.countNameSpaces>1){var tokens=cmpConfig.type.split(/\./g);var ns=tokens.join(".");ret=eval("new window.ludo."+ns+"(cmpConfig)");if(!ret.type){ret.type=ns}return ret}else{if(cmpType.nameSpace){if(!window.ludo[cmpType.nameSpace][cmpType.componentType]&&parentComponent){parentComponent.log("Class ludo."+cmpType.nameSpace+"."+cmpType.componentType+" does not exists")}ret=new window.ludo[cmpType.nameSpace][cmpType.componentType](cmpConfig);if(!ret.type){ret.type=cmpType.nameSpace}return ret}else{if(!window.ludo[cmpType.componentType]&&parentComponent){parentComponent.log("Cannot create object of type "+cmpType.componentType)}return new window.ludo[cmpType.componentType](cmpConfig)}}}},getViewType:function(c,g){var b="";var a="";if(c.type){b=c.type}else{if(c.cType){b=c.cType}else{b=g.cType}}var f=0;if(b.indexOf(".")>=0){var d=b.split(/\./g);a=d[0];b=d[1];f=d.length-1}return{nameSpace:a,componentType:b,countNameSpaces:f}},isConfigObject:function(a){return a&&a.initialize?false:true}});ludo.CmpMgr=new ludo.CmpMgrClass();ludo.getView=function(a){return ludo.CmpMgr.get(a)};ludo.get=function(a){return ludo.CmpMgr.get(a)};ludo._new=function(a){if(a.type&&ludo.SINGLETONS[a.type]){return ludo.SINGLETONS[a.type]}return ludo.factory.create(a)};ludo.FormMgrClass=new Class({Extends:Events,formElements:{},elementArray:[],posArray:{},forms:{},add:function(b){var a=b.getName();if(!this.formElements[a]){this.formElements[a]=b;this.elementArray.push(b);this.posArray[b.getId()]=this.elementArray.length-1}b.addEvent("focus",this.setFocus.bind(this));b.addEvent("click",this.setFocus.bind(this))},getNext:function(b){if(this.posArray[b.getId()]){var a=this.posArray[b.getId()];if(a<this.elementArray.length-1){return this.elementArray[a+1]}}return null},get:function(a){return this.formElements[a]?this.formElements[a]:null},currentFocusedElement:undefined,setFocus:function(b,a){if(a.isFormElement()&&a!==this.currentFocusedElement){if(this.currentFocusedElement&&this.currentFocusedElement.hasFocus()){this.currentFocusedElement.blur()}this.currentFocusedElement=a;
this.fireEvent("focus",a)}}});ludo.Form=new ludo.FormMgrClass();ludo.Effect=new Class({Extends:Events,inProgress:false,initialize:function(){if(Browser.ie){document.id(document.documentElement).addEvent("selectstart",this.cancelSelection.bind(this))}},fireEvents:function(a){this.fireEvent("start",a);this.fireEvent("end",a)},start:function(){this.fireEvent("start");this.inProgress=true;this.disableSelection()},end:function(){this.fireEvent("end");this.inProgress=false;this.enableSelection()},disableSelection:function(){ludo.dom.addClass(document.body,"ludo-unselectable")},enableSelection:function(){document.body.removeClass("ludo-unselectable")},cancelSelection:function(){return !(this.inProgress)}});ludo.EffectObject=new ludo.Effect();ludo.language={words:{},set:function(a,b){this.words[a]=b},get:function(a){return this.words[a]?this.words[a]:a},fill:function(a){this.words=Object.merge(this.words,a)}};ludo.RegistryClass=new Class({storage:{},set:function(a,b){this.storage[a]=b},get:function(a){return this.storage[a]}});ludo.registry=new ludo.RegistryClass();ludo.storage.LocalStorage=new Class({supported:false,initialize:function(){this.supported=typeof(Storage)!=="undefined"},save:function(a,c){if(!this.supported){return}var b="simple";if(ludo.util.isObject(c)||ludo.util.isArray(c)){c=JSON.encode(c);b="object"}localStorage[a]=c;localStorage[this.getTypeKey(a)]=b},get:function(a){if(!this.supported){return undefined}var b=this.getType(a);if(b==="object"){return JSON.decode(localStorage[a])}return localStorage[a]},getTypeKey:function(a){return a+"___type"},getType:function(a){a=this.getTypeKey(a);if(localStorage[a]!==undefined){return localStorage[a]}return"simple"},clearLocalStore:function(){localStorage.clear()}});ludo.localStorage=undefined;ludo.getLocalStorage=function(){if(!ludo.localStorage){ludo.localStorage=new ludo.storage.LocalStorage()}return ludo.localStorage};ludo.ObjectFactory=new Class({namespaces:[],classReferences:{},create:function(a){if(this.isClass(a)){return a}a.type=a.type||"View";if(this.classReferences[a.type]!==undefined){return new this.classReferences[a.type](a)}var c=this.getInNamespace("ludo",a);if(c){return c}for(var b=0;b<this.namespaces.length;b++){var d=this.getInNamespace(this.namespaces[b],a);if(d){return d}}ludo.util.log("Could not find class "+a.type);return undefined},registerClass:function(a,b){this.classReferences[a]=b},createNamespace:function(a){if(window[a]===undefined){window[a]={}}if(this.namespaces.indexOf(a)===-1){this.namespaces.push(a)}},getInNamespace:function(d,a){var c=a.type.split(/\./g);if(c[0]===d){c.shift()}var f=window[d];for(var b=0;b<c.length;b++){if(f[c[b]]!==undefined){f=f[c[b]]}else{return undefined}}return new f(a)},isClass:function(a){return a&&a.initialize!==undefined}});ludo.factory=new ludo.ObjectFactory();ludo._Config=new Class({storage:{},initialize:function(){this.setDefaultValues()},reset:function(){this.setDefaultValues()},setDefaultValues:function(){this.storage={url:"/controller.php",documentRoot:"/",socketUrl:"http://your-node-js-server-url:8080/",modRewrite:false,fileUploadUrl:undefined}},setUrl:function(a){this.storage.url=a},getUrl:function(){return this.storage.url},enableModRewriteUrls:function(){this.storage.modRewrite=true},disableModRewriteUrls:function(){this.storage.modRewrite=false},hasModRewriteUrls:function(){return this.storage.modRewrite===true},setSocketUrl:function(a){this.storage.socketUrl=a},getSocketUrl:function(){return this.storage.socketUrl},setDocumentRoot:function(a){this.storage.documentRoot=a==="."?"":a},getDocumentRoot:function(){return this.storage.documentRoot},setFileUploadUrl:function(a){this.storage.fileUploadUrl=a},getFileUploadUrl:function(){return this.storage.fileUploadUrl}});ludo.config=new ludo._Config();var Asset={javascript:function(d,b){if(!b){b={}}var a=new Element("script",{src:d,type:"text/javascript"}),f=b.document||document,c=b.onload||b.onLoad;delete b.onload;delete b.onLoad;delete b.document;if(c){if(typeof a.onreadystatechange!="undefined"){a.addEvent("readystatechange",function(){if(["loaded","complete"].contains(this.readyState)){c.call(this)}})}else{a.addEvent("load",c)}}return a.set(b).inject(f.head)},css:function(d,a){if(!a){a={}}var b=new Element("link",{rel:"stylesheet",media:"screen",type:"text/css",href:d});var c=a.onload||a.onLoad,f=a.document||document;delete a.onload;delete a.onLoad;delete a.document;if(c){b.addEvent("load",c)}return b.set(a).inject(f.head)}};if(Browser.ie&&Browser.version<9){Asset.css("dashboard/css/dashboard-ie.css")}ludo.Core=new Class({Extends:Events,id:undefined,name:undefined,module:undefined,submodule:undefined,controller:undefined,useController:false,stateful:false,statefulProperties:undefined,dependency:{},addOns:undefined,initialize:function(a){a=a||{};this.lifeCycle(a);this.applyAddOns()},lifeCycle:function(a){this.ludoConfig(a);this.ludoEvents()},applyAddOns:function(){if(this.addOns){for(var a=0;a<this.addOns.length;a++){this.addOns[a].parentComponent=this;
this.addOns[a]=this.createDependency("addOns"+a,this.addOns[a])}}},ludoConfig:function(a){this.setConfigParams(a,["url","name","controller","module","submodule","stateful","id","useController","addOns"]);if(this.stateful&&this.statefulProperties&&this.id){a=this.appendPropertiesFromStore(a);this.addEvent("state",this.saveStatefulProperties.bind(this))}if(a.listeners!==undefined){this.addEvents(a.listeners)}if(this.controller!==undefined){ludo.controllerManager.assignSpecificControllerFor(this.controller,this)}if(this.module||this.useController){ludo.controllerManager.registerComponent(this)}if(!this.id){this.id="ludo-"+String.uniqueID()}ludo.CmpMgr.registerComponent(this)},setConfigParams:function(a,c){for(var b=0;b<c.length;b++){if(a[c[b]]!==undefined){this[c[b]]=a[c[b]]}}},ludoEvents:function(){},appendPropertiesFromStore:function(a){var f=ludo.getLocalStorage().get(this.getKeyForLocalStore());if(f){var d=this.statefulProperties;for(var b=0;b<d.length;b++){a[d[b]]=f[d[b]]}}return a},saveStatefulProperties:function(){var c={};var b=this.statefulProperties;for(var a=0;a<b.length;a++){c[b[a]]=this[b[a]]}ludo.getLocalStorage().save(this.getKeyForLocalStore(),c)},getKeyForLocalStore:function(){return"state_"+this.id},getId:function(){return this.id},getName:function(){return this.name},getUrl:function(){if(this.url){return this.url}if(this.component){return this.component.getUrl()}if(this.applyTo){return this.applyTo.getUrl()}if(this.parentComponent){return this.parentComponent.getUrl()}return undefined},getEventEl:function(){return Browser.ie?document.id(document.documentElement):document.id(window)},isConfigObject:function(a){return a.initialize===undefined},NS:undefined,getNamespace:function(){if(this.NS==undefined){if(this.type){var a=this.type.split(/\./g);a.pop();this.NS=a.join(".")}else{this.NS=""}}return this.NS},hasController:function(){return this.controller?true:false},getController:function(){return this.controller},setController:function(a){this.controller=a;this.addControllerEvents()},addControllerEvents:function(){},getModule:function(){return this.getInheritedProperty("module")},getSubModule:function(){return this.getInheritedProperty("submodule")},getInheritedProperty:function(a){return this[a]!==undefined?this[a]:this.parentComponent?this.parentComponent.getInheritedProperty(a):undefined},saveState:function(){this.fireEvent("state")},createDependency:function(b,a){this.dependency[b]=ludo.util.isLudoJSConfig(a)?ludo._new(a):a;return this.dependency[b]},hasDependency:function(a){return this.dependency[a]?true:false},getDependency:function(b,a){if(this.dependency[b]){return this.dependency[b]}return this.createDependency(b,a)},relayEvents:function(c,b){for(var a=0;a<b.length;a++){c.addEvent(b[a],this.getRelayFn(b[a]).bind(this))}},getRelayFn:function(a){return function(){this.fireEvent.call(this,a,Array.prototype.slice.call(arguments))}.bind(this)}});ludo.Movable=new Class({Extends:Events,sources:{},targets:{},records:{},components:{},els:{shim:null,insertionMarker:null},dragProperties:{el:null,waiting:null,countSources:0,mouseOverCol:null,originalMousePos:{x:null,y:null},originalElPos:{x:null,y:null},jsObjects:{source:{item:null,column:null},target:{item:null,column:null,pos:null}}},id:null,delay:1,initialize:function(){this.createElements();this.id=String.uniqueID();document.body.addEvent("mouseup",this.stopMove.bind(this));document.body.addEvent("mousemove",this.mouseMove.bind(this))},addSource:function(h){var f=h.handle||null;var a=h.record||null;var b=h.component||null;var d=h.el||b.getEl();if(d.hasClass("ludo-movable")){return}if(!d.id){d.id="ludo-movable-"+String.uniqueID()}if(this.sources[d.id]){ludo.util.log(d.id);ludo.util.log("Error: "+d.id+" has duplicates")}if(a){this.records[d.id]=a}if(b){this.components[d.id]=b}this.sources[d.id]=h.el||h.component;ludo.dom.addClass(d,"ludo-movable");if(f){var c=d.getElements(f)[0];try{c.addEvent("mousedown",this.startMove.bind(this))}catch(g){ludo.util.log(h)}ludo.dom.addClass(c,"ludo-movable-handle");c.setStyle("cursor","move")}else{d.addEvent("mousedown",this.startMove.bind(this))}},addTarget:function(d){var a=d.record||null;var b=d.component||null;var c=d.el||b.getEl();if(!c.id){c.id="ludo-movable-target-"+String.uniqueID()}this.targets[c.id]=d.el||d.component;if(a){this.records[c.id]=a}if(b){this.components[c.id]=b}c.addEvent("mousemove",this.mouseMoveOnTarget.bind(this));c.addEvent("mouseover",this.mouseOverTarget.bind(this));ludo.dom.addClass(c,"ludo-movable-target")},mouseOverTarget:function(){},mouseMoveOnTarget:function(){},setWidthOfShimAndInsertionPoint:function(a){this.els.shim.setStyle("width",a);this.els.insertionMarker.setStyles({width:a,display:""})},getTargetElementFromEvent:function(b){var a=b.target;if(!a.hasClass("ludo-movable-target")){a=a.getParent(".ludo-movable-target")}return a},placeInsertionMarker:function(){},createElements:function(){this.createShim();this.createInsertionMarker()},createShim:function(){var a=this.els.shim=new Element("div");
ludo.dom.addClass(a,"ludo-framed-view-shim");a.setStyle("display","none");document.body.adopt(a)},createInsertionMarker:function(){var a=this.els.insertionMarker=new Element("div");a.setStyle("display","none");document.body.adopt(a)},stopMove:function(){if(this.dragProperties.waiting||this.dragProperties.mode){this.fireEvent("stop")}if(this.dragProperties.waiting){clearTimeout(this.dragProperties.waiting)}if(this.dragProperties.mode){this.dragProperties.mode=null;this.dragProperties.el.setStyle("display","");this.els.shim.setStyle("display","none");this.els.insertionMarker.setStyle("display","none");this.fireEvent("drop",[this,this.getSourceItem(),this.getTargetItem()])}},startMove:function(a){this.fireEvent("start");this.dragProperties.el=a.target;if(!this.dragProperties.el.hasClass("ludo-movable")){this.dragProperties.el=this.dragProperties.el.getParent(".ludo-movable")}var b=this.dragProperties.el.getCoordinates();this.els.shim.setStyle("display","none");this.resizeShim(b);this.dragProperties.mouseOverCol=null;this.dragProperties.jsObjects.target={column:null,item:null};this.setHeightOfInsertionMarker();this.dragProperties.jsObjects.source={item:this.sources[this.dragProperties.el.id],column:this.sources[this.dragProperties.el.id].getParent?this.sources[this.dragProperties.el.id].getParent():null};this.dragProperties.originalElPos={x:b.left,y:b.top};this.dragProperties.originalMousePos={x:a.page.x,y:a.page.y};if(this.hasDelay()){this.dragProperties.waiting=this.startMoveAfterDelay.delay(this.delay*1000,this)}else{this.hideSourceAndShowShim()}return false},setHeightOfInsertionMarker:function(){var a=this.dragProperties.el.getSize();this.els.insertionMarker.setStyle("height",a.y)},resizeShim:function(a){this.els.shim.setStyles({left:a.left,top:a.top+30,width:a.width,height:a.height})},hasDelay:function(){return this.delay>0},showShim:function(){this.els.shim.setStyle("display","")},startMoveAfterDelay:function(){if(this.dragProperties.waiting){this.hideSourceAndShowShim()}},hideSourceAndShowShim:function(){this.dragProperties.el.setStyle("display","none");this.dragProperties.mode="move";this.showShim();this.setInitialInsertionPoint();this.placeInsertionMarker()},mouseMove:function(a){if(this.dragProperties.mode=="move"){this.els.shim.setStyles({left:this.dragProperties.originalElPos.x+a.page.x-this.dragProperties.originalMousePos.x,top:this.dragProperties.originalElPos.y+a.page.y-this.dragProperties.originalMousePos.y+30});return false}return undefined},setInitialInsertionPoint:function(){},isActive:function(){return this.dragProperties.mode?true:false},getSourceColumn:function(){return this.dragProperties.jsObjects.source.column},getSourceItem:function(){return this.dragProperties.jsObjects.source.item},getTargetColumn:function(){return this.dragProperties.jsObjects.target.column},getTargetItem:function(){return this.dragProperties.jsObjects.target.item},getTargetPosition:function(){return this.dragProperties.jsObjects.target.pos},getSourceRecord:function(){return this.records[this.dragProperties.jsObjects.source.item.id]},getTargetRecord:function(){if(!this.dragProperties.jsObjects.target.item){return null}return this.records[this.dragProperties.jsObjects.target.item.id]},getSourceComponent:function(){return this.components[this.dragProperties.jsObjects.source.item.id]},getTargetView:function(){if(!this.dragProperties.jsObjects.target.item){return null}return this.components[this.dragProperties.jsObjects.target.item.id]}});ludo.remote.Inject=new Class({data:{},add:function(b,d){var f=b.split(/\//g);var c=f[0];var a=f[1];if(this.data[c]===undefined){this.data[c]={}}this.data[c][a]=d},get:function(c,a){if(this.data[c]&&this.data[c][a]){var b=this.data[c][a];delete this.data[c][a];return b}return undefined}});ludo.remoteInject=new ludo.remote.Inject();ludo.remote.Base=new Class({Extends:Events,remoteData:undefined,method:"post",initialize:function(a){a=a||{};if(a.listeners!==undefined){this.addEvents(a.listeners)}this.method=a.method||this.method;if(a.resource!==undefined){this.resource=a.resource}if(a.url!==undefined){this.url=a.url}if(a.shim){new ludo.remote.Shim({renderTo:a.shim.renderTo,remoteObj:this,txt:a.shim.txt})}},send:function(a,d,b,c){this.remoteData=undefined;if(d&&!ludo.util.isArray(d)){d=[d]}ludo.remoteBroadcaster.clear(this,a);this.fireEvent("start");this.sendToServer(a,d,b,c)},onComplete:function(){this.fireEvent("complete",this)},getUrl:function(a,c){var b=this.url!==undefined?this.url:ludo.config.getUrl();if(ludo.config.hasModRewriteUrls()){b=ludo.config.getDocumentRoot()+this.getServicePath(a,c)}else{b=this.url!==undefined?ludo.util.isFunction(this.url)?this.url.call():this.url:ludo.config.getUrl()}return b},getServicePath:function(a,b){var c=[this.resource];if(b&&b.length){c.push(b.join("/"))}if(a){c.push(a)}return c.join("/")},getDataForRequest:function(a,g,f,d){var b={data:f};if(d){if(ludo.util.isObject(d)){b=Object.merge(d,b)}}if(!ludo.config.hasModRewriteUrls()&&this.resource){b.request=this.getServicePath(a,g)
}var c=ludo.remoteInject.get(this.resource,a);if(c){b.data=b.data?Object.merge(b.data,c):c}return b},getResponseCode:function(){return this.remoteData&&this.remoteData.code?this.remoteData.code:0},getResponseMessage:function(){return this.remoteData&&this.remoteData.message?this.remoteData.message:undefined},getResource:function(){return this.resource},sendBroadCast:function(a){ludo.remoteBroadcaster.broadcast(this,a)}});ludo.remote.JSON=new Class({Extends:ludo.remote.Base,resource:undefined,url:undefined,initialize:function(a){this.parent(a)},sendToServer:function(a,d,b,c){if(d&&!ludo.util.isArray(d)){d=[d]}this.fireEvent("start",this);this.sendBroadCast(a);var f=new Request.JSON({url:this.getUrl(a,d),method:this.method,noCache:true,data:this.getDataForRequest(a,d,b,c),onSuccess:function(g){this.remoteData=g;if(g.success||g.success===undefined){this.fireEvent("success",this)}else{this.fireEvent("failure",this)}this.sendBroadCast(a);this.onComplete()}.bind(this),onError:function(h,g){this.remoteData={code:500,message:g};this.fireEvent("servererror",this);this.sendBroadCast(a);this.onComplete()}.bind(this)});f.send()},getResponseData:function(){if(!this.remoteData.response){return undefined}return this.remoteData.response.data?this.remoteData.response.data:this.remoteData.response},getResponse:function(){return this.remoteData},setResource:function(a){this.resource=a}});ludo.remote.HTML=new Class({Extends:ludo.remote.Base,HTML:undefined,sendToServer:function(a,d,b,c){var f=new Request({url:this.getUrl(a,d),method:this.method,noCache:true,evalScripts:true,data:this.getDataForRequest(a,d,b,c),onSuccess:function(g){this.remoteData=g;this.fireEvent("success",this);this.sendBroadCast(a);this.onComplete()}.bind(this),onError:function(h,g){this.remoteData={code:500,message:g};this.fireEvent("servererror",this);this.sendBroadCast(a);this.onComplete()}.bind(this)});f.send()},getResponseData:function(){return this.remoteData},getResponse:function(){return this.remoteData}});ludo.remote.Broadcaster=new Class({Extends:Events,defaultMessages:{},broadcast:function(g,b){var f=g.getResponseCode();var d,a;switch(f){case 0:d="start";break;case 200:d="success";break;default:d="failure";break}var c=this.getEventName(d,g.getResource());if(c){a=this.getEventName(d,g.getResource(),b)}else{c=this.getEventName("serverError",g.getResource());a=this.getEventName("serverError",g.getResource(),b)}var h={message:g.getResponseMessage(),code:g.getResponseCode(),resource:g.getResource(),service:b,type:d};if(!h.message){h.message=this.getDefaultMessage(a||c)}this.fireEvent(c,h);if(b){this.fireEvent(a,h)}},getDefaultMessage:function(a){return this.defaultMessages[a]?this.defaultMessages[a]:""},clear:function(d,b){var f={message:d.getResponseMessage(),code:d.getResponseCode(),resource:d.getResource(),service:b};var c=this.getEventName("clear",f.resource);var a=this.getEventName("clear",f.resource,b);this.fireEvent(c,f);if(b){this.fireEvent(a,f)}},getEventName:function(b,c,a){c=c||"";a=a||"";return[c,a,b.capitalize(),"Message"].join("")},addResourceEvent:function(a,c,b){this.addEvent(this.getEventName(a,c),b)},addServiceEvent:function(c,f,b,d){if(!b.length){this.addEvent(this.getEventName(c,f,undefined),d)}else{for(var a=0;a<b.length;a++){this.addEvent(this.getEventName(c,f,b[a]),d)}}},setDefaultMessage:function(c,b,d,a){this.defaultMessages[this.getEventName(b,d,a)]=c},eventObjToBuild:{},withResourceService:function(a){var b=a.split(/\//g);this.withResource(b[0]);if(b.length==2){this.withService(b[1])}return this},withResource:function(a){this.eventObjToBuild={resource:a};return this},withService:function(a){if(this.eventObjToBuild.service===undefined){this.eventObjToBuild.service=[]}this.eventObjToBuild.service.push(a);return this},on:function(b,c){if(!ludo.util.isArray(b)){b=[b]}for(var a=0;a<b.length;a++){this.addServiceEvent(b[a],this.eventObjToBuild.resource,this.eventObjToBuild.service,c)}return this}});ludo.remoteBroadcaster=new ludo.remote.Broadcaster();ludo.canvas.Engine=new Class({tCache:{},tCacheStrings:{},classNameCache:{},cache:{},set:function(b,a,c){if(a.substring(0,6)=="xlink:"){if(c.id!==undefined){c="#"+c.getId()}b.setAttributeNS("http://www.w3.org/1999/xlink",a.substring(6),c)}else{if(c.id!==undefined){c="url(#"+c.getId()+")"}b.setAttribute(a,c)}},remove:function(b,a){if(a.substring(0,6)=="xlink:"){b.removeAttributeNS("http://www.w3.org/1999/xlink",a.substring(6))}else{b.removeAttribute(a)}},get:function(b,a){if(a.substring(0,6)=="xlink:"){return b.getAttributeNS("http://www.w3.org/1999/xlink",a.substring(6))}else{return b.getAttribute(a)}},text:function(a,b){a.textContent=b},show:function(a){this.setStyle(a,"display","")},hide:function(a){this.setStyle(a,"display","none")},moveTo:function(b,a,c){b.setAttribute("x",a);b.setAttribute("y",c)},toBack:function(a){if(Browser.ie){this._toBack.delay(20,this,a)}else{this._toBack(a)}},_toBack:function(a){a.parentNode.insertBefore(a,a.parentNode.firstChild)},toFront:function(a){if(Browser.ie){this._toFront.delay(20,this,a)
}else{this._toFront(a)}},_toFront:function(a){a.parentNode.appendChild(a)},rotate:function(b,a){this.setTransformation(b,"rotate",a)},rotateAround:function(c,b,a,d){this.setTransformation(c,"rotate",b+" "+a+" "+d)},skewX:function(a,b){this.getTransformObject(a);a.transform.baseVal.getItem(0).setSkewX(b)},skewY:function(a,b){this.getTransformObject(a);a.transform.baseVal.getItem(0).setSkewY(b)},getCenter:function(a){return{x:this.getWidth(a)/2,y:this.getHeight(a)/2}},translate:function(b,a,c){this.setTransformation(b,"translate",a+" "+c)},getCurrentCache:function(b,a){return this.cache[b.id]!==undefined&&this.cache[b.id][a]!==undefined?this.cache[b.id][a]:[0,0]},scale:function(c,b,a){a=a||b;this.setTransformation(c,"scale",b+" "+a)},applyTransformationToMatrix:function(d,f,a,h){var b=this.getTransformObject(d);var g=this.getCurrentCache(d,f);if(h!==undefined){b.setMatrix(b.matrix[f](a-g[0],h-g[1]))}else{b.setMatrix(b.matrix[f](a-g[0]))}if(this.cache[d.id]===undefined){this.cache[d.id]={}}if(f==="scale"){a--;h--}this.cache[d.id][f]=[a,h]},setTransformMatrix:function(j,h,g,n,m,l,k){this.getTransformObject(j).setMatrix(h,g,n,m,l,k)},getTransformObject:function(c){if(c.transform.baseVal.numberOfItems==0){var a;if(c.ownerSVGElement){a=c.ownerSVGElement}else{a=document.createElementNS("http://www.w3.org/2000/svg","svg")}var b=a.createSVGTransform();c.transform.baseVal.appendItem(b)}return c.transform.baseVal.getItem(0)},setTransformation:function(a,b,c){var d=this.get(a,"id");this.buildTransformationCacheIfNotExists(a,d);this.updateTransformationCache(d,b,c);this.set(a,"transform",this.getTransformationAsText(d))},updateTransformationCache:function(d,b,c){c=c.toString();if(isNaN(c)){c=c.replace(/,/g," ");c=c.replace(/\s+/g," ")}var a=c.split(/\s/g);this.tCache[d][b]={values:a,readable:this.getValidReturn(b,a)};this.tCacheStrings[d]=undefined},clearTransformation:function(a){if(Browser.ie){a.setAttribute("transform",null)}else{a.removeAttribute("transform")}this.clearTransformationCache(a)},clearTransformationCache:function(a){this.tCache[this.get(a,"id")]=undefined},getTransformation:function(b,a){var c=this.get(b,"id");this.buildTransformationCacheIfNotExists(b,c);return this.tCache[c][a]?this.tCache[c][a].readable:undefined},buildTransformationCacheIfNotExists:function(a,b){if(!this.hasTransformationCache(b)){this.buildTransformationCache(a,b)}},getTransformationValues:function(f,d){var b=[];d=d.toLowerCase();var c=(this.get(f,"transform")||"").toLowerCase();var j=c.indexOf(d);if(j>=0){c=c.substr(j);var h=c.indexOf("(")+1;var a=c.indexOf(")");var g=c.substring(h,a);g=g.replace(/,/g," ");g=g.replace(/\s+/g," ");return g.split(/[,\s]/g)}return b},hasTransformationCache:function(a){return this.tCache[a]!==undefined},getValidReturn:function(c,a){var b={};switch(c){case"skewX":case"skewY":b=a[0];break;case"rotate":b.degrees=a[0];b.cx=a[1]?a[1]:0;b.cy=a[2]?a[2]:0;break;default:b.x=parseFloat(a[0]);b.y=a[1]?parseFloat(a[1]):b.x}return b},buildTransformationCache:function(c,f){f=f||this.get(c,"id");this.tCache[f]={};var d=this.getTransformationKeys(c);for(var b=0;b<d.length;b++){var a=this.getTransformationValues(c,d[b]);this.tCache[f][d[b]]={values:a,readable:this.getValidReturn(d[b],a)}}},getTransformationKeys:function(d){var a=[];var c=this.get(d,"transform")||"";var f=c.split(/\(/g);for(var b=0;b<f.length-1;b++){a.push(f[b].replace(/[^a-z]/gi,""))}return a},getTCache:function(a){return this.tCache[this.get(a,"id")]},getTransformationAsText:function(a){if(this.tCacheStrings[a]===undefined&&this.tCache[a]!==undefined){this.buildCacheString(a)}return this.tCacheStrings[a]},buildCacheString:function(c){this.tCacheStrings[c]="";var b=Object.keys(this.tCache[c]);for(var a=0;a<b.length;a++){this.tCacheStrings[c]+=b[a]+"("+this.tCache[c][b[a]].values.join(" ")+") "}this.tCacheStrings[c]=this.tCacheStrings[c].trim()},setStyle:function(b,a,c){b.style[String.camelCase(a)]=c},addClass:function(c,b){if(!this.hasClass(c,b)){var d=this.getId(c);this.classNameCache[d].push(b);this.updateNodeClassNameById(c,d)}var a=c.getAttribute("class");if(a){a=a.split(/\s/g);if(a.indexOf(b)>=0){return}a.push(b);this.set(c,"class",a.join(" "))}else{this.set(c,"class",b)}},hasClass:function(c,b){var d=this.getId(c);if(!this.classNameCache[d]){var a=c.getAttribute("class");if(a){this.classNameCache[d]=a.split(/\s/g)}else{this.classNameCache[d]=[]}}return this.classNameCache[d].indexOf(b)>=0},removeClass:function(b,a){if(this.hasClass(b,a)){var c=this.getId(b);this.classNameCache[c].erase(a);this.updateNodeClassNameById(b,c)}},updateNodeClassNameById:function(a,b){this.set(a,"class",this.classNameCache[b].join(" "))},getId:function(a){if(!a.getAttribute("id")){a.setAttribute("id",String.uniqueID())}return a.getAttribute("id")},effect:function(){if(ludo.canvas.effectObject===undefined){ludo.canvas.effectObject=new ludo.canvas.Effect()}return ludo.canvas.effectObject},empty:function(a){a.textContent=""},toRadians:function(a){return a*Math.PI/180},getPointAtDegreeOffset:function(g,d,b){var c=ludo.canvasEngine.toRadians(d);
var a=Math.cos(c);var f=Math.sin(c);return{x:g.x+(b*a),y:g.y+(b*f)}}});ludo.canvasEngine=new ludo.canvas.Engine();ludo.canvas.Node=new Class({Extends:Events,el:undefined,tagName:undefined,id:undefined,initialize:function(b,a,c){a=a||{};a.id=this.id=a.id||"ludo-svg-node-"+String.uniqueID();if(b!==undefined){this.tagName=b}this.createNode(this.tagName,a);if(c!==undefined){ludo.canvasEngine.text(this.el,c)}},createNode:function(b,a){if(a!==undefined){if(typeof b=="string"){b=this.createNode(b)}Object.each(a,function(d,c){if(d.getUrl!==undefined){d=d.getUrl()}if(c.substring(0,6)=="xlink:"){b.setAttributeNS("http://www.w3.org/1999/xlink",c.substring(6),d)}else{b.setAttribute(c,d)}})}else{b=document.createElementNS("http://www.w3.org/2000/svg",b)}this.el=b;b.style&&(b.style.webkitTapHighlightColor="rgba(0,0,0,0)");return b},getEl:function(){return this.el},engine:function(){return ludo.canvasEngine},addEvents:function(b){for(var a in b){if(b.hasOwnProperty(a)){this.addEvent(a,b[a])}}},addEvent:function(b,a){switch(b.toLowerCase()){case"mouseenter":ludo.canvasEventManager.addMouseEnter(this,a);break;case"mouseleave":ludo.canvasEventManager.addMouseLeave(this,a);break;default:this._addEvent(b,this.getDOMEventFn(b,a),this.el);this.parent(b,a)}},_addEvent:(function(){if(document.addEventListener){return function(c,b,a){if(a==undefined){a=this.el}a.addEventListener(c,b,false)}}else{return function(c,b,a){if(a==undefined){a=this.el}a.attachEvent("on"+c,b)}}})(),getDOMEventFn:function(a,b){return function(d){d=d||window.event;var c=d.target||d.srcElement;while(c&&c.nodeType==3){c=c.parentNode}c=c.correspondingUseElement||c;d={target:c,page:{x:(d.pageX!=null)?d.pageX:d.clientX+document.scrollLeft,y:(d.pageY!=null)?d.pageY:d.clientY+document.scrollTop},client:{x:(d.pageX!=null)?d.pageX-window.pageXOffset:d.clientX,y:(d.pageY!=null)?d.pageY-window.pageYOffset:d.clientY},event:d};if(b){b.call(this,d,this,b)}return false}.bind(this)},adopt:function(a){this.el.appendChild(a.getEl());a.parentNode=this;return this},getParent:function(){return this.parentNode},show:function(){ludo.canvasEngine.show(this.el)},hide:function(){ludo.canvasEngine.hide(this.el)},setProperties:function(b){for(var a in b){if(b.hasOwnProperty(a)){this.set(a,b[a])}}},set:function(a,b){ludo.canvasEngine.set(this.el,a,b)},remove:function(a){ludo.canvasEngine.remove(this.el,a)},get:function(a){return ludo.canvasEngine.get(this.el,a)},getTransformation:function(a){return ludo.canvasEngine.getTransformation(this.el,a)},setTransformation:function(a,b){ludo.canvasEngine.setTransformation(this.el,a,b)},translate:function(a,b){if(b===undefined){b=a.y;a=a.x}ludo.canvasEngine.setTransformation(this.el,"translate",a+" "+b)},getTranslate:function(){return ludo.canvasEngine.getTransformation(this.el,"translate")},rotate:function(b,a,c){ludo.canvasEngine[a!==undefined?"rotateAround":"rotate"](this.el,b,a,c)},applyFilter:function(a){this.set("filter",a.getUrl())},applyMask:function(a){this.set("mask",a.getUrl())},applyClipPath:function(a){this.set("clip-path",a.getUrl())},url:function(a,b){this.set(a,b.getUrl!==undefined?b.getUrl():"url(#"+b+")")},href:function(a){ludo.canvasEngine.set(this.el,"xlink:href",a)},text:function(a){ludo.canvasEngine.text(this.el,a)},add:function(b,a,d){var c=new ludo.canvas.Node(b,a,d);this.adopt(c);return c},setStyle:function(a,b){ludo.canvasEngine.setStyle(this.el,a,b)},setStyles:function(b){for(var a in b){if(b.hasOwnProperty(a)){this.setStyle(a,b[a])}}},addClass:function(a){ludo.canvasEngine.addClass(this.el,a)},hasClass:function(a){return ludo.canvasEngine.hasClass(this.el,a)},removeClass:function(a){ludo.canvasEngine.removeClass(this.el,a)},getId:function(){return this.id},getUrl:function(){return"url(#"+this.id+")"},getBBox:function(){return this.el.getBBox()},getSize:function(){var a=this.getBBox();return{x:a.width-a.x,y:a.height-a.y}},getCanvas:function(){return this.el.ownerSVGElement},getViewPort:function(){return this.el.viewPortElement},scale:function(b,a){ludo.canvasEngine.scale(this.el,b,a)},setTransformMatrix:function(j,h,g,n,m,l,k){this.setTransformMatrix(this.el,h,g,n,m,l,k)},empty:function(){ludo.canvasEngine.empty(this.getEl())},_curtain:undefined,curtain:function(a){if(this._curtain===undefined){this._curtain=new ludo.canvas.Curtain(this,a)}return this._curtain},_animation:undefined,animate:function(a,c,b){this.animation().animate(a,c,b)},animation:function(){if(this._animation===undefined){this._animation=new ludo.canvas.Animation(this.getEl())}return this._animation},toFront:function(){ludo.canvasEngine.toFront(this.getEl())},toBack:function(){ludo.canvasEngine.toBack(this.getEl())}});ludo.canvas.Element=new Class({Extends:ludo.Core,node:undefined,tag:undefined,engine:ludo.canvasEngine,p:undefined,attr:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["tag","attr"]);this.node=new ludo.canvas.Node(this.tag,this.attr)},getNode:function(){return this.node},getEl:function(){return this.node.el},set:function(a,b){this.engine.set(this.getEl(),a,b)
},get:function(a){return this.engine.get(this.getEl(),a)},setHtml:function(a){this.engine.setHtml(this.getEl(),a)},rotate:function(a){this.engine.rotate(this.getEl(),a)},toFront:function(){this.engine.toFront(this.getEl())},toBack:function(){this.engine.toBack(this.getEl())},skewX:function(a){this.engine.skewX(this.getEl(),a)},skewY:function(a){this.engine.skewY(this.getEl(),a)},adopt:function(a){this.node.adopt(a);return this},empty:function(){this.node.empty();return this},add:function(c,b,a){return this.node.add(c,b,a)}});ludo.canvas.Canvas=new Class({Extends:ludo.canvas.Element,tag:"svg",defaultProperties:{xmlns:"http://www.w3.org/2000/svg",version:"1.1"},renderTo:undefined,view:undefined,title:undefined,description:undefined,ludoConfig:function(a){a=a||{};a.attr=a.attr||{};a.attr=Object.merge(a.attr,this.defaultProperties);this.parent(a);this.setConfigParams(a,["renderTo","title","description"]);if(this.title){this.createTitle()}if(this.description){this.createDescription()}if(this.renderTo!==undefined){if(this.renderTo.getBody!==undefined){this.view=this.renderTo;this.view.addEvent("resize",this.fitParent.bind(this));this.renderTo=this.view.getBody()}else{this.renderTo=document.id(this.renderTo)}this.renderTo.adopt(this.getEl());this.setInitialSize(a)}},setInitialSize:function(a){a.width=a.width||this.width;a.height=a.height||this.height;if(a.width&&a.height){this.set("width",a.width);this.set("height",a.height);this.setViewBox(a.width,a.height);this.width=a.width;this.height=a.height}else{this.fitParent();this.renderTo.addEvent("resize",this.fitParent.bind(this))}},fitParent:function(){var a=this.renderTo.getSize();if(a.x===0||a.y===0){return}a.x-=(ludo.dom.getPW(this.renderTo)+ludo.dom.getBW(this.renderTo));a.y-=(ludo.dom.getPH(this.renderTo)+ludo.dom.getBH(this.renderTo));this.set("width",a.x);this.set("height",a.y);this.setViewBox(a.x,a.y);this.node.setStyle("width",a.x+"px");this.node.setStyle("height",a.y+"px");this.width=a.x;this.height=a.y;this.fireEvent("resize",a)},getHeight:function(){return this.height},getWidth:function(){return this.width},getCenter:function(){return{x:this.width/2,y:this.height/2}},setViewBox:function(c,b,a,d){this.set("viewBox",(a||0)+" "+(d||0)+" "+c+" "+b)},createTitle:function(){this.adopt(new ludo.canvas.Node("title",{},this.title))},createDescription:function(){this.adopt(new ludo.canvas.Node("desc",{},this.description))},defsNode:undefined,getDefs:function(){if(this.defsNode===undefined){this.defsNode=new ludo.canvas.Node("defs");this.adopt(this.defsNode)}return this.defsNode},adoptDef:function(a){return this.getDefs().adopt(a)}});ludo.layout.TextBox=new Class({Extends:ludo.canvas.Canvas,rotation:270,text:undefined,className:undefined,width:200,height:200,size:{x:0,y:0},x:0,y:0,ludoConfig:function(a){this.text=a.text;this.rotation=a.rotation;this.className=a.className;this.renderTo=a.renderTo;if(a.x!==undefined){this.x=a.x}if(a.y!==undefined){this.y=a.y}if(document.createElementNS===undefined){this.createIE8Box(a);return}this.parent(a);this.createStyles();this.renderText();this.storeSize();this.rotate();this.resizeCanvas()},createIE8Box:function(){var a=document.createElement("span");document.id(this.renderTo).appendChild(a);a.innerHTML=this.text;this.setIE8Transformation(a);return a},setIE8Transformation:function(b){var a=b.style;a.display="block";a.visibility="hidden";a.position="absolute";b.className=this.className;document.body.adopt(b);a.fontSize="12px";a.fontWeight="normal";a.filter="progid:DXImageTransform.Microsoft.Matrix("+this.getIE8Transformation()+", sizingMethod='auto expand')";a.height=b.offsetHeight+"px";this.size.x=b.offsetWidth;this.size.y=b.offsetHeight;if(this.rotation===90){a.right="0px"}a.visibility="visible";document.id(this.renderTo).appendChild(b)},deg2radians:Math.PI*2/360,getIE8Transformation:function(){var a=this.rotation*this.deg2radians;var b=Math.cos(a);var c=Math.sin(a);return["M11="+b,"M12="+(c*-1),"M21="+c,"M22="+b].join(",")},resizeCanvas:function(){var a=this.getSize();this.setViewBox(a.x,a.y);this.set("width",a.x);this.set("height",a.y)},createStyles:function(){this.styles=this.getStyles();var a=this.paint=new ludo.canvas.Paint(this.styles);this.adoptDef(a)},renderText:function(){var a=this.textNode=new ludo.canvas.Node("text",{x:this.x,y:this.y+parseInt(this.styles["font-size"]),"class":this.paint});a.text(this.text);this.adopt(a)},getStyles:function(){var c=new Element("div");c.className=this.className;c.style.display="none";document.body.adopt(c);var a=c.getStyle("line-height").replace(/[^0-9]/g,"");if(!a){a=c.getStyle("font-size")}var b={"font-size":c.getStyle("font-size"),"font-family":c.getStyle("font-family"),"font-weight":c.getStyle("font-weight"),"font-style":c.getStyle("font-style"),"line-height":a,fill:c.getStyle("color"),stroke:"none","stroke-opacity":0};b["line-height"]=b["line-height"]||b["font-size"];document.body.removeChild(c);return b},storeSize:function(){var a=this.textNode.el.getBBox();this.size={x:a.width+a.x,y:a.height+a.y}
},rotate:function(){var a=this.size.x;var d=this.size.y;var c=(this.size.y-parseInt(this.styles["line-height"]))/2;var b="";switch(this.rotation){case 270:b="translate("+(c*-1)+" "+a+") rotate("+this.rotation+")";break;case 180:b="rotate("+this.rotation+" "+(a/2)+" "+(d/2)+")";break;case 90:b="translate("+(d-c)+" "+0+") rotate("+this.rotation+")";break;case 0:b="translate(0 "+(c*-1)+")"}this.textNode.set("transform",b)},getSize:function(){switch(this.rotation){case 270:case 90:return{x:this.size.y,y:this.size.x};default:return this.size}}});ludo.layout.Resizer=new Class({Extends:ludo.Core,layout:{},orientation:undefined,view:undefined,dd:undefined,pos:undefined,isActive:false,hidden:false,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["orientation","view","layout","pos","hidden"]);this.createDOM(a.renderTo);this.addViewEvents();this.createDragable();if(this.hidden){this.hide()}},createDOM:function(a){this.el=new Element("div");this.el.addEvent("mouseenter",this.enterResizer.bind(this));this.el.addEvent("mouseleave",this.leaveResizer.bind(this));ludo.dom.addClass(this.el,"ludo-resize-handle");ludo.dom.addClass(this.el,"ludo-resize-handle-"+((this.orientation==="horizontal")?"col":"row"));ludo.dom.addClass(this.el,"ludo-layout-resize-"+((this.orientation==="horizontal")?"col":"row"));this.el.style.cursor=this.orientation==="horizontal"?"w-resize":"s-resize";this.el.style.zIndex=100000;a.appendChild(this.el)},enterResizer:function(){if(!this.isActive){this.el.style.zIndex=parseInt(this.el.style.zIndex)+1;ludo.dom.addClass(this.el,"ludo-resize-handle-active")}},leaveResizer:function(){if(!this.isActive){this.el.style.zIndex=parseInt(this.el.style.zIndex)-1;ludo.dom.removeClass(this.el,"ludo-resize-handle-active")}},createDragable:function(){this.dd=new ludo.effect.Drag({directions:this.orientation=="horizontal"?"X":"Y"});this.dd.addEvent("before",this.beforeDrag.bind(this));this.dd.addEvent("end",this.endDrag.bind(this));this.dd.add(this.el)},beforeDrag:function(){this.dd.setMinX(30);this.isActive=true;ludo.dom.removeClass(this.el,"ludo-resize-handle-active");ludo.dom.addClass(this.el,"ludo-resize-handle-active");this.fireEvent("before",[this,this.view]);this.fireEvent("startResize")},setMinWidth:function(a){if(this.pos==="left"){var b=this.view.getEl();this.dd.setMaxX(b.offsetLeft+b.offsetWidth-a)}else{this.dd.setMinX(this.view.getEl().offsetLeft+a)}},setMaxWidth:function(a){var b=this.view.getEl();if(this.pos==="right"){this.dd.setMaxX(b.offsetLeft+a)}else{var c=0;if(this.layout.affectedSibling){c=this.layout.affectedSibling.getEl().offsetLeft+10}this.dd.setMinX(Math.max(c,b.offsetLeft+b.offsetWidth-a))}},setMinHeight:function(b){if(this.pos==="above"){var a=this.view.getEl();this.dd.setMaxY(a.offsetTop+a.offsetHeight-b)}else{this.dd.setMinY(this.view.getEl().offsetTop+b)}},setMaxHeight:function(c){var a=this.view.getEl();if(this.pos==="below"){this.dd.setMaxY(a.offsetTop+c)}else{var b=10;if(this.layout.affectedSibling){b=this.layout.affectedSibling.getEl().offsetTop+10}this.dd.setMinY(Math.max(b,a.offsetTop+a.offsetHeight-c))}},endDrag:function(b,a){ludo.dom.removeClass(this.el,"ludo-resize-handle-over");ludo.dom.removeClass(this.el,"ludo-resize-handle-active");var c=this.orientation==="horizontal"?a.getDraggedX():a.getDraggedY();if(this.pos==="left"||this.pos==="above"){c*=-1}this.fireEvent("resize",c);this.fireEvent("stopResize");this.isActive=false},getEl:function(){return this.el},addViewEvents:function(){this.view.addEvent("maximize",this.show.bind(this));this.view.addEvent("expand",this.show.bind(this));this.view.addEvent("minimize",this.hide.bind(this));this.view.addEvent("collapse",this.hide.bind(this));this.view.addEvent("hide",this.hide.bind(this));this.view.addEvent("show",this.show.bind(this))},show:function(){this.el.style.display="";this.hidden=false},hide:function(){this.hidden=true;this.el.style.display="none"},getWidth:function(){return this.hidden?0:5},getHeight:function(){return this.hidden?0:5},resize:function(a){this.el.style.left="";this.el.style.top="";this.el.style.right="";this.el.style.bottom="";if(a.width!==undefined&&a.width>0){this.el.style.width=a.width+"px"}if(a.height!==undefined&&a.height>0){this.el.style.height=(a.height-ludo.dom.getMBPH(this.el))+"px"}if(a.left!==undefined){this.el.style.left=a.left+"px"}if(a.top!==undefined){this.el.style.top=a.top+"px"}if(a.bottom!==undefined){this.el.style.bottom=a.bottom+"px"}if(a.right!==undefined){this.el.style.right=a.right+"px"}},getParent:function(){},setParentComponent:function(){},isVisible:function(){return !this.hidden},isHidden:function(){return this.hidden},hasChildren:function(){return false},isFormElement:function(){return false}});ludo.layout.Base=new Class({Extends:Events,view:null,tabStrip:null,resizables:[],benchmarkTime:false,dependency:{},viewport:{top:0,left:0,width:0,height:0,bottom:0,right:0},initialize:function(a){this.id=String.uniqueID();this.view=a;if(a.getBody()){this.onCreate()}},onCreate:function(){if(this.view.layout.collapseBar){this.addCollapseBars()
}},addChild:function(h,f,g){h=this.getValidChild(h);h=this.getNewComponent(h);var d=this.getParentForNewChild();if(f){var b=[];for(var a=0;a<this.view.children.length;a++){if(g=="after"){b.push(this.view.children[a]);d.adopt(this.view.children[a].getEl())}if(this.view.children[a].getId()==f.getId()){b.push(h);d.adopt(h.getEl())}if(g=="before"){b.push(this.view.children[a]);d.adopt(this.view.children[a].getEl())}}this.view.children=b}else{this.view.children.push(h);var c=h.getEl();d.appendChild(c)}this.onNewChild(h);this.addChildEvents(h);this.fireEvent("addChild",[h,this]);return h},getParentForNewChild:function(){return this.view.els.body},layoutProperties:["collapsible","collapsed"],getValidChild:function(a){return a},onNewChild:function(f){var d=this.layoutProperties;for(var b=0;b<d.length;b++){if(f.layout[d[b]]===undefined&&f[d[b]]!==undefined){f.layout[d[b]]=f[d[b]]}}if(f.layout.collapseTo!==undefined){var a=ludo.get(f.layout.collapseTo);if(a){var c=a.getLayout().getCollapseBar(f.layout.collapsible);if(c){c.addView(f)}}}},addChildEvents:function(){},resizeChildren:function(){if(this.benchmarkTime){var a=new Date().getTime()}if(this.view.isHidden()){return}if(this.idLastDynamic===undefined){this.setIdOfLastChildWithDynamicWeight()}this.storeViewPortSize();this.resize();if(this.benchmarkTime){ludo.util.log("Time for resize("+this.view.layout.type+"): "+(new Date().getTime()-a))}},storeViewPortSize:function(){this.viewport.absWidth=this.getAvailWidth();this.viewport.absHeight=this.getAvailHeight();this.viewport.width=this.getAvailWidth()-this.viewport.left-this.viewport.right;this.viewport.height=this.getAvailHeight()-this.viewport.top-this.viewport.bottom},previousContentWidth:undefined,idLastDynamic:undefined,setIdOfLastChildWithDynamicWeight:function(){for(var a=this.view.children.length-1;a>=0;a--){if(this.hasLayoutWeight(this.view.children[a])){this.idLastDynamic=this.view.children[a].id;return}}this.idLastDynamic="NA"},hasLayoutWeight:function(a){return a.layout!==undefined&&a.layout.weight!==undefined},getNewComponent:function(a){a.renderTo=this.view.getBody();a.type=a.type||this.view.cType;a.parentComponent=this.view;return ludo.factory.create(a)},isLastSibling:function(b){var a=this.view.initialItemsObject;if(a.length){return a[a.length-1].id==b.id}else{return this.view.children[this.view.children.length-1].id==b.id}},prepareView:function(){},resize:function(){var a={};a.width=ludo.dom.getInnerWidthOf(this.view.getBody());if(a.width<0){a.width=undefined}for(var b=0;b<this.view.children.length;b++){this.view.children[b].resize(a)}},getAvailWidth:function(){return ludo.dom.getInnerWidthOf(this.view.getBody())},getAvailHeight:function(){return this.view.getInnerHeightOfBody()},addCollapseBars:function(){var b=this.view.layout.collapseBar;if(!ludo.util.isArray(b)){b=[b]}for(var a=0;a<b.length;a++){this.addChild(this.getCollapseBar(b[a]))}},collapseBars:{},getCollapseBar:function(a){a=a||"left";if(this.collapseBars[a]===undefined){var b=this.collapseBars[a]=new ludo.layout.CollapseBar({position:a,parentComponent:this.view,parentLayout:this.view.layout,listeners:{show:this.toggleCollapseBar.bind(this),hide:this.toggleCollapseBar.bind(this)}});this.updateViewport(b.getChangedViewport())}return this.collapseBars[a]},toggleCollapseBar:function(a){this.updateViewport(a.getChangedViewport());this.resize()},updateViewport:function(a){this.viewport[a.key]=a.value},createRenderer:function(){if(this.renderer===undefined){this.renderer=this.dependency.renderer=new ludo.layout.Renderer({view:this.view})}return this.renderer},getRenderer:function(){return this.renderer?this.renderer:this.createRenderer()},hideChild:function(a){this.setTemporarySize(a,{width:0,height:0})},minimize:function(b,a){this.setTemporarySize(b,a);this.resize()},setTemporarySize:function(b,a){if(a.width!==undefined){b.layout.cached_width=b.layout.width;b.layout.width=a.width}else{b.layout.cached_height=b.layout.height;b.layout.height=a.height}},clearTemporaryValues:function(a){if(a.layout.cached_width!==undefined){a.layout.width=a.layout.cached_width}if(a.layout.cached_height!==undefined){a.layout.height=a.layout.cached_height}a.layout.cached_width=undefined;a.layout.cached_height=undefined;this.resize()},getWidthOf:function(a){return a.layout.width},getHeightOf:function(a){return a.layout.height}});ludo.layout.Factory=new Class({getManager:function(a){return new ludo.layout[this.getLayoutClass(a)](a)},getLayoutClass:function(a){if(!a.layout||!a.layout.type){return"Base"}switch(a.layout.type.toLowerCase()){case"slidein":return"SlideIn";case"relative":return"Relative";case"fill":return"Fill";case"card":return"Card";case"grid":return"Grid";case"menu":return["Menu",(a.layout.orientation&&a.layout.orientation.toLowerCase()=="horizontal")?"Horizontal":"Vertical"].join("");case"tabs":case"tab":return"Tab";case"column":case"cols":return"LinearHorizontal";case"popup":return"Popup";case"canvas":return"Canvas";case"rows":case"row":return"LinearVertical";
case"linear":return["Linear",(a.layout.orientation&&a.layout.orientation.toLowerCase()=="horizontal")?"Horizontal":"Vertical"].join("");default:return"Base"}},getValidLayoutObject:function(a,c){a.layout=this.toLayoutObject(a.layout);c.layout=this.toLayoutObject(c.layout);if(!this.hasLayoutProperties(a,c)){return{}}var b=this.getMergedLayout(a.layout,c.layout);if(typeof b==="string"){b={type:b}}b=this.transferFromView(a,c,b);if(b.left===undefined&&b.x!==undefined){b.left=b.x}if(b.top===undefined&&b.y!==undefined){b.top=b.y}if(b.aspectRatio){if(b.width){b.height=Math.round(b.width/b.aspectRatio)}else{if(b.height){b.width=Math.round(b.height*b.aspectRatio)}}}b.type=b.type||"Base";return b},toLayoutObject:function(a){if(!a){return{}}if(ludo.util.isString(a)){return{type:a}}return a},hasLayoutProperties:function(a,b){if(a.layout||b.layout){return true}var d=["left","top","height","width","weight","x","y"];for(var c=0;c<d.length;c++){if(b[d[c]]!==undefined||a[d[c]]!==undefined){return true}}return false},transferFromView:function(a,c,b){var f=["left","top","width","height","weight","x","y"];for(var d=0;d<f.length;d++){if(b[f[d]]===undefined&&(c[f[d]]!==undefined||a[f[d]]!==undefined)){b[f[d]]=c[f[d]]||a[f[d]]}a[f[d]]=undefined}return b},getMergedLayout:function(c,b){for(var a in b){if(b.hasOwnProperty(a)){c[a]=b[a]}}return c}});ludo.layoutFactory=new ludo.layout.Factory();ludo.dataSource.Base=new Class({Extends:ludo.Core,singleton:false,url:undefined,postData:{},data:undefined,autoload:true,resource:"",service:"",arguments:undefined,inLoadMode:false,shim:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["url","postData","autoload","resource","service","arguments","data","shim"]);if(this.arguments&&!ludo.util.isArray(this.arguments)){this.arguments=[this.arguments]}},ludoEvents:function(){if(this.autoload){this.load()}},sendRequest:function(a,c,b){this.arguments=c;this.beforeLoad();this.requestHandler().send(a,c,b)},hasData:function(){return(this.data!==undefined)},getData:function(){return this.data},setPostParam:function(b,a){this.postData[b]=a},getSourceType:function(){return"JSON"},beforeLoad:function(){this.inLoadMode=true;this.fireEvent("beforeload")},load:function(){},loadUrl:function(a){this.url=a;delete this._request;this.load()},loadComplete:function(){this.inLoadMode=false},isLoading:function(){return this.inLoadMode},getPostData:function(){return this.postData}});ludo.dataSource.JSON=new Class({Extends:ludo.dataSource.Base,type:"dataSource.JSON",load:function(){if(!this.url&&!this.resource){return}this.parent();this.sendRequest(this.service,this.arguments,this.getPostData())},_request:undefined,requestHandler:function(){if(this._request===undefined){this._request=new ludo.remote.JSON({url:this.url,resource:this.resource,shim:this.shim,listeners:{beforeload:function(a){this.fireEvent("beforeload",a)},success:function(a){this.loadComplete(a.getResponseData(),a.getResponse())}.bind(this),failure:function(a){this.fireEvent("failure",[a.getResponse(),this])}.bind(this),error:function(a){this.fireEvent("servererror",[a.getResponseMessage(),a.getResponseCode()])}.bind(this)}})}return this._request},setData:function(a){this.loadComplete(a)},loadComplete:function(a){this.parent();var b=!this.data;this.data=a;this.fireEvent("parsedata");this.fireEvent("load",[this.data,this]);if(b){this.fireEvent("firstLoad",[this.data,this])}}});ludo.factory.registerClass("dataSource.JSON",ludo.dataSource.JSON);ludo.layout.Renderer=new Class({view:undefined,options:["width","height","rightOf","leftOf","below","above","sameHeightAs","sameWidthAs","offsetWidth","offsetHeight","rightOrLeftOf","leftOrRightOf","alignLeft","alignRight","alignTop","alignBottom","centerIn","left","top","offsetX","offsetY","fitVerticalViewPort"],fn:undefined,viewport:{x:0,y:0,width:0,height:0},coordinates:{left:undefined,right:undefined,above:undefined,below:undefined,width:undefined,height:undefined},lastCoordinates:{},initialize:function(a){this.view=a.view;this.fixReferences();this.setDefaultProperties();this.view.addEvent("show",this.resize.bind(this));ludo.dom.clearCache();this.addResizeEvent()},fixReferences:function(){var d;var f=false;for(var c=0;c<this.options.length;c++){var b=this.options[c];switch(b){case"offsetX":case"offsetY":case"width":case"height":case"left":case"top":case"fitVerticalViewPort":break;default:d=undefined;if(this.view.layout[b]!==undefined){f=true;var g=this.view.layout[b];if(typeof g==="string"){var a;if(g==="parent"){a=this.view.getParent()}else{a=ludo.get(g)}if(a){d=a.getEl();a.addEvent("resize",this.clearFn.bind(this))}else{d=document.id(g)}}else{if(g.getEl!==undefined){d=g.getEl();g.addEvent("resize",this.clearFn.bind(this))}else{d=document.id(g)}}if(d){this.view.layout[b]=d}else{this.view.layout[b]=undefined}}}}if(f){this.view.getEl().style.position="absolute"}},setDefaultProperties:function(){this.view.layout.width=this.view.layout.width||"matchParent";this.view.layout.height=this.view.layout.height||"matchParent"
},addResizeEvent:function(){if(this.view.isWindow){return}var a=this.view.getEl().parentNode;if(!a||!a.tagName){return}if(a.tagName.toLowerCase()!=="body"){a=document.id(a)}else{a=window}a.addEvent("resize",this.resize.bind(this))},buildResizeFn:function(){var c=this.view.getEl().parentNode;if(!c){this.fn=function(){}}var b=[];var d=[];for(var a=0;a<this.options.length;a++){if(this.view.layout[this.options[a]]!==undefined){b.push(this.getFnFor(this.options[a],this.view.layout[this.options[a]]));d.push(this.options[a])}}this.fn=function(){for(a=0;a<b.length;a++){b[a].call(this,this.view,this)}}},getFnFor:function(d,f){var g=this.coordinates;switch(d){case"height":if(f==="matchParent"){return function(c,h){g.height=h.viewport.height}}if(f==="wrap"){var b=ludo.dom.getWrappedSizeOfView(this.view);this.view.layout.height=b.y;return function(){g.height=b.y}}if(f.indexOf!==undefined&&f.indexOf("%")>0){f=parseInt(f);return function(c,h){g.height=(h.viewport.height*f/100)}}return function(){g.height=this.view.layout[d]}.bind(this);case"width":if(f==="matchParent"){return function(c,h){g.width=h.viewport.width}}if(f==="wrap"){var a=ludo.dom.getWrappedSizeOfView(this.view);this.view.layout.width=a.x;return function(){g.width=a.x}}if(f.indexOf!==undefined&&f.indexOf("%")>0){f=parseInt(f);return function(c,h){g.width=(h.viewport.width*f/100)}}return function(){g.width=this.view.layout[d]}.bind(this);case"rightOf":return function(){g.left=f.getPosition().x+f.offsetWidth};case"leftOf":return function(){g.left=f.getPosition().x-g.width};case"leftOrRightOf":return function(){var c=f.getPosition().x-g.width;if(c-g.width<0){c+=(f.offsetWidth+g.width)}g.left=c};case"rightOrLeftOf":return function(c,h){var j=f.getPosition().x+f.offsetWidth;if(j+g.width>h.viewport.width){j-=(f.offsetWidth+g.width)}g.left=j};case"above":return function(c,h){g.bottom=h.viewport.height-f.getPosition().y};case"below":return function(){g.top=f.getPosition().y+f.offsetHeight};case"alignLeft":return function(){g.left=f.getPosition().x};case"alignTop":return function(){g.top=f.getPosition().y};case"alignRight":return function(){g.left=f.getPosition().x+f.offsetWidth-g.width};case"alignBottom":return function(){g.top=f.getPosition().y+f.offsetHeight-g.height};case"offsetX":return function(){g.left=g.left?g.left+f:f};case"offsetY":return function(){g.top=g.top?g.top+f:f};case"sameHeightAs":return function(){g.height=f.offsetHeight};case"offsetWidth":return function(){g.width=g.width+f};case"offsetHeight":return function(){g.height=g.height+f};case"centerIn":return function(){var c=f.getPosition();g.top=(c.y+f.offsetHeight)/2-(g.height/2);g.left=(c.x+f.offsetWidth)/2-(g.width/2)};case"centerHorizontalIn":return function(){g.left=(f.getPosition().x+f.offsetWidth)/2-(g.width/2)};case"centerVerticalIn":return function(){g.top=(f.getPosition().y+f.offsetHeight)/2-(g.height/2)};case"sameWidthAs":return function(){g.width=f.offsetWidth};case"x":case"left":return function(){g.left=this.view.layout[d]}.bind(this);case"y":case"top":return function(){g.top=this.view.layout[d]}.bind(this);case"fitVerticalViewPort":return function(c,h){if(g.height){var j=g.top!==undefined?g.top:c.getEl().getPosition().y;if(j+g.height>h.viewport.height-2){g.top=h.viewport.height-g.height-2}}};default:return function(){}}},posKeys:["left","right","top","bottom"],clearFn:function(){this.fn=undefined},resize:function(){if(this.view.isHidden()){return}if(this.fn===undefined){this.buildResizeFn()}this.setViewport();this.fn.call(this);var d=this.coordinates;this.view.resize(d);if(d.bottom){d.top=undefined}if(d.right){d.left=undefined}for(var b=0;b<this.posKeys.length;b++){var a=this.posKeys[b];if(this.coordinates[a]!==undefined&&this.coordinates[a]!==this.lastCoordinates[a]){this.view.getEl().style[a]=d[a]+"px"}}this.lastCoordinates=Object.clone(d)},resizeChildren:function(){if(this.view.children.length>0){this.view.getLayout().resizeChildren()}},setViewport:function(){var a=this.view.getEl().parentNode;if(!a){return}this.viewport.width=a.offsetWidth-ludo.dom.getPW(a)-ludo.dom.getBW(a);this.viewport.height=a.offsetHeight-ludo.dom.getPH(a)-ludo.dom.getBH(a)},getMinWidth:function(){return this.view.layout.minWidth||5},getMinHeight:function(){return this.view.layout.minHeight||5},getMaxHeight:function(){return this.view.layout.maxHeight||5000},getMaxWidth:function(){return this.view.layout.maxWidth||5000},setPosition:function(a,b){if(a!==undefined&&a>=0){this.coordinates.left=this.view.layout.left=a;this.view.getEl().style.left=a+"px";this.lastCoordinates.left=a}if(b!==undefined&&b>=0){this.coordinates.top=this.view.layout.top=b;this.view.getEl().style.top=b+"px";this.lastCoordinates.top=b}},setSize:function(a){if(a.left){this.coordinates.left=this.view.layout.left=a.left}if(a.top){this.coordinates.top=this.view.layout.top=a.top}if(a.width){this.view.layout.width=this.coordinates.width=a.width}if(a.height){this.view.layout.height=this.coordinates.height=a.height}this.resize()},getPosition:function(){return{x:this.coordinates.left,y:this.coordinates.top}
},getSize:function(){return{x:this.coordinates.width,y:this.coordinates.height}},setValue:function(a,b){this.view.layout[a]=b},getValue:function(a){return this.view.layout[a]}});ludo.tpl.Parser=new Class({Extends:ludo.Core,type:"tpl.Parser",compiledTpl:undefined,getCompiled:function(b,f){if(!ludo.util.isArray(b)){b=[b]}var d=[];f=this.getCompiledTpl(f);for(var g=0;g<b.length;g++){var h=[];for(var c=0;c<f.length;c++){var a=f[c]["key"];if(a){h.push(b[g][a]?b[g][a]:"")}else{h.push(f[c])}}d.push(h.join(""))}return d},getCompiledTpl:function(c){if(!this.compiledTpl){this.compiledTpl=[];var f=c.indexOf("{");var b=0;while(f>=0&&b!=-1){if(f>b){var d=b===0?b:b+1;var a=b===0?f-b:f-b-1;this.compiledTpl.push(c.substr(d,a))}b=c.indexOf("}",f);if(b!=-1){this.compiledTpl.push({key:c.substr(f,b-f).replace(/[{}"]/g,"")})}f=c.indexOf("{",b)}if(b!=-1&&b<c.length){this.compiledTpl.push(c.substr(b+1))}}return this.compiledTpl},asString:function(b,a){return this.getCompiled(b,a).join("")},getTplValue:function(a,b){return b}});ludo.dom={cache:{PW:{},PH:{},BW:{},BH:{},MW:{},MH:{}},getMW:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.MW[a.id]===undefined){ludo.dom.cache.MW[a.id]=ludo.dom.getNumericStyle(a,"margin-left")+ludo.dom.getNumericStyle(a,"margin-right")}return ludo.dom.cache.MW[a.id]},getBW:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.BW[a.id]===undefined){ludo.dom.cache.BW[a.id]=ludo.dom.getNumericStyle(a,"border-left-width")+ludo.dom.getNumericStyle(a,"border-right-width")}return ludo.dom.cache.BW[a.id]},getPW:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.PW[a.id]===undefined){ludo.dom.cache.PW[a.id]=ludo.dom.getNumericStyle(a,"padding-left")+ludo.dom.getNumericStyle(a,"padding-right")}return ludo.dom.cache.PW[a.id]},getMH:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.MH[a.id]===undefined){ludo.dom.cache.MH[a.id]=ludo.dom.getNumericStyle(a,"margin-top")+ludo.dom.getNumericStyle(a,"margin-bottom")}return ludo.dom.cache.MH[a.id]},getBH:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.BH[a.id]===undefined){ludo.dom.cache.BH[a.id]=ludo.dom.getNumericStyle(a,"border-top-width")+ludo.dom.getNumericStyle(a,"border-bottom-width")}return ludo.dom.cache.BH[a.id]},getPH:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.PH[a.id]===undefined){ludo.dom.cache.PH[a.id]=ludo.dom.getNumericStyle(a,"padding-top")+ludo.dom.getNumericStyle(a,"padding-bottom")}return ludo.dom.cache.PH[a.id]},getMBPW:function(a){return ludo.dom.getPW(a)+ludo.dom.getMW(a)+ludo.dom.getBW(a)},getMBPH:function(a){return ludo.dom.getPH(a)+ludo.dom.getMH(a)+ludo.dom.getBH(a)},clearCache:function(){ludo.dom.cache={PW:{},PH:{},BW:{},BH:{},MW:{},MH:{}}},getNumericStyle:function(b,a){if(!b||!a||!b.getStyle){return 0}var c=b.getStyle(a);return c&&c!="thin"&&c!="auto"&&c!="medium"?parseInt(c):0},isInFamilies:function(c,b){for(var a=0;a<b.length;a++){if(ludo.dom.isInFamily(c,b[a])){return true}}return false},isInFamily:function(a,b){if(a.id===b){return true}return a.getParent("#"+b)},addClass:function(b,a){if(b&&!this.hasClass(b,a)){b.className=b.className?b.className+" "+a:a}},hasClass:function(b,a){return b&&b.className?b.className.split(/\s/g).indexOf(a)>-1:false},removeClass:function(b,a){if(b){b.className=b.className.replace(new RegExp("(^|\\s)"+a+"(?:\\s|$)"),"$1")}},getParent:function(b,a){b=b.parentNode;while(b&&!ludo.dom.hasClass(b,a)){b=b.parentNode}return b},scrollIntoView:function(g,d){var k=d.getEl();var f=d.getBody();var b=k.offsetHeight-ludo.dom.getPH(k)-ludo.dom.getBH(k)-ludo.dom.getMBPH(f);var j=g.getPosition(f).y;var h=(j+20)-(k.scrollTop+b);if(h>0){f.scrollTop+=h}var a=k.scrollTop-j;if(a>0){f.scrollTop-=a}},getInnerWidthOf:function(a){if(a.style.width&&a.style.width.indexOf("%")==-1){return ludo.dom.getNumericStyle(a,"width")}return a.offsetWidth-ludo.dom.getPW(a)-ludo.dom.getBW(a)},getInnerHeightOf:function(a){if(a.style.height&&a.style.height.indexOf("%")==-1){return ludo.dom.getNumericStyle(a,"height")}return a.offsetHeight-ludo.dom.getPH(a)-ludo.dom.getBH(a)},getTotalWidthOf:function(a){return a.offsetWidth+ludo.dom.getMW(a)},getWrappedSizeOfView:function(d){var g=d.getEl();var c=d.getBody();c.style.position="absolute";var f=c.offsetWidth;c.style.position="relative";var a=c.offsetHeight;return{x:f+ludo.dom.getMBPW(c)+ludo.dom.getMBPW(g),y:a+ludo.dom.getMBPH(c)+ludo.dom.getMBPH(g)+(d.getHeightOfTitleBar?d.getHeightOfTitleBar():0)}},getMeasuredWidth:function(a){var c=a.getBody();var b=c.measure(function(){return this.getSize()});return b.x+ludo.dom.getMW(c)},create:function(c){var b=document.createElement(c.tag||"div");if(c.cls){ludo.dom.addClass(b,c.cls)}if(c.renderTo){c.renderTo.appendChild(b)}if(c.css){for(var a in c.css){if(c.css.hasOwnProperty(a)){b.style[a]=c.css[a]}}}if(c.id){b.id=c.id}if(c.html){b.innerHTML=c.html}return b}};ludo.util={types:{},isArray:function(a){return ludo.util.type(a)=="array"},isObject:function(a){return ludo.util.type(a)==="object"
},isString:function(a){return ludo.util.type(a)==="string"},isFunction:function(a){return ludo.util.type(a)==="function"},argsToArray:function(a){return Array.prototype.slice.call(a)},type:function(a){if(a==null){return String(a)}return typeof a==="object"||typeof a==="function"?ludo.util.types[ludo.util.types.toString.call(a)]||"object":typeof a},isLudoJSConfig:function(a){return a.initialize===undefined&&a.type},tabletOrMobile:undefined,isTabletOrMobile:function(){if(ludo.util.tabletOrMobile===undefined){ludo.util.tabletOrMobile=this.isIpad()||this.isIphone()||this.isAndroid()}return ludo.util.tabletOrMobile},isIpad:function(){return navigator.platform.indexOf("iPad")>=0},isIphone:function(){return navigator.platform.indexOf("iPhone")>=0},isAndroid:function(){return Browser.Platform.android?true:false},cancelEvent:function(){return false},log:function(a){if(window.console){console.log(a)}},warn:function(a){if(window.console){console.warn(a)}},getNewZIndex:function(a){var b=ludo.CmpMgr.getNewZIndex();if(a.renderTo==document.body&&a.els.container.style.position==="absolute"){b+=10000}if(a.alwaysInFront){b+=400000}return b},dispose:function(a){if(a.getParent()){a.getParent().removeChild(a)}a.removeEvents();this.disposeDependencies(a.dependency);a.disposeAllChildren();for(var b in a.els){if(a.els.hasOwnProperty(b)){if(a.els[b]&&a.els[b].tagName&&b!="parent"){a.els[b].dispose();if(a.els[b].removeEvents){a.els[b].removeEvents()}}}}ludo.CmpMgr.deleteComponent(a);delete a.els},disposeDependencies:function(b){for(var a in b){if(b.hasOwnProperty(a)){if(b[a].removeEvents){b[a].removeEvents()}if(b[a].dispose){b[a].dispose()}else{if(b[a].dependency&&b[a].dependency.length){ludo.util.disposeDependencies(b[a].dependency)}}delete b[a]}}},parseDate:function(b,g){if(ludo.util.isString(b)){var f=g.split(/[^a-z%]/gi);var a=b.split(/[\.\-\/]/g);var d={};for(var c=0;c<f.length;c++){d[f[c]]=a[c]}d["%m"]=d["%m"]?d["%m"]-1:0;d["%h"]=d["%h"]||0;d["%i"]=d["%i"]||0;d["%s"]=d["%s"]||0;return new Date(d["%Y"],d["%m"],d["%d"],d["%h"],d["%i"],d["%s"])}return ludo.util.isString(b)?"":b},getDragStartEvent:function(){return ludo.util.isTabletOrMobile()?"touchstart":"mousedown"},getDragMoveEvent:function(){return ludo.util.isTabletOrMobile()?"touchmove":"mousemove"},getDragEndEvent:function(){return ludo.util.isTabletOrMobile()?"touchend":"mouseup"},supportsSVG:function(){return !!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg")["createSVGRect"]}};var ludoUtilTypes="Boolean Number String Function Array Date RegExp Object Error".split(" ");for(var i=0;i<ludoUtilTypes.length;i++){ludo.util.types["[object "+ludoUtilTypes[i]+"]"]=ludoUtilTypes[i].toLowerCase()}ludo.view.Shim=new Class({txt:"Loading content...",el:undefined,shim:undefined,renderTo:undefined,initialize:function(a){if(a.txt){this.txt=a.txt}this.renderTo=a.renderTo},getEl:function(){if(this.el===undefined){this.el=ludo.dom.create({renderTo:this.getRenderTo(),cls:"ludo-shim-loading",css:{display:"none"},html:this.getText(this.txt)})}return this.el},getShim:function(){if(this.shim===undefined){if(ludo.util.isString(this.renderTo)){this.renderTo=ludo.get(this.renderTo).getEl()}this.shim=ludo.dom.create({renderTo:this.getRenderTo(),cls:"ludo-loader-shim",css:{display:"none"}})}return this.shim},getRenderTo:function(){if(ludo.util.isString(this.renderTo)){var a=ludo.get(this.renderTo);if(!a){return undefined}this.renderTo=ludo.get(this.renderTo).getEl()}return this.renderTo},show:function(a){this.getEl().innerHTML=this.getText((a&&!ludo.util.isObject(a))?a:this.txt);this.css("");this.resizeShim()},resizeShim:function(){var b=document.id(this.el).getElement("span");var a=(b.offsetWidth+5);this.el.style.width=a+"px";this.el.style.marginLeft=(Math.round(a/2)*-1)+"px"},getText:function(a){a=ludo.util.isFunction(a)?a.call():a?a:"";return"<span>"+a+"</span>"},hide:function(){this.css("none")},css:function(a){this.getShim().style.display=a;this.getEl().style.display=a===""&&this.txt?"":"none"}});ludo.remote.Shim=new Class({Extends:ludo.view.Shim,initialize:function(a){this.parent(a);this.addShowHideEvents(a.remoteObj)},addShowHideEvents:function(a){if(a){a.addEvents({start:this.show.bind(this),complete:this.hide.bind(this)})}}});ludo.View=new Class({Extends:ludo.Core,type:"View",cType:"View",cls:"",bodyCls:"",cssSignature:undefined,closable:true,minimizable:false,movable:false,resizable:false,alwaysInFront:false,statefulProperties:["layout"],els:{},state:{},defaultDS:"dataSource.JSON",tagBody:"div",id:null,children:[],child:{},dataSource:undefined,socket:undefined,parentComponent:null,objMovable:null,width:undefined,height:undefined,overflow:undefined,html:"",hidden:false,css:undefined,containerCss:undefined,formConfig:undefined,isRendered:false,unRenderedChildren:[],frame:false,copyEvents:undefined,form:undefined,layout:undefined,tpl:"",tplParserConfig:{type:"tpl.Parser"},initialItemsObject:[],contextMenu:undefined,lifeCycleComplete:false,ludoDB:undefined,lifeCycle:function(a){this._createDOM();
if(!a.children){a.children=this.children;this.children=[]}this.ludoConfig(a);if(!a.children||!a.children.length){a.children=this.getClassChildren()}if(this.hidden){this.unRenderedChildren=a.children}else{this.remainingLifeCycle(a)}},getClassChildren:function(){return this.children},remainingLifeCycle:function(a){if(this.lifeCycleComplete){return}if(!a&&this.unRenderedChildren){a={children:this.unRenderedChildren}}this.lifeCycleComplete=true;this._styleDOM();if(a.children){for(var b=0;b<a.children.length;b++){a.children[b].id=a.children[b].id||"ludo-"+String.uniqueID()}this.initialItemsObject=a.children;this.addChildren(a.children)}this.ludoDOM();this.ludoCSS();this.ludoEvents();this.increaseZIndex();if(this.layout&&this.layout.type&&this.layout.type=="tabs"){this.getLayout().prepareView()}this.addCoreEvents();this.ludoRendered();if(!this.parentComponent){ludo.dom.clearCache();ludo.dom.clearCache.delay(50,this);var c=this.getLayout().getRenderer();c.resize();c.resizeChildren()}},ludoConfig:function(b){this.parent(b);b.els=b.els||{};if(this.parentComponent){b.renderTo=undefined}var c=["css","contextMenu","renderTo","tpl","containerCss","socket","form",,"title","html","hidden","copyEvents","dataSource","movable","resizable","closable","minimizable","alwaysInFront","parentComponent","cls","bodyCls","objMovable","width","height","frame","formConfig","overflow","ludoDB"];this.setConfigParams(b,c);if(this.socket){if(!this.socket.type){this.socket.type="socket.Socket"}this.socket.component=this;this.socket=this.createDependency("socket",this.socket)}if(this.renderTo){this.renderTo=document.id(this.renderTo)}this.layout=ludo.layoutFactory.getValidLayoutObject(this,b);if(this.ludoDB){this.ludoDB.type="ludoDB.Factory";var d=this.createDependency("ludoDB",new ludo.ludoDB.Factory(this.ludoDB));var a=this.hidden;d.addEvent("load",function(f){if(!this.hidden){this.addChildren(f.children)}else{this.unRenderedChildren=f.children;this.hidden=a;this.show()}}.bind(this));this.hidden=true;d.load()}if(this.copyEvents){this.createEventCopies()}this.insertDOMContainer()},insertDOMContainer:function(){if(this.hidden){this.els.container.style.display="none"}if(this.renderTo){this.renderTo.adopt(this.els.container)}},ludoDOM:function(){if(this.contextMenu){if(!ludo.util.isArray(this.contextMenu)){this.contextMenu=[this.contextMenu]}for(var a=0;a<this.contextMenu.length;a++){this.contextMenu[a].applyTo=this;this.contextMenu[a].contextEl=this.isFormElement()?this.getFormEl():this.getEl();new ludo.menu.Context(this.contextMenu[a])}this.contextMenu=undefined}if(this.cls){ludo.dom.addClass(this.getEl(),this.cls)}if(this.bodyCls){ludo.dom.addClass(this.getBody(),this.bodyCls)}if(this.type){ludo.dom.addClass(this.getEl(),"ludo-"+(this.type.replace(/\./g,"-").toLowerCase()))}if(this.css){this.getBody().setStyles(this.css)}if(this.containerCss){this.getEl().setStyles(this.containerCss)}if(this.frame){ludo.dom.addClass(this.getEl(),"ludo-container-frame");ludo.dom.addClass(this.getBody(),"ludo-body-frame")}if(this.cssSignature!==undefined){ludo.dom.addClass(this.getEl(),this.cssSignature)}},ludoCSS:function(){},ludoEvents:function(){if(this.dataSource){this.getDataSource()}},ludoRendered:function(){if(!this.layout.height&&!this.layout.above&&!this.layout.sameHeightAs&&!this.layout.alignWith){this.autoSetHeight()}if(!this.parentComponent){this.getLayout().createRenderer()}this.fireEvent("render",this);this.isRendered=true;if(this.form){this.getForm()}},createEventCopies:function(){this.copyEvents=Object.clone(this.copyEvents);for(var a in this.copyEvents){if(this.copyEvents.hasOwnProperty(a)){this.addEvent(a,this.getEventCopyFn(this.copyEvents[a]))}}},getEventCopyFn:function(a){return function(){this.fireEvent.call(this,a,Array.prototype.slice.call(arguments))}.bind(this)},insertJSON:function(a){if(this.tpl){this.getBody().set("html",this.getTplParser().asString(a,this.tpl))}},getTplParser:function(){if(!this.tplParser){this.tplParser=this.createDependency("tplParser",this.tplParserConfig)}return this.tplParser},autoSetHeight:function(){var a=this.getBody().measure(function(){return this.getSize()});this.layout.height=a.y+ludo.dom.getMH(this.getBody())+ludo.dom.getMBPH(this.getEl())},setHtml:function(a){this.getBody().set("html",a)},setContent:function(){if(this.html){if(this.children.length){ludo.dom.create({renderTo:this.getBody(),html:this.html})}else{this.getBody().innerHTML=this.html}}},load:function(){this.fireEvent("beforeload",[this.getUrl(),this]);if(this.dataSource){this.getDataSource().load()}},getParent:function(){return this.parentComponent?this.parentComponent:null},setParentComponent:function(a){this.parentComponent=a},_createDOM:function(){this.els.container=new Element("div");this.els.body=new Element(this.tagBody);this.els.container.adopt(this.els.body)},_styleDOM:function(){ludo.dom.addClass(this.els.container,"ludo-view-container");ludo.dom.addClass(this.els.body,"ludo-body");this.els.container.id=this.getId();this.els.body.style.height="100%";
if(this.overflow=="hidden"){this.els.body.style.overflow="hidden"}if(ludo.util.isTabletOrMobile()){ludo.dom.addClass(this.els.container,"ludo-view-container-mobile")}this.setContent()},addCoreEvents:function(){if(!this.getParent()&&this.type!=="Application"){this.getEl().addEvent("mousedown",this.increaseZIndex.bind(this))}},increaseZIndex:function(a){if(a&&a.target&&a.target.tagName.toLowerCase()=="a"){return}this.fireEvent("activate",this);this.setNewZIndex()},setNewZIndex:function(){this.getEl().style.zIndex=ludo.util.getNewZIndex(this)},getEl:function(){return this.els.container?this.els.container:null},getBody:function(){return this.els.body},hide:function(){if(!this.hidden&&this.getEl().style.display!=="none"){this.getEl().style.display="none";this.hidden=true;this.fireEvent("hide",this);this.resizeParent()}},hideAfterDelay:function(a){this.hide.delay((a||1)*1000,this)},isHidden:function(){return this.hidden},isVisible:function(){return !this.hidden},show:function(a){if(this.els.container.style.display==="none"){this.els.container.style.display="";this.hidden=false}if(!this.lifeCycleComplete){this.remainingLifeCycle()}if(!a){this.fireEvent("beforeshow",this)}this.setNewZIndex();if(!a){this.fireEvent("show",this)}if(this.parentComponent){this.resizeParent()}else{this.getLayout().getRenderer().resize()}},resizeParent:function(){var a=this.getParent();if(a){if(a.children.length>0){a.getLayout().resizeChildren()}}},showChild:function(a){var b=this.getChild(a);if(b){b.show();return true}return false},getChildren:function(){return this.children},getAllChildren:function(){var a=[];for(var b=0;b<this.children.length;b++){a.push(this.children[b]);if(!this.children[b].hasChildren){console.log(this.children[b])}if(this.children[b].hasChildren()){a=a.append(this.children[b].getChildren())}}return a},hasChildren:function(){return this.children.length>0},setTitle:function(a){this.title=a},getWidth:function(){return this.layout.pixelWidth?this.layout.pixelWidth:this.layout.width},getHeight:function(){return this.layout.pixelHeight?this.layout.pixelHeight:this.layout.height},resize:function(b){if(this.isHidden()){return}b=b||{};if(b.width){if(this.layout.aspectRatio&&this.layout.preserveAspectRatio&&b.width&&!this.isMinimized()){b.height=b.width/this.layout.aspectRatio}this.layout.pixelWidth=b.width;if(!isNaN(this.layout.width)){this.layout.width=b.width}var c=b.width-ludo.dom.getMBPW(this.els.container);if(c>0){this.els.container.style.width=c+"px"}}if(b.height&&!this.state.isMinimized){if(!this.state.isMinimized){this.layout.pixelHeight=b.height;if(!isNaN(this.layout.height)){this.layout.height=b.height}}var a=b.height-ludo.dom.getMBPH(this.els.container);if(a>0){this.els.container.style.height=a+"px"}}if(b.left!==undefined||b.top!==undefined){this.setPosition(b)}this.resizeDOM();if(b.height||b.width){this.fireEvent("resize")}if(this.children.length>0){this.getLayout().resizeChildren()}},isCollapsible:function(){return this.layout&&this.layout.collapsible?true:false},isChildOf:function(a){var b=this.parentComponent;while(b){if(b.id===a.id){return true}b=b.parentComponent}return false},setPosition:function(a){if(a.left!==undefined&&a.left>=0){this.els.container.style.left=a.left+"px"}if(a.top!==undefined&&a.top>=0){this.els.container.style.top=a.top+"px"}},getLayout:function(){if(!this.hasDependency("layoutManager")){this.createDependency("layoutManager",ludo.layoutFactory.getManager(this))}return this.getDependency("layoutManager")},resizeChildren:function(){if(this.children.length>0){this.getLayout().resizeChildren()}},isMinimized:function(){return false},cachedInnerHeight:undefined,resizeDOM:function(){if(this.layout.pixelHeight>0){var a=this.layout.pixelHeight?this.layout.pixelHeight-ludo.dom.getMBPH(this.els.container):this.els.container.style.height.replace("px","");a-=ludo.dom.getMBPH(this.els.body);if(a<=0||isNaN(a)){return}this.els.body.style.height=a+"px";this.cachedInnerHeight=a}},getInnerHeightOfBody:function(){return this.cachedInnerHeight?this.cachedInnerHeight:ludo.dom.getInnerHeightOf(this.els.body)},getInnerWidthOfBody:function(){return this.layout.pixelWidth?this.layout.pixelWidth-ludo.dom.getMBPW(this.els.container)-ludo.dom.getMBPW(this.els.body):ludo.dom.getInnerWidthOf(this.els.body)},addChildren:function(c){var a=[];for(var b=0,d=c.length;b<d;b++){a.push(this.addChild(c[b]))}return a},addChild:function(c,a,b){c=this.getLayout().addChild(c,a,b);if(c.name){this.child[c.name]=c}c.addEvent("dispose",this.removeChild.bind(this));return c},isMovable:function(){return this.movable},isClosable:function(){return this.closable},isMinimizable:function(){return this.minimizable},getChild:function(a){for(var b=0;b<this.children.length;b++){if(this.children[b].id==a||this.children[b].name==a){return this.children[b]}}return undefined},removeChild:function(a){this.children.erase(a);a.parentComponent=null},disposeAllChildren:function(){for(var a=this.children.length-1;a>=0;a--){this.children[a].dispose()}},dispose:function(){this.fireEvent("dispose",this);
ludo.util.dispose(this)},getTitle:function(){return this.title},dataSourceObj:undefined,getDataSource:function(){if(!this.dataSourceObj&&this.dataSource){var a;if(ludo.util.isString(this.dataSource)){a=this.dataSourceObj=ludo.get(this.dataSource)}else{if(!this.dataSource.type){this.dataSource.type=this.defaultDS}if(this.dataSource.shim&&!this.dataSource.shim.renderTo){this.dataSource.shim.renderTo=this.getEl()}a=this.dataSourceObj=this.createDependency("viewDataSource",this.dataSource)}var b=a.getSourceType()==="HTML"?"setHtml":"insertJSON";if(a.hasData()){this[b](a.getData())}a.addEvent("load",this[b].bind(this))}return this.dataSourceObj},_shim:undefined,shim:function(){if(this._shim===undefined){this._shim=new ludo.view.Shim({txt:"",renderTo:this.getEl()})}return this._shim},getForm:function(){if(!this.hasDependency("formManager")){this.createDependency("formManager",{type:"ludo.form.Manager",view:this,form:this.form})}return this.getDependency("formManager")},getParentForm:function(){var a=this.getParent();return a?a.hasDependency("formManager")?a.getDependency("formManager"):a.getParentForm():undefined},isFormElement:function(){return false},getHeightOfButtonBar:function(){return 0},getSocket:function(){return this.socket},canvas:undefined,getCanvas:function(){if(this.canvas===undefined){this.canvas=this.createDependency("canvas",new ludo.canvas.Canvas({renderTo:this}))}return this.canvas}});ludo.factory.registerClass("View",ludo.View);ludo.remote.Message=new Class({Extends:ludo.View,cls:"ludo-remote-message",listenTo:[],messageTypes:["success","failure","error"],ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["listenTo"]);if(!ludo.util.isArray(this.listenTo)){this.listenTo=[this.listenTo]}this.validateListenTo()},validateListenTo:function(){for(var a=0;a<this.listenTo.length;a++){this.listenTo[a]=this.listenTo[a].replace(/\//g,".")}},ludoEvents:function(){this.parent();var b=this.getResources();for(var a in b){if(b.hasOwnProperty(a)){this.addResourceEvent(a,b[a])}}},getResources:function(){var b={};var d,a;for(var c=0;c<this.listenTo.length;c++){if(this.listenTo[c].indexOf(".")>=0){var f=this.listenTo[c].split(/\./g);if(f.length===2){a=f.pop();d=f[0];a=a!="*"?a:undefined}}else{d=this.listenTo[c];a=undefined}if(b[d]==undefined){b[d]=[]}if(a&&b[d].indexOf(a)===-1){b[d].push(a)}}return b},addResourceEvent:function(c,a){ludo.remoteBroadcaster.addServiceEvent("clear",c,a,this.hideMessage.bind(this));for(var b=0;b<this.messageTypes.length;b++){ludo.remoteBroadcaster.addServiceEvent(this.messageTypes[b],c,a,this.showMessage.bind(this))}},showMessage:function(a){this.show();if(a.code&&a.code!==200){ludo.dom.addClass(this.getEl(),"ludo-remote-error-message")}else{ludo.dom.removeClass(this.getEl(),"ludo-remote-error-message")}this.setHtml(a.message);this.fireEvent("showMessage",this)},hideMessage:function(){this.setHtml("")}});ludo.remote.ErrorMessage=new Class({Extends:ludo.remote.Message,messageTypes:["failure","serverError"]});ludo.canvas.Effect=new Class({fps:33,fly:function(b,a,f,c){var d=this.getTranslate(b);this.execute("translate",b,[d.x,d.y],[d.y+a,d.y+f],c)},flyBack:function(a,b){var c=this.getTranslate(a);this.execute("translate",a,[c.x,c.y],[0,0],b)},getTranslate:function(b){var a=ludo.canvasEngine.getTransformation(b,"translate");if(!a){a={x:0,y:0}}return a},execute:function(d,c,g,b,f){f=f||0.25;var a=this.getEffectConfig(g,b,f);this.executeStep(d,c,g,a.steps,a.count,0)},executeStep:function(g,d,h,b,a,f){for(var c=0;c<b.length;c++){h[c]+=b[c]}ludo.canvasEngine.setTransformation(d,g,h.join(" "));f++;if(f<a){this.executeStep.delay(this.fps,this,[g,d,h,b,a,f])}},getEffectConfig:function(g,b,f){if(!ludo.util.isArray(g)){g=[g]}if(!ludo.util.isArray(b)){b=[b]}var a=Math.round(f*this.fps);var c=[];for(var d=0;d<g.length;d++){c.push((b[d]-g[d])/a)}return{steps:c,count:a}}});ludo.dataSource.Record=new Class({Extends:Events,record:undefined,collection:undefined,eventKeys:undefined,initialize:function(a,b){this.record=a;this.collection=b},set:function(a,b){this.fireEvent("beforeUpdate",this.record);this.record[a]=b;if(!this.eventKeys||this.eventKeys.indexOf(a)>=0){this.fireEvent("update",this.record)}return this},get:function(a){return this.record[a]},setProperties:function(b){this.fireEvent("beforeUpdate",this.record);for(var a in b){if(b.hasOwnProperty(a)){this.record[a]=b[a]}}this.fireEvent("update",[this.record,undefined,"update"]);return this},addChild:function(a){a=this.getPlainRecord(a);this.record.children=this.record.children||[];this.record.children.push(a);if(a.parentUid){var b=this.collection.getRecord(a.parentUid);if(b){b.removeChild(a)}}this.fireEvent("addChild",[a,this.record,"addChild"]);return this},getParent:function(){return this.collection.getRecord(this.record.parentUid)},getCollection:function(){return this.collection},isRecordObject:function(a){return a.initialize!==undefined&&a.record!==undefined},getChildren:function(){return this.record.children},removeChild:function(a){a=this.getPlainRecord(a);
var b=this.record.children.indexOf(a);if(b>=0){this.record.children.splice(b,1);this.fireEvent("removeChild",[a,this.record,"removeChild"])}},getPlainRecord:function(a){return this.isRecordObject(a)?a.record:a},select:function(){this.fireEvent("select",this)},insertBefore:function(a,b){if(this.inject(a,b)){this.fireEvent("insertBefore",[a,b,"insertBefore"])}},insertAfter:function(a,b){if(this.inject(a,b,1)){this.fireEvent("insertAfter",[a,b,"insertAfter"])}},inject:function(a,d,f){f=f||0;a=this.getPlainRecord(a);d=this.getPlainRecord(d);if(a===d){return false}if(a.parentUid){var c=this.collection.getRecord(a.parentUid);if(c){if(this.isMyChild(a)){this.record.children.splice(this.getChildIndex(a),1)}else{c.removeChild(a)}}}var b=this.record.children.indexOf(d);if(b!==-1){this.record.children.splice(b+f,0,a);return true}return false},getChildIndex:function(a){return this.record.children?this.record.children.indexOf(this.getPlainRecord(a)):-1},isMyChild:function(a){return this.record.children&&this.record.children.indexOf(this.getPlainRecord(a))!==-1},getUID:function(){return this.record.uid},getData:function(){return this.record},dispose:function(){this.fireEvent("dispose",this.record);delete this.record}});ludo.chart.Record=new Class({Extends:ludo.dataSource.Record,eventKeys:["value","label"],getStartPercent:function(){var a=this.getCollection();return a.getSumOf(0,a.indexOf(this)-1)/a.getSum()*100},getPercent:function(){return(this.getValue()/this.getCollection().getSum())*100},getSum:function(){return this.getCollection().getSum()},getDegrees:function(){return this.getPercent()*360/100},getAngle:function(){var b=this.getCollection().startAngle;var a=b+(this.getStartPercent()*360/100);if(a>360){a-=360}return a},getValue:function(){return this.get("value")},getLabel:function(){return this.get("label")},setValue:function(a){a=parseFloat(a);if(a!==this.get("value")){this.set("value",a)}},focus:function(){this.fireEvent("focus",this);this.set("focused",true)},blur:function(){this.fireEvent("blur",this);this.set("focused",false)},click:function(){var a=this.get("focused")?true:false;this[a?"blur":"focus"]()},isFocused:function(){return this.get("focused")?true:false},enter:function(){this.fireEvent("enter",this)},leave:function(){this.fireEvent("leave",this)}});ludo.dataSource.Collection=new Class({Extends:ludo.dataSource.JSON,sortFn:{},selectedRecords:[],primaryKey:"id",paging:undefined,dataCache:{},sortedBy:{column:undefined,order:undefined},searchConfig:undefined,statefulProperties:["sortedBy","paging"],index:undefined,searcherType:"dataSource.CollectionSearch",uidMap:{},selected:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["searchConfig","sortFn","primaryKey","sortedBy","paging","selected"]);if(this.primaryKey&&!ludo.util.isArray(this.primaryKey)){this.primaryKey=[this.primaryKey]}if(this.paging){this.paging.offset=this.paging.offset||0;this.paging.initialOffset=this.paging.offset;if(this.paging.initialOffset!==undefined){this.fireEvent("page",(this.paging.initialOffset/this.paging.size)+1)}if(this.isCacheEnabled()){this.addEvent("load",this.populateCache.bind(this))}}this.addEvent("parsedata",this.createIndex.bind(this));if(this.selected){this.addEvent("firstLoad",this.setInitialSelected.bind(this))}if(this.data&&!this.index){this.createIndex()}},hasRemoteSearch:function(){return this.paging&&this.paging.remotePaging},setInitialSelected:function(){this.selectRecord(this.selected)},getCount:function(){if(this.paging&&this.paging.rows){return this.paging.rows}if(this.searcher&&this.searcher.hasData()){return this.searcher.getCount()}return this.data?this.data.length:0},isCacheEnabled:function(){return this.paging&&this.paging.remotePaging&&this.paging.cache},sort:function(){if(this.sortedBy.column&&this.sortedBy.order){this.sortBy(this.sortedBy.column,this.sortedBy.order)}},by:function(a){this.sortedBy.column=a;this.sortedBy.order=this.getSortOrderFor(a);return this},ascending:function(){this.sortedBy.order="asc";return this},descending:function(){this.sortedBy.order="desc";return this},sortBy:function(b,a){a=a||this.getSortOrderFor(b);this.sortedBy={column:b,order:a};if(this.paging){this.paging.offset=this.paging.initialOffset||0;this.fireEvent("page",Math.round(this.paging.offset/this.paging.size)+1)}if(this.shouldSortOnServer()){this.loadOrGetFromCache()}else{var c=this._getData();c.sort(this.getSortFnFor(b,a));this.fireEvent("change")}this.fireEvent("sort",this.sortedBy);if(this.paging){this.firePageEvents()}this.fireEvent("state");return this},getSortedBy:function(){return this.sortedBy.column},getSortOrder:function(){return this.sortedBy.order},shouldSortOnServer:function(){return this.paging&&this.paging.remotePaging},getSortFnFor:function(b,a){if(this.sortFn[b]!==undefined){return this.sortFn[b][a]}if(a==="asc"){return function(d,c){return d[b]+"_"+d[this.primaryKey]<c[b]+"_"+c[this.primaryKey]?-1:1}}else{return function(d,c){return d[b]+"_"+d[this.primaryKey]<c[b]+"_"+c[this.primaryKey]?1:-1
}}},getSortOrderFor:function(a){if(this.sortedBy.column===a){return this.sortedBy.order==="asc"?"desc":"asc"}return"asc"},addRecord:function(a){this.data=this.data||[];this.data.push(a);if(!this.index){this.createIndex()}this.fireEvent("add",a);return this.createRecord(a)},findRecord:function(b){if(!this.data){return undefined}if(b.getUID!==undefined){b=b.getUID()}if(b.uid){b=b.uid}var d=this.getById(b);if(d){return d}var c=ludo.util.isObject(b)?"isRecordMatchingSearch":"hasMatchInPrimaryKey";for(var a=0;a<this.data.length;a++){if(this[c](this.data[a],b)){return this.data[a]}}return undefined},isRecordMatchingSearch:function(a,c){for(var b in c){if(c.hasOwnProperty(b)){if(a[b]!==c[b]){return false}}}return true},hasMatchInPrimaryKey:function(a,c){if(this.primaryKey){for(var b=0;b<this.primaryKey.length;b++){if(a[this.primaryKey[b]]===c){return true}}}return false},findRecords:function(c){var a=[];for(var b=0;b<this.data.length;b++){if(this.isRecordMatchingSearch(this.data[b],c)){a.push(this.data[b])}}return a},getLinearData:function(){return this.data},selectRecord:function(a){var b=this.findRecord(a);if(b){this._setSelectedRecord(b);return b}return undefined},selectRecords:function(b){this.selectedRecords=this.findRecords(b);for(var a=0;a<this.selectedRecords.length;a++){this.fireSelect(this.selectedRecords[a])}return this.selectedRecords},selectRecordIndex:function(a){var b=this._getData();if(b.length&&a>=0&&a<b.length){var c=b[a];this._setSelectedRecord(c);return c}return undefined},_getData:function(){if(this.hasSearchResult()){return this.searcher.getData()}return this.data},getRecordByIndex:function(a){if(this.data.length&&a>=0&&a<this.data.length){return this.data[a]}return undefined},previous:function(){var a=this.getPreviousOf(this.getSelectedRecord());if(a){this._setSelectedRecord(a)}return a},getPreviousOf:function(a){var c=this._getData();if(a){var b=c.indexOf(a);return b>0?c[b-1]:undefined}else{return c.length>0?c[0]:undefined}},next:function(){var a=this.getNextOf(this.getSelectedRecord());if(a){this._setSelectedRecord(a)}return a},getNextOf:function(a){var c=this._getData();if(a){var b=c.indexOf(a);return b<c.length-1?c[b+1]:undefined}else{return c.length>0?c[0]:undefined}},_setSelectedRecord:function(a){if(this.selectedRecords.length){this.fireEvent("deselect",this.selectedRecords[0])}this.selectedRecords=[a];this.fireSelect(Object.clone(a))},getSelectedRecord:function(){return this.selectedRecords.length>0?this.selectedRecords[0]:undefined},getSelectedRecords:function(){return this.selectedRecords},deleteRecords:function(c){var a=this.findRecords(c);for(var b=0;b<a.length;b++){this.data.erase(a[b]);this.fireEvent("delete",a[b])}},deleteRecord:function(a){var b=this.findRecord(a);if(b){this.data.erase(b);this.fireEvent("delete",b)}},selectTo:function(d){var f=this.getSelectedRecord();if(!f){this.selectRecord(d);return}var g=this.findRecord(d);if(g){this.selectedRecords=[];var b=this.data.indexOf(g);var a=this.data.indexOf(f);var c;if(b>a){for(c=a;c<=b;c++){this.selectedRecords.push(this.data[c]);this.fireSelect(this.data[c])}}else{for(c=a;c>=b;c--){this.selectedRecords.push(this.data[c]);this.fireSelect(this.data[c])}}}},updateRecord:function(a,b){var c=this.getRecord(a);if(c){c.setProperties(b)}return c},getPostData:function(){if(!this.paging){return this.parent()}var a=this.postData||{};a._paging={size:this.paging.size,offset:this.paging.offset};a._sort=this.sortedBy;return a},previousPage:function(){if(!this.paging||this.isOnFirstPage()){return}this.paging.offset-=this.paging.size;this.onPageChange("previousPage")},nextPage:function(){if(!this.paging||this.isOnLastPage()){return}this.paging.offset+=this.paging.size;this.onPageChange("nextPage")},lastPage:function(){if(!this.paging||this.isOnLastPage()){return}var b=this.getCount();var a=b%this.paging.size;if(a===0){a=this.paging.size}this.paging.offset=b-a;this.onPageChange("lastPage")},firstPage:function(){if(!this.paging||this.isOnFirstPage()){return}this.paging.offset=0;this.onPageChange("firstPage")},isOnFirstPage:function(){if(!this.paging){return true}return this.paging.offset===undefined||this.paging.offset===0},isOnLastPage:function(){return this.paging.size+this.paging.offset>=this.getCount()},onPageChange:function(a){if(this.paging.remotePaging){this.loadOrGetFromCache()}this.fireEvent("change");this.fireEvent(a);this.firePageEvents()},loadOrGetFromCache:function(){if(this.isDataInCache()){this.data=this.dataCache[this.getCacheKey()].data;this.fireEvent("change")}else{this.load()}},populateCache:function(){if(this.isCacheEnabled()){this.dataCache[this.getCacheKey()]={data:this.data,time:new Date().getTime()}}},isDataInCache:function(){return this.dataCache[this.getCacheKey()]!==undefined&&!this.isCacheOutOfDate()},clearCache:function(){this.dataCache={}},isCacheOutOfDate:function(){if(!this.paging.cacheTimeout){return false}var a=this.dataCache[this.getCacheKey()].time;return a+(this.paging.cacheTimeout*1000)<(new Date().getTime())
},getCacheKey:function(){var a=["key",this.paging.offset,this.sortedBy.column,this.sortedBy.order];if(this.searcher!==undefined&&this.searcher.hasData()){a.push(this.searcher.searchToString())}return a.join("|")},hasData:function(){return this.data&&this.data.length>0},firePageEvents:function(a){if(this.isOnLastPage()){this.fireEvent("lastPage")}else{this.fireEvent("notLastPage")}if(this.isOnFirstPage()){this.fireEvent("firstPage")}else{this.fireEvent("notFirstPage")}this.fireEvent("page",this.getPageNumber());if(a===undefined){this.fireEvent("state")}},toPage:function(a){if(a>0&&a<=this.getPageCount()&&!this.isOnPage(a)){this.paging.offset=(a-1)*this.paging.size;this.onPageChange("toPage");return true}return false},setPageSize:function(a){if(this.paging){this.dataCache={};this.paging.size=parseInt(a);this.paging.offset=0;this.onPageChange("toPage")}},isOnPage:function(a){return a==this.getPageNumber()},getPageNumber:function(){return this.paging?Math.floor(this.paging.offset/this.paging.size)+1:1},getPageCount:function(){return this.paging?Math.ceil(this.getCount()/this.paging.size):1},getData:function(){if(this.hasSearchResult()){if(this.paging&&this.paging.size){return this.getDataForPage(this.searcher.getData())}return this.searcher.getData()}if(!this.paging||this.paging.remotePaging){return this.parent()}return this.getDataForPage(this.data)},getDataForPage:function(a){if(!a||a.length==0){return[]}var b=this.paging.initialOffset||this.paging.offset;if(b>a.length){this.toPage(this.getPageCount());b=(this.getPageCount()-1)*this.paging.size}this.resetInitialOffset.delay(200,this);return a.slice(b,Math.min(a.length,b+this.paging.size))},resetInitialOffset:function(){this.paging.initialOffset=undefined},loadComplete:function(b,a){if(this.paging&&a.rows!==undefined){this.paging.rows=a.rows}if(this.paging&&a.response&&a.response.rows!==undefined){this.paging.rows=a.response.rows}this.parent(b,a);this.fireEvent("count",this.getCount());if(this.shouldSortAfterLoad()){this.sort()}else{this.fireEvent("change")}if(this.paging!==undefined){this.firePageEvents(true)}},createIndex:function(){this.index={};this.indexBranch(this.data)},indexBranch:function(c,b){for(var a=0;a<c.length;a++){this.indexRecord(c[a],b);if(c[a].children&&c[a].children.length){this.indexBranch(c[a].children,c[a])}}},indexRecord:function(a,b){if(!this.index){this.createIndex()}if(b){a.parentUid=b.uid}var c=this.getPrimaryKeyIndexFor(a);if(c){this.index[c]=a}if(!a.uid){a.uid=["uid_",String.uniqueID()].join("")}this.index[a.uid]=a},shouldSortAfterLoad:function(){if(this.paging&&this.paging.remotePaging){return false}return this.sortedBy!==undefined&&this.sortedBy.column&&this.sortedBy.order},search:function(a){this.getSearcher().search(a)},remoteSearch:function(a){this.postData=this.postData||{};this.postData.search=a;this.toPage(1);this.load()},afterSearch:function(){var a=this.getSearcher();this.fireEvent("count",a.hasData()?a.getCount():this.getCount());if(this.paging!==undefined){this.paging.offset=0;this.firePageEvents(true);this.fireEvent("pageCount",this.getPageCount())}this.fireEvent("change")},searcher:undefined,getSearcher:function(){if(this.searcher===undefined){this.searchConfig=this.searchConfig||{};var a=Object.merge({type:this.searcherType,dataSource:this},this.searchConfig);this.searcher=ludo._new(a);this.addSearcherEvents()}return this.searcher},addSearcherEvents:function(){this.searcher.addEvent("search",this.afterSearch.bind(this));this.searcher.addEvent("deleteSearch",this.afterSearch.bind(this))},hasSearchResult:function(){return this.searcher!==undefined&&this.searcher.hasData()},getById:function(c){if(this.index[c]!==undefined){return this.index[c]}if(this.primaryKey.length===1){return this.index[c]}else{var b=[];for(var a=0;a<this.primaryKey.length;a++){b.push(c[this.primaryKey[a]])}return this.index[b.join("")]}},recordObjects:{},getRecord:function(a){var b=this.findRecord(a);if(b){return this.createRecord(b)}return undefined},createRecord:function(a){var b=a.uid;if(!this.recordObjects[b]){this.recordObjects[b]=this.recordInstance(a,this);this.addRecordEvents(this.recordObjects[b])}return this.recordObjects[b]},recordInstance:function(a){return new ludo.dataSource.Record(a,this)},addRecordEvents:function(a){a.addEvent("update",this.onRecordUpdate.bind(this));a.addEvent("dispose",this.onRecordDispose.bind(this));a.addEvent("select",this.selectRecord.bind(this))},fireSelect:function(a){this.fireEvent("select",a)},onRecordUpdate:function(a){this.indexRecord(a);this.fireEvent("update",a)},onRecordDispose:function(a){var c=this.getBranchFor(a);if(c){var b=c.indexOf(a);if(b!==-1){c.splice(b,1)}this.removeFromIndex(a);this.fireEvent("dispose",a)}},getBranchFor:function(a){if(a.parentUid){var b=this.findRecord(a.parentUid);return b?b.children:undefined}else{return this.data}},removeFromIndex:function(a){this.recordObjects[a.uid]=undefined;this.index[a.uid]=undefined;var b=this.getPrimaryKeyIndexFor(a);if(b){this.index[b]=undefined
}},getPrimaryKeyIndexFor:function(a){if(this.primaryKey){var c=[];for(var b=0;b<this.primaryKey.length;b++){c.push(a[this.primaryKey[b]])}return c.join("")}return undefined}});ludo.factory.registerClass("dataSource.Collection",ludo.dataSource.Collection);ludo.chart.DataProvider=new Class({Extends:ludo.dataSource.Collection,type:"chart.DataProvider",sum:undefined,recordValues:{},records:[],startColor:"#561AD9",startAngle:270,highlighted:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["startColor"])},ludoEvents:function(){this.parent();this.addEvent("parsedata",this.setRecordValues.bind(this));if(this.data){this.setRecordValues()}},get:function(a){return this.getRecord(a)},setValue:function(c,a){var b=this.getRecord(c);if(b){b.setValue(a)}},getValue:function(b){var a=this.getRecord(b);return a?a.get("value"):undefined},createIndex:function(){this.sum=0;this.parent()},indexRecord:function(a,b){this.sum+=a.value-(this.recordValues[a.uid]?this.recordValues[a.uid]:0);this.parent(a,b);this.recordValues[a.uid]=a.value;this.createRecord(a)},getSum:function(){return this.sum},addRecordEvents:function(a){this.parent(a)},indexOf:function(a){return this.records.indexOf(a)},getSumOf:function(d,a){var b=0;for(var c=0;c<=a;c++){b+=this.records[c].getValue()}return b},createRecord:function(a){var b=this.parent(a);if(this.records.indexOf(b)===-1){this.records.push(b);this.fireEvent("createRecord",b);b.addEvent("focus",this.focus.bind(this));b.addEvent("blur",this.blur.bind(this));b.addEvent("enter",this.enter.bind(this));b.addEvent("leave",this.leave.bind(this))}return b},hasRecords:function(){return this.records.length>0},getRecords:function(){return this.records},color:function(){return this.getDependency("color",{type:"color.Color"})},setRecordValues:function(){var a=this.startColor;var c=this.getRecords();for(var b=0;b<c.length;b++){if(!c[b].get("color")){c[b].set("color",a);c[b].set("color-over",this.color().brighten(a,7));a=this.color().offsetHue(this.startColor,(b+1)*(360/(c.length+1)))}}},focused:undefined,focus:function(a){if(this.focused){this.focused.blur()}this.focused=a;this.fireEvent("focus",a)},blur:function(a){this.fireEvent("blur",a);this.focused=undefined},enter:function(a){if(this.highlighted){this.highlighted.blur()}this.fireEvent("enter",a);this.highlighted=a},leave:function(a){this.fireEvent("leave",a);this.highlighted=undefined},recordInstance:function(a){return new ludo.chart.Record(a,this)},getHighlighted:function(){return this.highlighted}});ludo.chart.Chart=new Class({Extends:ludo.View,css:{},dataProvider:undefined,ludoConfig:function(a){this.parent(a);this.layout.type="Canvas";this.setConfigParams(a,["dataProvider"]);this.css.backgroundColor="#fff";if(!this.dataProvider){this.dataProvider=this.createDependency("dataProvider",{type:"chart.DataProvider",data:a.data})}},updateChildren:function(){for(var a=0;a<this.children.length;a++){if(this.children[a].rendered&&this.children[a].update){this.children[a].onResize()}}},getRecords:function(){return this.dataProvider.getRecords()},getDataProvider:function(){return this.dataProvider},resize:function(a){this.parent(a);this.updateChildren()}});ludo.chart.Fragment=new Class({Extends:ludo.Core,record:undefined,nodes:[],rendering:{},ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["record","parentComponent"]);this.createNodes()},createNodes:function(){},ludoEvents:function(){this.parent();this.getParent().dataProvider().addEvent("update",this.update.bind(this));this.record.addEvent("focus",this.focus.bind(this));this.record.addEvent("blur",this.blur.bind(this));this.record.addEvent("enter",this.enter.bind(this));this.record.addEvent("leave",this.leave.bind(this))},getParent:function(){return this.parentComponent},createNode:function(b,a,d){var c;c=new ludo.canvas.Node(b,a,d);this.dependency["node-"+this.nodes.length]=c;this.nodes.push(c);c.addEvent("mouseenter",this.record.enter.bind(this.record));c.addEvent("mouseleave",this.record.leave.bind(this.record));c.addEvent("click",this.record.click.bind(this.record));c.setStyle("cursor","pointer");this.getParent().adopt(c);this.relayEvents(c,["mouseenter","mouseleave"]);return c},createStyle:function(a){var b=new ludo.canvas.Paint(a);this.getCanvas().adoptDef(b);return b},highlight:function(){},update:function(){},click:function(){this.clicked=true},getCanvas:function(){return this.getParent().getParent().getCanvas()},storeRendering:function(a){this.rendering=a},focus:function(){},blur:function(){},enter:function(){},leave:function(){},getRecord:function(){return this.record}});ludo.canvas.Group=new Class({Extends:ludo.canvas.Element,tag:"g",layout:{},ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["layout","css","renderTo","parentComponent"]);if(this.renderTo){this.renderTo.adopt(this)}if(this.css){this.node.setStyles(this.css)}},resize:function(a){if(a.width){this.width=a.width;this.set("width",a.width+"px")}if(a.height){this.height=a.height;this.set("height",a.height+"px")
}},getSize:function(){return{x:this.width||this.renderTo.offsetWidth,y:this.height||this.renderTo.offsetHeight}},isHidden:function(){return false}});ludo.chart.Base=new Class({Extends:ludo.canvas.Group,fragments:[],fragmentType:"chart.Fragment",highlighted:undefined,focused:undefined,animation:{duration:1,fps:33},addOns:undefined,fragmentMap:{},rendered:false,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["animation"]);this.create.delay(50,this)},ludoEvents:function(){this.parent();var a=this.dataProvider();a.addEvent("createRecord",this.createFragment.bind(this));a.addEvent("update",this.update.bind(this))},createFragments:function(){var a=this.getRecords();for(var b=0;b<a.length;b++){this.createFragment(a[b])}},createFragment:function(a){var b=this.createDependency("fragment"+this.fragments.length,{type:this.fragmentType,record:a,parentComponent:this});this.fragmentMap[a.getUID()]=b;this.fragments.push(b);this.relayEvents(b,["mouseenter","mouseleave"]);return b},getFragments:function(){return this.fragments},getParent:function(){return this.parentComponent},getRecords:function(){return this.getParent().getDataProvider().getRecords()},dataProvider:function(){return this.parentComponent.getDataProvider()},getCenter:function(){var a=this.getSize();return{x:a.x/2,y:a.y/2}},getRadius:function(){var a=this.getCenter();return Math.min(a.x,a.y)},create:function(){if(this.dataProvider().hasRecords()){this.createFragments()}this.render();this.rendered=true},render:function(){},update:function(a){this.fireEvent("update",a)},getFragmentFor:function(a){return this.fragmentMap[a.getUID()]},onResize:function(){},getCanvas:function(){return this.parentComponent.getCanvas()},getSquareSize:function(){var a=this.getSize();return Math.min(a.x,a.y)}});ludo.chart.PieSlice=new Class({Extends:ludo.chart.Fragment,createNodes:function(){var a=this.createStyle(this.getSliceStyle());this.createNode("path",{"class":a})},getSliceStyle:function(){return{"stroke-location":"inside",fill:this.record.get("color"),"stroke-linejoin":"round",stroke:"#ffffff",cursor:"pointer"}},set:function(a,c,b){this.nodes[0].set("d",this.getPath({radius:a,angle:c,degrees:b}))},getPath:function(b){var a=b.center||this.getParent().getCenter();var f=["M "+a.x+" "+a.y];if(b.angle>360){b.angle-=360}var d=ludo.canvasEngine.getPointAtDegreeOffset(a,b.angle,b.radius);f.push("L "+d.x+" "+d.y);f.push("M "+d.x+" "+d.y);f.push("A "+b.radius+" "+b.radius);f.push("0");f.push(b.degrees>180?"1":"0");f.push("1");var c=ludo.canvasEngine.getPointAtDegreeOffset(a,b.angle+b.degrees,b.radius);f.push(c.x+" "+c.y);f.push("L "+a.x+" "+a.y);this.storeRendering(b);return f.join(" ")},focus:function(){var a=this.centerOffset(this.getParent().getHighlightSize());this.node().engine().effect().fly(this.node().getEl(),a.x,a.y,0.1)},blur:function(){this.node().engine().effect().flyBack(this.node().getEl(),0.1)},node:function(){return this.nodes[0]},centerOffset:function(b){var a=this.record.getAngle()+(this.record.getDegrees()/2);return ludo.canvasEngine.getPointAtDegreeOffset({x:0,y:0},a,b)},enter:function(){this.nodes[0].setStyle("fill",this.record.get("color-over"))},leave:function(){this.nodes[0].setStyle("fill",this.record.get("color"))},update:function(){var a=this.getParent().getRadius();if(Math.round(a)==Math.round(this.rendering.radius)&&this.rendering.angle==this.record.getAngle()&&this.rendering.degrees==this.record.getDegrees()){return}var c=new ludo.canvas.Effect();var b=c.getEffectConfig([this.rendering.radius,this.rendering.angle,this.rendering.degrees],[a,this.record.getAngle(),this.record.getDegrees()],1);b.center=this.getParent().getCenter();this.executeAnimation(b,0)},executeAnimation:function(a,b){this.nodes[0].set("d",this.getPath({radius:this.rendering.radius,angle:this.rendering.angle+a.steps[1],degrees:this.rendering.degrees+a.steps[2],center:a.center}));if(b<a.count-1){this.executeAnimation.delay(33,this,[a,b+1])}}});ludo.chart.Pie=new Class({Extends:ludo.chart.Base,fragmentType:"chart.PieSlice",rendered:false,addOns:[],highlightSize:10,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["highlightSize"])},getHighlightSize:function(){return this.highlightSize},render:function(){this.animate()},getRadius:function(){return this.parent()-20},animate:function(){var f=new ludo.canvas.Effect();var c=this.getRecords();var a=f.getEffectConfig([0],[this.getRadius()],1);var g=[];var d=[];for(var b=0;b<c.length;b++){g.push(f.getEffectConfig([0],[c[b].getDegrees()],1).steps[0]);d.push(0)}this.rendered=false;this.executeAnimation({startAngle:this.dataProvider().startAngle,radius:a.steps[0],currentRadius:0,degrees:g,currentDegrees:d,count:a.count},0)},executeAnimation:function(a,c){a.currentRadius+=a.radius;var d=a.startAngle;for(var b=0;b<a.degrees.length;b++){a.currentDegrees[b]+=a.degrees[b];this.fragments[b].set(a.currentRadius,d,a.currentDegrees[b]);d+=a.currentDegrees[b]}if(c<a.count-1){this.executeAnimation.delay(33,this,[a,c+1])}else{this.rendered=true
}},update:function(){if(!this.rendered){this.render()}},onResize:function(){if(!this.rendered){return}var c=this.getRecords();var a=this.getRadius();for(var b=0;b<c.length;b++){this.fragments[b].set(a,c[b].getAngle(),c[b].getDegrees())}}});ludo.chart.Labels=new Class({Extends:ludo.chart.Base,fragmentType:"chart.Label",textStyles:undefined,textStylesOver:undefined,boxStyles:undefined,boxStylesOver:undefined,orientation:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["orientation","textStyles","boxStyles","textStylesOver","boxStylesOver"])},render:function(){this.onResize()},onResize:function(){if(!this.fragments.length){return}var a=this.getSize();this[this.orientation==="horizontal"||a.x>a.y?"resizeHorizontal":"resizeVertical"]()},resizeHorizontal:function(){var g=[];var c=this.getSize();var a=0;for(var b=0;b<this.fragments.length;b++){var f=this.fragments[b].getSize();var d=f.x+12;g.push(a);a+=d}var h=(c.x-a)/2;var j=(c.y-this.fragments[0].getSize().y)/2;for(b=0;b<this.fragments.length;b++){this.fragments[b].node().translate(g[b]+h,j)}},resizeVertical:function(){var g=[];var d=this.getSize();var c=0;for(var b=0;b<this.fragments.length;b++){var f=this.fragments[b].getSize();var a=f.y+3;g.push(c);c+=a}var h=(d.y-c)/2;for(b=0;b<this.fragments.length;b++){this.fragments[b].node().translate(2,g[b]+h)}}});ludo.chart.Label=new Class({Extends:ludo.chart.Fragment,createNodes:function(){var b=this.createNode("g");this.bg=new ludo.canvas.Rect({x:0,y:0,width:10,height:10});this.bg.setStyle("fill","#fff");this.bg.setStyle("fill-opacity","0");b.adopt(this.bg);var a=this.getCoordinatesForColorBox();this.colorBox=new ludo.canvas.Rect(a);b.adopt(this.colorBox);this.colorBox.setStyles(this.getBoxStyles());this.textNode=new ludo.canvas.Text(this.record.getLabel(),{x:a.x+a.width+3,y:this.getYForText()});this.textNode.setStyles(this.getTextStyles());b.adopt(this.textNode);this.setSize();this.bg.set("width",this.size.x);this.bg.set("height",this.size.x)},getFontSize:function(){var a=this.getTextStyles();return a["font-size"]?parseInt(a["font-size"]):13},getYForText:function(){return Math.floor(this.getFontSize()*0.9)},getCoordinatesForColorBox:function(){var b=this.getFontSize();var a=Math.round(b);return{x:0,y:b-a,width:a,height:a}},setSize:function(){this.size=this.nodes[0].getSize()},getSize:function(){return this.size},node:function(){return this.nodes[0]},getBoxStyles:function(){var a=this.getParent().boxStyles||{};a.fill=this.record.get("color");return a},getTextStyles:function(){return this.getParent().textStyles||{"font-size":"13px","font-weight":"normal"}},getTextStylesOver:function(){return this.getParent().textStylesOver||{"font-weight":"bold"}},getBoxStylesOver:function(){var a=this.getParent().boxStylesOver||{};if(!a.fill){a.fill=this.record.get("color-over")}return a},enter:function(){this.textNode.setStyles(this.getTextStylesOver());this.colorBox.setStyles(this.getBoxStylesOver())},leave:function(){this.textNode.setStyles(this.getTextStyles());this.colorBox.setStyles(this.getBoxStyles())}});ludo.chart.AddOn=new Class({Extends:ludo.Core,ludoConfig:function(a){this.parent(a);this.parentComponent=a.parentComponent},getParent:function(){return this.parentComponent}});ludo.chart.PieSliceHighlighted=new Class({Extends:ludo.chart.AddOn,tagName:"path",styles:undefined,size:5,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["styles","size"]);this.node=new ludo.canvas.Path();if(this.styles){this.node.setStyles(this.styles)}else{this.node.setStyle("fill-opacity",0.3)}this.getParent().adopt(this.node);this.node.toBack()},ludoEvents:function(){this.parent();var a=this.getParent().dataProvider();a.addEvents({enter:this.show.bind(this),leave:this.hide.bind(this),focus:this.focus.bind(this),blur:this.blur.bind(this)})},show:function(a){if(!this.getParent().rendered){return}var c=this.getParent().getFragmentFor(a);var d=c.getPath({radius:this.getParent().getRadius()+this.size,angle:a.getAngle(),degrees:a.getDegrees()});this.node.set("d",d);if(!this.styles){this.node.setStyles({fill:a.get("color")})}if(a.isFocused()){var b=c.nodes[0].getTranslate();this.node.translate(b)}else{this.node.translate(0,0)}this.node.show()},hide:function(){this.node.hide()},focus:function(a){var c=this.getParent().getFragmentFor(a);var b=c.centerOffset(this.getParent().getHighlightSize());this.node.translate(0,0);this.node.engine().effect().fly(this.node.getEl(),b.x,b.y,0.1)},blur:function(){this.node.engine().effect().flyBack(this.node.getEl(),0.1)}});ludo.canvas.Paint=new Class({Extends:ludo.canvas.Node,tagName:"style",css:{},nodes:[],className:undefined,tag:undefined,cssPrefix:undefined,mappings:{color:["stroke-color"],"background-color":["fill-color"],opacity:["fill-opacity","stroke-opacity"]},initialize:function(b,a){a=a||{};this.className=a.className||"css-"+String.uniqueID();this.cssPrefix=a.selectors?a.selectors:"."+this.className;if(a.selectors){delete a.selectors}if(a.className){delete a.className}this.parent(this.tagName,a);
if(b!==undefined){this.setStyles(b)}},setStyles:function(a){Object.each(a,function(c,b){this.setStyleProperty(b,c)},this);this.updateCssContent()},setStyle:function(a,b){this.setStyleProperty(a,b);this.updateCssContent()},updateCssContent:function(){var a=JSON.encode(this.css);a=a.replace(/"/g,"");a=a.replace(/,/g,";");this.text(this.cssPrefix+a)},setStyleProperty:function(a,b){b=this.getRealValue(b);if(this.mappings[a]){this.setMapped(a,b)}else{this.css[a]=b}},setMapped:function(c,d){for(var b=0;b<this.mappings[c].length;b++){var a=this.mappings[c][b];this.css[a]=d}},getStyle:function(a){if(this.mappings[a]){a=this.mappings[a][0]}return this.css[a]},getRealValue:function(a){return a&&a.id!==undefined?"url(#"+a.id+")":a},applyTo:function(a){ludo.canvasEngine.addClass(a.el?a.el:a,this.className)},getClassName:function(){return this.className},getUrl:function(){return this.className}});ludo.canvas.NamedNode=new Class({Extends:ludo.canvas.Node,initialize:function(a,b){a=a||{};if(a.listeners){this.addEvents(a.listeners);delete a.listeners}this.parent(this.tagName,a,b)}});ludo.canvas.Rect=new Class({Extends:ludo.canvas.NamedNode,tagName:"rect",getX:function(){return this.el.x.animVal.value},getY:function(){return this.el.y.animVal.value},getWidth:function(){return this.el.width.animVal.value},getHeight:function(){return this.el.height.animVal.value},getRx:function(){return this.el.rx.animVal.value},getRy:function(){return this.el.ry.animVal.value},setX:function(a){this.set("x",a)},setY:function(a){this.set("y",a)},setWidth:function(a){this.set("width",a)},setHeight:function(a){this.set("height",a)},setRx:function(a){this.set("rx",a)},setRy:function(a){this.set("ry",a)}});ludo.canvas.TextBox=new Class({Extends:ludo.canvas.Group,tag:"g",text:undefined,css:{"line-height":13},presentationAttributes:["x","y","width","height"],currentY:0,tags:{"<br>":"text"},ludoConfig:function(a){a=a||{};a.attr=this.getAttributes(a);this.parent(a);this.text=a.text;if(a.css){this.css=a.css}if(this.text){this.renderText()}},getAttributes:function(b){var a=b.attr||{};var d=this.presentationAttributes;for(var c=0;c<d.length;c++){if(b[d[c]]!==undefined){a[d[c]]=b[d[c]]}}return a},tagsToInsert:function(){var a=this.getTextParts();return this.toTags(a)},getTextParts:function(){var d=this.text.match(/(<\/?[a-z]+?>)/gmi);if(!d){return[this.text]}var b=0;var a=[];for(var c=0;c<d.length;c++){var f=this.text.indexOf(d[c],b===0?b:b+1);if(f>b){a.push(this.text.substr(b,f-b))}b=f}if(b<this.text.length){a.push(this.text.substr(b))}return a},toTags:function(b){var d=[{tag:"text",properties:{y:this.getYOfLine()}}];var c=d[0];for(var f=0;f<b.length;f++){var a=b[f].match(/<([a-z]+?)>/gi);if(a){a=a[0]}var g={properties:{}};g.tag=this.tags[a]?this.tags[a]:"tspan";g=this.assignDefaultProperties(g,a);g.text=this.stripTags(b[f]);if(g.tag==="tspan"){c.children=c.children||[];c.children.push(g)}else{d.push(g)}if(g.tag==="text"){g.properties.y=this.getYOfLine();c=g}}return d},assignDefaultProperties:function(f,a){if(a){var c=this.getDefaultTagProperties();var d=c[a];if(d){for(var b in d){if(d.hasOwnProperty(b)){f.properties[b]=d[b]}}}}return f},getYOfLine:function(){this.currentY+=15;return this.currentY},setText:function(a){this.currentY=0;this.empty();this.text=a;this.renderText()},renderText:function(){this.renderItems(this.tagsToInsert(),this)},renderItems:function(a,c){for(var b=0;b<a.length;b++){var d=new ludo.canvas.Node(a[b].tag,a[b].properties,a[b].text);c.adopt(d);if(a[b].children){this.renderItems(a[b].children,d)}}},stripTags:function(a){return a.replace(/<\/?[^>]+?>/g,"")},getDefaultTagProperties:function(){return{"<b>":{"font-weight":"bold"},"<em>":{"font-style":"italic"}}}});ludo.chart.Tooltip=new Class({Extends:ludo.chart.AddOn,tpl:"{label}: {value}",shown:false,offset:{x:0,y:0},size:{x:0,y:0},boxStyles:{},textStyles:{},ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["tpl","boxStyles","textStyles"]);this.createDOM();this.getParent().addEvents({mouseenter:this.show.bind(this),mouseleave:this.hide.bind(this)});this.getParent().getNode().addEvent("mousemove",this.move.bind(this))},createDOM:function(){this.node=new ludo.canvas.Node("g");this.getParent().adopt(this.node);this.node.hide();this.node.toFront.delay(50,this.node);this.rect=new ludo.canvas.Rect({x:0,y:0,rx:2,ry:2});this.rect.setStyles(this.getBoxStyling());this.node.adopt(this.rect);this.textBox=new ludo.canvas.TextBox();this.textBox.getNode().translate(4,0);this.textBox.getNode().setStyles(this.getTextStyles());this.node.adopt(this.textBox)},getBoxStyling:function(){var a=this.boxStyles||{};if(!a.fill){a.fill="#fff"}if(!a["stroke-location"]){a["stroke-location"]="inside"}if(a["fill-opacity"]===undefined){a["fill-opacity"]=0.8}if(a["stroke-width"]===undefined){a["stroke-width"]=1}return a},getTextStyles:function(){var a=this.textStyles||{};if(!a.fill){a.fill="#000"}return a},show:function(a){this.node.show();this.shown=true;this.offset=this.getParent().getParent().getBody().getPosition();
this.textBox.setText(this.getParsedHtml());this.rect.setStyle("stroke",this.getRecord().get("color"));this.size=this.textBox.getNode().getSize();this.size.x+=7;this.size.y+=10;this.rect.set("width",this.size.x);this.rect.set("height",this.size.y);this.rect.show();this.move(a)},hide:function(){this.node.hide();this.rect.hide();this.shown=false},move:function(a){if(this.shown){var b={x:a.page.x-this.offset.x-this.size.x-10,y:a.page.y-this.offset.y-this.size.y-5};if(b.x<0){b.x+=(this.size.x+20)}if(b.y<0){b.y+=(this.size.y+10)}this.node.translate(b.x,b.y)}},getParsedHtml:function(){var b=this.tpl.match(/\{(.*?)\}/gm);var a=this.tpl;var g=this.getRecord();for(var d=0;d<b.length;d++){var c=b[d].substr(1,b[d].length-2);var h="get"+c.substr(0,1).toUpperCase()+c.substr(1);var f=g[h]!==undefined?g[h]():g.get(c);if(f===undefined&&this.getParent().dataProvider()["method"]){f=this.getParent().dataProvider()["method"]()}if(!isNaN(f)&&f%1!==0){f=f.toFixed(1)}a=a.replace(b[d],f)}return a},getRecord:function(){return this.getParent().dataProvider().getHighlighted()}});ludo.ludoDB.Factory=new Class({Extends:ludo.Core,ludoDBConfig:undefined,arguments:undefined,resource:undefined,url:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["url","resource","arguments"]);if(this.arguments&&!ludo.util.isArray(this.arguments)){this.arguments=[this.arguments]}this.ludoDBConfig=a},load:function(){var b=[this.resource];if(this.arguments){b.splice(1,0,this.arguments)}var a=new ludo.remote.JSON({resource:"LudoJS",url:this.getUrl()});a.addEvent("success",this.loadComplete.bind(this));a.send("form",b)},loadComplete:function(a){this.fireEvent("load",a.getResponseData())}});ludo.color.Color=new Class({rgbColors:function(b){if(b.substr!==undefined){return this.rgbObject(b)}if(b.h!==undefined){return this.hsvToRGB(b.h,b.s,b.v)}return undefined},rgbObject:function(a){a=a.replace("#","");return{r:a.substr(0,2).toInt(16),g:a.substr(2,2).toInt(16),b:a.substr(4,2).toInt(16)}},rgbCode:function(f,d,h){if(d===undefined){if(f.r!==undefined){d=f.g;h=f.b;f=f.r}else{if(f.h!==undefined){var g=this.hsvToRGB(f.h,f.s,f.v);f=g.r;d=g.g;h=g.b}}}return this.toRGB(f,d,h)},toRGB:function(j,h,c){var f=Math.round(j).toString(16);var d=Math.round(h).toString(16);var a=Math.round(c).toString(16);if(f.length===1){f=["0",f].join("")}if(d.length===1){d=["0",d].join("")}if(a.length===1){a=["0",a].join("")}return["#",f,d,a].join("").toUpperCase()},toRGBFromObject:function(a){return this.toRGB(a.r,a.g,a.b)},toHSV:function(a){if(a.r===undefined){a=this.rgbObject(a)}return this.toHSVFromRGB(a.r,a.g,a.b)},toHSVFromRGBCode:function(b){var a=this.rgbObject(b);return this.toHSVFromRGB(a.r,a.g,a.b)},toHSVFromRGB:function(m,l,c){m=m/255;l=l/255;c=c/255;var a=Math.max(m,l,c),f=Math.min(m,l,c);var k,j;var n=a-f;j=a==0?0:n/a;if(a==f){k=0}else{switch(a){case m:k=(l-c)/n+(l<c?6:0);break;case l:k=(c-m)/n+2;break;case c:k=(m-l)/n+4;break}k/=6}return{h:k*360,s:j*100,v:a*100}},hsvToRGBCode:function(d,c,a){if(c===undefined){c=d.s;a=d.v;d=d.h}var b=this.hsvToRGB(d,c,a);return this.toRGB(b.r,b.g,b.b)},hsvToRGB:function(k,w,o){if(w===undefined){w=k.s;o=k.v;k=k.h}k/=360;w/=100;o/=100;var a,l,n;var j=Math.floor(k*6);var m=k*6-j;var d=o*(1-w);var c=o*(1-m*w);var u=o*(1-(1-m)*w);switch(j%6){case 0:a=o;l=u;n=d;break;case 1:a=c;l=o;n=d;break;case 2:a=d;l=o;n=u;break;case 3:a=d;l=c;n=o;break;case 4:a=u;l=d;n=o;break;case 5:a=o;l=d;n=c;break}return{r:a*255,g:l*255,b:n*255}},hslToRgb:function(k,o,j){var a,m,n;if(o==0){a=m=n=j}else{function f(h,g,b){if(b<0){b+=1}if(b>1){b-=1}if(b<1/6){return h+(g-h)*6*b}if(b<1/2){return g}if(b<2/3){return h+(g-h)*(2/3-b)*6}return h}var c=j<0.5?j*(1+o):j+o-j*o;var d=2*j-c;a=f(d,c,k+1/3);m=f(d,c,k);n=f(d,c,k-1/3)}return{r:a*255,g:m*255,b:n*255}},offsetHue:function(a,c){var b=this.toHSV(a);b.h+=c;if(b.h>=360){b.h-=360}return this.rgbCode(b)},offsetBrightness:function(a,c){var b=this.toHSV(a);b.v+=c;if(b.v>100){b.v=100}if(b.v<0){b.v=0}return this.rgbCode(b)},offsetSaturation:function(a,c){var b=this.toHSV(a);b.s+=c;if(b.s>100){b.s=100}if(b.s<0){b.s=0}return this.rgbCode(b)},brighten:function(a,c){var b=this.toHSV(a);a=this.offsetBrightness(a,b.v*c/100);a=this.offsetSaturation(a,b.s*c/100*-1);return a},darken:function(a,c){var b=this.toHSV(a);a=this.offsetBrightness(a,b.v*c/100*-1);a=this.offsetSaturation(a,b.s*c/100);return a}});ludo.color.Base=new Class({Extends:ludo.View,setColor:function(a){this.value=a}});ludo.effect.DraggableNode=new Class({id:undefined,el:undefined,handle:undefined,minX:undefined,maxX:undefined,minY:undefined,maxY:undefined,directions:undefined});ludo.effect.Effect=new Class({Extends:ludo.Core,fps:33,fly:function(a){a.el=document.id(a.el);a.duration=a.duration||0.2;if(a.from==undefined){a.from=a.el.getPosition()}var b=this.getFx(a.el,a.duration,a.onComplete);b.start({left:[a.from.x,a.to.x],top:[a.from.y,a.to.y]})},flyTo:function(b,a,d,c){this.fly({el:b,to:{x:a,y:d},duration:c})},getFx:function(a,d,c){d*=1000;var b=new Fx.Morph(a,{duration:d});
b.addEvent("complete",this.animationComplete.bind(this,[c,a]));return b},animationComplete:function(b,a){this.fireEvent("animationComplete",this);if(b!==undefined){b.call(this,a)}},fadeOut:function(a,d,f){var b=this.getStops(d);var c=100/b*-1;this.execute({el:a,index:0,stops:b,styles:[{key:"opacity",currentValue:100,change:c}],callback:f,unit:""})},slideIn:function(a,b,f,d){d=d||a.getPosition();var c={x:d.x,y:a.parentNode.offsetWidth+a.offsetHeight};this.slide(a,c,d,b,f)},slideOut:function(a,b,f,d){d=d||a.getPosition();var c={x:d.x,y:a.parentNode.offsetHeight+a.offsetHeight};this.slide(a,d,c,b,f)},slide:function(a,h,g,d,f){var c=this.getStops(d);var b=[];if(h.x!==g.x){a.style.left=h.x+"px";b.push({key:"left",currentValue:h.x,change:(g.x-h.x)/c})}if(h.y!==g.y){a.style.top=h.y+"px";b.push({key:"top",currentValue:h.y,change:(g.y-h.y)/c})}this.execute({el:a,index:0,stops:c,styles:b,callback:f,unit:"px"});this.show(a)},fadeIn:function(a,d,f){var b=this.getStops(d);var c=100/b;this.execute({el:a,index:0,stops:b,styles:[{key:"opacity",currentValue:0,change:c}],callback:f,unit:""});this.show(a)},show:function(a){if(a.style.visibility==="hidden"){a.style.visibility="visible"}},getStops:function(a){return Math.round(a*this.fps)},execute:function(a){var d=a.el;for(var b=0;b<a.styles.length;b++){var c=a.styles[b];c.currentValue+=c.change;switch(c.key){case"opacity":d.style.opacity=(c.currentValue/100);d.style.filter=["alpha(opacity=",c.currentValue,")"].join("");break;default:d.style[c.key]=Math.round(c.currentValue)+a.unit}a.index++;if(a.index<a.stops){this.execute.delay(this.fps,this,a)}else{if(a.callback){a.callback.apply(this)}}}}});ludo.effect.Drag=new Class({Extends:ludo.effect.Effect,handle:undefined,el:undefined,minX:undefined,minY:undefined,maxX:undefined,maxY:undefined,minPos:undefined,maxPos:undefined,directions:"XY",unit:"px",dragProcess:{active:false},coordinatesToDrag:undefined,delay:0,inDelayMode:false,els:{},useShim:false,autoHideShim:true,shimCls:undefined,mouseYOffset:undefined,mouseXOffset:undefined,fireEffectEvents:true,ludoConfig:function(a){this.parent(a);if(a.el!==undefined){this.add({el:a.el,handle:a.handle})}this.setConfigParams(a,["useShim","autoHideShim","directions","delay","minX","maxX","minY","maxY","minPos","maxPos","unit","shimCls","mouseYOffset","mouseXOffset","fireEffectEvents"])},ludoEvents:function(){this.parent();this.getEventEl().addEvent(ludo.util.getDragMoveEvent(),this.drag.bind(this));this.getEventEl().addEvent(ludo.util.getDragEndEvent(),this.endDrag.bind(this));if(this.useShim){this.addEvent("start",this.showShim.bind(this));if(this.autoHideShim){this.addEvent("end",this.hideShim.bind(this))}}},add:function(b){b=this.getValidNode(b);var a=document.id(b.el);this.setPositioning(a);var c=b.handle?document.id(b.handle):a;c.id=c.id||"ludo-"+String.uniqueID();ludo.dom.addClass(c,"ludo-drag");c.addEvent(ludo.util.getDragStartEvent(),this.startDrag.bind(this));c.setAttribute("forId",b.id);this.els[b.id]=Object.merge(b,{el:document.id(a),handle:c});return this.els[b.id]},remove:function(b){if(this.els[b]!==undefined){var a=document.id(this.els[b].handle);a.removeEvent(ludo.util.getDragStartEvent(),this.startDrag.bind(this));this.els[b]=undefined;return true}return false},removeAll:function(){var b=Object.keys(this.els);for(var a=0;a<b.length;a++){this.remove(b[a])}this.els={}},getValidNode:function(a){if(!this.isElConfigObject(a)){a={el:document.id(a)}}if(typeof a.el==="string"){a.el=document.id(a.el)}a.id=a.id||a.el.id||"ludo-"+String.uniqueID();if(!a.el.id){a.el.id=a.id}a.el.setAttribute("forId",a.id);return a},isElConfigObject:function(a){return a.el!==undefined||a.handle!==undefined},setPositioning:function(a){if(!this.useShim){a.style.position="absolute"}else{var b=a.getStyle("position");if(!b||(b!="relative"&&b!="absolute")){a.style.position="relative"}}},getById:function(a){return this.els[a]},getIdByEvent:function(b){var a=b.target;if(!a.hasClass("ludo-drag")){a=a.getParent(".ludo-drag")}return a.getProperty("forId")},getDragged:function(){return this.els[this.dragProcess.dragged]},getEl:function(){return this.els[this.dragProcess.dragged].el},getShimOrEl:function(){return this.useShim?this.getShim():this.getEl()},getSizeOf:function(a){return a.getSize!==undefined?a.getSize():{x:0,y:0}},getPositionOf:function(a){return a.getPosition()},setDragCoordinates:function(){this.coordinatesToDrag={x:"x",y:"y"}},startDrag:function(f){var j=this.getIdByEvent(f);var d=this.getById(j).el;var b=this.getSizeOf(d);var h;if(this.useShim){h=d.getPosition()}else{var c=this.getPositionedParent(d);h=c?d.getPosition(c):this.getPositionOf(d)}var a=h.x;var g=h.y;this.dragProcess={active:true,dragged:j,currentX:a,currentY:g,elX:a,elY:g,width:b.x,height:b.y,mouseX:f.page.x,mouseY:f.page.y};this.dragProcess.el=this.getShimOrEl();this.fireEvent("before",[this.els[j],this,{x:a,y:g}]);if(!this.isActive()){return undefined}this.dragProcess.minX=this.getMinX();this.dragProcess.maxX=this.getMaxX();this.dragProcess.minY=this.getMinY();
this.dragProcess.maxY=this.getMaxY();this.dragProcess.dragX=this.canDragAlongX();this.dragProcess.dragY=this.canDragAlongY();if(this.delay){this.setActiveAfterDelay()}else{this.fireEvent("start",[this.els[j],this,{x:a,y:g}]);if(this.fireEffectEvents){ludo.EffectObject.start()}}return false},getPositionedParent:function(b){var a=b.parentNode;while(a){var c=a.getStyle("position");if(c==="relative"||c==="absolute"){return a}a=a.getParent()}return undefined},cancelDrag:function(){this.dragProcess.active=false;this.dragProcess.el=undefined;if(this.fireEffectEvents){ludo.EffectObject.end()}},getShimFor:function(a){return a},setActiveAfterDelay:function(){this.inDelayMode=true;this.dragProcess.active=false;this.startIfMouseNotReleased.delay(this.delay*1000,this)},startIfMouseNotReleased:function(){if(this.inDelayMode){this.dragProcess.active=true;this.inDelayMode=false;this.fireEvent("start",[this.getDragged(),this,{x:this.getX(),y:this.getY()}]);ludo.EffectObject.start()}},drag:function(a){if(this.dragProcess.active&&this.dragProcess.el){var b={x:undefined,y:undefined};if(this.dragProcess.dragX){b.x=this.getXDrag(a)}if(this.dragProcess.dragY){b.y=this.getYDrag(a)}this.move(b);this.fireEvent("drag",[b,this.els[this.dragProcess.dragged],this]);if(ludo.util.isTabletOrMobile()){return false}}return undefined},move:function(a){if(a.x!==undefined){this.dragProcess.currentX=a.x;this.dragProcess.el.style.left=a.x+this.unit}if(a.y!==undefined){this.dragProcess.currentY=a.y;this.dragProcess.el.style.top=a.y+this.unit}},getX:function(){return this.dragProcess.currentX},getY:function(){return this.dragProcess.currentY},getXDrag:function(a){var b;if(this.mouseXOffset){b=a.page.x+this.mouseXOffset}else{b=a.page.x-this.dragProcess.mouseX+this.dragProcess.elX}if(b<this.dragProcess.minX){b=this.dragProcess.minX}if(b>this.dragProcess.maxX){b=this.dragProcess.maxX}return b},getYDrag:function(a){var b;if(this.mouseYOffset){b=a.page.y+this.mouseYOffset}else{b=a.page.y-this.dragProcess.mouseY+this.dragProcess.elY}if(b<this.dragProcess.minY){b=this.dragProcess.minY}if(b>this.dragProcess.maxY){b=this.dragProcess.maxY}return b},endDrag:function(){if(this.dragProcess.active){this.cancelDrag();this.fireEvent("end",[this.getDragged(),this,{x:this.getX(),y:this.getY()}])}if(this.inDelayMode){this.inDelayMode=false}},setMaxX:function(a){this.maxX=a},setMinX:function(a){this.minX=a},setMinY:function(a){this.minY=a},setMaxY:function(a){this.maxY=a},setMinPos:function(a){this.minPos=a},setMaxPos:function(a){this.maxPos=a},getMaxX:function(){return this.getMaxPos("maxX")},getMaxY:function(){return this.getMaxPos("maxY")},getMaxPos:function(b){var a=this.getConfigProperty(b);return a!==undefined?a:this.maxPos!==undefined?this.maxPos:100000},getMinX:function(){var a=this.getConfigProperty("minX");return a!==undefined?a:this.minPos},getMinY:function(){var a=this.getDragged();return a&&a.minY!==undefined?a.minY:this.minY!==undefined?this.minY:this.minPos},getDraggedX:function(){return this.getX()-this.dragProcess.elX},getDraggedY:function(){return this.getY()-this.dragProcess.elY},canDragAlongX:function(){return this.getConfigProperty("directions").indexOf("X")>=0},canDragAlongY:function(){return this.getConfigProperty("directions").indexOf("Y")>=0},getConfigProperty:function(b){var a=this.getDragged();return a&&a[b]!==undefined?a[b]:this[b]},getWidth:function(){return this.dragProcess.width},getHeight:function(){return this.dragProcess.height},getLeft:function(){return this.dragProcess.currentX},getTop:function(){return this.dragProcess.currentY},getShim:function(){if(this.shim===undefined){this.shim=new Element("div");ludo.dom.addClass(this.shim,"ludo-shim");this.shim.setStyles({position:"absolute","z-index":50000,display:"none"});document.body.adopt(this.shim);if(this.shimCls){for(var a=0;a<this.shimCls.length;a++){this.shim.addClass(this.shimCls[a])}}this.fireEvent("createShim",this.shim)}return this.shim},showShim:function(){this.getShim().setStyles({display:"",left:this.getShimX(),top:this.getShimY(),width:this.getWidth()+this.getShimWidthDiff(),height:this.getHeight()+this.getShimHeightDiff()});this.fireEvent("showShim",[this.getShim(),this])},getShimY:function(){if(this.mouseYOffset){return this.dragProcess.mouseY+this.mouseYOffset}else{return this.getTop()+ludo.dom.getMH(this.getEl())-ludo.dom.getMW(this.shim)}},getShimX:function(){if(this.mouseXOffset){return this.dragProcess.mouseX+this.mouseXOffset}else{return this.getLeft()+ludo.dom.getMW(this.getEl())-ludo.dom.getMW(this.shim)}},getShimWidthDiff:function(){return ludo.dom.getMW(this.getEl())-ludo.dom.getMBPW(this.shim)},getShimHeightDiff:function(){return ludo.dom.getMH(this.getEl())-ludo.dom.getMBPH(this.shim)},hideShim:function(){this.getShim().style.display="none"},setShimText:function(a){this.getShim().set("html",a)},flyBack:function(a){this.fly({el:this.getShimOrEl(),duration:a,from:{x:this.getLeft(),y:this.getTop()},to:{x:this.getStartX(),y:this.getStartY()},onComplete:this.flyBackComplete.bind(this)})
},flyToShim:function(a){this.fly({el:this.getEl(),duration:a,from:{x:this.getStartX(),y:this.getStartY()},to:{x:this.getLeft(),y:this.getTop()},onComplete:this.flyToShimComplete.bind(this)})},getStartX:function(){return this.dragProcess.elX},getStartY:function(){return this.dragProcess.elY},flyBackComplete:function(){this.fireEvent("flyBack",[this,this.getShimOrEl()])},flyToShimComplete:function(){this.fireEvent("flyToShim",[this,this.getEl()])},isActive:function(){return this.dragProcess.active}});ludo.form.validator.required=function(a,b){return !b||a.length>0};ludo.form.validator.minLength=function(b,a){return b.length===0||b.length>=a};ludo.form.validator.maxLength=function(b,a){return b.length===0||b.length<=a};ludo.form.validator.regex=function(b,a){return b.length===0||a.test(b)};ludo.form.validator.minValue=function(b,a){return b.length===0||parseInt(b)>=a};ludo.form.validator.maxValue=function(a,b){return a.length===0||parseInt(a)<=b};ludo.form.validator.twin=function(c,a){var b=ludo.get(a);return !b||(b&&c===b.value)};ludo.form.Element=new Class({Extends:ludo.View,label:undefined,suffix:"",value:undefined,onLoadMessage:"",labelWidth:100,name:undefined,fieldWidth:undefined,formCss:undefined,stretchField:true,required:false,dirtyFlag:false,initialValue:undefined,constructorValue:undefined,isReady:true,overflow:"hidden",twin:undefined,linkWith:undefined,statefulProperties:["value"],validator:undefined,validatorFn:undefined,validators:[],ludoConfig:function(b){this.parent(b);var a=this.getInheritedFormConfig();this.labelWidth=a.labelWidth||this.labelWidth;this.fieldWidth=a.fieldWidth||this.fieldWidth;this.inlineLabel=a.inlineLabel||this.inlineLabel;var c=["label","suffix","formCss","validator","stretchField","required","twin","disabled","labelWidth","fieldWidth","value","data"];this.setConfigParams(b,c);this.elementId="el-"+this.id;this.formCss=a.formCss||this.formCss;if(a.height&&b.height===undefined){this.layout.height=a.height}if(this.validator){this.createValidator()}if(b.linkWith!==undefined){this.setLinkWith(b.linkWith)}if(this.dataSource){this.isReady=false}this.initialValue=this.constructorValue=this.value;if(!this.name){this.name="ludo-form-el-"+String.uniqueID()}ludo.Form.add(this);if(this.required){this.applyValidatorFns(["required"])}this.applyValidatorFns(["twin"])},applyValidatorFns:function(c){for(var b=0;b<c.length;b++){var a=c[b];if(this[a]!==undefined){this.validators.push({fn:ludo.form.validator[a],key:a})}}},createValidator:function(){var a;if(ludo.util.isFunction(this.validator)){a=this.validator}else{this.validator.applyTo=this;this.validator=ludo._new(this.validator);a=this.validator.isValid.bind(this.validator)}this.validators.push({fn:a,key:""})},ludoEvents:function(){this.parent();if(this.dataSource){this.getDataSource().addEvent("load",this.setReady.bind(this))}var a=this.getFormEl();if(a){a.addEvent("keydown",this.keyDown.bind(this));a.addEvent("keypress",this.keyPress.bind(this));a.addEvent("keyup",this.keyUp.bind(this));a.addEvent("focus",this.focus.bind(this));a.addEvent("change",this.change.bind(this));a.addEvent("blur",this.blur.bind(this))}},ludoRendered:function(){this.parent();if(this.disabled){this.disable()}if(this.els.formEl){this.els.formEl.setProperty("name",this.getName());if(this.value!==undefined){this.els.formEl.set("value",this.value)}}if(this.linkWith){this.createBackLink()}var a=this.getParentForm();if(a){a.registerFormElement(this)}this.validate()},setEnabled:function(a){if(a){this.enable()}else{this.disable()}},disable:function(){this.getFormEl().setProperty("disabled","1");ludo.dom.addClass(this.els.label,"ludo-form-label-disabled")},enable:function(){this.getFormEl().removeProperty("disabled");ludo.dom.removeClass(this.els.label,"ludo-form-label-disabled")},getInheritedFormConfig:function(){var a=this.getParent();if(a){return a.formConfig||{}}return{}},ludoCSS:function(){this.parent();ludo.dom.addClass(this.getEl(),"ludo-form-element");if(this.els.formEl){if(this.fieldWidth){this.els.formEl.style.width=(this.fieldWidth-ludo.dom.getPW(this.els.formEl)-ludo.dom.getBW(this.els.formEl))+"px"}this.els.formEl.id=this.elementId;if(this.formCss){this.els.formEl.setStyles(this.formCss)}}},getFormElId:function(){return this.elementId},getWidth:function(){var a=this.parent();return a?a:this.fieldWidth+(this.label?this.labelWidth:0)+2},keyUp:function(a){this.fireEvent("key_up",[a.key,this.value,this])},keyDown:function(a){this.fireEvent("key_down",[a.key,this.value,this])},keyPress:function(a){this.fireEvent("key_press",[a.key,this.value,this])},focus:function(){this._focus=true;this.clearInvalid();this.fireEvent("focus",[this.value,this])},change:function(){if(this.els.formEl){this.setValue(this.els.formEl.get("value"))}if(this.wasValid){this.fireEvent("change",[this.getValue(),this])}},blur:function(){this._focus=false;this.validate();if(this.getFormEl()){this.value=this.getValueOfFormEl()}this.toggleDirtyFlag();this.fireEvent("blur",[this.value,this])},getValueOfFormEl:function(){return this.getFormEl().get("value")
},toggleDirtyFlag:function(){if(this.value!==this.initialValue){this.setDirty();this.fireEvent("dirty",[this.value,this])}else{this.setClean();this.fireEvent("clean",[this.value,this])}},hasFocus:function(){return this._focus},insertJSON:function(a){this.populate(a)},populate:function(){},getLabel:function(){return this.label},getValue:function(){return this.els.formEl?this.els.formEl.get("value"):this.value},setValue:function(a){if(!this.isReady){if(a){this.setValue.delay(50,this,a)}return}if(a==this.value){return}this.setFormElValue(a);this.value=a;this.validate();if(this.wasValid){this.fireEvent("valueChange",[this.getValue(),this]);if(this.stateful){this.fireEvent("state")}if(this.linkWith){this.updateLinked()}}this.fireEvent("value",a)},setFormElValue:function(a){if(this.els.formEl&&this.els.formEl.value!==a){this.els.formEl.set("value",a);if(this.inlineLabel){ludo.dom.removeClass(this.els.formEl,"ludo-form-el-inline-label")}}},getFormEl:function(){return this.els.formEl},isValid:function(){if(this.validators.length===0){return true}var b=this.getFormEl()?this.getValueOfFormEl().trim():this.value;for(var a=0;a<this.validators.length;a++){if(!this.validators[a].fn.apply(this,[b,this[this.validators[a].key]])){return false}}return true},clearInvalid:function(){ludo.dom.removeClass(this.getEl(),"ludo-form-el-invalid")},wasValid:true,validate:function(){this.clearInvalid();if(this.isValid()){this.wasValid=true;this.fireEvent("valid",[this.value,this]);return true}else{this.wasValid=false;this.fireEvent("invalid",[this.value,this]);return false}},isFormElement:function(){return true},reset:function(){this.setValue(this.initialValue)},clear:function(){this.setValue(this.constructorValue)},commit:function(){if(!this.isReady){this.commit.delay(100,this);return}this.initialValue=this.value},isDirty:function(){return this.dirtyFlag},setDirty:function(){this.dirtyFlag=true;ludo.dom.addClass(this.getEl(),"ludo-form-el-dirty")},setClean:function(){this.dirtyFlag=false;ludo.dom.removeClass(this.getEl(),"ludo-form-el-dirty")},setReady:function(){this.isReady=true},updateLinked:function(){var a=this.getLinkWith();if(a&&a.value!==this.value){a.setValue(this.value)}},setLinkWith:function(a){this.linkWith=a;this.addEvent("valueChange",this.updateLinked.bind(this))},createBackLink:function(a){a=a||0;var b=this.getLinkWith();if(b&&!b.linkWith){if(this.value===undefined){this.initialValue=this.constructorValue=b.value;this.setValue(b.value)}b.setLinkWith(this)}else{if(a<100){this.createBackLink.delay(50,this,a+1)}}},getLinkWith:function(){var a=ludo.get(this.linkWith);return a?a:this.parentComponent?this.parentComponent.child[this.linkWith]:undefined}});ludo.form.LabelElement=new Class({Extends:ludo.form.Element,fieldTpl:["<table ",'cellpadding="0" cellspacing="0" border="0" width="100%">',"<tbody>",'<tr class="input-row">','<td class="label-cell"><label class="input-label"></label></td>','<td><div class="input-cell"></div></td>','<td class="invalid-cell" style="position:relative"><div class="invalid-cell-div"></div></td>','<td class="suffix-cell" style="display:none"><label></label></td>','<td class="help-cell" style="display:none"></td>',"</tr>","</tbody>","</table>"],labelSuffix:":",ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["inlineLabel"]);if(!this.supportsInlineLabel()){this.inlineLabel=undefined}},ludoEvents:function(){this.parent();if(this.inlineLabel){var a=this.getFormEl();if(a){a.addEvent("blur",this.setInlineLabel.bind(this));a.addEvent("focus",this.clearInlineLabel.bind(this));this.addEvent("value",this.clearInlineLabelCls.bind(this))}}},ludoDOM:function(){this.parent();this.getBody().set("html",this.fieldTpl.join(""));this.addInput();this.addLabel();this.setWidthOfLabel()},ludoRendered:function(){this.parent();if(this.inlineLabel){this.setInlineLabel()}},supportsInlineLabel:function(){return true},setInlineLabel:function(){if(!this.inlineLabel){return}var a=this.getFormEl();if(a.get("value").length===0){ludo.dom.addClass(a,"ludo-form-el-inline-label");a.set("value",this.inlineLabel)}},clear:function(){this.parent();this.setInlineLabel()},reset:function(){this.parent();this.setInlineLabel()},clearInlineLabel:function(){var a=this.getFormEl();if(a.get("value")===this.inlineLabel){a.set("value","");ludo.dom.removeClass(this.getFormEl(),"ludo-form-el-inline-label")}},clearInlineLabelCls:function(){ludo.dom.removeClass(this.getFormEl(),"ludo-form-el-inline-label")},getValueOfFormEl:function(){var a=this.getFormEl().get("value");return this.inlineLabel&&this.inlineLabel===a?"":a},addLabel:function(){if(this.label!==undefined){this.getLabelDOM().set("html",this.label?this.label+this.labelSuffix:"");this.els.label.setProperty("for",this.getFormElId())}if(this.suffix){var b=this.getSuffixCell();b.style.display="";var a=b.getElement("label");if(a){a.set("html",this.suffix);a.setProperty("for",this.getFormElId())}}},setWidthOfLabel:function(){if(this.label===undefined){this.getLabelDOM().style.display="none"
}else{this.getLabelDOM().parentNode.style.width=this.labelWidth+"px"}},getLabelDOM:function(){return this.getCell(".input-label","label")},addInput:function(){if(!this.inputTag){return}this.els.formEl=new Element(this.inputTag);if(this.inputType){this.els.formEl.setProperty("type",this.inputType)}if(this.maxLength){this.els.formEl.setProperty("maxlength",this.maxLength)}if(this.readonly){this.els.formEl.setProperty("readonly",true)}this.getInputCell().adopt(this.els.formEl);if(this.fieldWidth){this.els.formEl.style.width=this.fieldWidth+"px";this.getInputCell().parentNode.style.width=(this.fieldWidth+ludo.dom.getMBPW(this.els.formEl))+"px"}this.els.formEl.id=this.getFormElId()},getSuffixCell:function(){return this.getCell(".suffix-cell","labelSuffix")},getInputCell:function(){return this.getCell(".input-cell","cellInput")},getInputRow:function(){return this.getCell(".input-row","inputRow")},getCell:function(a,b){if(!this.els[b]){this.els[b]=this.getBody().getElement(a)}return this.els[b]},resizeDOM:function(){this.parent();if(this.stretchField&&this.els.formEl){var b=this.getWidth();if(!isNaN(b)&&b>0){b-=(ludo.dom.getMBPW(this.getEl())+ludo.dom.getMBPW(this.getBody()))}else{var a=this.getParent();if(a&&a.layout.type!=="linear"&&a.layout.orientation!=="horizontal"){b=a.getWidth();b-=(ludo.dom.getMBPW(a.getEl())+ludo.dom.getMBPW(a.getBody()));b-=(ludo.dom.getMBPW(this.getEl())+ludo.dom.getMBPW(this.getBody()))}else{var d=this.els.container;b=d.offsetWidth-ludo.dom.getMBPW(this.els.body)-ludo.dom.getPW(d)-ludo.dom.getBW(d)}}if(this.label!==undefined){b-=this.labelWidth}if(this.suffix){b-=this.getSuffixCell().offsetWidth}if(this.inputTag!=="select"){b-=5}if(b>0&&!isNaN(b)){this.formFieldWidth=b;this.getFormEl().style.width=b+"px"}}}});ludo.form.Slider=new Class({Extends:ludo.form.LabelElement,cssSignature:"ludo-form-slider",type:"form.Slider",fieldTpl:["<table ",'cellpadding="0" cellspacing="0" border="0" width="100%">',"<tbody>",'<tr class="input-row">','<td class="label-cell"><label class="input-label"></label></td>','<td class="input-cell"></td>','<td class="suffix-cell" style="display:none"></td>','<td class="help-cell" style="display:none"></td>',"</tr>","</tbody>","</table>"],inputTag:undefined,inputType:undefined,sliderSize:100,direction:"horizontal",minValue:1,maxValue:10,height:undefined,reverse:false,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["direction","minValue","maxValue","reverse"])},ludoRendered:function(){this.parent();this.moveSliderBackgrounds()},moveSliderBackgrounds:function(){var b=Math.round(this.getHandleSize()/2);var a=this.getDirection()=="horizontal"?["left","right"]:["top","bottom"];this.els.bgfirst.style[a[0]]=b+"px";this.els.bglast.style[a[1]]=b+"px"},addInput:function(){this.parent();var a=this.els.slider=new Element("div");this.els.slider.addEvent("click",this.sliderClick.bind(this));ludo.dom.addClass(a,"ludo-form-slider-container");ludo.dom.addClass(a,"ludo-form-slider-"+this.getDirection());this.getInputCell().adopt(a);this.addSliderBg("first");this.addSliderBg("last");this.createSliderHandle()},createSliderHandle:function(){this.els.sliderHandle=ludo.dom.create({renderTo:this.els.slider,cls:"ludo-form-slider-handle"});this.drag=new ludo.effect.Drag(this.getDragConfig())},addSliderBg:function(a){this.els["bg"+a]=ludo.dom.create({renderTo:this.els.slider,cls:"ludo-form-slider-bg-"+a})},getDragConfig:function(){return{el:this.els.sliderHandle,fireEffectEvents:false,directions:this.getDirection()=="horizontal"?"X":"Y",listeners:{drag:this.receivePosition.bind(this)},minPos:0,maxPos:this.getSliderSize()}},sliderClick:function(a){if(!a.target.hasClass("ludo-form-slider-handle")){var c=this.els.slider.getPosition();var b=Math.round(this.getHandleSize()/2);this.receivePosition({x:a.page.x-c.x-b,y:a.page.y-c.y-b})}},receivePosition:function(a){this.setValue(this.pixelToValue(this.getDirection()=="horizontal"?a.x:a.y));this.fireEvent("change",[this.value,this])},pixelToValue:function(f){var d=this.getMinValue();var a=this.getMaxValue();var b=this.getSliderSize();var c=Math.round(f/b*(a-d))+d;if(this.shouldReverseAxis()){c=a-c}return c},getDirection:function(){if(this.direction===undefined){var a=this.getBody().getSize();if(a.x>=a.y){this.direction="horizontal"}else{this.direction="vertical"}}return this.direction},getMinValue:function(){return this.minValue},getMaxValue:function(){return this.maxValue},setValue:function(a){if(a>this.getMaxValue()){a=this.getMaxValue()}else{if(a<this.getMinValue()){a=this.getMinValue()}}this.parent(a);this.positionSliderHandle();this.toggleDirtyFlag()},resizeDOM:function(){this.parent();if(this.direction=="horizontal"){this.sliderSize=this.els.slider.offsetWidth}else{this.sliderSize=this.getBody().offsetHeight-ludo.dom.getMH(this.els.slider);this.els.slider.style.height=this.getHeight()+"px"}this.sliderSize-=this.getHandleSize();this.positionSliderHandle();this.drag.setMaxPos(this.sliderSize)},positionSliderHandle:function(){this.els.sliderHandle.style[this.handleCssProperty]=this.getHandlePos()+"px"
},getHandlePos:function(){var a=Math.round((this.value-this.minValue)/(this.maxValue-this.minValue)*this.sliderSize);if(this.shouldReverseAxis()){a=this.sliderSize-a}return a},_shouldReverse:undefined,shouldReverseAxis:function(){if(this._shouldReverse==undefined){this._shouldReverse=(this.direction=="horizontal"&&this.reverse)||(this.direction=="vertical"&&!this.reverse)}return this._shouldReverse},getSliderSize:function(){return this.sliderSize},getHandleSize:function(){if(this.handleSize===undefined){var a="height";this.handleCssProperty="top";if(this.getDirection()=="horizontal"){a="width";this.handleCssProperty="left"}this.handleSize=parseInt(this.els.sliderHandle.getStyle(a).replace("px",""))}return this.handleSize},supportsInlineLabel:function(){return false}});ludo.color.RGBSlider=new Class({Extends:ludo.color.Base,type:"color.RGBSlider",layout:{type:"relative"},value:"#000000",regex:/^\#[0-9A-Fa-f]{6}$/i,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["value"])},ludoRendered:function(){this.parent();this.updatePreview();this.child.preview.child.colorValue.addEvent("setColor",this.receiveColor.bind(this))},show:function(){this.parent();this.updateSliders()},setColor:function(a){if(this.regex.test(a)){this.value=a;this.updateSliders()}},getClassChildren:function(){return[this.getSlider("red",undefined),this.getSlider("green","red"),this.getSlider("blue","green"),this.getNumberField("red",undefined),this.getNumberField("green","redValue"),this.getNumberField("blue","greenValue"),{id:"colorPreview",name:"preview",layout:{alignParentLeft:true,fillRight:true,below:"blueValue",fillDown:true,width:"matchParent",type:"relative"},css:{border:"1px solid #000"},containerCss:{margin:3},children:[{name:"colorValue",type:"color.RGBSliderValue"}]}]},receiveColor:function(a){this.fireEvent("setColor",a.toUpperCase())},getSlider:function(a,b){return{name:a,id:a,value:this.getColorValue(a),type:"form.Slider",label:a.substr(0,1).toUpperCase()+a.substr(1),minValue:0,maxValue:255,labelWidth:45,layout:{alignParentTop:b?false:true,below:b,height:23,leftOf:a+"Value",fillLeft:true},listeners:{change:this.updatePreview.bind(this)}}},getNumberField:function(a,b){return{type:"form.Number",minValue:0,maxValue:255,fieldWidth:30,value:this.getColorValue(a),label:"",name:a+"Value",linkWith:a,layout:{alignParentRight:true,width:40,below:b},listeners:{change:this.updatePreview.bind(this)}}},updatePreview:function(){var b=["red","green","blue"];var a="#";for(var c=0;c<b.length;c++){a=a+this.prefixed(parseInt(this.child[b[c]].getValue()).toString(16))}this.child.preview.getBody().style.backgroundColor=a;this.child.preview.child.colorValue.setColor(a)},prefixed:function(a){return a.length===1?"0"+a:a},cInstance:undefined,colorInstance:function(){if(this.cInstance===undefined){this.cInstance=new ludo.color.Color()}return this.cInstance},getColorValue:function(a){return this.colorInstance().rgbObject(this.value)[a.substr(0,1)]||0},updateSliders:function(){if(!this.child.red||!this.value){return}var a=this.colorInstance().rgbObject(this.value);this.child.red.setValue(a.r);this.child.green.setValue(a.g);this.child.blue.setValue(a.b);this.updatePreview()}});ludo.color.RGBSliderValue=new Class({Extends:ludo.View,color:undefined,cls:"ludo-color-rgb-slider-value",layout:{width:70,height:20,centerInParent:true},overflow:"hidden",ludoEvents:function(){this.parent();this.getBody().addEvent("click",this.sendColor.bind(this))},setColor:function(a){this.color=a;this.getBody().innerHTML=a.toUpperCase()},sendColor:function(){this.fireEvent("setColor",this.color)}});ludo.color.Boxes=new Class({Extends:ludo.color.Base,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["colors"])},ludoDOM:function(){this.parent();this.getBody().style.overflowY="auto"},ludoEvents:function(){this.parent();this.getBody().addEvent("click",this.clickOnColorBox.bind(this))},ludoRendered:function(){this.parent();this.addColorBoxes()},addColorBoxes:function(){var d=[];for(var c=0;c<this.colors.length;c++){var a=this.getColorsIn(this.colors[c]);if(a.length>1){d.push('<div style="clear:both">')}for(var b=0;b<a.length;b++){d.push(this.getColorBox(a[b]))}if(a.length>1){d.push("</div>")}}this.getBody().innerHTML=d.join("")},getColorBox:function(a){if(!ludo.util.isArray(a)){a=[a,a]}var b=[];b.push('<div title="'+a[0]+'" rgbColor="'+a[1]+'" class="ludo-color-box" style="background-color:'+a[1]+'"></div>');return b.join("")},getColorsIn:function(f){var b=[];switch(f){case"grayScale":for(var d=0;d<256;d+=8){var g=this.getColorPrefixed(d);var a="#"+g+g+g;b.push([a,a])}break;case"namedColors":return this.namedColors;default:return f}return b},getColorPrefixed:function(b){var a=b.toString(16);if(a.length===1){a="0"+a}return a},clickOnColorBox:function(a){if(a.target.hasClass("ludo-color-box")){this.fireEvent("setColor",a.target.getAttribute("rgbColor"))}}});ludo.color.NamedColors=new Class({Extends:ludo.color.Boxes,colors:["grayScale","namedColors"],namedColors:[["AliceBlue","#F0F8FF"],["AntiqueWhite","#FAEBD7"],["Aqua","#00FFFF"],["Aquamarine","#7FFFD4"],["Azure","#F0FFFF"],["Beige","#F5F5DC"],["Bisque","#FFE4C4"],["Black","#000000"],["BlanchedAlmond","#FFEBCD"],["Blue","#0000FF"],["BlueViolet","#8A2BE2"],["Brown","#A52A2A"],["BurlyWood","#DEB887"],["CadetBlue","#5F9EA0"],["Chartreuse","#7FFF00"],["Chocolate","#D2691E"],["Coral","#FF7F50"],["CornflowerBlue","#6495ED"],["Cornsilk","#FFF8DC"],["Crimson","#DC143C"],["Cyan","#00FFFF"],["DarkBlue","#00008B"],["DarkCyan","#008B8B"],["DarkGoldenRod","#B8860B"],["DarkGray","#A9A9A9"],["DarkGreen","#006400"],["DarkKhaki","#BDB76B"],["DarkMagenta","#8B008B"],["DarkOliveGreen","#556B2F"],["Darkorange","#FF8C00"],["DarkOrchid","#9932CC"],["DarkRed","#8B0000"],["DarkSalmon","#E9967A"],["DarkSeaGreen","#8FBC8F"],["DarkSlateBlue","#483D8B"],["DarkSlateGray","#2F4F4F"],["DarkTurquoise","#00CED1"],["DarkViolet","#9400D3"],["DeepPink","#FF1493"],["DeepSkyBlue","#00BFFF"],["DimGray","#696969"],["DimGrey","#696969"],["DodgerBlue","#1E90FF"],["FireBrick","#B22222"],["FloralWhite","#FFFAF0"],["ForestGreen","#228B22"],["Fuchsia","#FF00FF"],["Gainsboro","#DCDCDC"],["GhostWhite","#F8F8FF"],["Gold","#FFD700"],["GoldenRod","#DAA520"],["Gray","#808080"],["Green","#008000"],["GreenYellow","#ADFF2F"],["HoneyDew","#F0FFF0"],["HotPink","#FF69B4"],["IndianRed","#CD5C5C"],["Indigo","#4B0082"],["Ivory","#FFFFF0"],["Khaki","#F0E68C"],["Lavender","#E6E6FA"],["LavenderBlush","#FFF0F5"],["LawnGreen","#7CFC00"],["LemonChiffon","#FFFACD"],["LightBlue","#ADD8E6"],["LightCoral","#F08080"],["LightCyan","#E0FFFF"],["LightGoldenRodYellow","#FAFAD2"],["LightGray","#D3D3D3"],["LightGreen","#90EE90"],["LightPink","#FFB6C1"],["LightSalmon","#FFA07A"],["LightSeaGreen","#20B2AA"],["LightSkyBlue","#87CEFA"],["LightSlateGray","#778899"],["LightSteelBlue","#B0C4DE"],["LightYellow","#FFFFE0"],["Lime","#00FF00"],["LimeGreen","#32CD32"],["Linen","#FAF0E6"],["Magenta","#FF00FF"],["Maroon","#800000"],["MediumAquaMarine","#66CDAA"],["MediumBlue","#0000CD"],["MediumOrchid","#BA55D3"],["MediumPurple","#9370DB"],["MediumSeaGreen","#3CB371"],["MediumSlateBlue","#7B68EE"],["MediumSpringGreen","#00FA9A"],["MediumTurquoise","#48D1CC"],["MediumVioletRed","#C71585"],["MidnightBlue","#191970"],["MintCream","#F5FFFA"],["MistyRose","#FFE4E1"],["Moccasin","#FFE4B5"],["NavajoWhite","#FFDEAD"],["Navy","#000080"],["OldLace","#FDF5E6"],["Olive","#808000"],["OliveDrab","#6B8E23"],["Orange","#FFA500"],["OrangeRed","#FF4500"],["Orchid","#DA70D6"],["PaleGoldenRod","#EEE8AA"],["PaleGreen","#98FB98"],["PaleTurquoise","#AFEEEE"],["PaleVioletRed","#DB7093"],["PapayaWhip","#FFEFD5"],["PeachPuff","#FFDAB9"],["Peru","#CD853F"],["Pink","#FFC0CB"],["Plum","#DDA0DD"],["PowderBlue","#B0E0E6"],["Purple","#800080"],["Red","#FF0000"],["RosyBrown","#BC8F8F"],["RoyalBlue","#4169E1"],["SaddleBrown","#8B4513"],["Salmon","#FA8072"],["SandyBrown","#F4A460"],["SeaGreen","#2E8B57"],["SeaShell","#FFF5EE"],["Sienna","#A0522D"],["Silver","#C0C0C0"],["SkyBlue","#87CEEB"],["SlateBlue","#6A5ACD"],["SlateGray","#708090"],["Snow","#FFFAFA"],["SpringGreen","#00FF7F"],["SteelBlue","#4682B4"],["Tan","#D2B48C"],["Teal","#008080"],["Thistle","#D8BFD8"],["Tomato","#FF6347"],["Turquoise","#40E0D0"],["Violet","#EE82EE"],["Wheat","#F5DEB3"],["White","#FFFFFF"],["WhiteSmoke","#F5F5F5"],["Yellow","#FFFF00"],["YellowGreen","#9ACD32"]]});
ludo.color.RgbColors=new Class({Extends:ludo.color.Boxes,colors:["rgb","grayScale"],getColorsIn:function(h){switch(h){case"rgb":var c=[];for(var f=15;f>=0;f-=3){for(var d=0;d<16;d+=3){for(var a=0;a<16;a+=3){c.push(this.getColorFrom(f,d,a))}}}return c;default:return this.parent(h)}},getColorFrom:function(d,c,a){return"#"+this.getHexColor(d)+this.getHexColor(c)+this.getHexColor(a)},getHexColor:function(a){a=a.toString(16).toUpperCase();return a+a}});ludo.layout.Linear=new Class({Extends:ludo.layout.Base,onCreate:function(){this.view.getBody().style.overflow="hidden";this.parent()},onNewChild:function(a){this.parent(a);this.updateLayoutObject(a);a.addEvent("collapse",this.minimize.bind(this));a.addEvent("expand",this.clearTemporaryValues.bind(this));a.addEvent("minimize",this.minimize.bind(this));a.addEvent("maximize",this.clearTemporaryValues.bind(this));a.addEvent("show",this.clearTemporaryValues.bind(this))},updateLayoutObject:function(a){a.layout=a.layout||{};a.layout.width=a.layout.width||a.width;a.layout.height=a.layout.height||a.height;a.layout.weight=a.layout.weight||a.weight;a.layout.resizable=a.layout.resizable||a.resizable;a.layout.minWidth=a.layout.minWidth||a.minWidth;a.layout.maxWidth=a.layout.maxWidth||a.maxWidth;a.layout.minHeight=a.layout.minHeight||a.minHeight;a.layout.maxHeight=a.layout.maxHeight||a.maxHeight},isResizable:function(a){return a.layout.resizable?true:false},beforeResize:function(a,b){if(a.orientation==="horizontal"){a.setMinWidth(b.layout.minWidth||10);a.setMaxWidth(b.layout.maxWidth||this.view.getBody().offsetWidth)}else{a.setMinHeight(b.layout.minHeight||10);a.setMaxHeight(b.layout.maxHeight||this.view.getBody().offsetHeight)}},getResizableFor:function(c,b){var a=(b==="left"||b==="right")?"width":"height";return new ludo.layout.Resizer({name:"resizer-"+c.name,orientation:(b==="left"||b==="right")?"horizontal":"vertical",pos:b,hidden:c.isHidden(),renderTo:this.view.getBody(),layout:{width:5,height:5},view:c,listeners:{resize:function(d){c.layout[a]+=d;this.resize()}.bind(this),before:this.beforeResize.bind(this)}})}});ludo.layout.LinearHorizontal=new Class({Extends:ludo.layout.Linear,resize:function(){var j=this.view.getInnerWidthOfBody();var k=this.hasDynamicHeight()?"auto":this.view.getInnerHeightOfBody();if(k==0){return}var h=0;var f=0;for(var g=0;g<this.view.children.length;g++){if(this.view.children[g].isVisible()){if(!this.hasLayoutWeight(this.view.children[g])){var c=this.getWidthOf(this.view.children[g]);if(c){h+=c}}else{f+=this.view.children[g].layout.weight}}}f=Math.max(1,f);var a;j=a=j-h;var b=0;for(g=0;g<this.view.children.length;g++){if(this.view.children[g].isVisible()){var d={height:k,left:b};if(this.hasLayoutWeight(this.view.children[g])){if(this.view.children[g].id==this.idLastDynamic){d.width=a}else{d.width=Math.round(j*this.view.children[g].layout.weight/f);a-=d.width}}else{d.width=this.getWidthOf(this.view.children[g])}this.resizeChild(this.view.children[g],d);b+=d.width}}for(g=0;g<this.resizables.length;g++){this.resizables[g].colResize()}},resizeChild:function(b,a){b.layout.width=a.width;b.layout.left=a.left;b.resize(a);b.saveState()},onNewChild:function(c){this.parent(c);c.getEl().style.position="absolute";if(this.isResizable(c)){var a=this.isLastSibling(c);var b=this.getResizableFor(c,a?"left":"right");this.addChild(b,c,a?"before":"after")}},hasDynamicHeight:function(){return this.view.layout.height&&this.view.layout.height=="dynamic"}});ludo.layout.LinearVertical=new Class({Extends:ludo.layout.Linear,onCreate:function(){this.parent()},resize:function(){var h=this.view.getInnerHeightOfBody();if(h==0){return}var g=0;var d=0;var l;var k=0;for(var f=0;f<this.view.children.length;f++){if(!this.hasLayoutWeight(this.view.children[f])){l=this.view.children[f].isHidden()?0:this.getHeightOf(this.view.children[f]);g+=l}else{if(!this.view.children[f].isHidden()){d+=this.view.children[f].layout.weight}}}d=Math.max(1,d);var j;var b=j=(h-g);var a=ludo.dom.getInnerWidthOf(this.view.getBody());for(f=0;f<this.view.children.length;f++){if(!this.view.children[f].isHidden()){var c={width:a};if(this.hasLayoutWeight(this.view.children[f])){if(this.view.children[f].id==this.idLastDynamic){c.height=j}else{c.height=Math.round(b*this.view.children[f].layout.weight/d);j-=c.height}}else{c.height=this.getHeightOf(this.view.children[f])}if(c.height<0){c.height=undefined}if(k>0){c.top=k}if(this.view.children[f].getEl().style.position==="absolute"){k+=this.view.children[f].getHeight()}this.resizeChild(this.view.children[f],c)}}},resizeChild:function(b,a){b.layout.height=a.height;b.resize(a);b.saveState()},onNewChild:function(c){this.parent(c);if(this.isResizable(c)){var a=this.isLastSibling(c);var b=this.getResizableFor(c,a?"above":"below");this.addChild(b,c,a?"before":"after")}}});ludo.layout.Card=new Class({Extends:ludo.layout.Base,visibleCard:undefined,animate:false,initialAnimate:false,animationDuration:0.25,animateX:true,touch:{},dragging:true,onCreate:function(){this.parent();var a=this.view.layout;
if(a.animate!==undefined){this.animate=a.animate}if(a.dragging!==undefined){this.dragging=a.dragging}if(a.animationDuration!==undefined){this.animationDuration=a.animationDuration}if(a.animateX!==undefined){this.animateX=a.animateX}this.initialAnimate=this.animate;if(this.animate){this.addEvent("highercard",this.animateHigherCard.bind(this));this.addEvent("lowercard",this.animateLowerCard.bind(this))}},addChild:function(c,a,b){if(!c.layout||!c.layout.visible){c.hidden=true}return this.parent(c,a,b)},onNewChild:function(a){this.parent(a);a.getEl().style.position="absolute";a.addEvent("show",this.setVisibleCard.bind(this));if(this.shouldSetCardVisible(a)){this.visibleCard=a;a.show()}if(this.dragging){this.addDragEvents(a)}},addDragEvents:function(a){a.getBody().addEvent(ludo.util.getDragStartEvent(),this.touchStart.bind(this));a.getEventEl().addEvent(ludo.util.getDragMoveEvent(),this.touchMove.bind(this));a.getEventEl().addEvent(ludo.util.getDragEndEvent(),this.touchEnd.bind(this))},resize:function(){if(this.visibleCard===undefined){this.view.children[0].show()}var a=this.view.getInnerHeightOfBody();var b=ludo.dom.getInnerWidthOf(this.view.getBody());if(this.visibleCard){this.visibleCard.resize({height:a,width:b})}},getVisibleCard:function(){return this.visibleCard},shouldSetCardVisible:function(a){return a.layout&&a.layout.visible==true},getPreviousCardOf:function(a){var b=this.view.children.indexOf(a);return b>0?this.view.children[b-1]:undefined},getNextCardOf:function(b){var a=this.view.children.indexOf(b);return a<this.view.children.length-1?this.view.children[a+1]:undefined},showPreviousCard:function(a){if(a){this.temporaryDisableAnimation()}if(this.visibleCard){var b=this.getPreviousCardOf(this.visibleCard);if(b){b.show();return true}}return false},showNextCard:function(a){if(a){this.temporaryDisableAnimation()}if(this.visibleCard){var b=this.getNextCardOf(this.visibleCard);if(b){b.show();return true}}return false},temporaryDisableAnimation:function(){this.animate=false;this.resetAnimation.delay(500,this)},resetAnimation:function(){this.animate=this.initialAnimate},setTemporaryZIndexOfVisibleCard:function(){var a=ludo.util.getNewZIndex(this.visibleCard);this.visibleCard.getEl().style.zIndex=a+100},showCard:function(a){if(this.view.child[a]){this.view.child[a].show();return true}return false},isLastCard:function(a){return this.view.children.indexOf(a)==this.view.children.length-1},isFirstCard:function(a){return this.view.children.indexOf(a)==0},setVisibleCard:function(c){this.removeValidationEvents();var b=0;if(this.visibleCard){var d=this.view.children.indexOf(this.visibleCard);var a=this.view.children.indexOf(c);b=a-d}this.visibleCard=c;this.addValidationEvents();if(b>0){this.fireEvent("highercard",[this,c])}else{if(b<0){this.fireEvent("lowercard",[this,c])}}this.fireEvent("showcard",[this,this.visibleCard]);if(this.isLastCard(c)){this.fireEvent("lastcard",[this,c])}else{this.fireEvent("notlastcard",[this,c])}if(this.isFirstCard(c)){this.fireEvent("firstcard",[this,c])}else{this.fireEvent("notfirstcard",[this,c])}},removeValidationEvents:function(){if(this.visibleCard){this.visibleCard.removeEvent("invalid",this.setInvalid);this.visibleCard.removeEvent("valid",this.setValid)}},addValidationEvents:function(){var a=this.visibleCard.getForm();a.addEvent("invalid",this.setInvalid.bind(this));a.addEvent("valid",this.setValid.bind(this));a.validate()},setInvalid:function(){this.fireEvent("invalid",this)},setValid:function(){this.fireEvent("valid",this)},showFirstCard:function(){if(this.view.children.length>0){this.view.children[0].show()}},showLastCard:function(){if(this.view.children.length>0){this.view.children[this.view.children.length-1].show()}},button:{},registerButton:function(a){this.button[a.name||a.id]=a},getButton:function(a){return this.button[a]},isValid:function(){if(this.visibleCard){return this.visibleCard.getForm().isValid()}return true},getCountCards:function(){return this.view.children.length},getIndexOfVisibleCard:function(){return this.visibleCard?this.view.children.indexOf(this.visibleCard):0},isOnFirstCard:function(){return this.getIndexOfVisibleCard()==0},isOnLastCard:function(){return this.getIndexOfVisibleCard()==this.view.children.length-1},getPercentCompleted:function(){return Math.round((this.getIndexOfVisibleCard()+1)/this.view.children.length*100)},animateHigherCard:function(){if(this.animate){if(this.animateX){this.animateFromRight()}else{this.animateFromBottom()}}},animateLowerCard:function(){if(this.animate){if(this.animateX){this.animateFromLeft()}else{this.animateFromTop()}}},getAnimationDuration:function(){return this.animationDuration*1000},animateFromRight:function(){this.animateAlongX(this.visibleCard.getParent().getBody().offsetWidth,0)},animateFromLeft:function(){this.animateAlongX(this.visibleCard.getParent().getBody().offsetWidth*-1,0)},animateFromTop:function(){this.animateAlongY(this.visibleCard.getParent().getBody().offsetHeight*-1,0)},animateFromBottom:function(){this.animateAlongY(this.visibleCard.getParent().getBody().offsetHeight,0)
},animateAlongX:function(b,a){this.visibleCard.getEl().style.left=b+"px";this.getFx().start({left:[b,a]})},animateAlongY:function(b,a){this.visibleCard.getEl().style.top=b+"px";this.getFx().start({top:[b,a]})},fx:{},getFx:function(){if(this.fx[this.visibleCard.id]===undefined){this.fx[this.visibleCard.id]=new Fx.Morph(this.visibleCard.getEl(),{duration:this.getAnimationDuration()});this.fx[this.visibleCard.id].addEvent("complete",this.animationComplete.bind(this));this.fx[this.visibleCard.id].addEvent("start",this.animationStart.bind(this))}return this.fx[this.visibleCard.id]},animationStart:function(){},animationComplete:function(a){a.style.left="0";a.style.top="0";a.style.borderWidth="0"},touchStart:function(d){if(this.isOnFormElement(d.target)){return undefined}var b=this.isFirstCard(this.visibleCard);var c=this.visibleCard.getForm().isValid();if(!c&&b){return undefined}var g=this.isLastCard(this.visibleCard);this.renderNextAndPreviousCard();var a=this.shouldAnimateOnXAxis();var f=a?this.view.getEl().offsetWidth:this.view.getEl().offsetHeight;this.touch={active:true,pos:a?d.page.x:d.page.y,previousCard:this.getPreviousCardOf(this.visibleCard),nextCard:this.getNextCardOf(this.visibleCard),animateX:a,zIndex:this.visibleCard.getEl().getStyle("z-index"),max:b?0:f,min:(g||!c)?0:f*-1,previousPos:0};if(d.target.tagName.toLowerCase()=="img"){return false}return false},shouldAnimateOnXAxis:function(){return this.animateX},touchMove:function(b){if(this.touch&&this.touch.active){var c;var a;if(this.touch.animateX){c=b.page.x-this.touch.pos;a="left"}else{c=b.page.x-this.touch.pos;a="top"}c=Math.min(c,this.touch.max);c=Math.max(c,(this.touch.min));this.setZIndexOfOtherCards(c);this.touch.previousPos=c;this.visibleCard.els.container.style[a]=c+"px";return false}return undefined},setZIndexOfOtherCards:function(a){if(a>0&&this.touch.previousPos<=0){if(this.touch.nextCard){this.touch.nextCard.getEl().style.zIndex=(this.touch.zIndex-3)}if(this.touch.previousCard){this.touch.previousCard.getEl().style.zIndex=this.touch.zIndex-1}}else{if(a<0&&this.touch.previousPos>=0){if(this.touch.nextCard){this.touch.nextCard.getEl().style.zIndex=this.touch.zIndex-1}if(this.touch.previousCard){this.touch.previousCard.getEl().style.zIndex=this.touch.zIndex-3}}}},touchEnd:function(){if(this.touch.active){this.touch.active=false;var a=this.touch.previousPos;if(a>0&&this.touch.max&&a>(this.touch.max/2)){this.animateToPrevious()}else{if(a<0&&a<(this.touch.min/2)){this.animateToNext()}else{this.visibleCard.getEl().style[this.touch.animateX?"left":"top"]="0px"}}}},isOnFormElement:function(b){var a=b.tagName.toLowerCase();return a=="input"||a=="textarea"||a==="select"},renderNextAndPreviousCard:function(){this.setTemporaryZIndexOfVisibleCard();var c=this.visibleCard.id;this.temporaryDisableAnimation();var b;var a=true;if(b=this.getPreviousCardOf(ludo.get(c))){b.show(a)}if(b=this.getNextCardOf(ludo.get(c))){b.show(a)}ludo.get(c).show()},animateToPrevious:function(){if(this.touch.animateX){this.animateAlongX(ludo.dom.getNumericStyle(this.visibleCard.getEl(),"left"),this.view.getEl().offsetWidth)}else{this.animateAlongY(ludo.dom.getNumericStyle(this.visibleCard.getEl(),"top"),this.view.getEl().offsetHeight)}this.showPreviousCard.delay(this.getAnimationDuration(),this,true)},animateToNext:function(){if(this.touch.animateX){this.animateAlongX(ludo.dom.getNumericStyle(this.visibleCard.getEl(),"left"),this.view.getEl().offsetWidth*-1)}else{this.animateAlongX(ludo.dom.getNumericStyle(this.visibleCard.getEl(),"top"),this.view.getEl().offsetHeight*-1)}this.showNextCard.delay(this.getAnimationDuration(),this,true)}});ludo.layout.TabStrip=new Class({Extends:ludo.View,type:"layout.TabStrip",tabPos:"left",lm:undefined,tabs:{},currentPos:-1,activeTab:undefined,currentZIndex:3,ludoConfig:function(a){this.parent(a);if(a.tabPos!==undefined){this.tabPos=a.tabPos}this.lm=a.lm},ludoEvents:function(){this.parent();this.lm.addEvent("addChild",this.registerChild.bind(this));this.lm.addEvent("showChild",this.activateTabFor.bind(this));this.lm.addEvent("removeChild",this.removeTabFor.bind(this))},registerChild:function(a){if(!this.lm.isTabStrip(a)){this.createTabFor(a)}},resizeTabs:function(){this.currentPos=-1;for(var a in this.tabs){if(this.tabs.hasOwnProperty(a)){var b=this.tabs[a];b.style[this.getPosAttribute()]=this.currentPos+"px";this.increaseCurrentPos(b)}}},createTabFor:function(b){var a;if(this.tabPos==="top"||this.tabPos=="bottom"){a=this.getPlainTabFor(b)}else{a=this.getSVGTabFor(b)}a.addEvent("click",b.show.bind(b,false));this.getBody().adopt(a);if(b.layout.closable){this.addCloseButton(a,b)}a.style[this.getPosAttribute()]=this.currentPos+"px";a.className="ludo-tab-strip-tab ludo-tab-strip-tab-"+this.tabPos;this.tabs[b.getId()]=a;this.increaseCurrentPos(a);if(!b.isHidden()){this.activateTabFor(b)}},addCloseButton:function(b,d){var a=new Element("div");a.className="ludo-tab-close ludo-tab-close-"+this.tabPos;a.addEvent("mouseenter",this.enterCloseButton.bind(this));
a.addEvent("mouseleave",this.leaveCloseButton.bind(this));a.id="tab-close-"+d.id;a.addEvent("click",this.removeChild.bind(this));b.appendChild(a);var c;switch(this.tabPos){case"top":case"bottom":c=b.getStyle("padding-right");b.style.paddingRight=(parseInt(c)+a.offsetWidth)+"px";break;case"right":c=b.getStyle("padding-right");b.style.paddingBottom=(parseInt(c)+a.offsetHeight)+"px";break;case"left":c=b.getStyle("padding-right");b.style.paddingTop=(parseInt(c)+a.offsetHeight)+"px";break}},removeChild:function(a){var b=a.target.id.replace("tab-close-","");ludo.get(b).dispose();return false},removeTabFor:function(a){this.tabs[a.getId()].dispose();delete this.tabs[a.getId()];this.resizeTabs()},enterCloseButton:function(a){a.target.addClass("ludo-tab-close-"+this.tabPos+"-over")},leaveCloseButton:function(a){a.target.removeClass("ludo-tab-close-"+this.tabPos+"-over")},getPosAttribute:function(){if(!this.posAttribute){switch(this.tabPos){case"top":case"bottom":this.posAttribute="left";break;case"left":case"right":this.posAttribute="top";break}}return this.posAttribute},increaseCurrentPos:function(a){if(this.tabPos==="top"||this.tabPos==="bottom"){this.currentPos+=a.offsetWidth+ludo.dom.getMW(a)}else{this.currentPos+=a.offsetHeight+ludo.dom.getMH(a)}this.currentPos--},getPlainTabFor:function(b){var a=new Element("div");this.getBody().adopt(a);a.className="ludo-tab-strip-tab ludo-tab-strip-tab-"+this.tabPos;a.innerHTML='<div class="ludo-tab-strip-tab-bg-first"></div><div class="ludo-tab-strip-tab-bg-last"></div>';ludo.dom.create({tag:"span",html:this.getTitleFor(b),renderTo:a});return a},getSVGTabFor:function(f){var b=new Element("div");this.getBody().adopt(b);b.innerHTML='<div class="ludo-tab-strip-tab-bg-first"></div><div class="ludo-tab-strip-tab-bg-last">';var d=document.createElement("div");b.adopt(d);var c=new ludo.layout.TextBox({renderTo:d,width:100,height:100,className:"ludo-tab-strip-tab-txt-svg",text:this.getTitleFor(f),rotation:this.getRotation()});var a=c.getSize();d.style.width=a.x+"px";d.style.height=a.y+"px";return b},getRotation:function(){if(this.rotation===undefined){switch(this.tabPos){case"left":this.rotation=270;break;case"right":this.rotation=90;break;case"bottom":this.rotation=180;break;default:this.rotation=0;break}}return this.rotation},getTitleFor:function(a){return(a.layout.title||a.getTitle())},activateTabFor:function(a){if(this.activeTab!==undefined){ludo.dom.removeClass(this.activeTab,"ludo-tab-strip-tab-active")}if(this.tabs[a.id]!==undefined){ludo.dom.addClass(this.tabs[a.id],"ludo-tab-strip-tab-active");this.activeTab=this.tabs[a.id];this.activeTab.style.zIndex=this.currentZIndex;this.currentZIndex++}},ludoDOM:function(){this.parent();ludo.dom.addClass(this.getEl(),"ludo-tab-strip");ludo.dom.addClass(this.getEl(),"ludo-tab-strip-"+this.tabPos);var a=document.createElement("div");ludo.dom.addClass(a,"ludo-tab-strip-line");this.getBody().adopt(a)},getTabFor:function(a){return this.tabs[a.id]},getChangedViewport:function(){var a;if(this.tabPos==="top"||this.tabPos==="bottom"){a=this.getEl().offsetHeight+ludo.dom.getMH(this.getEl())}else{a=this.getEl().offsetWidth+ludo.dom.getMW(this.getEl())}return{key:this.tabPos,value:a}},getCount:function(){return Object.keys(this.tabs).length}});ludo.layout.Relative=new Class({Extends:ludo.layout.Base,children:undefined,layoutFnProperties:["width","height","alignParentTop","alignParentBottom","alignParentLeft","alignParentRight","leftOf","rightOf","below","above","alignLeft","alignRight","alignTop","alignBottom","sameWidthAs","sameHeightAs","centerInParent","centerHorizontal","centerVertical","fillLeft","fillRight","fillUp","fillDown","absBottom","absWidth","absHeight","absLeft","absTop","absRight","offsetX","offsetY"],newChildCoordinates:{},lastChildCoordinates:{},onCreate:function(){this.parent();this.view.getBody().style.position="relative"},resize:function(){if(this.children===undefined){this.prepareResize()}for(var a=0;a<this.children.length;a++){if(!this.children[a].layoutResizeFn){this.children[a].layoutResizeFn=this.getResizeFnFor(this.children[a])}this.children[a].layoutResizeFn.call(this.children[a],this)}},prepareResize:function(){this.fixLayoutReferences();this.arrangeChildren();this.createResizeFunctions()},createResizeFunctions:function(){for(var a=0;a<this.children.length;a++){this.children[a].layoutResizeFn=this.getResizeFnFor(this.children[a])}},fixLayoutReferences:function(){for(var d=0;d<this.view.children.length;d++){var f=this.view.children[d];var a=this.depKeys;for(var b=0;b<a.length;b++){if(f.layout[a[b]]!==undefined){f.layout[a[b]]=this.getReference(f.layout[a[b]])}}}},getResizeFnFor:function(b){var a=this.getLayoutFnsFor(b);return function(c){for(var d=0;d<a.length;d++){a[d].call(b,c)}}},getLayoutFnsFor:function(f){var a=[];var d=this.layoutFnProperties;for(var b=0;b<d.length;b++){if(f.layout[d[b]]!==undefined&&f.layout[d[b]]!==false){var c=this.getLayoutFn(d[b],f);if(c){a.push(c)}}}a.push(this.getLastLayoutFn(f));return a},getLayoutFn:function(b,f){var d=this.newChildCoordinates[f.id];
var a;switch(b){case"top":case"left":return function(){d[b]=f.layout[b]}.bind(f);case"offsetX":return function(){d.left+=f.layout[b]}.bind(f);case"offsetY":return function(){d.top+=f.layout[b]}.bind(f);case"width":case"height":return this.getPropertyFn(f,b);case"absLeft":return function(){d.left=0};case"absRight":return function(){d.right=0};case"absBottom":return function(){d.bottom=0};case"absWidth":return function(c){d.width=c.viewport.absWidth};case"absHeight":return function(c){d.height=c.viewport.absHeight};case"alignParentLeft":return function(c){d.left=c.viewport.left};case"alignParentRight":return function(c){d.right=c.viewport.right};case"alignParentTop":return function(c){d.top=c.viewport.top};case"alignParentBottom":return function(c){d.bottom=c.viewport.bottom};case"leftOf":a=this.lastChildCoordinates[f.layout.leftOf.id];return function(){d.right=a.right+a.width};case"rightOf":a=this.lastChildCoordinates[f.layout.rightOf.id];return function(){d.left=a.left+a.width};case"below":a=this.lastChildCoordinates[f.layout.below.id];return function(){d.top=a.top+a.height};case"above":a=this.lastChildCoordinates[f.layout.above.id];return function(){d.bottom=a.bottom+a.height};case"sameHeightAs":a=this.lastChildCoordinates[f.layout.sameHeightAs.id];return function(){d.height=a.height};case"sameWidthAs":a=this.lastChildCoordinates[f.layout.sameWidthAs.id];return function(){d.width=a.width};case"centerInParent":return function(c){d.top=parseInt(c.viewport.height/2-d.height/2);d.left=parseInt(c.viewport.width/2-d.width/2)};case"centerHorizontal":return function(c){d.left=parseInt(c.viewport.width/2-d.width/2)};case"centerVertical":return function(c){d.top=parseInt(c.viewport.height/2-d.height/2)};case"fillLeft":return function(c){if(d.right!==undefined){d.width=c.viewport.absWidth-d.right}};case"fillRight":return function(c){if(d.left===undefined){d.left=0}d.width=c.viewport.absWidth-d.left-c.viewport.right};case"fillDown":return function(c){if(d.top===undefined){d.top=0}d.height=c.viewport.absHeight-d.top-c.viewport.bottom};case"fillUp":return function(c){if(d.bottom!==undefined){d.height=c.viewport.absHeight-d.bottom-c.viewport.top}};case"alignLeft":return this.getAlignmentFn(f,b,"left");case"alignRight":return this.getAlignmentFn(f,b,"right");case"alignTop":return this.getAlignmentFn(f,b,"top");case"alignBottom":return this.getAlignmentFn(f,b,"bottom")}return undefined},getAlignmentFn:function(g,f,b){var d=this.newChildCoordinates[g.id];var a=this.lastChildCoordinates[g.layout[f].id];return function(){d[b]=a[b]}},getPropertyFn:function(h,f){var g=this.newChildCoordinates[h.id];if(isNaN(h.layout[f])){switch(h.layout[f]){case"matchParent":return function(c){g[f]=c.viewport[f]};case"wrap":var a=ludo.dom.getWrappedSizeOfView(h);var d=f==="width"?"x":"y";return function(){g[f]=a[d]};default:if(h.layout[f].indexOf!==undefined&&h.layout[f].indexOf("%")>=0){var b=parseInt(h.layout[f].replace(/[^0-9]/g));return function(c){g[f]=parseInt(c.viewport[f]*b/100)}}return undefined}}else{return function(){g[f]=h.layout[f]}.bind(h)}},posProperties:["left","right","bottom","top"],getLastLayoutFn:function(a){return function(j){var l=j.newChildCoordinates[a.id];var g=j.lastChildCoordinates[a.id];var k=j.posProperties;if(a.layout.above&&a.layout.below){l.height=j.viewport.height-l.bottom-l.top}if(a.isHidden()){l.width=0;l.height=0}a.resize({width:l.width!==g.width?l.width:undefined,height:l.height!==g.height?l.height:undefined});if(l.right!==undefined&&l.width){l.left=j.viewport.absWidth-l.right-l.width;l.right=undefined}if(l.bottom!==undefined&&l.height){l.top=j.viewport.absHeight-l.bottom-l.height;l.bottom=undefined}if(l.bottom!==undefined){var f=j.viewport.absHeight-l.bottom-(l.top||0);if(f!=g.height){a.resize({height:j.viewport.absHeight-l.bottom-(l.top||0)})}l.bottom=undefined}for(var d=0;d<k.length;d++){var b=k[d];if(l[b]!==undefined){j.positionChild(a,b,l[b])}g[b]=l[b]}g.width=l.width;g.height=l.height;j.updateLastCoordinatesFor(a)}},updateLastCoordinatesFor:function(c){var b=this.lastChildCoordinates[c.id];var a=c.getEl();if(b.left===undefined){b.left=a.offsetLeft>0?a.offsetLeft:0}if(b.top===undefined){b.top=a.offsetTop>0?a.offsetTop:0}if(b.width===undefined){b.width=a.offsetWidth}if(b.height===undefined){b.height=a.offsetHeight}if(b.right===undefined){b.right=this.viewport.width-b.left-b.width}if(b.bottom===undefined){b.bottom=this.viewport.height-b.top-b.height}},positionChild:function(c,b,a){c.getEl().style[b]=a+"px";c[b]=a},assignDefaultCoordinates:function(a){this.newChildCoordinates[a.id]={};this.lastChildCoordinates[a.id]={}},arrangeChildren:function(){this.children=[];for(var f=0;f<this.view.children.length;f++){var k=this.view.children[f];this.children.push(k);this.assignDefaultCoordinates(k);if(k.isHidden()){this.setTemporarySize(k,{width:0,height:0})}}this.createResizables();var h=this.getWronglyArrangedChild();var a=0;while(h&&a<30){var g=this.getDependencies(h);if(g.length>0){for(var d=0;d<g.length;d++){if(this.isArrangedBefore(h,g[d])){var b=this.children.indexOf(h);
this.children.splice(b,1);this.children.push(h)}}}h=this.getWronglyArrangedChild();a++}if(a===30){ludo.util.log("Possible circular layout references defined for children in Relative layout")}},resizeKeys:{left:"leftOf",right:"rightOf",above:"above",below:"below"},resizables:{},createResizables:function(){for(var b=this.children.length-1;b>=0;b--){var h=this.children[b];if(this.isChildResizable(h)){this.resizables[h.id]={};for(var a=0;a<h.layout.resize.length;a++){var d=h.layout.resize[a];var g=this.resizables[h.id][d]=this.getResizableFor(h,d);this.assignDefaultCoordinates(g);this.updateReference(this.resizeKeys[d],h,g);var f=d=="left"||d==="above"?b:b+1;this.children.splice(f,0,g)}}}},getResizable:function(b,a){return this.resizables[b.id][a]},getResizableFor:function(c,b){var a=(b==="left"||b==="right")?"width":"height";return new ludo.layout.Resizer({name:"resizer-"+c.name,orientation:(b==="left"||b==="right")?"horizontal":"vertical",pos:b,renderTo:this.view.getBody(),sibling:this.getSiblingForResize(c,b),layout:this.getResizerLayout(c,b),view:c,listeners:{resize:function(d){c.layout[a]+=d;this.resize()}.bind(this),before:this.beforeResize.bind(this)}})},getSiblingForResize:function(b,a){switch(a){case"left":return b.layout.rightOf;case"right":return b.layout.leftOf;case"above":return b.layout.below;case"below":return b.layout.above}return undefined},beforeResize:function(a,b){if(a.orientation==="horizontal"){a.setMinWidth(b.layout.minWidth||10);a.setMaxWidth(b.layout.maxWidth||this.view.getBody().offsetWidth)}else{a.setMinHeight(b.layout.minHeight||10);a.setMaxHeight(b.layout.maxHeight||this.view.getBody().offsetHeight)}},getResizerLayout:function(c,b){var a={};switch(b){case"left":case"right":a.sameHeightAs=c;a.alignTop=c;a.width=5;break;default:a.sameWidthAs=c;a.alignLeft=c;a.height=5}return a},updateReference:function(b,d,c){for(var a=0;a<this.children.length;a++){if(this.children[a].layout[b]===d){this.children[a].layout[b]=c;c.layout.affectedSibling=this.children[a]}}c.layout[b]=d},isChildResizable:function(a){return a.layout&&a.layout.resize&&a.layout.resize.length>0},getWronglyArrangedChild:function(){for(var b=0;b<this.children.length;b++){var f=this.children[b];var d=this.getDependencies(f);if(d.length>0){for(var a=0;a<d.length;a++){if(this.isArrangedBefore(f,d[a])){return f}}}}return undefined},isArrangedBefore:function(b,a){return this.children.indexOf(b)<this.children.indexOf(a)},depKeys:["above","below","leftOf","rightOf","alignLeft","alignBottom","alignRight","alignTop","sameWidthAs","sameHeightAs"],getDependencies:function(d){var a=[];for(var b=0;b<this.depKeys.length;b++){if(d.layout[this.depKeys[b]]!==undefined){var c=d.layout[this.depKeys[b]];if(c!==undefined){a.push(c)}}}return a},getReference:function(a){if(a.getId!==undefined){return a}if(this.view.child[a]!==undefined){return this.view.child[a]}return ludo.get(a)},clearChildren:function(){this.children=undefined},getChildren:function(){return this.children},onNewChild:function(b){this.parent(b);b.getEl().style.position="absolute";var a=b.layout;if(a.centerInParent!==undefined){a.centerHorizontal=undefined;a.centerVertical=undefined}if(a.fillRight===undefined){if(a.width===undefined){a.width=b.width?b.width:undefined}}if(a.height===undefined){a.height=b.height?b.height:undefined}if(a.leftOf){a.right=undefined}if(a.rightOf){a.left=undefined}if(a.below){a.top=undefined}if(a.above){a.bottom=undefined}},addChildEvents:function(a){a.addEvent("hide",this.hideChild.bind(this));a.addEvent("show",this.clearTemporaryValues.bind(this));a.addEvent("collapse",this.minimize.bind(this));a.addEvent("minimize",this.minimize.bind(this));a.addEvent("expand",this.clearTemporaryValues.bind(this));a.addEvent("maximize",this.clearTemporaryValues.bind(this))}});ludo.layout.Tab=new Class({Extends:ludo.layout.Relative,visibleChild:undefined,tabStrip:undefined,onCreate:function(){this.parent();ludo.dom.addClass(this.view.getEl(),"ludo-layout-tab");this.addChild(this.getTabStrip());this.updateViewport(this.tabStrip.getChangedViewport())},addChild:function(c,a,b){if(!this.isTabStrip(c)&&(!c.layout||!c.layout.visible)){c.hidden=true}return this.parent(c,a,b)},onNewChild:function(b){if(!this.isTabStrip(b)){if(!b.isHidden()){this.setVisibleChild(b)}var a=b.layout;a.alignParentLeft=true;a.alignParentTop=true;a.fillRight=true;a.fillDown=true}this.parent(b)},setTemporarySize:function(){},addChildEvents:function(a){if(!this.isTabStrip(a)){a.addEvent("show",this.showTab.bind(this));a.addEvent("dispose",this.onChildDispose.bind(this))}},getTabPosition:function(){return this.view.layout.tabs||"top"},getTabStrip:function(){if(this.tabStrip===undefined){this.tabStrip=new ludo.layout.TabStrip({lm:this,parentComponent:this.view,tabPos:this.getTabPosition(),renderTo:this.view.getBody(),layout:this.getTabStripLayout()})}return this.tabStrip},setVisibleChild:function(a){if(this.visibleChild){this.visibleChild.hide()}this.visibleChild=a;this.fireEvent("showChild",a)},showTab:function(a){if(a!==this.visibleChild){this.setVisibleChild(a);
this.resize()}},resize:function(){if(this.visibleChild===undefined){if(this.view.children.length>1){this.view.children[1].show()}}else{if(this.children===undefined||!this.visibleChild.layoutResizeFn){this.prepareResize()}this.tabStrip.layoutResizeFn.call(this.visibleChild,this);if(!this.visibleChild.layoutResizeFn){this.prepareResize()}this.visibleChild.layoutResizeFn.call(this.visibleChild,this)}},getTabStripLayout:function(){switch(this.getTabPosition()){case"top":return{absTop:true,absLeft:true,absWidth:true};case"left":return{absTop:true,absLeft:true,absHeight:true};case"right":return{absTop:true,absRight:true,absHeight:true};case"bottom":return{absBottom:true,absLeft:true,absWidth:true}}return undefined},isTabStrip:function(a){return a.type==="layout.TabStrip"},onChildDispose:function(b){if(this.visibleChild&&this.visibleChild.id===b.id){var a=this.view.children.indexOf(this.visibleChild);if(a>1){this.view.children[a-1].show()}else{if(this.view.children.length>2){this.view.children[a+1].show()}}}this.fireEvent("removeChild",b)}});ludo.layout.Fill=new Class({Extends:ludo.layout.Base,resize:function(){var a=this.view.getInnerHeightOfBody();if(a<=0){return}for(var b=0;b<this.view.children.length;b++){this.view.children[b].resize({height:a})}}});ludo.layout.Grid=new Class({Extends:ludo.layout.Base,columns:5,rows:5,onCreate:function(){var a=this.view.layout;if(a.columns!==undefined){this.columns=a.columns}if(a.rows!==undefined){this.rows=a.rows}},resize:function(){this.storeCellSize();var f=0;var d;for(var a=0;a<this.view.children.length;a++){var b=this.view.children[a];d=b.layout&&b.layout.colspan?b.layout.colspan:1;this.view.children[a].resize({width:this.cellSize.x*d,height:this.cellSize.y,left:this.cellSize.x*(f%this.columns),top:this.cellSize.y*(Math.floor(f/this.columns)%this.rows)});f+=d}},storeCellSize:function(){this.cellSize={x:this.getAvailWidth()/this.columns,y:this.getAvailHeight()/this.rows}},getCellSize:function(){return this.cellSize},onNewChild:function(a){a.getEl().style.position="absolute"}});ludo.layout.Popup=new Class({Extends:ludo.layout.Base,visibleChild:undefined,addChild:function(c,a,b){if(!c.layout||!c.layout.visible){c.hidden=true}return this.parent(c,a,b)},onNewChild:function(a){if(!a.isHidden()){this.setVisibleChild(a)}a.getEl().style.position="absolute";a.addEvent("show",this.setVisibleChild.bind(this));this.parent(a)},setVisibleChild:function(a){if(this.visibleChild&&this.shouldToggle()){this.visibleChild.hide()}this.visibleChild=a;this.fireEvent("showChild",a)},getParentForNewChild:function(){return document.body},shouldToggle:function(){return this.view.layout.toggle},resize:function(){var b=this.view.children;for(var a=0;a<b.length;a++){if(!b[a].isHidden()){b[a].getLayout().getRenderer().resize()}}}});ludo.layout.Canvas=new Class({Extends:ludo.layout.Relative,addChild:function(b){b=this.getValidChild(b);b=this.getNewComponent(b);this.view.children.push(b);var a=b;this.view.getCanvas().adopt(a);this.onNewChild(b);this.addChildEvents(b);this.fireEvent("addChild",[b,this]);return b},addChildEvents:function(a){a.addEvent("hide",this.hideChild.bind(this));a.addEvent("show",this.clearTemporaryValues.bind(this))},positionChild:function(c,b,a){c[b]=a;this.currentTranslate[b]=a;c.node.translate(this.currentTranslate.left,this.currentTranslate.top)},currentTranslate:{left:0,top:0}});ludo.layout.SlideIn=new Class({Extends:ludo.layout.Base,slideEl:undefined,onCreate:function(){this.view.getBody().style.overflowX="hidden"},onNewChild:function(a){this.parent(a);a.getEl().style.position="absolute"},resize:function(){var a=this.getWidthOfMenu();this.view.children[0].resize({width:a,height:this.viewport.height});this.slideEl.style.width=(this.viewport.absWidth+a)+"px";this.slideEl.style.left=this.view.layout.active?0:(a*-1)+"px";this.view.children[1].getEl().style.left=a+"px";this.view.children[1].resize({width:this.viewport.absWidth,height:this.viewport.height})},show:function(){if(!this.isMenuOpen()){if(this.view.children[0].hidden){this.view.children[0].show()}this.view.layout.active=true;var a=this.getWidthOfMenu();this.effect().slide(this.slideEl,{x:a*-1},{x:0},this.getDuration())}},hide:function(){if(this.isMenuOpen()){this.view.layout.active=false;var a=this.getWidthOfMenu();this.effect().slide(this.slideEl,{x:0},{x:a*-1},this.getDuration())}},isMenuOpen:function(){return this.view.layout.active},toggle:function(){this[this.view.layout.active?"hide":"show"]()},effect:function(){if(this.effectObject===undefined){this.effectObject=new ludo.effect.Effect}return this.effectObject},getDuration:function(){return this.view.layout.duration||0.15},getWidthOfMenu:function(){var a=this.view.children[0].layout.width;if(isNaN(a)){switch(a){case"matchParent":return this.viewport.width;default:return parseInt(a)*this.viewport.width/100}}else{return a}},getParentForNewChild:function(){if(!this.slideEl){this.slideEl=ludo.dom.create({tag:"div",renderTo:this.view.getBody(),css:{height:"100%",position:"absolute"}})
}return this.slideEl}});ludo.layout.MenuContainer=new Class({Extends:Events,type:"layout.MenuContainer",lm:undefined,layout:{width:"wrap",height:"wrap"},children:[],alwaysInFront:true,initialize:function(a){this.lm=a;this.setLayout();this.createDom()},setLayout:function(){var a=this.layout;if(this.lm.view.parentComponent){var c=this.getSubMenuVAlign();var b=this.getSubMenuHAlign();if(this.getParentLayoutOrientation()==="horizontal"){a[c]=this.lm.view.getParent().getEl();a.alignLeft=this.lm.view}else{a[b]=this.lm.view.getEl();a[c==="above"?"alignBottom":"alignTop"]=this.lm.view;a.offsetY=-3}this.lm.view.layout.alignSubMenuV=this.lm.view.layout.alignSubMenuV||c;this.lm.view.layout.alignSubMenuH=this.lm.view.layout.alignSubMenuH||b;a.height="wrap"}a.fitVerticalViewPort=true},getSubMenuVAlign:function(){var a=["above","below"];var b=this.lm.view.parentComponent;return b&&b.layout.alignSubMenuV&&a.indexOf(b.layout.alignSubMenuV)!==-1?b.layout.alignSubMenuV:"below"},getSubMenuHAlign:function(){var a=["leftOrRightOf","rightOrLeftOf","leftOf","rightOf"];var b=this.lm.view.parentComponent;return b&&b.layout.alignSubMenuH&&a.indexOf(b.layout.alignSubMenuH)!==-1?b.layout.alignSubMenuH:"rightOrLeftOf"},getParentLayoutOrientation:function(){var a=this.lm.view.parentComponent;return a?a.layout.orientation:""},createDom:function(){this.el=ludo.dom.create({css:{position:"absolute",display:"none"},renderTo:document.body});ludo.dom.addClass(this.el,"ludo-menu-vertical-"+this.getSubMenuVAlign());if(this.getSubMenuHAlign().indexOf("left")===0){ludo.dom.addClass(this.el,"ludo-menu-vertical-to-left")}if(this.getParentLayoutOrientation()==="horizontal"&&this.getSubMenuVAlign().indexOf("above")===0){ludo.dom.addClass(this.lm.view.parentComponent.getEl(),"ludo-menu-horizontal-up")}this.body=ludo.dom.create({renderTo:this.el})},getEl:function(){return this.el},getBody:function(){return this.body},resize:function(a){if(a.width){this.getEl().style.width=a.width+"px"}},isHidden:function(){return false},show:function(){this.getEl().style.zIndex=(ludo.util.getNewZIndex(this)+100);if(this.getEl().style.display===""){return}this.getEl().style.display="";this.resizeChildren();this.getRenderer().resize();if(!this.layout.width||this.layout.width==="wrap"){this.setFixedRenderingWidth()}this.fireEvent("show",this)},setFixedRenderingWidth:function(){this.layout.width=undefined;var c=this.getRenderer();c.clearFn();c.setValue("width",c.getSize().x);c.resize();for(var a=0;a<this.lm.view.children.length;a++){var b=this.lm.view.children[a].getLayout().getRenderer();b.clearFn();b.setValue("width",c.getValue("width"))}this.resizeChildren()},childrenResized:false,resizeChildren:function(){if(this.childrenResized){return}for(var a=0;a<this.lm.view.children.length;a++){this.lm.view.children[a].getLayout().getRenderer().resize()}this.fireEvent("resize")},hide:function(){this.getEl().style.display="none";this.fireEvent("hide",this)},renderer:undefined,getRenderer:function(){if(this.renderer===undefined){this.renderer=new ludo.layout.Renderer({view:this})}return this.renderer}});ludo.layout.Menu=new Class({Extends:ludo.layout.Base,active:false,alwaysActive:false,onCreate:function(){this.menuContainer=new ludo.layout.MenuContainer(this);if(this.view.layout.active){this.alwaysActive=true}if(this.view.id===this.getTopMenuComponent().id){document.id(document.documentElement).addEvent("click",this.autoHideMenus.bind(this));ludo.EffectObject.addEvent("start",this.hideAllMenus.bind(this))}},getMenuContainer:function(){return this.menuContainer},getValidChild:function(a){if(ludo.util.isString(a)){a={html:a}}a.layout=a.layout||{};if(a.children&&!a.layout.type){a.layout.type="menu";a.layout.orientation="vertical"}a.type=a.type||"menu.Item";if(a.type==="menu.Item"){a.orientation=this.view.layout.orientation}else{a.layout.height=a.layout.height||a.height}return a},parentForNewChild:undefined,getParentForNewChild:function(){if(this.parentForNewChild===undefined){var a=!this.hasMenuLayout(this.view.parentComponent);var b=a?this.parent():this.getMenuContainer().getBody();ludo.dom.addClass(b.parentNode,"ludo-menu");ludo.dom.addClass(b.parentNode,"ludo-menu-"+this.view.layout.orientation);if(a&&!this.view.layout.isContext){ludo.dom.addClass(b.parentNode,"ludo-menu-top")}this.parentForNewChild=b;if(a){this.view.addEvent("show",this.resize.bind(this))}}return this.parentForNewChild},onNewChild:function(a){this.assignMenuItemFns(a);if(this.hasMenuLayout(a)){a.addEvent("addChild",this.assignMenuItemFns.bind(this))}},hasMenuLayout:function(a){return a&&a.layout&&a.layout.type&&a.layout.type.toLowerCase()==="menu"},parentContainers:undefined,getTopMenuComponent:function(){var a=this.view;while(a.parentComponent&&this.hasMenuLayout(a.parentComponent)){a=a.getParent()}return a},assignMenuItemFns:function(f){var c=this;var d=c.view.getParent();var b=this.getTopMenuComponent();var a=b.getLayout();if(f.mouseOver===undefined){f.getEl().addEvent("mouseenter",function(){this.mouseOver()}.bind(f));
f.mouseOver=function(){this.fireEvent("enterMenuItem",this)}.bind(f)}f.getMenuLayoutManager=function(){return this.parentComponent&&this.parentComponent.getMenuLayoutManager?this.parentComponent.getMenuLayoutManager():c}.bind(f);f.getParentMenuItem=function(){return c.hasMenuLayout(d)?c.view:undefined}.bind(f);f.isTopMenuItem=function(){return !c.hasMenuLayout(d)}.bind(f);f.getMenuContainer=function(){return c.getMenuContainer()}.bind(f);f.getMenuContainerToShow=function(){if(this.containerToShow===undefined){if(c.hasMenuLayout(this)&&this.children.length>0){if(!this.children[0].lifeCycleComplete){this.children[0].remainingLifeCycle()}this.containerToShow=this.children[0].getMenuContainer()}else{this.containerToShow=undefined}}return this.containerToShow}.bind(f);f.getMenuContainersToShow=function(){if(!this.menuContainersToShow){var h=[];var g=this.getParent();while(g&&g.layout.orientation==="vertical"){if(g.getMenuContainerToShow){h.unshift(g.getMenuContainerToShow())}g=g.getParent()}var j=this.getMenuContainerToShow();if(j){h.push(j)}this.menuContainersToShow=h}return this.menuContainersToShow}.bind(f);f.getMenuComponent=function(){return b}.bind(f);f.getParentMenuItems=function(){if(!this.parentMenuItems){this.parentMenuItems=[];var g=this.getParent();while(g&&g.getMenuContainer){this.parentMenuItems.push(g);g=g.getParent()}}return this.parentMenuItems}.bind(f);f.addEvent("click",function(){b.fireEvent("click",this)}.bind(f));if(this.view.layout.orientation==="horizontal"&&f.children.length>0){f.addEvent("click",function(){a.activate(f)}.bind(this))}else{f.addEvent("click",a.hideAllMenus.bind(a))}f.addEvent("enterMenuItem",function(){a.showMenusFor(f);a.highlightItemPath(f)}.bind(this))},shownMenus:[],activate:function(a){this.active=!this.active;if(this.shownMenus.length===0){ludo.EffectObject.fireEvents()}this.showMenusFor(a)},showMenusFor:function(c){if(!this.active&&!this.alwaysActive){this.hideMenus()}else{var a=c.getMenuContainersToShow();this.hideMenus(a);this.shownMenus=a;for(var b=0;b<this.shownMenus.length;b++){this.shownMenus[b].show()}}},hideAllMenus:function(){this.hideMenus();this.clearHighlightedPath();if(this.view.layout.isContext){this.view.getEl().style.display="none"}this.shownMenus=[]},hideMenus:function(b){b=b||[];for(var a=0;a<this.shownMenus.length;a++){if(b.indexOf(this.shownMenus[a])===-1){this.shownMenus[a].hide()}}},highlightedItems:[],highlightItemPath:function(c){var a=c.getParentMenuItems();this.clearHighlightedPath(a);for(var b=0;b<a.length;b++){ludo.dom.addClass(a[b].getEl(),"ludo-menu-item-active")}this.highlightedItems=a},clearHighlightedPath:function(c){c=c||[];var a=this.highlightedItems;for(var b=0;b<a.length;b++){if(c.indexOf(a[b])===-1){ludo.dom.removeClass(a[b].getEl(),"ludo-menu-item-active")}}},autoHideMenus:function(a){if(this.active||this.alwaysActive){if(a.target.className&&a.target.className.indexOf&&a.target.className.indexOf("ludo-menu-item")===-1&&!a.target.getParent(".ludo-menu")){this.hideAllMenus();if(this.view.layout.orientation==="horizontal"){this.active=false}}}}});ludo.layout.MenuHorizontal=new Class({Extends:ludo.layout.Menu,getValidChild:function(a){a=this.parent(a);a.layout.width=a.layout.width||"wrap";return a},onNewChild:function(a){a.getEl().style.position="absolute";this.parent(a)},resized:false,resize:function(){if(!this.resized){this.resized=true;var b=0;for(var a=0;a<this.view.children.length;a++){this.view.children[a].resize({left:b,height:this.viewport.height});b+=this.view.children[a].getEl().offsetWidth+ludo.dom.getMW(this.view.children[a].getEl())}}}});ludo.layout.MenuVertical=new Class({Extends:ludo.layout.Menu,active:true,getValidChild:function(a){a=this.parent(a);if(!a.layout.width){a.layout.width="fitParent"}return a},resize:function(){for(var a=0;a<this.view.children.length;a++){this.view.children[a].getLayout().getRenderer().resize()}}});ludo.layout.CollapseBar=new Class({Extends:ludo.View,orientation:undefined,position:undefined,views:[],viewportCoordinates:{},buttons:{},currentPos:0,ludoConfig:function(a){this.parent(a);this.position=a.position||"left";this.setLayout()},ludoDOM:function(){this.parent();ludo.dom.addClass(this.getEl(),"ludo-collapse-bar");ludo.dom.addClass(this.getEl(),"ludo-collapse-bar-"+this.orientation);ludo.dom.addClass(this.getEl(),"ludo-collapse-bar-"+this.position)},setLayout:function(){this.orientation=(this.position==="left"||this.position==="right")?"vertical":"horizontal";this.layout={};switch(this.position){case"left":this.layout.absLeft=true;this.layout.alignParentTop=true;this.layout.fillDown=true;this.layout.width=25;break;case"right":this.layout.absRight=true;this.layout.alignParentTop=true;this.layout.fillDown=true;this.layout.width=25;break;case"top":this.layout.absTop=true;this.layout.absLeft=true;this.layout.absWidth=true;this.layout.height=25;break;case"bottom":this.layout.absBottom=true;this.layout.absLeft=true;this.layout.absWidth=true;this.layout.height=25;break}},getChangedViewport:function(){var a=0;
if(!this.isHidden()){switch(this.position){case"left":case"right":a=this.layout.width;break;case"top":case"bottom":a=this.layout.height;break}}return{key:this.position,value:a}},addView:function(a){this.views.push(a);this.addButton(a)},addButton:function(a){var c=this.buttons[a.id]=new Element("div");c.id="button-"+a.id;c.addEvent("mouseenter",this.enterButton.bind(this));c.addEvent("mouseleave",this.leaveButton.bind(this));c.addEvent("click",this.toggleView.bind(this));this.getBody().adopt(c);c.innerHTML='<div class="collapse-bar-button-bg-first"></div><div class="collapse-bar-button-bg-last"></div>';c.className="collapse-bar-button collapse-bar-button-"+this.position;var d=new ludo.layout.TextBox({renderTo:c,text:a.title,rotation:this.getRotation(),className:"ludo-view-collapsed-title"});var b=d.getSize();c.style.width=b.x+"px";c.style.height=b.y+"px";if(this.position==="top"||this.position==="bottom"){c.style.left=this.currentPos+"px";this.currentPos+=b.x+ludo.dom.getMBPW(c)}else{c.style.top=this.currentPos+"px";this.currentPos+=b.y+ludo.dom.getMBPH(c)}if(!a.isHidden()){this.activateButton(a)}a.addEvent("show",this.activateButton.bind(this));a.addEvent("hide",this.deactivateButton.bind(this))},getRotation:function(){switch(this.position){case"left":return 270;case"right":return 90;default:return 0}},toggleView:function(c){var b=this.getButtonByDom(c.target);var d=b.id.replace("button-","");var a=ludo.get(d);if(a.isHidden()){a.show()}else{a.hide()}},enterButton:function(a){this.getButtonByDom(a.target).addClass("collapse-bar-button-over")},leaveButton:function(a){this.getButtonByDom(a.target).removeClass("collapse-bar-button-over")},activateButton:function(a){if(a.getParent().isHidden()){a.getParent().show()}this.buttons[a.id].addClass("collapse-bar-button-active")},toggleParent:function(a){if(this.allHidden(a)){a.getParent().hide()}},allHidden:function(a){var c=a.getParent();for(var b=0;b<c.children.length;b++){if(c.children[b].isHidden()||!c.children[b].title){}else{return false}}return true},deactivateButton:function(a){this.buttons[a.id].removeClass("collapse-bar-button-active");this.toggleParent.delay(50,this,a)},getButtonByDom:function(a){while(a.tagName.toLowerCase()==="svg"||a.tagName.toLowerCase()==="text"||!ludo.dom.hasClass(a,"collapse-bar-button")){a=a.parentNode}return a},getViews:function(){return this.views}});ludo.CollectionView=new Class({Extends:ludo.View,emptyText:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["emptyText"])},ludoEvents:function(){this.parent();if(this.emptyText&&!this.getDataSource().hasRemoteSearch()){this.getDataSource().getSearcher().addEvents({matches:this.hideEmptyText.bind(this),noMatches:this.showEmptyText.bind(this)})}},hideEmptyText:function(){this.emptyEl().style.display="none"},showEmptyText:function(){this.emptyEl().style.display="";this._emptyEl.innerHTML=this.getEmptyText()},emptyEl:function(){if(this._emptyEl===undefined){this._emptyEl=ludo.dom.create({tag:"div",renderTo:this.getBody(),cls:"ludo-empty-text",css:{position:"absolute"},html:this.getEmptyText()})}return this._emptyEl},getEmptyText:function(){return ludo.util.isFunction(this.emptyText)?this.emptyText.call():this.emptyText},_nodeContainer:undefined,nodeContainer:function(){if(this._nodeContainer===undefined){this._nodeContainer=ludo.dom.create({tag:"div",renderTo:this.getBody()})}return this._nodeContainer},render:function(){if(this.emptyText){this[this.getDataSource().hasData()?"hideEmptyText":"showEmptyText"]()}},insertJSON:function(){}});ludo.List=new Class({Extends:ludo.CollectionView,defaultDS:"dataSource.Collection",overflow:"scroll",highlighted:undefined,recordMap:{},ludoConfig:function(a){this.parent(a)},ludoEvents:function(){this.parent();this.getBody().addEvent("click",this.onClick.bind(this))},ludoRendered:function(){this.parent();if(this.dataSource){if(this.dataSourceObj&&this.dataSourceObj.hasData()){this.render()}this.getDataSource().addEvents({change:this.render.bind(this),select:this.select.bind(this),deselect:this.deselect.bind(this),update:this.update.bind(this),"delete":this.remove.bind(this)})}},render:function(){this.parent();var j=this.getDataSource().getData();var h=this.getTplParser().getCompiled(j,this.tpl);var a=this.nodeContainer();a.innerHTML="";for(var c=0;c<h.length;c++){var g=document.id(ludo.dom.create({tag:"div",id:"list-"+j[c].uid,html:h[c],css:{cursor:"pointer"},cls:"ludo-list-item",renderTo:a}));this.recordMap[j[c].uid]=g.id;g.addEvent("mouseenter",this.enter.bind(this));g.addEvent("mouseleave",this.leave.bind(this))}var f=this.getDataSource().getSelectedRecord();if(f){this.select(f)}},enter:function(b){var a=this.getRecordDOM(b.target);if(a){ludo.dom.addClass(a,"ludo-list-item-highlighted")}},leave:function(b){var a=this.getRecordDOM(b.target);if(a){ludo.dom.removeClass(a,"ludo-list-item-highlighted")}},getRecordDOM:function(a){if(!ludo.dom.hasClass(a,"ludo-list-item")){a=a.getParent(".ludo-list-item")}return a},getRecordId:function(a){a=this.getRecordDOM(a);
if(a){return a.id.replace("list-","")}return undefined},getDOMForRecord:function(a){return this.recordMap[a.uid]?document.id(this.recordMap[a.uid]):undefined},select:function(a){var b=this.getDOMForRecord(a);if(b){ludo.dom.addClass(b,"ludo-list-item-selected")}},deselect:function(a){var b=this.getDOMForRecord(a);if(b){ludo.dom.removeClass(b,"ludo-list-item-selected")}},update:function(a){var b=this.getDOMForRecord(a);if(b){var c=this.getTplParser().asString(a,this.tpl);b.set("html",c)}},remove:function(a){var b=this.getDOMForRecord(a);if(b){b.dispose();this.recordMap[a.uid]=undefined}},onClick:function(b){var a=this.getRecordId(b.target);if(a){this.getDataSource().getRecord(a).select()}}});ludo.Notification=new Class({Extends:ludo.View,alwaysInFront:true,duration:3,showEffect:undefined,hideEffect:undefined,effect:"fade",effectDuration:1,autoDispose:false,ludoConfig:function(a){a.renderTo=a.renderTo||document.body;this.setConfigParams(a,["autoDispose","showEffect","hideEffect","effect","effectDuration","duration"]);this.showEffect=this.showEffect||this.effect;this.hideEffect=this.hideEffect||this.effect;if(!a.layout&&!this.layout){a.layout={centerIn:a.renderTo}}this.parent(a)},ludoEvents:function(){this.parent();if(this.autoDispose){this.addEvent("hide",this.dispose.bind(this))}},ludoDOM:function(){this.parent();this.getEl().addClass("ludo-notification")},ludoRendered:function(){if(!this.layout.width||!this.layout.height){var a=ludo.dom.getWrappedSizeOfView(this);if(!this.layout.width){this.layout.width=a.x}if(!this.layout.height){this.layout.height=a.y}}this.parent();this.show()},hide:function(){if(this.hideEffect){var a=new ludo.effect.Effect();a[this.getEndEffectFn()](this.getEl(),this.effectDuration,this.onHideComplete.bind(this),this.getLayout().getRenderer().getPosition())}else{this.parent()}},show:function(){this.parent();if(this.showEffect){var a=new ludo.effect.Effect();a[this.getStartEffectFn()](this.getEl(),this.effectDuration,this.autoHide.bind(this),this.getLayout().getRenderer().getPosition())}},getStartEffectFn:function(){switch(this.showEffect){case"fade":return"fadeIn";case"slide":return"slideIn";default:return this.showEffect}},getEndEffectFn:function(){switch(this.hideEffect){case"fade":return"fadeOut";case"slide":return"slideOut";default:return this.hideEffect}},autoHide:function(){this.hide.delay(this.duration*1000,this)},onHideComplete:function(){this.getEl().style.display="none";this.fireEvent("hide",this)}});ludo.socket.Socket=new Class({Extends:ludo.Core,type:"socket.Socket",url:undefined,socket:undefined,component:undefined,emitEvents:undefined,ludoConfig:function(a){this.parent(a);if(a.url!==undefined){this.url=a.url}if(a.component!==undefined){this.component=a.component}if(a.emitEvents!==undefined){this.emitEvents=a.emitEvents}if(!this.hasIoSocketLibrary()||!this.hasIoSocketLibraryForThisUrl()){this.loadLib()}if(this.emitEvents){this.assignComponentEvents()}},assignComponentEvents:function(){for(var a=0;a<this.emitEvents.length;a++){this.component.addEvent(this.emitEvents[a],this.getEventFn(this.emitEvents[a]).bind(this))}},getEventFn:function(a){return function(b){this.emit(a,b)}},getUrl:function(){var a=this.url||ludo.config.getSocketUrl();if(a){a=a.trim()}return a},loadLib:function(){var a=this.getUrl();if(a!==undefined){if(ludo.socket.libLoaded===undefined){ludo.socket.libLoaded={}}if(ludo.socket.libLoaded[a]===undefined){if(a!==undefined){ludo.socket.libLoaded[a]=true;Asset.javascript(a+"/socket.io/socket.io.js")}}}},on:function(b,a){if(!this.hasIoSocketLibrary()){this.on.delay(50,this,[b,a]);return}this.getSocket().on(b,a)},emit:function(a,b){if(!this.hasIoSocketLibrary()){this.emit.delay(50,this,[a,b]);return}this.getSocket().emit(a,this.getObjectToEmit(a,b))},getObjectToEmit:function(a,b){return{m:this.getModule(),s:this.getSubModule(),c:a,q:b}},hasIoSocketLibrary:function(){return window.io!==undefined},hasIoSocketLibraryForThisUrl:function(){return ludo.socket.libLoaded===undefined||ludo.socket.libLoaded[this.getUrl()]==undefined},getSocket:function(){if(this.socket===undefined){if(ludo.socket.socketCache===undefined){ludo.socket.socketCache={}}var a=this.getUrl();if(ludo.socket.socketCache[a]===undefined){ludo.socket.socketCache[a]=window.io.connect(a)}this.socket=ludo.socket.socketCache[a]}return this.socket}});ludo.effect.Resize=new Class({Extends:ludo.Core,useShim:true,component:undefined,els:{shim:undefined,applyTo:undefined,handle:{}},minX:undefined,maxX:undefined,minWidth:undefined,maxWidth:undefined,minY:undefined,maxY:undefined,minHeight:undefined,maxHeight:undefined,preserveAspectRatio:false,aspectRatio:undefined,resizeKeys:{e:["width"],s:["height"],w:["left","width"],n:["top","height"],nw:["top","left","height","width"],ne:["top","width","height"],se:["width","height"],sw:["left","height","width"]},aspectRatioKeys:undefined,dragProperties:{active:false},xRegions:[["w","nw","sw"],["e","ne","se"]],yRegions:[["n","nw","ne"],["s","sw","se"]],aspectRatioMinMaxSet:false,ludoConfig:function(a){this.setConfigParams(a,["useShim","minX","maxX","minY","maxY","maxWidth","minWidth","minHeight","maxHeight","preserveAspectRatio"]);
if(a.component){this.component=a.component;this.els.applyTo=this.component.getEl()}else{this.els.applyTo=a.applyTo}if(a.listeners){this.addEvents(a.listeners)}this.addDragEvents();this.setDisplayPropertyOfEl.delay(100,this)},setDisplayPropertyOfEl:function(){var a=this.getEl().getStyle("display");if(a!=="absolute"&&a!=="relative"){if(Browser.ie&&Browser.version<9){return}this.getEl().style.display="relative"}},addDragEvents:function(){document.body.addEvent(ludo.util.getDragEndEvent(),this.stopResize.bind(this));document.body.addEvent(ludo.util.getDragMoveEvent(),this.resize.bind(this))},addHandle:function(c,a){var b=this.els.handle[c]=new Element("div");ludo.dom.addClass(b,"ludo-component-resize-el");b.addClass(this.getCssFor(c));if(a){b.addClass(a)}b.set("html","<span></span>");b.style.cursor=c+"-resize";b.setProperty("region",c);b.addEvent(ludo.util.getDragStartEvent(),this.startResize.bind(this));this.els.applyTo.adopt(b)},startResize:function(b){var a=b.target.getProperty("region");this.fireEvent("start",a);ludo.EffectObject.start();this.dragProperties={active:true,region:a,start:{x:b.page.x,y:b.page.y},current:{x:b.page.x,y:b.page.y},el:this.getShimCoordinates(),minWidth:this.minWidth,maxWidth:this.maxWidth,minHeight:this.minHeight,maxHeight:this.maxHeight,area:this.getScalingFactors(),preserveAspectRatio:this.preserveAspectRatio?this.preserveAspectRatio:b.shift?true:false};if(this.preserveAspectRatio||b.shift){this.setMinAndMax()}this.dragProperties.minX=this.getDragMinX();this.dragProperties.maxX=this.getDragMaxX();this.dragProperties.minY=this.getDragMinY();this.dragProperties.maxY=this.getDragMaxY();this.setBodyCursor();if(this.useShim){this.showShim()}return ludo.util.isTabletOrMobile()?false:undefined},setMinAndMax:function(){var g=this.getAspectRatio();var f=this.dragProperties;if(g===0){return}var a,j,l,k;if(this.maxWidth!==undefined){k=this.maxWidth/g}if(this.minWidth!==undefined){l=this.minWidth/g}if(this.maxHeight!==undefined){j=this.maxHeight*g}if(this.minHeight!==undefined){a=this.minHeight*g}var h=this.getEl().getPosition();var b=this.getBodyWidth()-h.x;var c=this.getBodyHeight()-h.y;f.minWidth=Math.max(a||0,this.minWidth||0);f.maxWidth=Math.min(j||b,this.maxWidth||b);f.minHeight=Math.max(l||0,this.minHeight||0);f.maxHeight=Math.min(k||c,this.maxHeight||c);if(f.maxWidth/g>f.maxHeight){f.maxWidth=f.maxHeight*g}if(f.maxHeight*g>f.maxWidth){f.maxHeight=f.maxWidth/g}},getDragMinX:function(){var a,c=this.dragProperties,b=c.region;if(c.maxWidth!==undefined&&this.xRegions[0].indexOf(b)>=0){a=c.el.left+c.el.width-c.maxWidth}else{if(c.minWidth!==undefined&&this.xRegions[1].indexOf(b)>=0){a=c.el.left+c.minWidth}}if(this.minX!==undefined){if(a==undefined){a=this.minX}else{a=Math.max(a,this.minX)}}return a},getDragMaxX:function(){var a,c=this.dragProperties,b=c.region;if(c.minWidth!==undefined&&this.xRegions[0].indexOf(b)>=0){a=c.el.left+c.el.width-c.minWidth}else{if(c.maxWidth!==undefined&&this.xRegions[1].indexOf(b)>=0){a=c.el.left+c.maxWidth}}if(this.maxX!==undefined){if(a==undefined){a=this.maxX}else{a=Math.min(a,this.maxX)}}return a},getDragMinY:function(){var a,c=this.dragProperties,b=c.region;if(c.maxHeight!==undefined&&this.yRegions[0].indexOf(b)>=0){a=c.el.top+c.el.height-c.maxHeight}else{if(c.minHeight!==undefined&&this.yRegions[1].indexOf(b)>=0){a=c.el.top+c.minHeight}}if(this.minY!==undefined){if(a==undefined){a=this.minY}else{a=Math.max(a,this.minY)}}return a},getDragMaxY:function(){var a,c=this.dragProperties,b=c.region;if(c.minHeight!==undefined&&this.yRegions[0].indexOf(b)>=0){a=c.el.top+c.el.height-c.minHeight}else{if(c.maxHeight!==undefined&&this.yRegions[1].indexOf(b)>=0){a=c.el.top+c.maxHeight}}if(this.maxY!==undefined){if(a==undefined){a=this.maxY}else{a=Math.min(a,this.maxY)}}return a},setBodyCursor:function(){document.body.style.cursor=this.dragProperties.region+"-resize"},revertBodyCursor:function(){document.body.style.cursor="default"},resize:function(a){if(this.dragProperties.active){this.dragProperties.current=this.getCurrentCoordinates(a);var b=this.getCoordinates();this.fireEvent("resize",b);if(this.useShim){this.els.shim.setStyles(b)}else{this.getEl().setStyles(b)}}},getCurrentCoordinates:function(b){var a={x:b.page.x,y:b.page.y};var c=this.dragProperties;if(c.preserveAspectRatio&&c.region.length===2){return a}if(c.minX!==undefined&&a.x<c.minX){a.x=c.minX}if(c.maxX!==undefined&&a.x>c.maxX){a.x=c.maxX}if(c.minY!==undefined&&a.y<c.minY){a.y=c.minY}if(c.maxY!==undefined&&a.y>c.maxY){a.y=c.maxY}return a},getCoordinates:function(){var g=this.dragProperties;var f=this.resizeKeys[g.region];var a={};if(!g.preserveAspectRatio||g.region.length===1){for(var b=0;b<f.length;b++){a[f[b]]=this.getCoordinate(f[b])}}if(g.preserveAspectRatio){switch(g.region){case"e":case"w":a.height=a.width/this.aspectRatio;break;case"n":case"s":a.width=a.height*this.aspectRatio;break;default:var c=this.getScaleFactor();a.width=g.el.width*c;a.height=g.el.height*c;if(g.region=="ne"||g.region=="nw"){a.top=g.el.top+g.el.height-a.height
}if(g.region=="nw"||g.region=="sw"){a.left=g.el.left+g.el.width-a.width}a.width+=this.getBWOfShim();a.height+=this.getBHOfShim();break}}return a},getScaleFactor:function(){var f=this.dragProperties;var c=f.region;var b;var a=(f.current.x-f.start.x)*f.area.xFactor/f.area.sum;var g=(f.current.y-f.start.y)*f.area.yFactor/f.area.sum;switch(c){case"se":b=1+a+g;break;case"ne":b=1+a+g*-1;break;case"nw":b=1+a*-1+g*-1;break;case"sw":b=1+a*-1+g;break}if(f.minWidth){b=Math.max(b,f.minWidth/f.el.width)}if(f.minHeight){b=Math.max(b,f.minHeight/f.el.height)}if(f.maxWidth){b=Math.min(b,f.maxWidth/f.el.width)}if(f.maxHeight){b=Math.min(b,f.maxHeight/f.el.height)}return b},getCoordinate:function(a){var b=this.dragProperties.region;var c=this.dragProperties;switch(a){case"width":if(b=="e"||b=="ne"||b=="se"){return c.el.width-c.start.x+c.current.x+this.getBWOfShim()}else{return c.el.width+c.start.x-c.current.x+this.getBWOfShim()}break;case"height":if(b=="s"||b=="sw"||b=="se"){return c.el.height-c.start.y+c.current.y+this.getBHOfShim()}else{return c.el.height+c.start.y-c.current.y+this.getBHOfShim()}case"top":if(b=="n"||b=="nw"||b=="ne"){return c.el.top-c.start.y+c.current.y}else{return c.el.top+c.start.y-c.current.y}case"left":if(b=="w"||b=="nw"||b=="sw"){return c.el.left-c.start.x+c.current.x}else{return c.el.left+c.start.x-c.current.x}}return undefined},getBWOfShim:function(){if(this.useShim){return ludo.dom.getBW(this.getShim())}return 0},getBHOfShim:function(){if(this.useShim){return ludo.dom.getBH(this.getShim())}return 0},stopResize:function(){if(this.dragProperties.active){this.dragProperties.active=false;this.fireEvent("stop",this.getCoordinates());ludo.EffectObject.end();this.revertBodyCursor();if(this.useShim){this.hideShim()}}},getCssFor:function(a){return"ludo-component-resize-region-"+a},showShim:function(){var b=this.getShim();var a=this.getShimCoordinates();b.setStyles({display:"",left:a.left,top:a.top,width:a.width,height:a.height})},hideShim:function(){this.getShim().style.display="none"},getShimCoordinates:function(){var a=this.getEl().getCoordinates();if(this.useShim){var b=this.getShim();a.width-=ludo.dom.getBW(b);a.height-=ludo.dom.getBH(b)}return a},getShim:function(){if(!this.els.shim){var a=this.els.shim=new Element("div");ludo.dom.addClass(a,"ludo-shim-resize");a.setStyles({position:"absolute","z-index":50000});document.body.adopt(a)}return this.els.shim},getEl:function(){return this.els.applyTo},hideAllHandles:function(){this.setHandleDisplay("none")},showAllHandles:function(){this.setHandleDisplay("")},setHandleDisplay:function(b){for(var a in this.els.handle){if(this.els.handle.hasOwnProperty(a)){this.els.handle[a].style.display=b}}},getAspectRatio:function(){if(this.aspectRatio===undefined){var a=this.getEl().getSize();this.aspectRatio=a.x/a.y}return this.aspectRatio},getBodyWidth:function(){return document.documentElement.offsetWidth},getBodyHeight:function(){return document.documentElement.offsetHeight},getScalingFactors:function(){var a=this.getEl().getSize();return{xFactor:a.x/a.y,yFactor:a.y/a.x,sum:a.x+a.y}}});ludo.view.ButtonBar=new Class({Extends:ludo.View,type:"ButtonBar",layout:{type:"linear",orientation:"horizontal",width:"matchParent"},align:"right",cls:"ludo-component-button-container",overflow:"hidden",component:undefined,buttonBarCss:undefined,ludoConfig:function(a){this.setConfigParams(a,["align","component","buttonBarCss"]);a.children=this.getValidChildren(a.children);if(this.align=="right"){a.children=this.getItemsWithSpacer(a.children)}else{a.children[0].containerCss=a.children[0].containerCss||{};if(!a.children[0].containerCss["margin-left"]){a.children[0].containerCss["margin-left"]=2}}this.parent(a)},ludoDOM:function(){this.parent();this.getBody().addClass("ludo-content-buttons")},ludoRendered:function(){this.parent();this.component.addEvent("resize",this.resizeRenderer.bind(this));if(this.buttonBarCss){this.getEl().parentNode.setStyles(this.buttonBarCss)}},resizeRenderer:function(){this.getLayout().getRenderer().resize()},getValidChildren:function(b){for(var a=0;a<b.length;a++){if(b[a].value&&!b[a].type){b[a].type="form.Button"}}return b},getButtons:function(){var a=[];for(var b=0;b<this.children.length;b++){if(this.children[b].isButton&&this.children[b].isButton()){a.push(this.children[b])}}return a},getButton:function(b){var d=this.children;for(var a=0;a<d.length;a++){if(d[a].id==b||d[a].name==b||(d[a].getValue&&d[a].getValue().toLowerCase()==b.toLowerCase())){return d[a]}}return undefined},getItemsWithSpacer:function(a){a.splice(0,0,{layout:{weight:1},containerCss:{"background-color":"transparent"},css:{"background-color":"transparent"}});return a},getView:function(){return this.component}});ludo.view.TitleBar=new Class({Extends:ludo.Core,view:undefined,els:{el:undefined,icon:undefined,title:undefined,buttons:{},buttonArray:[]},toggleStatus:{},ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["view","buttons"]);if(!this.buttons){this.buttons=this.getDefaultButtons()
}this.view.addEvent("setTitle",this.setTitle.bind(this));this.view.addEvent("resize",this.resizeDOM.bind(this));this.createDOM();this.setSizeOfButtonContainer()},getDefaultButtons:function(){var b=[];var a=this.view;if(a.isMinimizable()){b.push("minimize")}if(a.isCollapsible()){b.push("collapse")}if(a.isClosable()){b.push("close")}return b},createDOM:function(){var a=this.els.el=new Element("div");ludo.dom.addClass(a,this.view.boldTitle?"ludo-framed-view-titlebar":"ludo-component-titlebar");var b=0;if(this.view.icon){this.createIconDOM();b+=ludo.dom.getNumericStyle(a,"width")}this.createTitleDOM();a.adopt(this.getButtonContainer());this.resizeButtonContainer.delay(20,this);this.els.title.style.left=b+"px";a.addEvent("selectstart",ludo.util.cancelEvent)},createIconDOM:function(){this.els.icon=ludo.dom.create({renderTo:this.els.el,cls:"ludo-framed-view-titlebar-icon",css:{backgroundImage:"url("+this.view.icon+")"}})},setTitle:function(a){this.els.title.innerHTML=a},createTitleDOM:function(){var a=this.els.title=ludo.dom.create({cls:"ludo-framed-view-titlebar-title",renderTo:this.els.el});this.setTitle(this.view.title)},cancelTextSelection:function(){return false},getButtonContainer:function(){var b=this.els.controls=ludo.dom.create({cls:"ludo-title-bar-button-container"});b.style.cursor="default";this.createEdge("left",b);this.createEdge("right",b);for(var a=0;a<this.buttons.length;a++){b.appendChild(this.getButton(this.buttons[a]))}this.addBorderToButtons();return b},createEdge:function(c,b){var a=ludo.dom.create({cls:"ludo-title-bar-button-container-"+c+"-edge",renderTo:b});a.style.cssText="position:absolute;z-index:1;"+c+":0;top:0;width:55%;height:100%;background-repeat:no-repeat;background-position:top "+c;return a},shouldShowCollapseButton:function(){var a=this.view.getParent();return a.layout&&a.layout.type?a.layout.type==="linear"||a.layout.type=="relative":false},resizeButtonContainer:function(){this.els.controls.style.width=this.getWidthOfButtons()+"px"},getButton:function(c){c=ludo.util.isString(c)?{type:c}:c;var a=this.els.buttons[c.type]=new Element("div");a.id="b-"+String.uniqueID();a.className="ludo-title-bar-button ludo-title-bar-button-"+c.type;a.addEvents({click:this.getButtonClickFn(c.type),mouseenter:this.enterButton.bind(this),mouseleave:this.leaveButton.bind(this)});a.setProperty("title",c.title?c.title:c.type.capitalize());a.setProperty("buttonType",c.type);if(c.type==="collapse"){ludo.dom.addClass(a,"ludo-title-bar-button-collapse-"+this.getCollapseButtonDirection())}this.els.buttonArray.push(a);return a},getButtonClickFn:function(c){var b=ludo.view.getTitleBarButton(c);var a=b&&b.toggle?b.toggle:undefined;return function(f){this.leaveButton(f);var d=c;if(a){if(this.toggleStatus[c]){d=this.toggleStatus[c];ludo.dom.removeClass(f.target,"ludo-title-bar-button-"+d);d=this.getNextToggle(a,d)}ludo.dom.removeClass(f.target,"ludo-title-bar-button-"+d);this.toggleStatus[c]=d;ludo.dom.addClass(f.target,"ludo-title-bar-button-"+this.getNextToggle(a,d))}this.fireEvent(d)}.bind(this)},getNextToggle:function(a,c){var b=a.indexOf(c)+1;return a[b>=a.length?0:b]},addBorderToButtons:function(){var b=false;for(var a=0;a<this.els.buttonArray.length;a++){this.els.buttonArray[a].removeClass("ludo-title-bar-button-with-border");if(b){this.els.buttonArray[a].addClass("ludo-title-bar-button-with-border")}b=true}},enterButton:function(c){var b=c.target;var a=b.getProperty("buttonType");ludo.dom.addClass(b,"ludo-title-bar-button-"+a+"-over")},leaveButton:function(b){var a=b.target;a.removeClass("ludo-title-bar-button-"+a.getProperty("buttonType")+"-over")},getWidthOfButtons:function(){var a=0;var c=this.els.buttonArray;for(var b=0,f=c.length;b<f;b++){var d=ludo.dom.getNumericStyle(c[b],"width")+ludo.dom.getBW(c[b])+ludo.dom.getPW(c[b])+ludo.dom.getMW(c[b]);if(!isNaN(d)&&d){a+=d}else{a+=c[b].offsetWidth}}return a?a:c.length*10},getEl:function(){return this.els.el},setSizeOfButtonContainer:function(){if(this.els.controls){var a=this.getWidthOfButtons();this.els.controls.style.width=a+"px";this.els.controls.style.display=a>0?"":"none"}if(this.icon){this.els.title.setStyle("left",document.id(this.els.icon).getStyle("width"))}},getWidthOfIconAndButtons:function(){var a=this.view.icon?this.els.icon.offsetWidth:0;return a+this.els.controls.offsetWidth},resizeDOM:function(){var a=(this.view.width-this.getWidthOfIconAndButtons());if(a>0){this.els.title.style.width=a+"px"}},height:undefined,getHeight:function(){if(this.height===undefined){var a=this.els.el;this.height=ludo.dom.getNumericStyle(a,"height");this.height+=ludo.dom.getMH(a)+ludo.dom.getBH(a)+ludo.dom.getPH(a)}return this.height},getCollapseButtonDirection:function(){var b=this.view;if(ludo.util.isString(b.layout.collapsible)){return b.layout.collapsible}var a=b.getParent();if(a&&a.layout&&a.layout.type==="linear"&&a.layout.orientation==="horizontal"){return a.children.indexOf(b)===0?"left":"right"}else{return a.children.indexOf(b)===0?"top":"bottom"}}});ludo.view.registerTitleBarButton=function(b,a){ludo.registry.set("titleBar-"+b,a)
};ludo.view.getTitleBarButton=function(a){return ludo.registry.get("titleBar-"+a)};ludo.view.registerTitleBarButton("minimize",{toggle:["minimize","maximize"]});ludo.FramedView=new Class({Extends:ludo.View,type:"FramedView",layout:{type:"fill",minWidth:100,minHeight:100},minimized:false,title:"",movable:false,minimizable:false,resizable:false,closable:false,width:null,height:200,preserveAspectRatio:false,icon:undefined,titleBar:undefined,titleBarHidden:false,boldTitle:true,hasMenu:false,buttons:[],buttonBar:undefined,menuConfig:null,menuObj:null,column:null,state:{isMinimized:false},ludoConfig:function(a){this.parent(a);if(a.buttons){a.buttonBar={children:a.buttons}}this.setConfigParams(a,["buttonBar","hasMenu","menuConfig","icon","titleBarHidden","titleBar","buttons","boldTitle","minimized"])},getTitleBarConfig:function(){return undefined},getButtonBarConfig:function(){return undefined},ludoDOM:function(){this.parent();ludo.dom.addClass(this.els.container,"ludo-framed-view");if(this.hasTitleBar()){this.getTitleBar().getEl().inject(this.getBody(),"before")}ludo.dom.addClass(this.getBody(),"ludo-framed-view-body");if(!this.getParent()&&this.isResizable()){this.getResizer().addHandle("s")}},ludoRendered:function(){if(!this.buttonBar){this.buttonBar=this.getButtonBarConfig()}if(this.buttonBar&&!this.buttonBar.children){this.buttonBar={children:this.buttonBar}}if(this.buttonBar){this.getButtonBar()}else{ludo.dom.addClass(this.els.container,"ludo-component-no-buttonbar")}this.parent();if(this.minimized){this.minimize()}},resizer:undefined,getResizer:function(){if(this.resizer===undefined){var a=this.getLayout().getRenderer();this.resizer=this.createDependency("resizer",new ludo.effect.Resize({component:this,preserveAspectRatio:this.layout.preserveAspectRatio,minWidth:a.getMinWidth(),minHeight:a.getMinHeight(),maxHeight:a.getMaxHeight(),maxWidth:a.getMaxWidth(),listeners:{stop:a.setSize.bind(a)}}));this.resizer.addEvent("stop",this.saveState.bind(this))}return this.resizer},setTitle:function(a){this.parent(a);this.fireEvent("setTitle",a)},resizeDOM:function(){var a=this.getHeight();a-=(ludo.dom.getMBPH(this.els.container)+ludo.dom.getMBPH(this.els.body)+this.getHeightOfTitleAndButtonBar());if(a>=0){this.els.body.style.height=a+"px";this.cachedInnerHeight=a;if(this.buttonBarComponent){this.buttonBarComponent.resize()}}},heightOfTitleAndButtonBar:undefined,getHeightOfTitleAndButtonBar:function(){if(this.isHidden()){return 0}if(!this.heightOfTitleAndButtonBar){this.heightOfTitleAndButtonBar=this.getHeightOfTitleBar()+this.getHeightOfButtonBar()}return this.heightOfTitleAndButtonBar},getHeightOfButtonBar:function(){if(!this.buttonBar){return 0}return this.els.buttonBar.el.offsetHeight+ludo.dom.getMH(this.els.buttonBar.el)},getHeightOfTitleBar:function(){if(!this.hasTitleBar()){return 0}return this.titleBarObj.getHeight()},hasTitleBar:function(){return !this.titleBarHidden},getTitleBar:function(){if(this.titleBarObj===undefined){if(!this.titleBar){this.titleBar=this.getTitleBarConfig()||{}}this.titleBar.view=this;this.titleBar.type="view.TitleBar";this.titleBarObj=this.createDependency("titleBar",this.titleBar);this.titleBarObj.addEvents({close:this.close.bind(this),minimize:this.minimize.bind(this),maximize:this.maximize.bind(this),collapse:this.hide.bind(this)});if(this.isMovable()&&!this.getParent()){this.drag=this.createDependency("drag",new ludo.effect.Drag({handle:this.titleBarObj.getEl(),el:this.getEl(),listeners:{start:this.increaseZIndex.bind(this),end:this.stopMove.bind(this)}}));this.titleBarObj.getEl().style.cursor="move"}}return this.titleBarObj},getHeight:function(){return this.isMinimized()?this.getHeightOfTitleBar():this.parent()},close:function(){this.hide();this.fireEvent("close",this)},isMinimized:function(){return this.state.isMinimized},maximize:function(){this.state.isMinimized=false;if(!this.hidden){this.resize({height:this.layout.height});this.els.body.style.visibility="visible";this.showResizeHandles();this.fireEvent("maximize",this)}},showResizeHandles:function(){if(this.isResizable()){this.getResizer().showAllHandles()}},hideResizeHandles:function(){if(this.isResizable()){this.getResizer().hideAllHandles()}},minimize:function(){this.state.isMinimized=true;if(!this.hidden){var a=this.layout.height;var b=this.getHeightOfTitleBar();this.els.container.setStyle("height",this.getHeightOfTitleBar());this.els.body.style.visibility="hidden";this.hideResizeHandles();this.layout.height=a;this.fireEvent("minimize",[this,{height:b}])}},getHtml:function(){return this.els.body.get("html")},getButtonBar:function(){if(!this.els.buttonBar){this.els.buttonBar=this.els.buttonBar||{};var a=this.els.buttonBar.el=ludo.dom.create({renderTo:this.els.container,cls:"ludo-component-buttonbar"});ludo.dom.addClass(this.getEl(),"ludo-component-with-buttonbar");this.buttonBar.renderTo=a;this.buttonBar.component=this;this.buttonBarComponent=this.createDependency("buttonBar",new ludo.view.ButtonBar(this.buttonBar))}return this.els.buttonBar.el
},getButton:function(a){return this.getButtonByKey(a)},hideButton:function(a){return this.buttonEffect(a,"hide")},showButton:function(a){return this.buttonEffect(a,"show")},getButtons:function(){return this.buttonBarComponent?this.buttonBarComponent.getButtons():[]},disableButton:function(a){return this.buttonEffect(a,"disable")},enableButton:function(a){return this.buttonEffect(a,"enable")},buttonEffect:function(c,b){var a=this.getButtonByKey(c);if(a){a[b]();return true}return false},getButtonByKey:function(b){if(this.buttonBarComponent){return this.buttonBarComponent.getButton(b)}for(var a=0;a<this.buttons.length;a++){if(this.buttons[a].getId()===b||this.buttons[a].getValue()==b||this.buttons[a].getName()==b){return this.buttons[a]}}return null},isResizable:function(){return this.resizable},stopMove:function(b,a){this.getLayout().getRenderer().setPosition(a.getX(),a.getY());this.fireEvent("stopmove",this)}});ludo.Application=new Class({Extends:ludo.View,type:"Application",layout:{width:"matchParent",height:"matchParent"},ludoConfig:function(a){a.renderTo=document.body;this.parent(a);this.setBorderStyles()},ludoRendered:function(){this.parent();this.getEl().addClass("ludo-application");this.getBody().addClass("ludo-application-content")},setBorderStyles:function(){var a={width:"100%",height:"100%",overflow:"hidden",margin:0,padding:0,border:0};document.body.setStyles(a);document.id(document.documentElement).setStyles(a)}});ludo.Window=new Class({Extends:ludo.FramedView,type:"Window",cssSignature:"ludo-window",movable:true,resizable:true,closable:true,top:undefined,left:undefined,width:300,height:200,resizeTop:true,resizeLeft:true,hideBodyOnMove:false,preserveAspectRatio:false,statefulProperties:["layout"],ludoConfig:function(a){a=a||{};a.renderTo=document.body;var b=["resizeTop","resizeLeft","hideBodyOnMove","preserveAspectRatio"];this.setConfigParams(a,b);this.parent(a)},ludoEvents:function(){this.parent();if(this.hideBodyOnMove){this.addEvent("startmove",this.hideBody.bind(this));this.addEvent("stopmove",this.showBody.bind(this))}this.addEvent("stopmove",this.saveState.bind(this))},hideBody:function(){this.getBody().style.display="none";this.els.buttonBar.el.style.display="none"},showBody:function(){this.getBody().style.display="";this.els.buttonBar.el.style.display=""},ludoRendered:function(){this.parent();ludo.dom.addClass(this.getEl(),"ludo-window");this.focusFirstFormField();this.fireEvent("activate",this)},ludoDOM:function(){this.parent();if(this.isResizable()){var a=this.getResizer();if(this.resizeTop){if(this.resizeLeft){a.addHandle("nw")}a.addHandle("n");a.addHandle("ne")}if(this.resizeLeft){a.addHandle("w");a.addHandle("sw")}a.addHandle("e");a.addHandle("se")}},show:function(){this.parent();this.focusFirstFormField()},focusFirstFormField:function(){var b=this.getBody().getElements("input");for(var a=0,d=b.length;a<d;a++){if(b[a].type&&b[a].type.toLowerCase()==="text"){b[a].focus();return}}var c=this.getBody().getElement("textarea");if(c){c.focus()}},isUsingShimForResize:function(){return true},showAt:function(a,b){this.setXY(a,b);this.show()},setXY:function(a,c){this.layout.left=a;this.layout.top=c;var b=this.getLayout().getRenderer();b.clearFn();b.resize()},center:function(){var b=document.body.getSize();var a=Math.round((b.x/2)-(this.getWidth()/2));var c=Math.round((b.y/2)-(this.getHeight()/2));this.setXY(a,Math.max(0,c))},showCentered:function(){this.center();this.show()},isWindow:function(){return true}});ludo.Accordion=new Class({Extends:ludo.FramedView,type:"Accordion",closable:false,heightBeforeMinimize:undefined,slideInProgress:false,fx:undefined,fxContent:undefined,minimized:false,ludoConfig:function(a){if(!a.height){a.height="auto"}this.parent(a)},ludoDOM:function(){this.parent();this.getEl().addClass("ludo-accordion")},ludoRendered:function(){this.fx=new Fx.Morph(this.getEl(),{duration:100});this.fxContent=new Fx.Morph(this.getBody(),{duration:100});this.fx.addEvent("complete",this.animationComplete.bind(this));this.getTitleBar().getEl().addEvent("click",this.toggleExpandCollapse.bind(this));this.parent()},toggleExpandCollapse:function(){this.state.isMinimized?this.maximize():this.minimize()},maximize:function(){if(this.slideInProgress){return}this.slideInProgress=true;this.state.isMinimized=false;this.showResizeHandles();this.fx.start({height:[this.getHeightOfTitleBar(),this.heightBeforeMinimize]});this.fxContent.start({"margin-top":[this.getBody().getStyle("margin-top"),0]});this.fireEvent("maximize",this)},minimize:function(){if(this.slideInProgress){return}this.heightBeforeMinimize=this.getEl().offsetHeight-ludo.dom.getBH(this.getEl())-ludo.dom.getPH(this.getEl());this.slideInProgress=true;this.state.isMinimized=true;this.hideResizeHandles();var a=this.getHeightOfTitleBar();this.fx.start({height:[this.heightBeforeMinimize,a]});this.fxContent.start({"margin-top":[0,(this.heightBeforeMinimize-a)*-1]});this.fireEvent("minimize",[this,{height:a}])},animationComplete:function(){this.slideInProgress=false
}});ludo.dataSource.SearchParser=new Class({searches:undefined,parsedSearch:{items:[]},branches:[],compiled:undefined,getSearchFn:function(a){this.parse(a);this.compiled=this.parsedSearch;this.compiled=this.compile(Object.clone(this.parsedSearch));return this.compiled},clear:function(){this.parsedSearch={items:[]};this.branches=[]},parse:function(d){this.clear();this.branches.push(this.parsedSearch);for(var a=0;a<d.length;a++){if(this.isBranchStart(d[a])){var b={items:[]};this.appendToCurrentBranch(b);this.branches.push(b)}else{if(this.isBranchEnd(d[a])){this.setOperatorIfEmpty();if(this.branches.length>1){this.branches.pop()}}else{if(this.isOperator(d[a])){if(!this.hasOperator()){this.setOperator(d[a])}else{if(this.shouldCreateBranchOfPrevious(d[a])){this.createBranchOfPrevious();this.setOperator(d[a])}else{if(this.shouldCreateNewBranch(d[a])){var c={operator:d[a],items:[]};c.items.push(this.branches[this.branches.length-1].items.pop());this.appendToCurrentBranch(c);this.branches.push(c)}}}}else{this.appendToCurrentBranch(d[a])}}}}this.setOperatorIfEmpty()},compile:function(c){var b=this.getIndexOfInnerBranch(c);var a=0;while(b>=0&&a<100){c.items[b]={fn:this.compile(c.items[b])};a++;b=this.getIndexOfInnerBranch(c)}return c.operator==="&"?this.getAndFn(c):this.getOrFn(c)},getAndFn:function(b){var a=b.items;return function(c){for(var d=0;d<a.length;d++){if(a[d].txt!==undefined){if(c.searchIndex.indexOf(a[d].txt)===-1){return false}}else{if(a[d].fn!==undefined){if(!a[d].fn.call(this,c)){return false}}}}return true}},getOrFn:function(b){var a=b.items;return function(c){for(var d=0;d<a.length;d++){if(a[d].txt!==undefined){if(c.searchIndex.indexOf(a[d].txt)>-1){return true}}else{if(a[d].fn!==undefined){if(a[d].fn.call(this,c)){return true}}}}return false}},getIndexOfInnerBranch:function(b){for(var a=0;a<b.items.length;a++){if(b.items[a].operator!==undefined){return a}}return -1},setOperatorIfEmpty:function(){var a=this.branches[this.branches.length-1];a.operator=a.operator||"&"},isBranchStart:function(a){return a==="("},isBranchEnd:function(a){return a===")"},shouldCreateBranchOfPrevious:function(a){return a==="|"&&this.getCurrentOperator()==="&"},createBranchOfPrevious:function(){var a=this.branches[this.branches.length-1];var b={operator:a.operator,items:a.items};a.operator=undefined;a.items=[b]},shouldCreateNewBranch:function(a){return a==="&"&&this.isDifferentOperator(a)},appendToCurrentBranch:function(a){this.branches[this.branches.length-1].items.push(a)},isOperator:function(a){return a==="|"||a==="&"},hasOperator:function(){return this.branches[this.branches.length-1].operator!==undefined},isDifferentOperator:function(a){return a!==this.getCurrentOperator()},getCurrentOperator:function(){return this.branches[this.branches.length-1].operator},setOperator:function(a){this.branches[this.branches.length-1].operator=a}});ludo.dataSource.CollectionSearch=new Class({Extends:ludo.Core,dataSource:undefined,searchResult:undefined,searchIndexCreated:false,delay:0,searches:undefined,searchBranches:undefined,searchFn:undefined,currentBranch:undefined,index:undefined,searchParser:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["dataSource","index","delay"]);this.searchParser=new ludo.dataSource.SearchParser();this.clear()},ludoEvents:function(){this.parent();if(!this.dataSource.hasRemoteSearch()){this.dataSource.addEvent("beforeload",this.clearSearchIndex.bind(this));this.dataSource.addEvent("beforeload",this.deleteSearch.bind(this));this.dataSource.addEvent("update",this.clearSearchIndex.bind(this))}},search:function(b){if(!b&&this.searches.length==0){return}this.clear();this.where(b);this.endBranch();var a=this.getSearchDelay();if(a===0){this.executeSearch(this.searches[0].txt)}else{this.executeSearch.delay(a*1000,this,this.searches[0].txt)}},executeSearch:function(a){if(a==this.searches[0].txt){this.execute()}},clear:function(){this.searches=[];return this},deleteSearch:function(){this.fireEvent("deleteSearch");this.searchResult=undefined;this.clear()},where:function(a){this.clear();this.appendSearch(Array.from(arguments));return this},or:function(a){this.appendOperator("|");this.appendSearch(Array.from(arguments));return this},appendSearch:function(b){this.preCondition(b);var c=this.getActualArgument(b);var a;if(typeof c==="function"){a={fn:c}}else{a={txt:c.toLowerCase()}}this.searches.push(a);this.postCondition(b)},and:function(a){this.appendOperator("&");this.appendSearch(Array.from(arguments));return this},preCondition:function(a){if(a.length==2&&a[0]==="("){this.branch()}},postCondition:function(a){if(a.length==2&&a[1]===")"){this.endBranch()}},getActualArgument:function(a){if(a.length===2){if(a[0]==")"||a[0]=="("){return a[1]}return a[0]}return a[0]},withIn:function(b){for(var a=0;a<b.length;a++){this.or(b[a])}return this},branch:function(){this.appendOperator("(");return this},endBranch:function(){this.appendOperator(")");return this},appendOperator:function(a){if(a!="("&&this.searches.length==0){return
}if(a==="|"&&this.searches.getLast()==="("){return}this.searches.push(a)},execute:function(){if(!this.searchIndexCreated){this.createSearchIndex()}if(!this.hasSearchTokens()){this.deleteSearch()}else{this.fireEvent("initSearch");this.searchResult=[];this.compileSearch();this.performSearch()}this.fireEvent("search");return this},performSearch:function(){var b=this.getDataFromSource();for(var a=0;a<b.length;a++){if(this.isMatchingSearch(b[a])){this.searchResult.push(b[a])}}},isMatchingSearch:function(a){return this.searchFn.call(this,a)},compileSearch:function(){this.searchFn=this.searchParser.getSearchFn(this.searches)},hasSearchTokens:function(){return this.hasContentInFirstSearch()||this.searches.length>1},hasContentInFirstSearch:function(){if(this.searches.length===0){return false}var a=this.searches[0];return(ludo.util.isArray(a)||a.fn!==undefined||(a.txt!==undefined&&a.txt.length>0))},hasData:function(){return this.searchResult!==undefined},getData:function(){return this.searchResult},getDataFromSource:function(){return this.dataSource.getLinearData()},getSearchDelay:function(){return this.delay||0},clearSearchIndex:function(){this.searchIndexCreated=false},createSearchIndex:function(){this.indexBranch(this.getDataFromSource());this.searchIndexCreated=true},indexBranch:function(g,c){c=c||[];var f=this.getSearchIndexKeys();var b;for(var d=0;d<g.length;d++){b=[];for(var a=0;a<f.length;a++){if(g[d][f[a]]!==undefined){b.push((g[d][f[a]]+"").toLowerCase())}}g[d].searchIndex=b.join(" ");for(a=0;a<c.length;a++){c[a].searchIndex=[c[a].searchIndex,g[d].searchIndex].join(" ")}if(g[d].children){this.indexBranch(g[d].children,c.concat(g[d]))}}},getSearchIndexKeys:function(){if(this.index!==undefined){return this.index}var f=["children","searchIndex","uid"];var d=this.getDataFromSource();if(d.length>0){var a=Object.clone(d[0]);var b=[];for(var c in a){if(a.hasOwnProperty(c)){if(f.indexOf(c)===-1){b.push(c)}}}return b}return["NA"]},getCount:function(){return this.searchResult?this.searchResult.length:0},searchToString:function(){return this.hasData()?"":""}});ludo.effect.DropPoint=new Class({id:undefined,el:undefined,captureRegions:undefined});ludo.effect.DragDrop=new Class({Extends:ludo.effect.Drag,useShim:false,currentDropPoint:undefined,onValidDropPoint:undefined,captureRegions:false,mouseYOffset:undefined,ludoConfig:function(a){this.parent(a);if(a.captureRegions!==undefined){this.captureRegions=a.captureRegions}},ludoEvents:function(){this.parent();this.addEvent("start",this.setStartProperties.bind(this));this.addEvent("end",this.drop.bind(this))},getDropIdByEvent:function(b){var a=b.target;if(!a.hasClass("ludo-drop")){a=a.getParent(".ludo-drop")}return a.getProperty("forId")},remove:function(b){if(this.els[b]!==undefined){var a=document.id(this.els[b].el);a.removeEvent("mouseenter",this.enterDropTarget.bind(this));a.removeEvent("mouseleave",this.leaveDropTarget.bind(this));return this.parent(b)}return false},addDropTarget:function(a){a=this.getValidNode(a);ludo.dom.addClass(a.el,"ludo-drop");a.el.addEvent("mouseenter",this.enterDropTarget.bind(this));a.el.addEvent("mouseleave",this.leaveDropTarget.bind(this));var b=a.captureRegions!==undefined?a.captureRegions:this.captureRegions;if(b){a.el.addEvent("mousemove",this.captureRegion.bind(this))}a=this.els[a.id]=Object.merge(a,{el:a.el,captureRegions:b});return a},enterDropTarget:function(a){if(this.isActive()){this.setCurrentDropPoint(a);this.onValidDropPoint=true;this.fireEvent("enterDropTarget",this.getDropEventArguments(a));if(this.onValidDropPoint){if(this.shouldCaptureRegionsFor(this.currentDropPoint)){this.setMidPoint()}this.fireEvent("validDropTarget",this.getDropEventArguments(a))}else{this.fireEvent("invalidDropTarget",this.getDropEventArguments(a))}return false}return undefined},setCurrentDropPoint:function(a){this.currentDropPoint=this.getById(this.getDropIdByEvent(a))},leaveDropTarget:function(a){if(this.isActive()&&this.currentDropPoint){this.fireEvent("leaveDropTarget",this.getDropEventArguments(a));this.onValidDropPoint=false;this.currentDropPoint=undefined}},getDropEventArguments:function(a){return[this.getDragged(),this.currentDropPoint,this,a.target]},setInvalid:function(){this.onValidDropPoint=false},getCurrentDropPoint:function(){return this.currentDropPoint},drop:function(a){if(this.onValidDropPoint){this.fireEvent("drop",this.getDropEventArguments(a))}},setStartProperties:function(){this.onValidDropPoint=false},shouldCaptureRegionsFor:function(a){return this.els[a.id].captureRegions===true},getDropPointCoordinates:function(){if(this.currentDropPoint){return this.currentDropPoint.el.getCoordinates()}return undefined},previousRegions:{h:undefined,v:undefined},captureRegion:function(a){if(this.isActive()&&this.onValidDropPoint&&this.shouldCaptureRegionsFor(this.currentDropPoint)){var b=this.midPoint;if(a.page.y<b.y&&this.previousRegions.v!=="n"){this.fireEvent("north",this.getDropEventArguments(a));this.previousRegions.v="n"}else{if(a.page.y>=b.y&&this.previousRegions.v!=="s"){this.fireEvent("south",this.getDropEventArguments(a));
this.previousRegions.v="s"}}if(a.page.x<b.x&&this.previousRegions.h!=="w"){this.fireEvent("west",this.getDropEventArguments(a));this.previousRegions.h="w"}else{if(a.page.x>=b.x&&this.previousRegions.h!=="e"){this.fireEvent("east",this.getDropEventArguments(a));this.previousRegions.h="e"}}}},midPoint:undefined,setMidPoint:function(){var a=this.getDropPointCoordinates();this.midPoint={x:a.left+(a.width/2),y:a.top+(a.height/2)};this.previousRegions={h:undefined,v:undefined}}});ludo.grid.ColumnMove=new Class({Extends:ludo.effect.DragDrop,gridHeader:undefined,columnManager:undefined,shimCls:["ludo-grid-movable-shim"],insertionMarker:undefined,arrowHeight:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["gridHeader","columnManager"])},ludoEvents:function(){this.parent();this.addEvent("createShim",this.setZIndex.bind(this))},setZIndex:function(a){a.style.zIndex=50000},getMarker:function(){if(this.insertionMarker===undefined){this.insertionMarker=ludo.dom.create({cls:"ludo-grid-movable-insertion-marker",css:{display:"none"},renderTo:document.body});ludo.dom.create({cls:"ludo-grid-movable-insertion-marker-bottom",renderTo:this.insertionMarker})}return this.insertionMarker},hideMarker:function(){this.getMarker().style.display="none"},showMarkerAt:function(a,d){var c=a.getCoordinates();var b=this.getMarker().style;b.display="";b.left=(c.left+(d=="after"?c.width:0))+"px";b.top=(c.top-this.getArrowHeight())+"px";b.height=c.height+"px"},setMarkerHeight:function(a){this.getMarker().style.height=(a+(this.getArrowHeight()*2))+"px"},getArrowHeight:function(){if(!this.arrowHeight){this.arrowHeight=this.getMarker().getElement(".ludo-grid-movable-insertion-marker-bottom").offsetHeight}return this.arrowHeight}});ludo.Scroller=new Class({Extends:Events,els:{applyTo:null,el:null,elInner:null,parent:null},active:0,wheelSize:5,type:"horizontal",currentSize:0,renderTo:undefined,initialize:function(a){this.type=a.type||this.type;if(a.applyTo){this.setApplyTo(a.applyTo)}this.renderTo=a.parent?document.id(a.parent):null;if(a.mouseWheelSizeCls){this.determineMouseWheelSize(a.mouseWheelSizeCls)}this.createElements();this.createEvents()},setApplyTo:function(a){if(!ludo.util.isArray(a)){a=[a]}this.els.applyTo=a},determineMouseWheelSize:function(a){var b=new Element("div");b.addClass(a);b.setStyle("visibility","hidden");document.body.adopt(b);this.wheelSize=b.getSize().y;if(!this.wheelSize){this.wheelSize=25}b.destroy()},createElements:function(){this.els.el=new Element("div");ludo.dom.addClass(this.els.el,"ludo-scroller");ludo.dom.addClass(this.els.el,"ludo-scroller-"+this.type);this.els.el.setStyles({position:"relative","z-index":1000,overflow:"hidden"});var a=Browser.ie&&Browser.version<9?"scroll":"auto";if(this.type=="horizontal"){this.els.el.setStyles({"overflow-x":a,width:"100%",height:Browser.ie?"21px":"17px"})}else{this.els.el.setStyles({"overflow-y":a,height:"100%",width:Browser.ie?"21px":"17px",right:"0px",top:"0px",position:"absolute"})}this.els.el.addEvent("scroll",this.performScroll.bind(this));this.els.elInner=new Element("div");this.els.elInner.setStyle("position","relative");this.els.elInner.set("html","&nbsp;");this.els.el.adopt(this.els.elInner)},createEvents:function(){this.els.elInner.addEvent("resize",this.toggle.bind(this));if(this.type=="vertical"){for(var a=0;a<this.els.applyTo.length;a++){this.els.applyTo[a].addEvent("mousewheel",this.eventScroll.bind(this))}}document.id(window).addEvent("resize",this.resize.bind(this))},resize:function(){if(this.type=="horizontal"){this.els.el.setStyle("width",this.renderTo.offsetWidth)}else{var a=this.renderTo.offsetHeight;if(a==0){return}this.els.el.setStyle("height",a)}this.toggle()},getEl:function(){return this.els.el},setContentSize:function(a){if(this.type=="horizontal"){this.currentSize=a||this.getWidthOfScrollableElements();this.els.elInner.setStyle("width",this.currentSize)}else{this.currentSize=a||this.getHeightOfScrollableElements();if(this.currentSize<=0){var b=this.els.applyTo.getChildren(".ludo-grid-data-column");if(b.length){this.currentSize=b[0].getSize().y}}this.els.elInner.setStyle("height",this.currentSize)}if(this.currentSize<=0){this.setContentSize.delay(1000,this)}this.resize();this.toggle()},getWidthOfScrollableElements:function(){return this.getTotalSize("offsetWidth")},getHeightOfScrollableElements:function(){return this.getTotalSize("offsetHeight")},getTotalSize:function(c){var a=0;for(var b=0;b<this.els.applyTo.length;b++){a+=this.els.applyTo[b][c]}return a},eventScroll:function(a){this.els.el.scrollTop-=(a.wheel*this.wheelSize);return false},performScroll:function(){if(this.type=="horizontal"){this.scrollTo(this.els.el.scrollLeft)}else{this.scrollTo(this.els.el.scrollTop)}},scrollBy:function(b){var a=this.type==="horizontal"?"scrollLeft":"scrollTop";this.els.el[a]+=b;this.scrollTo(this.els.el[a])},scrollTo:function(c){var b=this.type==="horizontal"?"left":"top";for(var a=0;a<this.els.applyTo.length;a++){this.els.applyTo[a].style[b]=(c*-1)+"px"
}this.fireEvent("scroll",this)},getHeight:function(){return this.active?this.els.el.getSize().y:0},getWidth:function(){return this.active?this.els.el.getSize().x:0},toggle:function(){this.shouldShowScrollbar()?this.show():this.hide()},shouldShowScrollbar:function(){var b=this.type==="horizontal"?"x":"y";var a=this.getParentEl().getSize()[b];return this.currentSize>a&&a>0},getParentEl:function(){return this.renderTo?this.renderTo:this.els.el},show:function(){this.active=true;this.els.el.style.display=""},hide:function(){this.active=false;this.scrollTo(0);this.els.el.style.display="none"}});ludo.grid.GridHeader=new Class({Extends:ludo.Core,columnManager:undefined,grid:undefined,cells:{},cellHeight:undefined,spacing:{},headerMenu:false,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["columnManager","headerMenu","grid"]);this.measureCellHeight();this.createDOM()},ludoEvents:function(){this.parent();var a=this.columnManager;a.addEvent("resize",this.renderColumns.bind(this));a.addEvent("stretch",this.renderColumns.bind(this));a.addEvent("movecolumn",this.renderColumns.bind(this));a.addEvent("hidecolumn",this.renderColumns.bind(this));a.addEvent("showcolumn",this.renderColumns.bind(this));this.grid.addEvent("render",this.renderColumns.bind(this));this.grid.getDataSource().addEvent("sort",this.updateSortArrow.bind(this))},createDOM:function(){this.el=new Element("div");ludo.dom.addClass(this.el,"ludo-header");ludo.dom.addClass(this.el,"testing");this.el.inject(this.grid.getBody().getFirst(),"before");var a=this.columnManager.getCountRows();this.el.setStyle("height",this.cellHeight*a+ludo.dom.getMBPH(this.el));this.renderColumns()},renderColumns:function(){var d=this.columnManager.getCountRows();for(var g=0;g<d;g++){var c=this.columnManager.getColumnsInRow(g);var b=0;for(var f=0;f<c.length;f++){var a=this.columnManager.getWidthOf(c[f]);if(g==this.columnManager.getStartRowOf(c[f])){var k=this.getCell(c[f]);k.setStyle("display","");k.setStyle("left",b);k.setStyle("top",g*this.cellHeight);var l=(this.columnManager.getRowSpanOf(c[f])*this.cellHeight)-this.spacing.height;var h=(f==c.length-1)?this.spacing.width-1:this.spacing.width;k.setStyle("width",a-h);k.setStyle("height",l);k.setStyle("line-height",l);this.resizeCellBackgrounds(c[f]);k.removeClass("last-header-cell");if(f==c.length-1){ludo.dom.addClass(k,"last-header-cell")}}b+=a}}this.hideHiddenColumns()},hideHiddenColumns:function(){var b=this.columnManager.getHiddenColumns();for(var a=0;a<b.length;a++){if(this.cellExists(b[a])){this.cells[b[a]].style.display="none"}}},cellExists:function(a){return this.cells[a]!==undefined},measureCellHeight:function(){if(this.grid.isHidden()){return}var a=new Element("div");ludo.dom.addClass(a,"ludo-grid-header-cell");this.grid.getBody().adopt(a);this.cellHeight=a.getSize().y+ludo.dom.getMH(a);this.spacing={width:ludo.dom.getMBPW(a),height:ludo.dom.getMBPH(a)};a.dispose()},menuButtons:{},getCell:function(a){if(this.cells[a]){return this.cells[a]}var b=this.cells[a]=new Element("div");b.setProperty("col",a);ludo.dom.addClass(b,"ludo-grid-header-cell");ludo.dom.addClass(b,"ludo-header-"+this.columnManager.getHeaderAlignmentOf(a));ludo.dom.create({tag:"span",cls:"ludo-cell-text",renderTo:b,html:this.columnManager.getHeadingFor(a)});this.createTopAndBottomBackgrounds(a);this.addDOMForDropTargets(b,a);if(this.columnManager.isSortable(a)){b.addEvent("click",this.sortByDOM.bind(this))}b.addEvent("mouseover",this.mouseoverHeader.bind(this));b.addEvent("mouseout",this.mouseoutHeader.bind(this));if(this.headerMenu){this.menuButtons[a]=new ludo.menu.Button({renderTo:b,id:this.getMenuButtonId(a),menu:this.getMenu(a),listeners:{beforeShow:this.validateButtonDisplay.bind(this)}})}this.el.adopt(b);this.getMovable().add({el:b,column:a});return b},validateButtonDisplay:function(a){if(this.columnMove&&this.columnMove.isActive()){a.cancelShow()}},cellBg:{},createTopAndBottomBackgrounds:function(b){var c=new Element("div");ludo.dom.addClass(c,"ludo-grid-header-cell-top");this.cells[b].adopt(c);var a=new Element("div");ludo.dom.addClass(a,"ludo-grid-header-cell-bottom");this.cells[b].adopt(a);this.cellBg[b]={top:c,bottom:a}},resizeCellBackgrounds:function(b){var c=(this.columnManager.getRowSpanOf(b)*this.cellHeight)-this.spacing.height;var a=Math.round(c)/2;this.cellBg[b].top.setStyle("height",a);a=c-a;this.cellBg[b].bottom.setStyle("height",a)},getMenu:function(a){return{singleton:true,id:this.getMenuId(),type:"menu.Menu",direction:"vertical",children:this.getColumnMenu(a)}},getColumnMenu:function(d){var a=[];var c=this.columnManager.getLeafKeys();for(var b=0;b<c.length;b++){a.push({type:"form.Checkbox",disabled:!(this.columnManager.isRemovable(c[b])),checked:this.columnManager.isVisible(c[b]),label:this.columnManager.getHeadingFor(c[b]),action:c[b],height:25,width:150,listeners:{change:this.getColumnToggleFn(c[b],d)}})}a.push({html:ludo.language.get("Sort ascending"),listeners:{click:function(){this.sort("ascending")}.bind(this)}});a.push({html:ludo.language.get("Sort descending"),listeners:{click:function(){this.sort("descending")
}.bind(this)}});return a},sort:function(a){this.grid.getDataSource().by(this.currentColumn)[a]().sort();ludo.get(this.getMenuButtonId(this.currentColumn)).hideMenu()},getColumnToggleFn:function(b,a){return function(c){if(c){this.columnManager.showColumn(b)}else{this.columnManager.hideColumn(b)}ludo.get(this.getMenuButtonId(a)).hideMenu()}.bind(this)},getMenuId:function(){return"header-menu-"+this.getId()},getMenuButtonId:function(a){return this.getMenuId()+"-"+a},currentColumn:undefined,mouseoverHeader:function(b){var a=this.getColByDOM(b.target);if(!this.grid.colResizeHandler.isActive()&&!this.grid.isColumnDragActive()&&this.columnManager.isSortable(a)){this.currentColumn=a;this.cells[a].addClass("ludo-grid-header-cell-over")}},mouseoutHeader:function(b){if(!this.grid.colResizeHandler.isActive()){var a=this.getColByDOM(b.target);if(!a){return}this.cells[a].removeClass("ludo-grid-header-cell-over")}},getColByDOM:function(b){var a=b.getProperty("col");if(!a&&a!="0"){a=b.getParent().getProperty("col")}return a},getHeight:function(){if(this.cachedHeight===undefined){this.cachedHeight=this.columnManager.getCountRows()*this.cellHeight;this.cachedHeight+=ludo.dom.getMBPH(this.el)}return this.cachedHeight},getEl:function(){return this.el},sortByDOM:function(b){var a=this.getColByDOM(b.target);this.grid.getDataSource().sortBy(a)},addDOMForDropTargets:function(c,b){var d=new Element("div");d.setStyles({position:"absolute","z-index":15,left:"0px",top:"0px",width:"50%",height:"100%"});c.adopt(d);var a=new Element("div");a.setStyles({position:"absolute","z-index":15,right:"0px",top:"0px",width:"50%",height:"100%"});c.adopt(a);this.getMovable().addDropTarget({el:d,column:b,position:"before"});this.getMovable().addDropTarget({el:a,column:b,position:"after"})},columnMove:undefined,getMovable:function(){if(this.columnMove===undefined){this.columnMove=new ludo.grid.ColumnMove({useShim:true,delay:0.5,mouseYOffset:15,mouseXOffset:15,listeners:{before:this.validateMove.bind(this),start:this.grid.hideResizeHandles.bind(this.grid),end:this.grid.showResizeHandles.bind(this.grid),enterDropTarget:this.validateDrop.bind(this),leaveDropTarget:this.leaveDropTarget.bind(this),showShim:this.setColumnTextOnMove.bind(this),drop:this.moveColumn.bind(this)}})}return this.columnMove},setColumnTextOnMove:function(c,a){var b=a.getDragged().column;c.set("html",this.columnManager.getHeadingFor(b));c.setStyle("line-height",c.style.height)},validateMove:function(b,a){if(!this.columnManager.isMovable(b.column)){a.cancelDrag()}},validateDrop:function(d,f){var c=this.columnManager;if(c.canBeMovedTo(d.column,f.column,f.position)){var b=this.getMovable();b.showMarkerAt(this.getCell(f.column),f.position);var a=(c.getChildDepthOf(f.column)+c.getRowSpanOf(f.column))*this.cellHeight;b.setMarkerHeight(a)}},leaveDropTarget:function(){this.getMovable().hideMarker()},moveColumn:function(a,b){if(b.position=="before"){this.columnManager.insertColumnBefore(a.column,b.column)}else{this.columnManager.insertColumnAfter(a.column,b.column)}this.getMovable().hideMarker()},clearSortClassNameFromHeaders:function(){var c=this.columnManager.getLeafKeys();for(var a=0;a<c.length;a++){if(this.cells[c[a]]!==undefined){var b=this.cells[c[a]].getElements("span")[0];b.removeClass("ludo-cell-text-sort-asc");b.removeClass("ludo-cell-text-sort-desc")}}},updateSortArrow:function(a){this.clearSortClassNameFromHeaders();if(this.cells[a.column]){this.cells[a.column].getElements("span")[0].addClass("ludo-cell-text-sort-"+a.order)}}});ludo.ColResize=new Class({Extends:ludo.Core,component:undefined,resizeHandles:{},resizeProperties:{},minPos:0,maxPos:10000,ludoConfig:function(a){this.parent(a);this.component=a.component;this.createEvents()},createEvents:function(){this.getEventEl().addEvent(ludo.util.getDragMoveEvent(),this.moveColResizeHandle.bind(this));this.getEventEl().addEvent(ludo.util.getDragEndEvent(),this.stopColResize.bind(this))},setPos:function(a,b){this.resizeHandles[a].setStyle("left",b)},hideHandle:function(a){this.resizeHandles[a].style.display="none"},showHandle:function(a){this.resizeHandles[a].style.display=""},hideAllHandles:function(){for(var a in this.resizeHandles){if(this.resizeHandles.hasOwnProperty(a)){this.hideHandle(a)}}},showAllHandles:function(){for(var a in this.resizeHandles){if(this.resizeHandles.hasOwnProperty(a)){this.showHandle(a)}}},getHandle:function(b,a){var c=new Element("div");ludo.dom.addClass(c,"ludo-column-resize-handle");c.setStyles({top:0,position:"absolute",height:"100%",cursor:"col-resize","z-index":15000,display:a?"":"none"});c.setProperty("col-reference",b);c.addEvent(ludo.util.getDragStartEvent(),this.startColResize.bind(this));if(!ludo.util.isTabletOrMobile()){c.addEvent("mouseenter",this.mouseOverResizeHandle.bind(this));c.addEvent("mouseleave",this.mouseOutResizeHandle.bind(this))}this.resizeHandles[b]=c;return c},startColResize:function(c){var a=c.target.getProperty("col-reference");this.fireEvent("startresize",a);ludo.dom.addClass(c.target,"ludo-resize-handle-active");
var d=this.getLeftOffsetOfColResizeHandle();var b=this.resizeProperties;b.min=this.getMinPos()-d;b.max=this.getMaxPos()-d;b.mouseX=this.resizeProperties.currentX=c.page.x;b.elX=parseInt(c.target.getStyle("left").replace("px",""));b.currentX=this.resizeProperties.elX;b.active=true;b.el=c.target;b.index=a;return false},getLeftOffsetOfColResizeHandle:function(){if(!this.resizeHandles[0]){return 3}if(!this.handleOffset){var a=Math.ceil(this.resizeHandles[0].getSize().x/2);if(a>0){this.handleOffset=a}else{return 3}}return this.handleOffset},moveColResizeHandle:function(a){if(this.resizeProperties.active){var b=this.resizeProperties.elX-this.resizeProperties.mouseX+a.page.x;b=Math.max(b,this.resizeProperties.min);b=Math.min(b,this.resizeProperties.max);this.resizeProperties.el.setStyle("left",b);this.resizeProperties.currentX=b;return false}return undefined},stopColResize:function(){if(this.resizeProperties.active){this.resizeProperties.active=false;this.resizeProperties.el.removeClass("ludo-resize-handle-active");var a=this.resizeProperties.currentX-this.resizeProperties.elX;this.fireEvent("resize",[this.resizeProperties.index,a]);return false}return undefined},getMinPos:function(){return this.minPos},getMaxPos:function(){return this.maxPos},setMinPos:function(a){this.minPos=a},setMaxPos:function(a){this.maxPos=a},mouseOverResizeHandle:function(a){ludo.dom.addClass(a.target,"ludo-grid-resize-handle-over")},mouseOutResizeHandle:function(a){a.target.removeClass("ludo-grid-resize-handle-over")},isActive:function(){return this.resizeProperties.active}});ludo.grid.ColumnManager=new Class({Extends:ludo.Core,type:"grid.ColumnManager",fill:true,columns:{},columnKeys:[],statefulProperties:["columns","columnKeys"],columnLookup:{},ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["fill","columns"]);this.createColumnLookup();if(a.columnKeys!==undefined&&this.hasValidColumnKeys(a.columnKeys)){this.columnKeys=a.columnKeys}else{this.columnKeys=this.getLeafKeysFromColumns()}},getLeafKeysFromColumns:function(d){var a=[];d=d||this.columns;for(var c in d){if(d.hasOwnProperty(c)){a.push(c);if(d[c].columns!==undefined){var f=this.getLeafKeysFromColumns(d[c].columns);for(var b=0;b<f.length;b++){a.push(f[b])}}}}return a},createColumnLookup:function(b,c){b=b||this.columns;for(var a in b){if(b.hasOwnProperty(a)){this.columnLookup[a]=b[a];this.columnLookup[a].group=c;if(b[a].columns!==undefined){this.createColumnLookup(b[a].columns,a)}}}},hasValidColumnKeys:function(b){for(var a=0;a<b.length;a++){if(this.columnLookup[b[a]]===undefined){return false}}return true},hasLastColumnDynamicWidth:function(){return this.fill},getColumns:function(){return this.columns},getColumn:function(a){return this.columnLookup[a]},getLeafKeys:function(){var a=[];for(var b=0;b<this.columnKeys.length;b++){if(this.columnLookup[this.columnKeys[b]].columns===undefined){a.push(this.columnKeys[b])}}return a},getVisibleColumns:function(){var a={};var d=this.getLeafKeys();for(var c=0;c<d.length;c++){var b=d[c];if(!this.isHidden(b)){a[b]=this.columnLookup[b]}}return a},getHeadingFor:function(a){return this.getColumnKey(a,"heading")||""},getMinWidthOf:function(d){if(this.isGroup(d)){var c=this.getIdOfChildren(d);var a=0;for(var b=0;b<c.length;b++){a+=this.getMinWidthOf(c[b])}return a}return this.getColumnKey(d,"minWidth")||50},getMaxWidthOf:function(a){return this.getColumnKey(a,"maxWidth")||1000},getWidthOf:function(d){var a=this.getStrechedWithOf(d);if(a){return a}if(this.isGroup(d)){var b=this.getColumnsInGroup(d);var c=0;Object.each(b,function(g,f){if(!this.isHidden(f)){c+=this.getWidthOf(f)}}.bind(this));return c}else{return this.getColumnKey(d,"width")||100}},isGroup:function(a){return this.columnLookup[a]!==undefined&&this.columnLookup[a].columns!==undefined},getColumnsInGroup:function(a){return this.columnLookup[a].columns},getStrechedWithOf:function(a){return this.getColumnKey(a,"stretchWidth")},isRemovable:function(a){return this.getColumnKey(a,"removable")?true:false},isInAGroup:function(a){return this.getColumnKey(a,"group")!==undefined},getGroupIdOf:function(a){return this.getColumnKey(a,"group")},getGroupFor:function(a){var b=this.getGroupIdOf(a);return b?this.columnLookup[b]:undefined},getChildCount:function(a){var b=this.getColumn(a);if(b.columns!==undefined){return Object.getLength(b.columns)}return 0},getIdOfChildren:function(a){var b=this.getColumn(a);if(b){return Object.keys(b.columns)}return 0},isInSameGroup:function(b,a){return this.isInAGroup(b)&&this.getGroupIdOf(b)==this.getGroupIdOf(a)},isSortable:function(a){return this.getColumnKey(a,"sortable")?true:false},isHidden:function(a){var b=this.getColumnKey(a,"hidden");if(b){return true}var c;if(c=this.getGroupIdOf(a)){return this.isHidden(c)}return b},isVisible:function(a){return !this.isHidden(a)},isResizable:function(b){var a=this.getColumnKey(b,"resizable")!==false;if(a&&this.hasLastColumnDynamicWidth()&&this.isLastVisibleColumn(b)){a=false}return a},isMovable:function(b){var a=this.getGroupIdOf(b);
if(a&&this.getChildCount(a)==1){return false}return this.getColumnKey(b,"movable")||false},hasMovableColumns:function(){for(var a=0;a<this.columnKeys.length;a++){if(this.isMovable(this.columnKeys[a])){return true}}return false},getAlignmentOf:function(a){return this.getColumnKey(a,"align")||"left"},getHeaderAlignmentOf:function(a){return this.getColumnKey(a,"headerAlign")||"left"},setLeft:function(a,b){this.columnLookup[a].left=b},getLeftPosOf:function(a){return this.getColumnKey(a,"left")||0},getRendererFor:function(a){return this.getColumnKey(a,"renderer")},setWidth:function(b,a){this.columnLookup[b].width=a},setStretchedWidth:function(a){this.columnLookup[this.getLastVisible()].stretchWidth=a;this.fireEvent("stretch")},clearStretchedWidths:function(){for(var a=0;a<this.columnKeys.length;a++){this.columnLookup[this.columnKeys[a]].stretchWidth=undefined}},increaseWithFor:function(b,c){var a=this.getWidthOf(b);this.columnLookup[b].width=a+c;this.fireEvent("resize");this.fireEvent("state")},getColumnKey:function(b,a){if(this.columnLookup[b]!==undefined){return this.columnLookup[b][a]}return null},getTotalWidth:function(){var c=this.getVisibleColumns();var b=0;for(var a in c){if(c.hasOwnProperty(a)){b+=this.getWidthOf(a)}}return b},getMinPosOf:function(a){return this.getTotalWidthOfPreviousOf(a)+this.getMinWidthOf(a)},getMaxPosOf:function(a){return this.getTotalWidthOfPreviousOf(a)+this.getMaxWidthOf(a)},getTotalWidthOfPreviousOf:function(c){var d=this.getLeafKeys();var a=0;for(var b=0;b<d.length;b++){if(d[b]==c){return a}if(!this.isHidden(d[b])){a+=this.getWidthOf(d[b])}}return 0},insertColumnBefore:function(a,b){this.moveColumn(a,b,"before")},insertColumnAfter:function(a,b){this.moveColumn(a,b,"after")},moveColumn:function(c,b,k){var m=this.getInsertionPoint(b,k);var l=this.columnKeys.indexOf(c);if(this.isInAGroup(c)&&!this.isInSameGroup(c,b)){this.removeFromGroup(c)}var f,d;var g=[l];if(this.isGroup(c)){var a=this.getIdOfChildren(c);for(f=0;f<a.length;f++){g.push(this.columnKeys.indexOf(a[f]))}}if(this.isInAGroup(b)){this.insertIntoSameGroupAs(c,b)}var h=[];for(f=0;f<this.columnKeys.length;f++){if(f==m&&k=="before"){for(d=0;d<g.length;d++){h.push(this.columnKeys[g[d]])}}if(g.indexOf(f)==-1){h.push(this.columnKeys[f])}if(f==m&&k=="after"){for(d=0;d<g.length;d++){h.push(this.columnKeys[g[d]])}}}this.columnKeys=h;this.fireEvent("movecolumn",[c,this.columnKeys[m],k]);this.fireEvent("state")},getInsertionPoint:function(d,f){var a=this.columnKeys.indexOf(d);if(f==="after"&&this.isGroup(d)){var c=Object.keys(this.getColumnsInGroup(d));for(var b=0;b<c.length;b++){a=Math.max(a,this.columnKeys.indexOf(c[b]))}}return a},insertIntoSameGroupAs:function(b,a){var c=this.columnLookup[a].group;this.columnLookup[b].group=c;this.columnLookup[c].columns[b]=this.columnLookup[b];this.clearCache()},isLastVisibleColumn:function(c){var d=this.getLeafKeys();for(var b=d.length-1;b>=0;b--){var a=d[b];if(!this.isHidden([a])){return a===c}}return false},removeFromGroup:function(a){var b=this.getGroupFor(a);if(b){delete b.columns[a];this.getColumn(a).group=undefined;this.clearCache();return true}return false},hideColumn:function(a){if(this.columnExists(a)&&!this.isHidden(a)){this.columnLookup[a].hidden=true;this.fireEvent("hidecolumn",a);this.fireEvent("state")}},columnExists:function(a){return this.columnLookup[a]!==undefined},hideAllColumns:function(){var b=this.getLeafKeys();for(var a=0;a<b.length;a++){this.columnLookup[b[a]].hidden=true}},showColumn:function(a){if(this.columnExists(a)&&this.isHidden([a])){this.columnLookup[a].hidden=false;this.fireEvent("showcolumn",a);this.fireEvent("state")}},getIndexOfLastVisible:function(){var b=this.getLeafKeys();for(var a=b.length-1;a>=0;a--){if(!this.isHidden(b[a])){return a}}return null},getLastVisible:function(){return this.getLeafKeys()[this.getIndexOfLastVisible()]},countHeaderRows:undefined,getCountRows:function(){if(this.countHeaderRows===undefined){var a=0;var c=this.getLeafKeys();for(var b=0;b<c.length;b++){a=Math.max(a,this.getStartRowOf(c[b]))}this.countHeaderRows=a+1}return this.countHeaderRows},countParentCache:{},getStartRowOf:function(c){if(this.countParentCache[c]===undefined){var b=0;if(this.columnLookup[c].group!==undefined){var a=this.columnLookup[c].group;while(a){b++;a=this.columnLookup[a].group}}this.countParentCache[c]=b}return this.countParentCache[c]},clearCache:function(){this.countParentCache={};this.columnDepthCache={}},getColumnsInRow:function(a){var d=[];for(var f=0;f<this.columnKeys.length;f++){if(!this.isHidden(this.columnKeys[f])){var c=this.columnKeys[f];var b=this.getStartRowOf(c);if(b<=a&&!this.isGroup(c)){d.push(c)}else{if(b==a){d.push(c)}}}}return d},getRowSpanOf:function(a){var b=this.getCountRows();return b-this.getStartRowOf(a)-(this.isGroup(a)?this.getChildDepthOf(a):0)},columnDepthCache:{},getChildDepthOf:function(d){if(this.columnDepthCache[d]===undefined){if(this.isGroup(d)){var a=0;var c=this.getIdOfChildren(d);for(var b=0;b<c.length;b++){a=Math.max(a,this.getChildDepthOf(c[b]))
}a++;this.columnDepthCache[d]=a}else{this.columnDepthCache[d]=0}}return this.columnDepthCache[d]},getHiddenColumns:function(){var a=[];for(var b=0;b<this.columnKeys.length;b++){if(this.isHidden(this.columnKeys[b])){a.push(this.columnKeys[b])}}return a},canBeMovedTo:function(a,b){return a!==b}});ludo.grid.RowManager=new Class({Extends:ludo.Core,type:"grid.RowManager",renderer:undefined,ludoConfig:function(a){this.parent(a);if(a.renderer){this.renderer=a.renderer}}});ludo.grid.Grid=new Class({Extends:ludo.View,type:"Grid",hasMenu:true,colMovable:null,menu:true,menuConfig:[],scrollbar:{},highlightRecord:true,uniqueId:"",activeRecord:{},headerMenu:true,mouseOverEffect:true,columnManager:undefined,columns:undefined,rowManager:undefined,emptyText:"No data",defaultDS:"dataSource.Collection",ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["columns","fill","headerMenu","columnManager","rowManager","mouseOverEffect","emptyText"]);if(this.columnManager){ludo.util.warn("Deprecated columnManager used, use columns instead")}if(!this.columnManager){this.columnManager={columns:this.columns,fill:this.fill}}if(this.columnManager){if(!this.columnManager.type){this.columnManager.type="grid.ColumnManager"}this.columnManager.stateful=this.stateful;this.columnManager.id=this.columnManager.id||this.id+"_cm";this.columnManager=this.createDependency("colManager",this.columnManager);this.columnManager.addEvents({hidecolumn:this.refreshData.bind(this),showcolumn:this.refreshData.bind(this),movecolumn:this.onColumnMove.bind(this),resize:this.resizeColumns.bind(this)})}if(this.rowManager){if(!this.rowManager.type){this.rowManager.type="grid.RowManager"}this.rowManager=this.createDependency("rowManager",this.rowManager)}if(this.stateful&&this.dataSource!==undefined&&ludo.util.isObject(this.dataSource)){this.dataSource.id=this.dataSource.id||this.id+"_ds";this.dataSource.stateful=this.stateful}this.uniqueId=String.uniqueID()},ludoDOM:function(){this.parent();ludo.dom.addClass(this.getEl(),"ludo-grid-Grid");var a=this.getBody();var c=this.els.dataContainerTop=new Element("div");ludo.dom.addClass(c,"ludo-grid-data-container");c.setStyles({overflow:ludo.util.isTabletOrMobile()?"auto":"hidden",position:"relative"});a.adopt(c);a.setStyle("overflow","visible");this.els.dataContainer=new Element("div");c.adopt(this.els.dataContainer);this.els.dataContainer.setStyle("position","relative");this.gridHeader=this.createDependency("gridHeader",{type:"grid.GridHeader",headerMenu:this.headerMenu,columnManager:this.columnManager,grid:this});this.createDataColumnElements();this.createScrollbars();this.createColResizeHandles()},ludoEvents:function(){this.parent();if(this.dataSource){if(this.dataSourceObj&&this.dataSourceObj.hasData()){this.populateData()}this.getDataSource().addEvents({change:this.populateData.bind(this),select:this.setSelectedRecord.bind(this),deselect:this.deselectDOMForRecord.bind(this),update:this.showUpdatedRecord.bind(this),"delete":this.removeDOMForRecord.bind(this)});this.getDataSource().addEvent("select",this.selectDOMForRecord.bind(this))}this.getBody().addEvents({selectstart:ludo.util.cancelEvent,click:this.cellClick.bind(this),dblclick:this.cellDoubleClick.bind(this)});if(this.mouseOverEffect){this.els.dataContainer.addEvent("mouseleave",this.mouseLeavesGrid.bind(this))}},ludoRendered:function(){this.parent();this.ifStretchHideLastResizeHandles();if(this.highlightRecord){this.els.dataContainer.setStyle("cursor","pointer")}this.positionVerticalScrollbar.delay(100,this);if(this.getParent()){this.getParent().getBody().setStyles({padding:0});ludo.dom.clearCache();this.getParent().resize.delay(100,this.getParent())}},currentOverRecord:undefined,mouseoverDisabled:false,enterCell:function(b){if(this.mouseoverDisabled){return}var a=this.getRecordByDOM(b);if(a){if(this.currentOverRecord){this.deselectDOMForRecord(this.currentOverRecord,"ludo-grid-record-over")}this.currentOverRecord=a;this.selectDOMForRecord(a,"ludo-grid-record-over")}},mouseLeavesGrid:function(){if(this.currentOverRecord){this.deselectDOMForRecord(this.currentOverRecord,"ludo-grid-record-over");this.currentOverRecord=undefined}},cellClick:function(b){var a=this.getRecordByDOM(b.target);if(a){this.getDataSource().selectRecord(a);this.fireEvent("click",[a,this.getColumnByDom(b.target)])}},getColumnByDom:function(a){a=document.id(a);if(!a.hasClass("ludo-grid-data-cell")){a=a.getParent(".ludo-grid-data-cell")}if(a){return a.getProperty("col")}return undefined},setSelectedRecord:function(a){this.fireEvent("selectrecord",a);this.highlightActiveRecord()},highlightActiveRecord:function(){if(this.highlightRecord){var a=this.getDataSource().getSelectedRecord();if(a&&a.uid){this.selectDOMForRecord(a,"ludo-active-record")}}},selectDOMForRecord:function(b,a){a=a||"ludo-active-record";var c=this.getDOMCellsForRecord(b);for(var d in c){if(c.hasOwnProperty(d)){ludo.dom.addClass(c[d],a)}}},deselectDOMForRecord:function(b,a){a=a||"ludo-active-record";var c=this.getDOMCellsForRecord(b);
for(var d in c){if(c.hasOwnProperty(d)){c[d].removeClass(a)}}},showUpdatedRecord:function(a){var b=this.getDOMCellsForRecord(a);var d;var f;for(var c in b){if(b.hasOwnProperty(c)){f=this.columnManager.getRendererFor(c);if(f){d=f(a[c],a)}else{d=a[c]}b[c].getElement("span").set("html",d)}}},removeDOMForRecord:function(a){var b=this.getDOMCellsForRecord(a);for(var c in b){if(b.hasOwnProperty(c)){b[c].dispose()}}},getDOMCellsForRecord:function(b){var d={};var h,a;var g=this.columnManager.getLeafKeys();for(var f=0;f<g.length;f++){var c=this.getBody().getElement("#ludo-grid-column-"+g[f]+"-"+this.uniqueId);a="cell-"+g[f]+"-"+b.uid+"-"+this.uniqueId;h=c.getElement("#"+a);if(h){d[g[f]]=h}}return d},selectRecord:function(a){if(ludo.util.isString(a)){a={id:a}}this.getDataSource().selectRecord(a)},cellDoubleClick:function(b){var a=this.getRecordByDOM(b.target);if(a){this.getDataSource().selectRecord(a);this.fireEvent("dblclick",[a,this.getColumnByDom(b.target)])}},getRecordByDOM:function(b){b=document.id(b);if(!b.hasClass("ludo-grid-data-cell")){b=b.getParent(".ludo-grid-data-cell")}if(b&&b.hasClass("ludo-grid-data-cell")){var a=b.getProperty("uid");return this.getDataSource().findRecord({uid:a})}return undefined},isColumnDragActive:function(){return this.colMovable&&this.colMovable.isActive()},hideResizeHandles:function(){this.colResizeHandler.hideAllHandles()},showResizeHandles:function(){this.colResizeHandler.showAllHandles();this.ifStretchHideLastResizeHandles()},resizeChildren:function(){this.parent();if(this.colResizeHandler&&this.columnManager.hasLastColumnDynamicWidth()){this.resizeColumns()}},onColumnMove:function(a,b,c){if(c=="before"){this.els.dataColumns[a].inject(this.els.dataColumns[b],"before")}else{this.els.dataColumns[a].inject(this.els.dataColumns[b],"after")}this.cssColumns();this.resizeColumns()},cssColumns:function(){var b=Object.keys(this.els.dataColumns);for(var a=0;a<b.length;a++){var d=this.els.dataColumns[b[a]];d.removeClass("ludo-grid-data-last-column");d.removeClass("ludo-grid-data-last-column-left");d.removeClass("ludo-grid-data-column-left");d.removeClass("ludo-grid-data-last-column-center");d.removeClass("ludo-grid-data-column-center");d.removeClass("ludo-grid-data-last-column-right");d.removeClass("ludo-grid-data-column-right");ludo.dom.addClass(d,this.getColumnCssClass(b[a]))}},refreshData:function(){if(!this.isRendered){return}this.createDataColumnElements();this.resizeColumns();this.populateData();this.showResizeHandles()},insertJSON:function(){},addRecord:function(a){this.getDataSource().addRecord(a)},resizeDOM:function(){this.resizeColumns();var a=this.getHeight()-ludo.dom.getMBPH(this.els.container)-ludo.dom.getMBPH(this.els.body);a-=this.scrollbar.horizontal.getHeight();if(a<0){return}this.els.body.style.height=a+"px";this.cachedInnerHeight=a;var b=this.getBody().offsetHeight;if(b==0){this.resizeDOM.delay(100,this);return}this.els.dataContainerTop.setStyle("height",b-this.gridHeader.getHeight());this.scrollbar.vertical.resize();this.scrollbar.horizontal.resize()},createScrollbars:function(){this.scrollbar.horizontal=this.createDependency("scrollHorizontal",new ludo.Scroller({type:"horizontal",applyTo:this.getBody(),parent:this.getBody()}));this.scrollbar.horizontal.getEl().inject(this.getBody(),"after");this.scrollbar.vertical=this.createDependency("scrollVertical",new ludo.Scroller({type:"vertical",applyTo:this.els.dataContainer,parent:this.els.dataContainerTop,mouseWheelSizeCls:"ludo-grid-data-cell"}));this.getEl().adopt(this.scrollbar.vertical.getEl());this.positionVerticalScrollbar()},positionVerticalScrollbar:function(){var a=this.gridHeader.getHeight();if(a==0){this.positionVerticalScrollbar.delay(100,this);return}this.scrollbar.vertical.getEl().setStyle("top",a)},sortBy:function(a){this.getDataSource().sortBy(a)},createColResizeHandles:function(){this.colResizeHandler=new ludo.ColResize({component:this,listeners:{startresize:this.setResizePos.bind(this),resize:this.resizeColumn.bind(this)}});var c=this.columnManager.getLeafKeys();for(var a=0;a<c.length;a++){var b=this.colResizeHandler.getHandle(c[a],this.columnManager.isResizable(c[a]));this.getBody().adopt(b);ludo.dom.addClass(b,"ludo-grid-resize-handle")}},setResizePos:function(a){this.colResizeHandler.setMinPos(this.columnManager.getMinPosOf(a));this.colResizeHandler.setMaxPos(this.columnManager.getMaxPosOf(a));this.mouseoverDisabled=true;this.mouseLeavesGrid()},mouseOverResizeHandle:function(a){ludo.dom.addClass(a.target,"ludo-grid-resize-handle-over")},mouseOutResizeHandle:function(a){a.target.removeClass("ludo-grid-resize-handle-over")},resizeColumns:function(){this.mouseoverDisabled=false;var d=0;this.stretchLastColumn();var c=this.columnManager.getLeafKeys();for(var b=0;b<c.length;b++){if(this.columnManager.isHidden(c[b])){this.colResizeHandler.hideHandle(c[b])}else{var f=this.columnManager.getWidthOf(c[b]);var g=ludo.dom.getBW(this.els.dataColumns[c[b]])-(b===c.length-1)?1:0;this.els.dataColumns[c[b]].style.left=d+"px";
this.els.dataColumns[c[b]].style.width=(f-ludo.dom.getPW(this.els.dataColumns[c[b]])-g)+"px";this.columnManager.setLeft(c[b],d);d+=f;this.colResizeHandler.setPos(c[b],d);if(this.columnManager.isResizable(c[b])){this.colResizeHandler.showHandle(c[b])}else{this.colResizeHandler.hideHandle(c[b])}}}var a=this.columnManager.getTotalWidth();this.els.dataContainerTop.setStyle("width",a);this.scrollbar.horizontal.setContentSize(a)},stretchLastColumn:function(){if(this.columnManager.hasLastColumnDynamicWidth()){this.columnManager.clearStretchedWidths();var a=this.columnManager.getTotalWidth();var d=this.getBody().getCoordinates().width-ludo.dom.getPW(this.getBody())-ludo.dom.getBW(this.getBody());var b=d-a;if(b<=0){return}var c=this.columnManager.getWidthOf(this.columnManager.getLastVisible())+b;this.columnManager.setStretchedWidth(c)}},populateData:function(){this.fireEvent("state");this.currentOverRecord=undefined;this.currentData=this.getDataSource().getData();if(this.emptyText){this.emptyTextEl().style.display=this.currentData.length>0?"none":""}if(Browser.ie){this.populateDataIE();return}var g=[];var d=this.columnManager.getLeafKeys();for(var b=0;b<d.length;b++){var f="ludo-grid-column-"+d[b]+"-"+this.uniqueId;if(this.columnManager.isHidden(d[b])){g.push('<div id="'+f+'" class="ludo-grid-data-column" style="display:none"></div>')}else{g.push('<div id="'+f+'" col="'+d[b]+'" class="ludo-grid-data-column ludo-grid-data-column-'+b+" "+this.getColumnCssClass(d[b])+'">'+this.getHtmlTextForColumn(d[b])+"</div>")}}this.els.dataContainer.set("html",g.join(""));var a=this.els.dataContainer.getChildren(".ludo-grid-data-column");this.els.dataColumns={};var c;for(b=0,c=a.length;b<c;b++){this.els.dataColumns[a[b].getProperty("col")]=a[b]}this.fireEvent("renderdata",[this,this]);this.resizeColumns();this.resizeVerticalScrollbar();this.highlightActiveRecord()},emptyTextEl:function(){if(this.els.emptyText===undefined){this.els.emptyText=ludo.dom.create({cls:"ludo-grid-empty-text",html:this.emptyText,renderTo:this.getEl()})}return this.els.emptyText},getColumnCssClass:function(b){var a;if(this.columnManager.isLastVisibleColumn(b)){a="ludo-grid-data-last-column ludo-grid-data-last-column-"}else{a="ludo-grid-data-column-"}a+=this.columnManager.getAlignmentOf(b);return a},populateDataIE:function(){this.els.dataContainer.set("html","");this.createDataColumnElements();this.resizeColumns();var b=this.columnManager.getLeafKeys();for(var a=0;a<b.length;a++){if(this.columnManager.isHidden(b[a])){this.els.dataColumns[b[a]].style.display="none"}else{this.els.dataColumns[b[a]].style.display="";this.els.dataColumns[b[a]].innerHTML=this.getHtmlTextForColumn(b[a])}}this.resizeVerticalScrollbar();this.highlightActiveRecord()},resizeVerticalScrollbar:function(){var b=this.els.dataColumns[this.columnManager.getLastVisible()];if(!b){return}var a=b.offsetHeight;if(a===0){this.resizeVerticalScrollbar.delay(300,this)}else{this.els.dataContainer.setStyle("height",a);this.scrollbar.vertical.setContentSize()}},createDataColumnElements:function(){this.els.dataColumns={};var c=this.columnManager.getLeafKeys();for(var a=0;a<c.length;a++){var b=ludo.dom.create({cls:"ludo-grid-data-column",renderTo:this.els.dataContainer});b.setAttribute("col",c[a]);ludo.dom.addClass(b,this.getColumnCssClass(a));b.id="ludo-grid-column-"+c[a]+"-"+this.uniqueId;this.els.dataColumns[c[a]]=b}},getHtmlTextForColumn:function(b){var l=[];var d=["ludo-grid-data-odd-row","ludo-grid-data-even-row"];var k;var g=this.currentData;if(!g){return""}var m=this.columnManager.getRendererFor(b);var n=this.rowManager?this.rowManager.renderer:undefined;var c="";for(var f=0,h=g.length;f<h;f++){k=g[f][b];if(m){k=m(k,g[f])}var a=["cell-",b,"-",g[f].uid,"-",this.uniqueId].join("");var j=this.mouseOverEffect?" onmouseover=\"ludo.get('"+this.id+"').enterCell(this)\"":"";if(n){c=n(g[f]);if(c){c=" "+c}}l.push('<div id="'+a+'" '+j+' col="'+b+'" class="ludo-grid-data-cell '+(d[f%2])+c+'" uid="'+g[f].uid+'"><span class="ludo-grid-data-cell-text">'+k+"</span></div>")}return l.join("")},resizeColumn:function(b,a){this.columnManager.increaseWithFor(b,a)},ifStretchHideLastResizeHandles:function(){if(this.columnManager.hasLastColumnDynamicWidth()){this.colResizeHandler.hideHandle(this.columnManager.getLastVisible())}},scrollBy:function(a,b){if(b){this.scrollbar.vertical.scrollBy(b)}if(a){this.scrollbar.horizontal.scrollBy(a)}},getSelectedRecord:function(){return this.getDataSource().getSelectedRecord()},getColumnManager:function(){return this.columnManager}});ludo.form.Button=new Class({Extends:ludo.form.Element,type:"form.Button",defaultSubmit:false,inputType:"submit",cssSignature:"ludo-form-button",name:"",value:"",els:{el:null,txt:null},component:null,menu:undefined,toggle:false,disableOnInvalid:false,disabled:false,selected:false,overflow:"hidden",icon:undefined,active:false,size:"m",iconWidths:{s:15,m:25,l:34,xl:44},heights:{s:15,m:25,l:35,xl:45},ludoConfig:function(b){this.parent(b);var c=b.value||this.value;
var a=c?c.length:5;this.layout.width=this.layout.width||Math.max(a*10,80);this.setConfigParams(b,["size","menu","icon","toggle","disableOnInvalid","defaultSubmit","disabled","selected"]);if(b.toggleGroup!==undefined){if(ludo.util.type(b.toggleGroup)==="String"){b.toggleGroup={type:"form.ToggleGroup",id:"toggleGroup-"+b.toggleGroup}}b.toggleGroup.singleton=true;this.toggleGroup=ludo._new(b.toggleGroup);this.toggleGroup.addButton(this)}},ludoDOM:function(){this.parent();this.getEl().style.display=this.isHidden()?"none":"block";this.getEl().addClass("ludo-form-button-"+this.size);this.addLeftEdge();this.addRightEdge();this.addLabel();if(this.icon){this.addIcon()}var a=this.getBody();a.setStyle("padding-left",0);this.getEl().addEvent("selectstart",ludo.util.cancelEvent)},ludoEvents:function(){this.parent();var a=this.getBody();a.addEvent("click",this.click.bind(this));a.addEvent("mouseenter",this.mouseOver.bind(this));a.addEvent("mouseleave",this.mouseOut.bind(this));a.addEvent("mousedown",this.mouseDown.bind(this));this.mouseUpBound=this.mouseUp.bind(this);document.body.addEvent("mouseup",this.mouseUpBound);if(this.defaultSubmit){this.keyPressBound=this.keyPress.bind(this);document.id(window).addEvent("keypress",this.keyPressBound)}},ludoRendered:function(){this.parent();if(this.disabled){this.disable()}if(this.toggle&&this.active){this.getBody().addClass("ludo-form-button-pressed")}this.component=this.getParentComponent();if(this.component&&this.disableOnInvalid){var a=this.component.getForm();a.addEvent("valid",this.enable.bind(this));a.addEvent("invalid",this.disable.bind(this));if(!a.isValid()){this.disable()}}},dispose:function(){this.parent();document.body.removeEvent("mouseup",this.mouseUpBound);if(this.defaultSubmit){document.id(window).removeEvent("keypress",this.keyPressBound)}},addLabel:function(){var a=this.els.txt=new Element("div");ludo.dom.addClass(a,"ludo-form-button-value");a.setStyles({width:"100%",height:this.heights[this.size]-2,position:"absolute",left:this.icon?this.iconWidths[this.size]+"px":"0px","text-align":this.icon?"left":"center","z-index":7});a.set("html",this.value);this.getBody().adopt(a)},addIcon:function(){var a=this.els.icon=new Element("div");a.setStyles({position:"absolute",width:this.iconWidths[this.size],"z-index":8,left:0,top:0,height:"100%","background-image":"url("+this.icon+")","background-repeat":"no-repeat","background-position":"center center"});a.inject(this.els.txt,"before")},setIcon:function(a){if(!this.els.icon){this.addIcon()}this.icon=a;this.els.icon.setStyle("background-image","url("+a+")")},addLeftEdge:function(){var a=this.els.buttonLeftludo=new Element("div");ludo.dom.addClass(a,"ludo-form-button-bg-left");ludo.dom.addClass(a,"ludo-form-button-"+this.size+"-bg-left");a.setStyles({position:"absolute",left:0,"z-index":5});this.getBody().adopt(a)},addRightEdge:function(){var a=new Element("div");ludo.dom.addClass(a,"ludo-form-button-bg-right");ludo.dom.addClass(a,"ludo-form-button-"+this.size+"-bg-right");a.setStyles({position:"absolute",right:0,"z-index":6});this.getBody().adopt(a)},disable:function(){this.disabled=true;if(this.els.body){ludo.dom.addClass(this.els.body,"ludo-form-button-disabled");this.els.body.removeClass("ludo-form-button-over");this.els.body.removeClass("ludo-form-button-down")}},enable:function(){this.disabled=false;if(this.els.body){this.els.body.removeClass("ludo-form-button-disabled")}},isDisabled:function(){return this.disabled},setValue:function(a){this.value=a;this.els.txt.set("html",a)},getValue:function(){return this.value},mouseOver:function(){if(!this.isDisabled()){this.getBody().addClass("ludo-form-button-over");this.fireEvent("mouseover",this)}},mouseOut:function(){if(!this.isDisabled()){this.getBody().removeClass("ludo-form-button-over");this.fireEvent("mouseout",this)}},isDown:false,mouseDown:function(){if(!this.isDisabled()){this.isDown=true;this.getBody().addClass("ludo-form-button-down");this.fireEvent("mousedown",this)}},mouseUp:function(){if(this.isDown&&!this.isDisabled()){this.getBody().removeClass("ludo-form-button-down");this.fireEvent("mouseup",this)}},clickAfterDelay:function(){this.click.delay(10,this)},click:function(){this.focus();if(!this.isDisabled()){this.getEl().focus();this.fireEvent("click",[this.getValue(),this]);if(this.toggle){if(!this.active){this.turnOn()}else{this.turnOff()}}return false}},getName:function(){return this.name},defaultBeforeClickEvent:function(){return true},isButton:function(){return true},resizeDOM:function(){this.getBody().style.height=this.heights[this.size]+"px"},validate:function(){},getParentComponent:function(){var a=this.getParent();if(a&&a.type.indexOf("ButtonBar")>=0){return a.getView()}return a},select:function(){this.getBody().addClass("ludo-form-button-selected")},deSelect:function(){this.getBody().removeClass("ludo-form-button-selected")},turnOn:function(){this.active=true;this.fireEvent("on",[this.getValue(),this]);this.getBody().addClass("ludo-form-button-pressed")},turnOff:function(){this.active=false;
this.fireEvent("off",[this.getValue(),this]);this.getBody().removeClass("ludo-form-button-pressed")},getToggleGroup:function(){return this.toggleGroup},isActive:function(){return this.active}});ludo.card.Button=new Class({Extends:ludo.form.Button,type:"card.Button",autoHide:false,applyTo:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["autoHide","applyTo"]);if(a.applyTo&&!ludo.get(a.applyTo)){this.onCreate.delay(50,this)}else{this.onCreate()}},onCreate:function(){this.applyTo=this.applyTo?ludo.get(this.applyTo):this.getParentComponent();if(this.applyTo){this.applyTo.getLayout().registerButton(this)}this.addButtonEvents()},getParentComponent:function(){var b=this.parent();if(b.layout===undefined||(b.layout.type!=="card")){for(var a=0;a<b.children.length;a++){if(b.children[a].layout&&b.children[a].layout.type==="card"){return b.children[a]}}}return b.layout&&b.layout.type==="card"?b:undefined}});ludo.card.FinishButton=new Class({Extends:ludo.card.Button,type:"card.FinishButton",value:"Finish",hidden:true,addButtonEvents:function(){var b;if(this.applyTo){b=this.applyTo.getLayout();var a=this.applyTo.getForm();b.addEvent("valid",this.enable.bind(this));b.addEvent("invalid",this.disable.bind(this));b.addEvent("lastcard",this.show.bind(this));b.addEvent("notlastcard",this.hide.bind(this));a.addEvent("beforeSave",this.disable.bind(this));a.addEvent("success",this.setSubmitted.bind(this));if(!b.isValid()){this.disabled=true}}this.addEvent("click",this.submit.bind(this));if(b&&b.isOnLastCard()){this.show()}},enable:function(){if(this.applyTo.getLayout().isValid()){this.parent()}},show:function(){if(!this.submitted){return this.parent()}return undefined},submitted:false,submit:function(){if(this.applyTo){this.applyTo.getForm().submit()}},setSubmitted:function(){this.submitted=true}});ludo.card.NextButton=new Class({Extends:ludo.card.Button,type:"card.NextButton",value:"Next",addButtonEvents:function(){if(this.applyTo){var a=this.applyTo.getLayout();a.addEvent("valid",this.enable.bind(this));a.addEvent("invalid",this.disable.bind(this));if(!a.isValid()){this.disable()}if(this.autoHide){if(a.isOnLastCard()){this.hide()}else{this.show()}a.addEvent("lastcard",this.hide.bind(this));a.addEvent("notlastcard",this.show.bind(this))}else{if(a.isOnLastCard()){this.disable()}else{this.enable()}a.addEvent("lastcard",this.disable.bind(this));a.addEvent("notlastcard",this.enable.bind(this))}}this.addEvent("click",this.nextCard.bind(this))},enable:function(){if(this.applyTo.getLayout().isValid()){this.parent()}},nextCard:function(){if(this.applyTo){this.applyTo.getLayout().showNextCard()}}});ludo.card.PreviousButton=new Class({Extends:ludo.card.Button,type:"card.PreviousButton",value:"Previous",addButtonEvents:function(){this.addEvent("click",this.showPreviousCard.bind(this));if(this.applyTo){var a=this.applyTo.getLayout();if(this.autoHide){if(!a.isOnFirstCard()){this.show()}else{this.hide()}a.addEvent("firstcard",this.hide.bind(this));a.addEvent("notfirstcard",this.show.bind(this))}else{if(!a.isOnFirstCard()){this.enable()}else{this.disable()}a.addEvent("firstcard",this.disable.bind(this));a.addEvent("notfirstcard",this.enable.bind(this))}}},showPreviousCard:function(){if(this.applyTo){this.applyTo.getLayout().showPreviousCard()}}});ludo.progress.DataSource=new Class({Extends:ludo.dataSource.JSON,type:"progress.DataSource",singleton:true,autoload:false,progressId:undefined,stopped:false,pollFrequence:1,resource:"LudoDBProgress",service:"read",listenTo:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["pollFrequence","listenTo"]);if(this.listenTo){ludo.remoteBroadcaster.withResourceService(this.listenTo).on("start",this.startProgress.bind(this))}},startProgress:function(){this.inject();this.stopped=false;this.fireEvent("start");this.load.delay(1000,this)},inject:function(){ludo.remoteInject.add(this.listenTo,{LudoDBProgressID:this.getNewProgressBarId()})},loadComplete:function(a){this.fireEvent("load",a);if(a.percent<100&&!this.stopped){this.load.delay(this.pollFrequence*1000,this)}else{if(a.percent>=100){this.finish()}}},getNewProgressBarId:function(){this.progressId=this.progressId="ludo-progress-"+String.uniqueID();this.arguments=this.progressId;return this.progressId},getProgressId:function(){return this.progressId},stop:function(){this.stopped=true;this.fireEvent("stop")},proceed:function(){this.stopped=false;this.load()},finish:function(){this.stopped=true;this.progressId=undefined;this.fireEvent("finish");this.inject()}});ludo.progress.Base=new Class({Extends:ludo.View,applyTo:undefined,pollFrequence:1,url:undefined,onLoadMessage:"",hideOnFinish:true,defaultDS:"progress.DataSource",ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["applyTo","listenTo","pollFrequence","hideOnFinish"]);if(this.applyTo){this.applyTo=ludo.get(this.applyTo)}this.dataSource=this.dataSource||{};this.dataSource.pollFrequence=this.pollFrequence;this.dataSource.listenTo=this.listenTo;if(this.listenTo){ludo.remoteBroadcaster.withResourceService(this.listenTo).on("start",this.show.bind(this))
}this.getDataSource().addEvents({load:this.insertJSON.bind(this),start:this.start.bind(this),finish:this.finishEvent.bind(this)})},start:function(){this.fireEvent("start");this.insertJSON({text:"",percent:0})},hideAfterDelay:function(){this.hide.delay(1000,this)},getProgressBarId:function(){return this.getDataSource().getProgressId()},stop:function(){this.getDataSource().stop()},proceed:function(){this.getDataSource().proceed()},finish:function(){this.getDataSource().finish()},finishEvent:function(){if(this.hideOnFinish){this.hideAfterDelay()}this.fireEvent("finish")}});ludo.progress.Bar=new Class({Extends:ludo.progress.Base,type:"ProgressBar",width:300,height:35,progressBarWidth:0,currentPercent:0,stopped:false,hidden:true,fx:undefined,ludoRendered:function(){this.parent();this.createBackgroundForProgressBar();this.createMovablePartOfProgressBar();this.createTextElement();this.autoSetProgressWidth()},createBackgroundForProgressBar:function(){var b=this.els.progressBg=new Element("div");ludo.dom.addClass(b,"ludo-Progress-Bar-Bg");this.getBody().adopt(b);var c=this.els.progressBgRight=new Element("div");ludo.dom.addClass(c,"ludo-Progress-Bar-Bg-Left");b.adopt(c);var a=this.els.progressBgRight=new Element("div");ludo.dom.addClass(a,"ludo-Progress-Bar-Bg-Right");b.adopt(a)},createMovablePartOfProgressBar:function(){var b=this.els.progress=new Element("div");ludo.dom.addClass(b,"ludo-Progress-Bar");this.els.progressBg.adopt(b);this.els.progress.setStyle("width","0px");var c=this.els.progressLeft=new Element("div");ludo.dom.addClass(c,"ludo-Progress-Bar-Left");b.adopt(c);var a=this.els.progressRight=new Element("div");ludo.dom.addClass(a,"ludo-Progress-Bar-Right");b.adopt(a)},createTextElement:function(){var a=this.els.percent=new Element("div");ludo.dom.addClass(a,"ludo-Progress-Bar-Percent");this.els.progressBg.adopt(a)},resizeDOM:function(){this.parent();if(this.els.progressBg){this.autoSetProgressWidth()}},insertJSON:function(a){var b=a.data?a.data:a;this.setPercent(b.percent)},startProgress:function(){this.parent();this.stopped=false;this.setPercent(0);this.els.progress.style.width="0px";this.currentPercent=0},finish:function(){this.parent();this.setPercent(100)},autoSetProgressWidth:function(){if(!this.isVisible()){return}var a=parseInt(this.getBody().getStyle("width").replace("px",""));a-=ludo.dom.getMW(this.els.progressBg);this.setProgressBarWidth(a);this.setPercent(this.currentPercent)},setProgressBarWidth:function(a){if(isNaN(a)){return}this.progressBarWidth=a;this.els.progressBg.setStyle("width",a);this.progressBarWidth=a},setPercent:function(a){if(a==this.currentPercent){return}if(a===0&&this.currentPercent===100){this.els.progress.style.width="0px"}else{this.getFx().start({width:[this.currentPercent,a]})}this.currentPercent=a;this.els.percent.innerHTML=a+"%"},getCurrentPercent:function(){return this.currentPercent},animate:function(){if(this.currentPercent<100){this.currentPercent++;this.setPercent(this.currentPercent);this.animate.delay(50,this)}},getFx:function(){if(this.fx===undefined){this.fx=new Fx.Morph(this.els.progress,{duration:100,unit:"%"})}return this.fx}});ludo.card.ProgressBar=new Class({Extends:ludo.progress.Bar,hidden:false,applyTo:undefined,ludoEvents:function(){this.parent();if(this.applyTo){this.applyTo.getLayout().registerButton(this);this.applyTo.getLayout().addEvent("showcard",this.setCardPercent.bind(this))}},ludoRendered:function(){this.parent();if(this.applyTo){this.setCardPercent()}},setCardPercent:function(){this.setPercent(this.applyTo.getLayout().getPercentCompleted())},getProgressBarId:function(){return undefined}});ludo.calendar.Base=new Class({Extends:ludo.View,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthsLong:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["M","T","W","T","F","S","S"],headerWeek:"Week",ludoConfig:function(a){this.parent(a);this.date=new Date();this.translate()},translate:function(){for(var a=0;a<this.months.length;a++){this.months[a]=ludo.language.get(this.months[a]);this.monthsLong[a]=ludo.language.get(this.monthsLong[a])}for(a=0;a<this.days.length;a++){this.days[a]=ludo.language.get(this.days[a])}this.headerWeek=ludo.language.get(this.headerWeek)},setDate:function(a){this.date=a},getDate:function(){return this.date},sendSetDateEvent:function(){this.fireEvent("setdate",[this.date,this])},setValue:function(){}});ludo.calendar.Calendar=new Class({Extends:ludo.calendar.Base,layout:{type:"linear",orientation:"vertical"},value:undefined,children:[{type:"calendar.NavBar",name:"info"},{type:"calendar.Days",name:"days"},{type:"calendar.Today",name:"today"}],inputFormat:"Y-m-d",date:undefined,minDate:undefined,maxDate:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["inputFormat","value","minDate","maxDate","date"]);this.date=this.date||this.value;this.date=this.date?Date.parse(this.date):new Date();this.value=this.date;if(this.minDate){this.minDate=Date.parse(this.minDate)
}if(this.maxDate){this.maxDate=Date.parse(this.maxDate)}},setYear:function(a){this.date.set("year",a);this.setDate(this.date)},setDate:function(a,c){this.date=a;for(var b=0;b<this.children.length;b++){if(!c||this.children[b].id!==c.id){this.children[b].setDate(this.date)}}},getDate:function(){return this.value},getValue:function(){return this.value.format(this.inputFormat)},setValue:function(a){this.value=Date.parse(a);this.fireEvent("change",[this.value,this])},setMonth:function(a){a=a-1;this.date.set("month",a);this.setDate(this.date)},ludoRendered:function(){this.parent();for(var a=0;a<this.children.length;a++){var b=this.children[a];b.setDate(this.date);b.setValue(this.date);b.addEvent("setdate",this.setDate.bind(this));b.addEvent("change",this.setValue.bind(this))}this.getLayout().resize()}});ludo.calendar.Days=new Class({Extends:ludo.calendar.Base,layout:{weight:1},date:undefined,colWidthFirst:16,colWidthRest:12,showWeeks:true,sundayFirst:false,overflow:"hidden",week:undefined,value:undefined,touch:{enabled:false},ludoRendered:function(){this.parent();this.createCalendarHeader();this.createCalendarView()},ludoDOM:function(){this.parent();this.getBody().addClass("ludo-calendar-view")},ludoEvents:function(){this.parent();if(ludo.util.isTabletOrMobile()){var a=this.getBody();a.addEvent("touchstart",this.touchStart.bind(this));this.getEventEl().addEvent("touchmove",this.touchMove.bind(this));this.getEventEl().addEvent("touchend",this.touchEnd.bind(this))}},touchStart:function(a){this.touch={enabled:true,x1:a.page.x,x2:a.page.x,y1:a.page.y,y2:a.page.y};if(a.target.tagName.toLowerCase()=="window"){return false}return undefined},touchMove:function(c){if(this.touch.enabled){this.touch.x2=c.page.x;this.touch.y2=c.page.y;var b=this.touch.x2-this.touch.x1;var a=this.touch.y2-this.touch.y1;if(Math.abs(b)>Math.abs(a)){if(b>100){b=100}if(b<-100){b=-100}this.els.monthView.style.left=b+"px";this.els.monthView.style.top="0px"}else{if(a>100){a=100}if(a<-100){a=-100}this.els.monthView.style.top=a+"px";this.els.monthView.style.left="0px"}return false}return undefined},touchEnd:function(){if(this.touch.enabled){this.touch.enabled=false;var b=this.touch.x2-this.touch.x1;var a=this.touch.y2-this.touch.y1;var d=Math.abs(b);var c=Math.abs(a);if(d>100||c>100){if(d>c){this.data[b>0?"decrement":"increment"]("month",1)}else{this.data[a>0?"decrement":"increment"]("year",1)}this.sendSetDateEvent();this.showMonth()}this.els.monthView.style.left="0";this.els.monthView.style.top="0"}},createCalendarHeader:function(){var c=this.els.daysHeader=new Element("div");ludo.dom.addClass(c,"ludo-calendar-header");this.getBody().adopt(c);var b=["<table ",'cellpadding="0" cellspacing="0" border="0" width="100%">'];b.push(this.getColGroup().join(""));b.push("<tr>");var d=this.getTextForHeader();for(var a=0;a<d.length;a++){b.push("<td>"+d[a]+"</td>")}b.push("</tr>");b.push("</table>");c.set("html",b.join(""))},resizeDOM:function(){if(!this.els.daysContainer){this.resizeDOM.delay(10,this);return}this.parent();var d=this.getBody();var g=this.els.daysHeader;var f=d.getSize();var a=f.y-ludo.dom.getBH(d)-ludo.dom.getPH(d)-g.offsetHeight+ludo.dom.getMH(g);var j=this.els.daysContainer;a-=(ludo.dom.getMH(j)+ludo.dom.getPH(j)+ludo.dom.getBH(j));j.style.height=a+"px"},getColGroup:function(){var b=[];b.push("<colgroup>");b.push('<col width="'+this.colWidthFirst+'%" />');for(var a=0;a<7;a++){b.push('<col width="'+this.colWidthRest+'%" />')}b.push("</colgroup>");return b},getTextForHeader:function(){var a=[this.headerWeek];if(this.sundayFirst){a.push(this.days[this.days.length-1]);a=a.append(this.days.slice(0,this.days.length-1))}else{a=a.append(this.days)}return a},createCalendarView:function(){var a=this.els.daysContainer=new Element("div");ludo.dom.addClass(a,"ludo-calendar-container-days");a.setStyles({position:"relative",width:"100%",overflow:"hidden",left:0,top:0});a.addEvent("mousemove",this.mouseOverDays.bind(this));a.addEvent("mouseleave",this.removeClsFromMouseOverDay.bind(this));this.getBody().adopt(a)},showMonth:function(){if(this.els.monthView){this.els.monthView.dispose()}var a=this.els.monthView=new Element("div");a.addEvent("click",this.selectDay.bind(this));ludo.dom.addClass(a,"ludo-calendar-body-days");this.resizeMonthView();a.style.position="absolute";this.els.daysContainer.adopt(a);var f=["<table ",'cellpadding="0" cellspacing="0" border="0" width="100%" style="height:100%">'];f.push(this.getColGroup().join(""));var j=this.getDaysForView();var k="";var b=0;if(this.isValueMonth()){b=this.value.get("date")}var g=0;if(this.isOnTodaysMonth()){g=new Date().get("date")}var h=false;var c=false;for(var d=0;d<j.length;d++){k="";if(d%8==0){if(d){f.push("</tr>")}f.push("<tr>");k="calendar-week"}else{if(j[d]==1&&h){c=true}if(j[d]==1){h=true}k="calendar-day";if(!h||c){k=k+" calendar-day-inactive"}else{if((this.sundayFirst&&(d-1)%8==0)||(!this.sundayFirst&&(d+1)%8==0)){k=k+" calendar-sunday"}if(j[d]==b){k=k+" calendar-day-selected"}if(j[d]==g){k=k+" calendar-day-today"
}k=k+" calendar-day-"+j[d]}}f.push('<td class="'+k+'">'+j[d]+"</td>")}f.push("</table>");a.set("html",f.join(""));this.resizeMonthView.delay(20,this)},mouseOverDays:function(b){var a=b.target;this.removeClsFromMouseOverDay();if(!a.hasClass("calendar-day")||a.hasClass("calendar-day-inactive")){return}ludo.dom.addClass(a,"calendar-day-mouse-over");this.els.mouseOverDay=a},removeClsFromMouseOverDay:function(){if(this.els.mouseOverDay){ludo.dom.removeClass(this.els.mouseOverDay,"calendar-day-mouse-over");this.els.mouseOverDay=undefined}},isValueMonth:function(){return this.value?this.value.get("month")==this.date.get("month")&&this.value.get("year")==this.date.get("year"):false},isOnTodaysMonth:function(){var a=new Date();return a.get("month")==this.date.get("month")&&a.get("year")==this.date.get("year")},resizeMonthView:function(){this.els.monthView.style.width="100%"},getDaysForView:function(){var j=[];var a=this.date.clone();a.setDate("1");var h=a.clone().decrement("day",1);var b=a.getLastDayOfMonth();var c=a.getUTCDay();if(this.sundayFirst){c++;if(c>6){c=0}}var d;if(c>0||b<31){this.setStartWeek(h.get("week"));var k=h.getLastDayOfMonth();var g=c||7;j.push(this.getNextWeek());for(d=g-1;d>0;d--){j.push(k-d)}if(j.length%8==0){j.push(this.getNextWeek())}}else{this.setStartWeek(a.get("week"));j.push(this.getNextWeek())}for(d=1;d<=b;d++){j.push(d);if(j.length%8==0){j.push(this.getNextWeek())}}var f=j.length;for(d=j.length;d<48;d++){if(j.length<48){if(j.length%8==0){j.push(this.getNextWeek())}j.push(d-f+1)}}return j},selectDay:function(b){var a=b.target;if(!ludo.dom.hasClass(a,"calendar-day")){a=a.getParent(".calendar-day");if(!a){return}}if(ludo.dom.hasClass(a,"calendar-day-inactive")){return}this.removeClsFromSelectedDay();ludo.dom.addClass(a,"calendar-day-selected");this.value=this.date.clone();this.value.set("date",a.get("html"));this.fireEvent("change",[this.value,this])},removeClsFromSelectedDay:function(){if(this.els.monthView&&this.isValueMonth()){var a=this.els.monthView.getElement(".calendar-day-"+this.value.get("date"));if(a){ludo.dom.removeClass(a,"calendar-day-selected")}}},addClsForSelectedDay:function(){if(this.els.monthView&&this.isValueMonth()){var a=this.els.monthView.getElement(".calendar-day-"+this.value.get("date"));if(a){ludo.dom.addClass(a,"calendar-day-selected")}}},setStartWeek:function(a){this.week=a},getNextWeek:function(){var a=this.week;this.week++;if(this.week>53||(this.week>50&&this.date.get("month")==0)){this.week=1}return a},setDate:function(a){this.date=a;this.showMonth()},setValue:function(a){this.removeClsFromSelectedDay();this.value=a.clone();this.addClsForSelectedDay()}});ludo.calendar.NavBar=new Class({Extends:ludo.calendar.Base,type:"calendar.NavBar",height:20,date:undefined,layout:{type:"linear",orientation:"horizontal"},cls:"ludo-calendar-info-panel",children:[{type:"form.Button",size:"s",value:"<<",name:"previousyear",width:25},{type:"form.Button",size:"s",value:"<",name:"previous",width:25},{weight:1,name:"info",type:"calendar.MonthYearSelector"},{type:"form.Button",size:"s",name:"next",value:">",width:25},{type:"form.Button",size:"s",name:"nextyear",value:">>",width:25}],ludoRendered:function(){this.parent();this.child.previous.addEvent("click",this.goToPreviousMonth.bind(this));this.child.next.addEvent("click",this.goToNextMonth.bind(this));this.child.nextyear.addEvent("click",this.goToNextYear.bind(this));this.child.previousyear.addEvent("click",this.goToPreviousYear.bind(this))},goToPreviousMonth:function(){this.setDate(this.date.decrement("month",1));this.sendSetDateEvent()},goToNextMonth:function(){this.setDate(this.date.increment("month",1));this.sendSetDateEvent()},goToPreviousYear:function(){this.setDate(this.date.decrement("year",1));this.sendSetDateEvent()},goToNextYear:function(){this.setDate(this.date.increment("year",1));this.sendSetDateEvent()},setDate:function(a){this.date=a;this.showDate();this.child.info.setDate(a)},sendDate:function(a){this.date=a;this.sendSetDateEvent()},showDate:function(){this.child.info.addEvent("setdate",this.sendDate.bind(this))}});ludo.calendar.Selector=new Class({Extends:ludo.calendar.Base,height:25,date:undefined,minDate:undefined,maxDate:undefined,overflow:"hidden",minDisplayedYear:undefined,maxDisplayedYear:undefined,fx:undefined,offsetOptions:13,calCls:"ludo-calendar-year-container",ludoConfig:function(a){this.parent(a);this.els.options=[]},ludoRendered:function(){this.parent();this.createOptionsContainer();this.fx=new Fx.Tween(this.els.calendarContainer,{duration:200});this.renderOptions();this.autoResize()},createOptionsContainer:function(){var a=this.els.calendarContainer=new Element("div");a.addClass(this.calCls);a.setStyles({position:"absolute",width:"3000px",left:0,top:0});this.getBody().adopt(a)},autoResize:function(){var a=this.els.calendarContainer.getSize().y;a+=ludo.dom.getMH(this.els.calendarContainer);this.layout.height=a+ludo.dom.getMBPH(this.getBody())+ludo.dom.getMBPH(this.getEl())},resizeDOM:function(){this.parent();
if(this.els.activeOption){this.animateDomToCenter.delay(20,this,this.els.activeOption)}},removeOptions:function(){for(var a=0;a<this.els.options.length;a++){this.els.options[a].dispose()}this.els.options=[]},centerDom:function(a){a.getParent().style.marginLeft=this.getCenterPos(a)+"px"},animateDomToCenter:function(a){if(a&&a.getParent()){this.fx.start("margin-left",a.getParent().style.marginLeft,this.getCenterPos(a))}},getCenterPos:function(a){return Math.round((this.getBody().clientWidth/2)-a.offsetLeft-(a.offsetWidth/2))},setMinDate:function(a){this.minDate=a},setMaxDate:function(a){this.maxDate=a}});ludo.calendar.MonthSelector=new Class({Extends:ludo.calendar.Base,height:25,ludoRendered:function(){this.parent();this.createMonthContainer();this.renderMonths();this.autoResize()},autoResize:function(){var a=this.els.monthContainer.offsetHeight;a+=ludo.dom.getMH(this.els.monthContainer)+ludo.dom.getMBPH(this.getBody())+ludo.dom.getMBPH(this.getEl());this.layout.height=a},createMonthTooltip:function(){var a=this.els.monthTip=new Element("div");a.setStyles({position:"absolute",display:"none"});ludo.dom.addClass(a,"ludo-calendar-month-tip");ludo.dom.addClass(a,"ludo-calendar-month");a.addEvent("click",this.clickMonth.bind(this));this.els.monthContainer.adopt(a)},createMonthContainer:function(){var a=this.els.monthContainer=new Element("div");ludo.dom.addClass(a,"ludo-calendar-month-container");a.setStyles({position:"absolute",width:"3000px",left:0,top:0});this.getBody().adopt(a)},renderMonths:function(){this.els.monthContainer.set("html","");this.createMonthTooltip();var c=this.date.get("month");for(var a=0;a<this.months.length;a++){var b=new Element("div");ludo.dom.addClass(b,"ludo-calendar-month");b.setProperty("month",a);this.els.monthContainer.adopt(b);if(a==c){ludo.dom.addClass(b,"ludo-calendar-month-selected");b.set("html","<span>"+this.months[a]+"</span>");b.addEvent("mouseenter",this.hideTooltip.bind(this))}else{b.addEvent("mouseenter",this.showTooltip.bind(this));b.setProperty("title",this.months[a]);ludo.dom.addClass(b,"ludo-calendar-month-inactive")}b.addEvent("click",this.clickMonth.bind(this))}this.els.monthContainer.addEvent("mouseleave",this.hideTooltip.bind(this))},clickMonth:function(b){var a=this.getMonthEl(b.target);this.setMonth(a.getProperty("month"));this.sendSetDateEvent()},setDate:function(a){this.parent(a);this.renderMonths()},showTooltip:function(d){var a=this.getMonthEl(d.target);var b=this.els.monthTip;b.setProperty("month",a.getProperty("month"));var c=this.months[a.getProperty("month")];b.set("html",c);b.style.left=Math.max(0,a.offsetLeft)+"px";b.style.display=""},hideTooltip:function(){this.els.monthTip.style.display="none"},getMonthEl:function(a){if(!a.hasClass("ludo-calendar-month")){a=a.getParent(".ludo-calendar-month")}return a}});ludo.calendar.Today=new Class({Extends:ludo.calendar.Base,layout:{type:"relative"},height:25,overflow:"hidden",css:{"margin-top":2},ludoRendered:function(){this.parent();this.child.today.addEvent("click",this.setToday.bind(this))},getClassChildren:function(){return[{name:"today",type:"form.Button",value:ludo.language.get("Today"),layout:{centerInParent:true}}]},setDate:function(){},setToday:function(){this.date=new Date();this.sendSetDateEvent()}});ludo.calendar.YearSelector=new Class({Extends:ludo.calendar.Selector,minDisplayedYear:undefined,maxDisplayedYear:undefined,resizeDOM:function(){this.parent();if(this.els.activeOption){this.animateDomToCenter(this.els.activeOption)}},renderOptions:function(){this.removeOptions();this.els.activeOption=undefined;var c=this.date.get("year");for(var a=c-this.offsetOptions;a<c+this.offsetOptions;a++){var b=this.getDomForAYear(a);this.els.calendarContainer.adopt(b);this.els.options.push(b)}this.setMinAndMaxDisplayed()},setMinAndMaxDisplayed:function(){this.minDisplayedYear=this.date.clone().decrement("year",this.offsetOptions).get("year");this.maxDisplayedYear=this.date.clone().increment("year",this.offsetOptions).get("year")},getDomForAYear:function(b){var a=new Element("div");a.set("html","<span>"+b+"</span>");a.setProperty("year",b);ludo.dom.addClass(a,"ludo-calendar-year");if(b==this.date.get("year")){ludo.dom.addClass(a,"ludo-calendar-year-selected");this.els.activeOption=a}a.addEvent("click",this.clickYear.bind(this));return a},clickYear:function(b){var a=b.target;if(!a.hasClass("ludo-calendar-year")){a=a.getParent(".ludo-calendar-year")}this.date.set("year",a.getProperty("year"));this.setDate(this.date);this.sendSetDateEvent()},setDate:function(a){this.date=a;this.addAndRemoveOptions();if(this.els.activeOption){this.centerDom(this.els.activeOption);this.els.activeOption.removeClass("ludo-calendar-year-selected")}this.els.activeOption=this.getDomElForCurrentYear();if(this.els.activeOption){ludo.dom.addClass(this.els.activeOption,"ludo-calendar-year-selected");this.animateDomToCenter.delay(20,this,this.els.activeOption)}},addAndRemoveOptions:function(){var b=this.date.get("year");var a=Math.round((this.maxDisplayedYear+this.minDisplayedYear)/2);
if(b<this.minDisplayedYear||b>this.maxDisplayedYear){this.renderOptions()}else{if(b<a){this.insertYearsBefore(a-b)}else{this.insertYearsAfter(b-a)}}this.setMinAndMaxDisplayed()},insertYearsBefore:function(f){var b=[];for(var a=f;a>0;a--){var d=this.minDisplayedYear-a;var c=this.getDomForAYear(d);c.inject(this.els.options[0],"before");b.push(c);this.els.options[this.els.options.length-1].dispose();this.els.options.length--}this.els.options=b.append(this.els.options)},insertYearsAfter:function(d){for(var a=1;a<=d;a++){var c=this.maxDisplayedYear+a;var b=this.getDomForAYear(c);this.els.calendarContainer.adopt(b);this.els.options.push(b);this.els.options[a-1].dispose()}this.els.options=this.els.options.slice(d)},getDomElForCurrentYear:function(){var b=this.date.get("year");var c=this.els.options;for(var a=0;a<c.length;a++){if(c[a].getProperty("year")==b){return c[a]}}return undefined}});ludo.calendar.MonthYearSelector=new Class({Extends:ludo.calendar.Selector,height:25,minDisplayed:undefined,maxDisplayed:undefined,fx:undefined,date:undefined,calCls:"ludo-calendar-month-year-container",renderOptions:function(){this.removeOptions();this.els.activeOption=undefined;for(var a=this.offsetOptions*-1;a<=this.offsetOptions;a++){var b=this.getDomForAMonth(a);this.els.calendarContainer.adopt(b);this.els.options.push(b)}this.setMinAndMaxDisplayed()},setMinAndMaxDisplayed:function(){var a=this.date.clone();this.minDisplayed=a.decrement("month",this.offsetOptions);a=this.date.clone();this.maxDisplayed=a.increment("month",this.offsetOptions)},getDomForAMonth:function(c){var f=this.date.clone().increment("month",c);var a=this.months[f.get("month")];var b=new Element("div");b.setProperties({year:f.get("year"),month:f.get("month")});ludo.dom.addClass(b,"ludo-calendar-month-year");if(c==0){ludo.dom.addClass(b,"ludo-calendar-month-year-selected");this.els.activeOption=b}b.set("html","<span>"+a+"</span>");b.addEvent("click",this.clickMonth.bind(this));return b},clickMonth:function(b){var a=b.target;if(!a.hasClass("ludo-calendar-month-year")){a=a.getParent(".ludo-calendar-month-year")}this.setMonthAndYear(a.getProperty("month"),a.getProperty("year"));this.sendSetDateEvent()},setMonthAndYear:function(b,a){this.date.set("month",b);this.date.set("year",a);this.refreshView()},setDate:function(a){this.parent(a);this.refreshView()},refreshView:function(){this.addAndRemoveOptions();if(this.els.activeOption){this.centerDom(this.els.activeOption);this.els.activeOption.set("html",this.months[this.els.activeOption.getProperty("month")]);this.els.activeOption.removeClass("ludo-calendar-month-year-selected")}this.els.activeOption=this.getNewActiveOption();this.populateActiveMonth();this.animateDomToCenter.delay(20,this,this.els.activeOption)},populateActiveMonth:function(){ludo.dom.addClass(this.els.activeOption,"ludo-calendar-month-year-selected");this.els.activeOption.set("html",this.months[this.date.get("month")]+", "+this.date.get("year"))},addAndRemoveOptions:function(){var b=this.date.clone().decrement("month",this.offsetOptions);var a=this.date.clone().increment("month",this.offsetOptions);if(a<this.minDisplayed||b>this.maxDisplayed){this.renderOptions()}else{var c=this.date.diff(this.minDisplayed,"month")+this.offsetOptions;if(c>0){this.insertMonthBefore(c)}else{this.insertMonthAfter(c*-1)}}this.setMinAndMaxDisplayed()},insertMonthBefore:function(f){var c=[];for(var b=0;b<f;b++){var a=b-this.offsetOptions;var d=this.getDomForAMonth(a);d.inject(this.els.options[0],"before");c.push(d);this.els.options[this.els.options.length-1].dispose();this.els.options.length--}this.els.options=c.append(this.els.options)},insertMonthAfter:function(d){for(var b=d;b>0;b--){var a=this.offsetOptions-b+1;var c=this.getDomForAMonth(a);this.els.calendarContainer.adopt(c);this.els.options.push(c);this.els.options[b-1].dispose()}this.els.options=this.els.options.slice(d)},getNewActiveOption:function(){var b=this.date.get("year"),c=this.date.get("month");for(var a=0;a<this.els.options.length;a++){if(this.els.options[a].getProperty("year")==b&&this.els.options[a].getProperty("month")==c){return this.els.options[a]}}return undefined}});ludo.menu.Item=new Class({Extends:ludo.View,type:"menu.Item",menu:null,subMenu:null,menuItems:[],spacer:undefined,icon:undefined,orientation:"vertical",disabled:false,label:"",action:undefined,record:undefined,fire:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["orientation","icon","record","value","label","action","disabled","fire"]);this.html=this.html||this.label;if(this.html==="|"){this.spacer=true;this.layout.height=1}else{this.layout.height=this.layout.height||this.orientation==="vertical"?25:"matchParent"}},ludoEvents:function(){this.parent();if(!this.isSpacer()){this.getEl().addEvents({click:this.click.bind(this),mouseenter:this.mouseOver.bind(this),mouseleave:this.mouseOut.bind(this)})}},resizeDOM:function(){this.parent();this.getBody().style.lineHeight=this.cachedInnerHeight+"px"},resizeParent:function(){},ludoDOM:function(){this.parent();
ludo.dom.addClass(this.getEl(),"ludo-menu-item");if(this.isSpacer()){if(this.orientation==="horizontal"){this.getEl().setStyle("width",1)}ludo.dom.addClass(this.getEl(),"ludo-menu-item-spacer-"+this.orientation)}ludo.dom.addClass(this.getEl(),"ludo-menu-item-"+this.orientation);if(this.icon){this.createIcon()}if(this.disabled){this.disable()}if(this.children.length){var a=this.els.expand=new Element("div");ludo.dom.addClass(a,"ludo-menu-item-expand");ludo.dom.addClass(a,"ludo-menu-item-"+this.orientation+"-expand");this.getEl().adopt(a)}},getLabel:function(){return this.label},getRecord:function(){return this.record},ludoRendered:function(){this.parent();if(this.isSpacer()){this.getBody().setStyle("visibility","hidden")}},click:function(){if(this.disabled){return}ludo.dom.addClass(this.getEl(),"ludo-menu-item-down");this.fireEvent("click",this);if(this.fire){this.fireEvent(this.fire,this)}},select:function(){ludo.dom.addClass(this.getEl(),"ludo-menu-item-selected")},deselect:function(){this.getEl().removeClass("ludo-menu-item-selected")},disable:function(){this.disabled=true;ludo.dom.addClass(this.getEl(),"ludo-menu-item-disabled")},isDisabled:function(){return this.disabled},enable:function(){this.disabled=false;this.getEl().removeClass("ludo-menu-item-disabled")},createIcon:function(){var a=this.els.icon=new Element("div");ludo.dom.addClass(a,"ludo-menu-item-icon");a.setStyles({"background-position":"center center","background-repeat":"no-repeat",position:"absolute","text-align":"center",left:0,top:0,height:"100%"});if(this.icon.indexOf(".")>=0){a.setStyle("background-image","url("+this.icon+")")}else{a.set("html",this.icon)}this.getEl().adopt(a)},mouseOver:function(){if(!this.disabled){ludo.dom.addClass(this.getEl(),"ludo-menu-item-over")}this.fireEvent("enterMenuItem",this)},mouseOut:function(){if(!this.disabled){this.getEl().removeClass("ludo-menu-item-over");this.getEl().removeClass("ludo-menu-item-down");this.fireEvent("leaveMenuItem",this)}},isSpacer:function(){return this.spacer},showMenu:function(){this.menuHandler.showMenu(this)}});ludo.menu.Menu=new Class({Extends:ludo.View,type:"menu.Menu",layout:{type:"Menu",orientation:"vertical",width:"wrap",height:"wrap"},addCoreEvents:function(){}});ludo.menu.Context=new Class({Extends:ludo.View,type:"menu.Context",layout:{type:"Menu",orientation:"vertical",width:"wrap",height:"wrap",active:true,isContext:true},renderTo:document.body,selector:undefined,component:undefined,record:undefined,recordType:undefined,contextEl:undefined,ludoConfig:function(a){this.renderTo=document.body;this.parent(a);this.setConfigParams(a,["selector","recordType","record","applyTo","contextEl"]);if(this.recordType){this.record={type:this.recordType}}},ludoDOM:function(){this.parent();this.getEl().style.position="absolute"},ludoEvents:function(){this.parent();document.id(document.documentElement).addEvent("click",this.hideAfterDelay.bind(this));if(this.contextEl){document.id(this.contextEl).addEvent("contextmenu",this.show.bind(this))}},hideAfterDelay:function(){if(!this.isHidden()){this.hide.delay(50,this)}},ludoRendered:function(){this.parent();this.hide()},getSelectedRecord:function(){return this.selectedRecord},show:function(d){if(this.selector){var a=this.getValidDomElement(d.target);if(!a){return undefined}this.fireEvent("selectorclick",a)}if(this.record){var c=this.applyTo.getRecordByDOM(d.target);if(!c){return undefined}if(this.isContextMenuFor(c)){this.selectedRecord=c}}ludo.EffectObject.fireEvents();this.getLayout().hideAllMenus();this.parent();if(!this.getParent()){var b=this.getEl();var f=this.getXAndYPos(d);b.style.left=f.x+"px";b.style.top=f.y+"px"}return false},isContextMenuFor:function(a){for(var b in this.record){if(this.record.hasOwnProperty(b)){if(!a[b]||this.record[b]!==a[b]){return false}}}return true},getXAndYPos:function(f){var c={x:f.page.x,y:f.page.y};var g=document.body.clientWidth;var b=document.body.clientHeight;var d=this.getEl().getSize();var a=c.x+d.x;var h=c.y+d.y;if(a>g){c.x-=(a-g)}if(h>b){c.y-=(h-b)}return c},addCoreEvents:function(){},getValidDomElement:function(c){if(!this.selector){return true}var a=this.selector.replace(/[\.#]/g,"");if(c.hasClass(a)||c.id==a){return c}var b=c.getParent(this.selector);if(b){return b}return false}});ludo.menu.DropDown=new Class({Extends:ludo.menu.Menu,type:"menu.DropDown",ludoConfig:function(a){a.renderTo=document.body;this.parent(a);this.setConfigParams(a,["applyTo"]);this.layout.below=this.layout.below||this.applyTo;this.layout.alignLeft=this.layout.alignLeft||this.applyTo},ludoEvents:function(){this.parent();document.id(document.documentElement).addEvent("click",this.hideAfterDelay.bind(this))},hideAfterDelay:function(){if(!this.isHidden()){this.hide.delay(50,this)}},toggle:function(){if(this.isHidden()){this.show()}else{this.hide()}}});ludo.menu.Button=new Class({Extends:ludo.Core,width:15,renderTo:undefined,alwaysVisible:false,region:"ne",el:undefined,menu:undefined,menuCreated:false,autoPosition:true,toggleOnClick:false,ludoConfig:function(a){this.parent(a);
this.setConfigParams(a,["alwaysVisible","region","renderTo","menu","autoPosition","toggleOnClick"])},ludoEvents:function(){this.parent();this.ludoDOM();this.createButtonEvents()},ludoDOM:function(){var a=this.el=new Element("div");a.id="ludo-menu-button-"+String.uniqueID();ludo.dom.addClass(a,"ludo-menu-button");document.id(this.renderTo).adopt(a);a.setStyles({position:"absolute",height:"100%"});this.createButtonEl();this.positionButton()},createButtonEvents:function(){this.buttonEl.addEvent("click",this.toggle.bind(this));ludo.EffectObject.addEvent("start",this.hideMenu.bind(this));this.buttonEl.addEvent("mouseenter",this.enterButton.bind(this));this.buttonEl.addEvent("mouseleave",this.leaveButton.bind(this));if(!this.alwaysVisible){var a=document.id(this.renderTo);a.addEvent("mouseenter",this.show.bind(this));a.addEvent("mouseleave",this.hide.bind(this));this.hide()}else{this.show()}},enterButton:function(){ludo.dom.addClass(this.el,"ludo-menu-button-over")},leaveButton:function(){ludo.dom.removeClass(this.el,"ludo-menu-button-over")},toggle:function(a){a.stop();if(this.toggleOnClick&&this.menuCreated){this.menu[this.menu.isHidden()?"show":"hide"]()}else{this.showMenu()}},createButtonEl:function(){var a=this.buttonEl=new Element("div");ludo.dom.addClass(a,"ludo-menu-button-arrow");this.getEl().adopt(a)},positionButton:function(){var b=this.getEl();var a=this.region;if(a=="ne"||a=="se"){b.setStyle("right",0)}if(a=="nw"||a=="sw"){b.setStyle("left",0)}if(a=="se"||a=="sw"){b.setStyle("bottom",0)}if(a=="ne"||a=="nw"){b.setStyle("top",0)}},getEl:function(){return this.el},showMenu:function(){if(!this.menuCreated){this.createMenuView()}if(this.menu._button&&this.menu._button!==this.id){var a=ludo.get(this.menu._button);if(a){a.hideButton()}}this.menu._button=this.id;this.menu.show();this.positionMenu();this.fireEvent("show",this)},cancelShow:function(){this.okToShowButton=false},hideMenu:function(){if(this.menu.hidden){return}if(this.menu.hide!==undefined){if(this.menu.getLayout().hideAllMenus){this.menu.getLayout().hideAllMenus()}this.menu.hide()}this.hide()},createMenuView:function(){if(this.menu.id){var a=ludo.get(this.menu.id);if(a){this.menu=a}}this.menuCreated=true;if(this.menu.getEl===undefined){this.menu.renderTo=document.body;this.menu.type=this.menu.type||"View";this.menu.hidden=true;this.menu=this.createDependency("menuForButton",this.menu);this.menu._button=this.getEl().id;document.body.addEvent("mouseup",this.autoHideMenu.bind(this))}else{document.body.adopt(this.menu.getEl())}this.menu.addEvent("show",this.showIf.bind(this));this.menu.addEvent("hide",this.hideButton.bind(this));this.menu.getEl().style.position="absolute";this.menu.getEl().addClass("ludo-menu-button-menu")},positionMenu:function(){if(this.autoPosition){var a=this.el.getCoordinates();this.menu.resize({left:a.left,top:a.top+a.height})}},showIf:function(){if(this.menu._button===this.id){this.show()}},okToShowButton:false,show:function(){this.okToShowButton=true;this.fireEvent("beforeShow",this);if(this.okToShowButton){this.buttonEl.style.display="";ludo.dom.addClass(this.el,"ludo-menu-button-active")}},hide:function(){if(this.menu===undefined||this.menu.isHidden===undefined||this.menu.isHidden()){this.hideButton()}else{if(this.menu._button!==this.id){this.hideButton()}}},hideButton:function(){if(this.alwaysVisible){return}this.buttonEl.style.display="none";ludo.dom.removeClass(this.el,"ludo-menu-button-active")},getMenuView:function(){return this.menu},autoHideMenu:function(a){if(!this.menu||this.menu.hidden){return}if(!ludo.dom.isInFamilies(a.target,[this.el.id,this.menu.getEl().id])){this.hideMenu();this.hideButton()}}});ludo.dataSource.TreeCollection=new Class({Extends:ludo.dataSource.Collection,type:"dataSource.TreeCollection",searcherType:"dataSource.TreeCollectionSearch",getChildren:function(a){var b=this.findRecord(a);if(b){if(!b.children){b.children=[]}return b.children}return undefined},fireSelect:function(a){this.fireEvent("select",this.getRecord(a))},addRecordEvents:function(a){this.parent(a);a.addEvent("addChild",this.indexRecord.bind(this));a.addEvent("insertBefore",this.indexRecord.bind(this));a.addEvent("insertAfter",this.indexRecord.bind(this));var c=["insertBefore","insertAfter","addChild","removeChild"];for(var b=0;b<c.length;b++){a.addEvent(c[b],this.fireRecordEvent.bind(this))}},fireRecordEvent:function(a,c,b){this.fireEvent(b,[a,c])},addSearcherEvents:function(){this.searcher.addEvent("match",function(a){this.fireEvent("show",this.getRecord(a))}.bind(this));this.searcher.addEvent("mismatch",function(a){this.fireEvent("hide",this.getRecord(a))}.bind(this))}});ludo.tree.Tree=new Class({Extends:ludo.CollectionView,type:"tree.Tree",nodeCache:{},renderedRecords:{},tpl:'<span class="ludo-tree-node-spacer"></span> {title}',tplKey:undefined,dataSource:{},defaultDS:"dataSource.TreeCollection",defaults:undefined,categoryKey:"type",categoryConfig:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["defaults","categoryConfig","categoryKey"])
},ludoEvents:function(){this.parent();if(this.dataSource){this.getDataSource().addEvents({select:this.selectRecord.bind(this),deselect:this.deSelectRecord.bind(this),add:this.addRecord.bind(this),addChild:this.addChild.bind(this),dispose:this.removeChild.bind(this),removeChild:this.removeChild.bind(this),show:this.showRecord.bind(this),hide:this.hideRecord.bind(this)})}},ludoDOM:function(){this.parent();this.getBody().style.overflowY="auto";this.getBody().addEvents({click:this.onClick.bind(this),dblclick:this.onDblClick.bind(this)})},onClick:function(b){var a=this.getRecordByDOM(b.target);if(a){if(b.target.tagName.toLowerCase()==="span"&&this.isSelectable(a)){this.getDataSource().selectRecord(a)}if(ludo.dom.hasClass(b.target,"ludo-tree-node-expand")){this.expandOrCollapse(a,b.target)}else{this.expand(a,b.target)}}},onDblClick:function(b){var a=this.getRecordByDOM(b.target);if(a){this.fireEvent("dblClick",a)}},selectRecord:function(a){if(!a.getPlainRecord){a=this.getDataSource().getRecord(a)}if(!a){return}if(!this.isRecordRendered(a)){this.showRecord(a)}var b=this.getDomElement(a,".ludo-tree-node-plain");if(b){ludo.dom.addClass(b,"ludo-tree-selected-node")}},deSelectRecord:function(a){var b=this.getDomElement(a,".ludo-tree-node-plain");if(b){ludo.dom.removeClass(b,"ludo-tree-selected-node")}},getDomElement:function(b,a){var c=this.getDomByRecord(b);if(c){return document.id(c).getFirst(a)}return undefined},expandOrCollapse:function(a,b){b=this.getExpandEl(a);var c=ludo.dom.hasClass(b,"ludo-tree-node-collapse")?"collapse":"expand";this[c](a,b)},expand:function(a,b){b=this.getExpandEl(a);if(!this.areChildrenRendered(a)){this.renderChildrenOf(a)}ludo.dom.addClass(b,"ludo-tree-node-collapse");this.getCachedNode(a,"children","child-container-").style.display=""},collapse:function(a,b){b=this.getExpandEl(a);ludo.dom.removeClass(b,"ludo-tree-node-collapse");this.getCachedNode(a,"children","child-container-").style.display="none"},getExpandEl:function(a){return this.getCachedNode(a,"expand","expand-")},getChildContainer:function(a){return this.getCachedNode(a,"children","child-container-")},hideRecord:function(a){if(this.isRecordRendered(a)){this.getCachedNode(a,"node","").style.display="none"}},showRecord:function(a){if(!this.isRecordRendered(a)){this.showRecord(a.getParent());this.expand(a.getParent());this.showRecord(a.getParent())}this.getCachedNode(a,"node","").style.display=""},getDomByRecord:function(a){return a?this.getCachedNode(a,"node",""):undefined},isRecordRendered:function(a){return this.renderedRecords[a.getUID?a.getUID():a.uid]?true:false},areChildrenRendered:function(a){a=a.getUID?a.record:a;return a.children&&a.children.length?this.isRecordRendered(a.children[0]):false},getCachedNode:function(a,d,c){if(this.nodeCache[d]===undefined){this.nodeCache[d]={}}var b=a.getUID?a.getUID():a.uid;if(!this.nodeCache[d][b]){this.nodeCache[d][b]=this.getBody().getElementById(c+b)}return this.nodeCache[d][b]},getRecordByDOM:function(c){var a=this.getBody();while(c!==a&&(!c.className||c.className.indexOf("ludo-tree-a-node")===-1)){c=c.parentNode}if(c){return this.getDataSource().getRecord(c.id)}return undefined},insertJSON:function(){this.nodeCache={};this.renderedRecords={};this.nodeContainer().innerHTML="";this.render()},render:function(){this.parent();var a=this.getDataSource().getData();this.nodeContainer().innerHTML=this.getHtmlForBranch(a)},getHtmlForBranch:function(c){var b=[];for(var a=0;a<c.length;a++){b.push(this.getHtmlFor(c[a],(a===c.length-1),true))}return b.join("")},renderChildrenOf:function(a){var b=this.getChildContainer(a);if(b){var d=a.getChildren();if(d){b.innerHTML=this.getHtmlForBranch(d)}}},getHtmlFor:function(a,d,c){var b=[];this.renderedRecords[a.uid]=true;if(c){b.push('<div class="ludo-tree-a-node ludo-tree-node');if(d){b.push(" ludo-tree-node-last-sibling")}b.push('" id="'+a.uid+'">')}b.push('<div class="ludo-tree-node-plain">');b.push(this.isSelectable(a)?'<span class="ludo-tree-node-selectable">':"<span>");b.push(this.getNodeTextFor(a));b.push("</span>");b.push('<div class="ludo-tree-node-expand" id="expand-'+a.uid+'" style="position:absolute;display:'+(a.children&&a.children.length?"":"none")+'"></div>');b.push("</div>");b.push('<div class="ludo-tree-node-container" style="display:none" id="child-container-');b.push(a.uid);b.push('">');b.push("</div>");if(c){b.push("</div>")}this.fireEvent("createNode",[a.uid,a,this]);return b.join("")},isSelectable:function(a){if(this.categoryConfig){a=a.getUID?a.getData():a;var b=this.categoryConfig[a[this.categoryKey]];return b&&b.selectable!==undefined?b.selectable:true}return true},getNodeTextFor:function(a){var d=this.getTplFields(a);var b=this.getTpl(a);for(var c=0,f=d.length;c<f;c++){var g=d[c];b=b.replace("{"+g+"}",a[g]?a[g]:this.getDefaultValue(a,g))}b='<span class="ludo-tree-node-spacer"></span>'+b;return b},getDefaultValue:function(a,c){if(this.defaults){var b=this.categoryKey;return a[b]&&this.defaults&&this.defaults[a[b]]?this.defaults[a[b]][c]:""
}return""},tpls:undefined,getTpl:function(a){return this.tpl.tplKey?this.tpl[a[this.tplKey]]:this.tpl},getTplFields:function(a){if(!this.tplFields){if(ludo.util.isString(this.tpl)){this.tplFields=this.getTplMatches(this.tpl)}else{this.tplFields={};var b=Object.clone(this.tpl);this.tplKey=b.tplKey;for(var c in b){if(b.hasOwnProperty(c)){if(c!="tplKey"){this.tplFields[c]=this.getTplMatches(b[c])}}}}}return this.tplKey?this.tplFields[a[this.tplKey]]:this.tplFields},getTplMatches:function(a){var c=a.match(/{([^}]+)}/g);for(var b=0;b<c.length;b++){c[b]=c[b].replace(/[{}]/g,"")}return c},addRecord:function(a){this.addChild(a)},addChild:function(b,c){var a=c?this.getChildContainer(c):this.getBody();if(a){var d=this.getDomByRecord(b)||this.getNewNodeFor(b);a.appendChild(d);this.cssBranch(c?c.children:this.getDataSource().data);if(c){this.getExpandEl(c).style.display=""}}},getNewNodeFor:function(a){a=a.getUID?a.record:a;if(!a.uid){this.getDataSource().indexRecord(a)}return ludo.dom.create({cls:"ludo-tree-a-node ludo-tree-node",html:this.getHtmlFor(a,false,false),id:a.uid})},cssBranch:function(a){var d=a.length;for(var b=Math.max(0,d-2);b<d;b++){var c=this.getDomByRecord(a[b]);if(c){if(b<d-1){ludo.dom.removeClass(c,"ludo-tree-node-last-sibling")}else{ludo.dom.addClass(c,"ludo-tree-node-last-sibling")}}}},removeChild:function(a){var b=this.getDomByRecord(a);if(b){b.parentNode.removeChild(b);delete this.renderedRecords[this.getUID(a)];if(a.parentUid){var c=this.dataSource.findRecord(a.parentUid);if(c){this.cssBranch(c.children)}}}},getUID:function(a){return a.getUID?a.getUID():a.uid}});ludo.dataSource.HTML=new Class({Extends:ludo.dataSource.Base,type:"dataSource.HTML",getSourceType:function(){return"HTML"},load:function(){this.parent();this.sendRequest(this.service,this.arguments,this.getPostData())},loadComplete:function(a){this.parent();this.data=a;this.fireEvent("load",this.data)},_request:undefined,requestHandler:function(){if(this._request===undefined){this._request=new ludo.remote.HTML({shim:this.shim,url:this.url,resource:this.resource,listeners:{beforeload:function(a){this.fireEvent("beforeload",a)},success:function(a){this.loadComplete(a.getResponseData(),a.getResponse())}.bind(this),error:function(a){this.fireEvent("servererror",[a.getResponseMessage(),a.getResponseCode()])}.bind(this)}})}return this._request}});ludo.dataSource.TreeCollectionSearch=new Class({Extends:ludo.dataSource.CollectionSearch,matchesFound:false,performSearch:function(){this.matchesFound=false;this.performSearchIn(this.getDataFromSource());if(!this.matchesFound){this.fireEvent("noMatches")}else{this.fireEvent("matches")}},performSearchIn:function(b){for(var a=0;a<b.length;a++){if(this.isMatchingSearch(b[a])){this.searchResult.push(b[a]);this.fireEvent("match",b[a]);this.matchesFound=true;if(b[a].children){this.performSearchIn(b[a].children)}}else{this.fireEvent("mismatch",b[a])}}}});ludo.controller.Manager=new Class({Extends:ludo.Core,controllers:[],components:[],registerController:function(a){this.controllers.push(a);for(var b=0;b<this.components.length;b++){var d=this.components[b];if(a.shouldBeControllerFor(d)){this.assignControllerTo(a,d)}}},registerComponent:function(b){if(!b.hasController()){this.components.push(b);var a=this.getControllerFor(b);if(a){this.assignControllerTo(a,b)}}},getControllerFor:function(a){for(var b=0;b<this.controllers.length;b++){if(this.controllers[b].shouldBeControllerFor(a)){return this.controllers[b]}}return undefined},assignSpecificControllerFor:function(a,b){if(typeof a==="string"){a=ludo.get(a);if(a){this.assignControllerTo(a,b)}return}a=b.createDependency("controller-"+String.uniqueID(),a);this.assignControllerTo(a,b)},assignControllerTo:function(a,b){b.setController(a);a.addBroadcastFor(b);a.addView(b)}});ludo.controllerManager=new ludo.controller.Manager();ludo.controller.Controller=new Class({Extends:ludo.Core,type:"controller.Controller",applyTo:undefined,id:undefined,components:[],controller:undefined,useController:false,broadcast:undefined,ludoConfig:function(a){a=a||{};a.controller=undefined;a.useController=false;this.parent(a);if(a.broadcast){this.broadcast=a.broadcast}ludo.controllerManager.registerController(this);if(this["addView"]==undefined){alert("You need to implement an addView method for the controller ("+this.type+")")}},addBroadcastFor:function(a){if(this.broadcast&&this.broadcast[a.type]!==undefined){var c=this.broadcast[a.type];for(var b=0;b<c.length;b++){var d=this.getBroadcastEventNames(c[b]);a.addEvent(d.component,this.getBroadcastFn(d.controller).bind(this))}}},getBroadcastFn:function(a){return function(){this.fireEvent(a,arguments)}},getBroadcastEventNames:function(b){if(typeof b=="object"){for(var a in b){if(b.hasOwnProperty(a)){return{component:a,controller:b[a]}}}}return{component:b,controller:b}},shouldBeControllerFor:function(a){if(a===this){return false}if(!this.applyTo){return this.isInSameNamespaceAs(a)}var b=this.getModuleKeyFor(a);if(this.isAppliedDirectlyToModule(b)){return true
}return this.isAppliedIndirectlyToModule(b)},getModuleKeyFor:function(a){return a.module+(a.submodule?"."+a.submodule:"")},isAppliedDirectlyToModule:function(a){return(this.applyTo.indexOf(a)===0)},isAppliedIndirectlyToModule:function(a){for(var b=0;b<this.applyTo.length;b++){if(a.indexOf(this.applyTo[b])===0){return true}}return false},isInSameNamespaceAs:function(a){return this.getNamespace()==a.getNamespace()}});ludo.getController=function(a){if(a.substr){a=ludo.get(a)}return a};ludo.progress.Text=new Class({Extends:ludo.progress.Base,type:"progress.Text",width:300,height:30,stopped:false,hidden:true,tpl:"{text}"});ludo.form.ToggleGroup=new Class({Extends:ludo.Core,type:"form.ToggleGroup",singleton:true,buttons:[],activeButton:undefined,ludoConfig:function(a){this.parent(a)},addButton:function(a){this.buttons.push(a);a.addEvent("on",this.buttonClickEvent.bind(this));a.addEvent("off",this.buttonClickEvent.bind(this));if(a.isActive()){this.buttonClick(a)}},buttonClickEvent:function(b,a){this.buttonClick(a)},buttonClick:function(a){if(this.activeButton&&this.activeButton.isActive()){this.activeButton.turnOff()}if(a.isActive()){this.activeButton=a;this.fireEvent("on",[a.getValue(),a])}else{this.activeButton=undefined;this.fireEvent("off",[a.getValue(),a])}},turnOn:function(a){if(a=this.getButton(a)){a.turnOn()}},turnOff:function(a){if(a=this.getButton(a)){a.turnOff()}},getButton:function(b){if(ludo.util.type(b)==="String"){for(var a=0;a<this.buttons.length;a++){if(this.buttons[a].getValue()==b){return this.buttons[a]}}}return b},getValue:function(){return this.activeButton.getValue()}});ludo.form.Manager=new Class({Extends:ludo.Core,view:null,formComponents:[],map:{},fileUploadComponents:[],progressBar:undefined,invalidIds:[],dirtyIds:[],form:{method:"post"},record:undefined,resource:undefined,service:undefined,method:undefined,url:undefined,currentId:undefined,autoLoad:false,listeners:undefined,cacheStorage:{},cache:false,cacheTimeout:undefined,updateCacheOnChange:true,arguments:undefined,ludoConfig:function(a){this.view=a.view;a.form=a.form||{};this.setConfigParams(a.form,["resource","method","url","autoLoad","cache","service"]);this.id=String.uniqueID();if(a.form.listeners!==undefined){this.addEvents(a.form.listeners)}this.getFormElements();if(this.autoLoad){this.read(a.form.arguments)}},getFormElements:function(){if(!this.view.isRendered){this.getFormElements.delay(100,this);return}var d=this.view.getAllChildren();d.push(this.view);var f;for(var b=0,a=d.length;b<a;b++){f=d[b];if(f.getProgressBarId!==undefined){this.registerProgressBar(f)}else{if(f.isFormElement()){this.registerFormElement(f)}}}this.fireEvent((this.invalidIds.length==0)?"valid":"invalid");this.fireEvent((this.dirtyIds.length==0)?"clean":"dirty")},registerFormElement:function(a){if(this.formComponents.indexOf(a)>=0){return}this.map[a.name]=a;if(this.record&&this.record[a.name]){a.setValue(this.record[a.name])}if(this.cache&&this.updateCacheOnChange){a.addEvent("valueChange",this.updateCache.bind(this))}if(a.isFileUploadComponent){this.fileUploadComponents.push(a)}this.formComponents.push(a);a.addEvents({valid:this.onValid.bind(this),invalid:this.onInvalid.bind(this),dirty:this.onDirty.bind(this),clean:this.onClean.bind(this),change:this.onChange.bind(this)});if(!a.isValid()){this.invalidIds.push(a.getId())}if(a.isDirty()){this.dirtyIds.push(a.getId())}},set:function(a,b){if(this.map[a]){this.map[a].setValue(b)}},get:function(a){return this.map[a]?this.map[a].getValue():undefined},registerProgressBar:function(a){if(!this.progressBar){this.progressBar=a}},onDirty:function(b,c){var a=c.getId();if(this.dirtyIds.indexOf(a)==-1){this.dirtyIds.push(a)}this.fireEvent("dirty",c)},onClean:function(a,b){this.dirtyIds.erase(b.getId());if(this.dirtyIds.length===0){this.fireEvent("clean")}},onChange:function(a,b){this.fireEvent("change",[this,b])},onValid:function(a,b){this.invalidIds.erase(b.getId());if(this.invalidIds.length==0){this.fireEvent("valid",this)}},onInvalid:function(b,c){var a=c.getId();if(this.invalidIds.indexOf(a)==-1){this.invalidIds.push(a)}this.fireEvent("invalid",this)},validate:function(){if(this.invalidIds.length>0){this.fireEvent("invalid",this)}else{this.fireEvent("valid",this)}},isValid:function(){return this.invalidIds.length===0},getValues:function(){var a={};for(var b=0;b<this.formComponents.length;b++){var c=this.formComponents[b];a[c.getName()]=c.getValue()}return a},submit:function(){this.save()},deleteRecord:function(){this.fireEvent("beforeDelete");this.beforeRequest();var b=this.getDeletePath();var a=new ludo.remote.JSON({resource:b.resource,listeners:{success:function(c){this.fireEvent("deleted",[c.getResponse(),this.view]);this.afterRequest()}.bind(this),failure:function(c){this.fireEvent("deleteFailed",[c.getResponse(),this.view]);this.afterRequest()}.bind(this)}});a.send(b.service,b.argument)},getDeletePath:function(){if(this.currentId){return{resource:this.resource,service:"delete",argument:this.currentId}}return undefined
},getUnfinishedFileUploadComponent:function(){for(var a=0;a<this.fileUploadComponents.length;a++){if(this.fileUploadComponents[a].hasFileToUpload()){this.fileUploadComponents[a].addEvent("submit",this.save.bind(this));return this.fileUploadComponents[a]}}return undefined},save:function(){if(this.getUrl()||ludo.config.getUrl()){var a;if(a=this.getUnfinishedFileUploadComponent()){a.upload();return}this.fireEvent("invalid");this.fireEvent("beforeSave");this.beforeRequest();this.requestHandler().send(this.service?this.service:"save",this.currentId,this.getValues(),{progressBarId:this.getProgressBarId()})}},read:function(a){if(this.isInCache(a)){this.currentId=a;this.fill(this.getCached(a))}else{this.fireEvent("beforeRead");this.beforeRequest();this.currentIdToBeSet=a;this.readHandler().sendToServer("read",a)}},getCached:function(a){return this.cacheStorage[a]?this.cacheStorage[a].data:undefined},updateCache:function(b,a){if(this.cacheStorage[this.currentId]){this.cacheStorage[this.currentId].data[a.getName()]=b}},storeCache:function(b,a){this.cacheStorage[b]={data:Object.clone(a),time:new Date().getTime()}},isInCache:function(a){if(this.cache&&this.cacheStorage[a]){if(!this.cacheTimeout||this.cacheStorage[a].time+(this.cacheTimeout*1000*60)<new Date().getTime()){return true}}return false},_readHandler:undefined,readHandler:function(){if(this._readHandler===undefined){this._readHandler=this.getDependency("readHandler",new ludo.remote.JSON({url:this.url,resource:this.resource?this.resource:"Form",method:this.method?this.method:"post",service:"read",listeners:{success:function(a){this.currentId=this.currentIdToBeSet;this.record=a.getResponseData();if(this.cache){this.storeCache(this.currentId,this.record)}this.fill(this.record);this.fireEvent("read",[a.getResponse(),this.view]);if(this.isValid()){this.fireEvent("valid")}this.fireEvent("clean");this.afterRequest()}.bind(this),failure:function(a){this.fireEvent("failure",[a.getResponse(),this.view]);this.afterRequest()}.bind(this),error:function(a){this.fireEvent("servererror",[a.getResponseMessage(),a.getResponseCode()]);this.fireEvent("valid",this);this.afterRequest()}.bind(this)}}))}return this._readHandler},fill:function(b){for(var a in this.map){if(this.map.hasOwnProperty(a)){if(b[a]!==undefined){this.map[a].setValue(b[a]);this.map[a].commit()}else{this.map[a].reset()}}}},_request:undefined,requestHandler:function(){if(this._request===undefined){if(!this.resource){ludo.util.warn("Warning: form does not have a resource property. Falling back to default: 'Form'")}this._request=this.createDependency("_request",new ludo.remote.JSON({url:this.url,resource:this.resource?this.resource:"Form",method:this.method?this.method:"post",listeners:{success:function(a){this.commitFormElements();this.fireEvent("saved",[a.getResponse(),this.view]);this.setCurrentId(a.getResponseData());this.fireEvent("success",[a.getResponse(),this.view]);if(this.isValid()){this.fireEvent("valid")}this.fireEvent("clean");this.afterRequest()}.bind(this),failure:function(a){if(this.isValid()){this.fireEvent("valid")}this.fireEvent("failure",[a.getResponse(),this.view]);this.afterRequest()}.bind(this),error:function(a){this.fireEvent("servererror",[a.getResponseMessage(),a.getResponseCode()]);this.fireEvent("valid",this);this.afterRequest()}.bind(this)}}))}return this._request},afterRequest:function(){this.fireEvent("afterRequest")},beforeRequest:function(){this.fireEvent("beforeRequest")},setCurrentId:function(a){if(!isNaN(a)){this.currentId=a}if(ludo.util.isObject(a)){this.currentId=a.id}},getProgressBarId:function(){return this.progressBar?this.progressBar.getProgressBarId():undefined},commitFormElements:function(){for(var a=0;a<this.formComponents.length;a++){this.formComponents[a].commit()}},reset:function(){for(var a=0;a<this.formComponents.length;a++){this.formComponents[a].reset()}this.dirtyIds=[];this.fireEvent("clean");this.fireEvent("reset")},newRecord:function(){this.fireEvent("new");this.currentId=undefined;this.clear()},clear:function(){for(var a=0;a<this.formComponents.length;a++){this.formComponents[a].clear()}this.dirtyIds=[];this.fireEvent("clean");this.fireEvent("clear")},isDirty:function(){return this.dirtyIds.length>0}});ludo.form.SubmitButton=new Class({Extends:ludo.form.Button,type:"form.SubmitButton",value:"Submit",disableOnInvalid:true,applyTo:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["applyTo"])},ludoRendered:function(){this.parent();this.applyTo=this.applyTo?ludo.get(this.applyTo):this.getParentComponent();if(this.applyTo){var a=this.applyTo.getForm();a.addEvent("valid",this.enable.bind(this));a.addEvent("invalid",this.disable.bind(this));a.addEvent("clean",this.disable.bind(this));a.addEvent("dirty",this.enable.bind(this));this.checkValidity.delay(100,this)}this.addEvent("click",this.submit.bind(this))},checkValidity:function(){if(this.applyTo.getForm().isValid()){this.enable()}else{this.disable()}},submit:function(){if(this.applyTo){this.applyTo.getForm().submit()
}}});ludo.form.CancelButton=new Class({Extends:ludo.form.Button,type:"form.CancelButton",value:"Cancel",applyTo:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["applyTo"])},ludoRendered:function(){this.parent();this.applyTo=this.applyTo?ludo.get(this.applyTo):this.getParentComponent();this.addEvent("click",this.hideComponent.bind(this))},hideComponent:function(){if(this.applyTo){this.applyTo.hide()}}});ludo.form.Text=new Class({Extends:ludo.form.LabelElement,type:"form.Text",labelWidth:100,defaultValue:"",maxLength:undefined,minLength:undefined,ucFirst:false,ucWords:false,inputType:"text",inputTag:"input",regex:undefined,validateKeyStrokes:false,formFieldWidth:undefined,readonly:false,selectOnFocus:false,ludoConfig:function(b){this.parent(b);var c=["selectOnFocus","regex","minLength","maxLength","defaultValue","validateKeyStrokes","ucFirst","ucWords","readonly"];this.setConfigParams(b,c);if(this.regex&&ludo.util.isString(this.regex)){var d=this.regex.split(/\//g);var a=d.length>1?d.pop():"";this.regex=new RegExp(d.join("/"),a)}this.applyValidatorFns(["minLength","maxLength","regex"])},ludoEvents:function(){this.parent();var a=this.getFormEl();if(this.ucFirst||this.ucWords){this.addEvent("blur",this.upperCaseWords.bind(this))}this.addEvent("blur",this.validate.bind(this));if(this.validateKeyStrokes){a.addEvent("keydown",this.validateKey.bind(this))}ludo.dom.addClass(a.parentNode,"ludo-form-text-element");a.addEvent("keyup",this.sendKeyEvent.bind(this));if(this.selectOnFocus){a.addEvent("focus",this.selectText.bind(this))}},sendKeyEvent:function(){this.fireEvent("key",this.els.formEl.value)},validateKey:function(a){if(!a.control&&!a.alt&&this.regex&&a.key&&a.key.length==1){if(!this.regex.test(a.key)){return false}}return undefined},getFieldWidth:function(){return this.formFieldWidth},focus:function(){this.parent();this.getFormEl().focus()},validate:function(){var a=this.parent();if(!a&&!this._focus){this.getEl().addClass("ludo-form-el-invalid")}return a},keyUp:function(a){this.parent(a);if(this.validateKeyStrokes){this.validate()}},upperCaseWords:function(){if(this.ucFirst||this.ucWords){var c=this.getValueOfFormEl();if(c.length==0){return}if(this.ucWords&&c.length>1){var b=c.split(/\s/g);for(var a=0;a<b.length;a++){if(b[a].length==1){b[a]=b[a].toUpperCase()}else{b[a]=b[a].substr(0,1).toUpperCase()+b[a].substr(1)}}this.getFormEl().set("value",b.join(" "))}else{c=c.substr(0,1).toUpperCase()+c.substr(1);this.getFormEl().set("value",c)}}},hasSelection:function(){var b=this.getSelectionStart();var a=this.getSelectionEnd();return a>b},selectText:function(){this.getFormEl().select()},getSelectionStart:function(){if(this.els.formEl.createTextRange){var a=document.selection.createRange().duplicate();a.moveEnd("character",this.els.formEl.value.length);if(a.text==""){return this.els.formEl.value.length}return this.els.formEl.value.lastIndexOf(a.text)}else{return this.els.formEl.selectionStart}},getSelectionEnd:function(){if(this.els.formEl.createTextRange){var a=document.selection.createRange().duplicate();a.moveStart("character",-this.els.formEl.value.length);return a.text.length}else{return this.els.formEl.selectionEnd}}});ludo.form.Combo=new Class({Extends:ludo.form.Text,type:"form.Combo",layout:{type:"popup"},menuButton:undefined,childLayout:undefined,ludoConfig:function(a){this.parent(a);this.childLayout=a.childLayout||this.childLayout},ludoRendered:function(){this.parent();ludo.Form.addEvent("focus",this.autoHide.bind(this));var a=this.children[0];a.layout=a.layout||{};if(this.childLayout){a.layout=Object.merge(a.layout,this.childLayout)}a.layout.below=a.layout.below||this.getInputCell();if(a.left===undefined){a.layout.alignLeft=a.layout.alignLeft||this.getInputCell()}if(!a.layout.width){a.layout.sameWidthAs=a.layout.sameWidthAs||this.getInputCell()}a.layout.height=a.layout.height||200;a.alwaysInFront=true;a.cls=a.cls?a.cls+" form-combo-child":"form-combo-child";this.getInputCell().style.position="relative";this.createDependency("menuButton",new ludo.menu.Button({type:"menu.Button",renderTo:this.getInputCell(),alwaysVisible:true,region:"ne",autoPosition:false,menu:this.children[0],toggleOnClick:true,listeners:{show:function(){this.fireEvent("showCombo")}.bind(this)}}));this.children[0].addEvent("show",this.focus.bind(this))},autoHide:function(a){if(a.isButton&&a.isButton()){return}if(a!==this&&!a.isChildOf(this.children[0])){this.children[0].hide()}},hideMenu:function(){this.children[0].hide()}});ludo.form.Date=new Class({Extends:ludo.form.Combo,children:[{type:"calendar.Calendar"}],displayFormat:"Y-m-d",inputFormat:"Y-m-d",childLayout:{width:250,height:250},ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["displayFormat","inputFormat"]);this.displayFormat=this.displayFormat.replace(/([a-z])/gi,"%$1");this.inputFormat=this.inputFormat.replace(/([a-z])/gi,"%$1");this.value=this.value?ludo.util.parseDate(this.value,this.inputFormat):undefined;this.initialValue=this.constructorValue=this.value
},ludoRendered:function(){this.parent();this.setFormElValue(this.value)},addChild:function(a){a.value=this.value||new Date();this.parent(a);this.children[0].addEvent("change",function(b){this.setValue(ludo.util.parseDate(b,this.inputFormat));this.blur()}.bind(this))},ludoEvents:function(){this.parent();this.addEvent("showCombo",function(){this.children[0].setDate(this.value?ludo.util.parseDate(this.value,this.displayFormat):new Date())}.bind(this))},setValue:function(a){a=a?ludo.util.parseDate(a,this.displayFormat):a;if(a&&a.getYear&&isNaN(a.getYear())){a=undefined}this.parent(a)},setFormElValue:function(a){if(this.els.formEl&&this.els.formEl.value!==a){a=a?ludo.util.isString(a)?a:a.format(this.displayFormat):"";this.els.formEl.set("value",a)}this.children[0].hide()},getValue:function(){return this.value?ludo.util.parseDate(this.value,this.displayFormat).format(this.inputFormat):undefined}});ludo.form.Color=new Class({Extends:ludo.form.Combo,regex:/^#[0-9A-F]{6}$/i,childLayout:{width:290,height:250},getClassChildren:function(){return[{layout:{type:"tabs"},cls:"ludo-tabs-in-dropdown",bodyCls:"ludo-tabs-in-dropdown-body",children:[{title:ludo.language.get("RGB"),type:"color.RgbColors",name:"rgbColors",value:this.value,listeners:{setColor:this.receiveColor.bind(this),render:this.setInitialWidgetValue.bind(this)}},{title:ludo.language.get("Named Colors"),type:"color.NamedColors",name:"boxes",value:this.value,listeners:{setColor:this.receiveColor.bind(this),render:this.setInitialWidgetValue.bind(this)}},{name:"slider",title:ludo.language.get("Color Slider"),type:"color.RGBSlider",value:this.value,listeners:{setColor:this.receiveColor.bind(this),render:this.setInitialWidgetValue.bind(this)}}]}]},setInitialWidgetValue:function(a){a.setColor(this.value)},ludoEvents:function(){this.parent();this.addEvent("change",this.updateWidgets.bind(this))},updateWidgets:function(){var b=this.getColorWidgets();for(var a=0;a<b.length;a++){if(b[a].setColor){b[a].setColor(this.value)}}},receiveColor:function(a){this.setValue(a);this.hideMenu()},getColorWidgets:function(){return this.children[0].children}});ludo.form.ResetButton=new Class({Extends:ludo.form.Button,type:"form.ResetButton",value:"Reset",applyTo:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["applyTo"])},ludoRendered:function(){this.parent();this.applyTo=this.applyTo?ludo.get(this.applyTo):this.getParentComponent();var a=this.applyTo.getForm();if(this.applyTo){a.addEvent("dirty",this.enable.bind(this));a.addEvent("clean",this.disable.bind(this))}if(!a.isDirty()){this.disable()}this.addEvent("click",this.reset.bind(this))},reset:function(){if(this.applyTo){this.applyTo.getForm().reset()}}});ludo.form.ComboTree=new Class({Extends:ludo.form.Element,type:"form.ComboTree",cssSignature:"form-combo",treeConfig:undefined,emptyText:"",width:400,height:26,inputConfig:{fieldWidth:440,labelWidth:1,width:350},selectedRecord:undefined,layout:{type:"cols"},treePanel:undefined,input:undefined,searchable:false,timeStamp:0,currentSearchValue:"",ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["searchable","inputConfig","treeConfig","emptyText"]);if(this.treeConfig.type===undefined){this.treeConfig.type="tree.Tree"}this.inputConfig.type="form.Text";this.inputConfig.stretchField=true},ludoEvents:function(){this.parent();document.body.addEvent("mousedown",this.autoHide.bind(this))},ludoDOM:function(){if(this.label){this.addChild({html:"<label>"+this.label+":</label>",width:this.labelWidth})}this.viewField=this.addChild({type:"form.ComboField",weight:1});this.viewField.addEvent("click",this.showTree.bind(this));this.input=this.addChild(this.inputConfig);this.input.addEvent("focus",this.showTree.bind(this));this.input.addEvent("focus",this.selectInputText.bind(this));this.input.addEvent("blur",this.blurInput.bind(this));this.input.addEvent("key_up",this.filter.bind(this));this.input.addEvent("key_down",this.keyDown.bind(this));this.input.hide();this.treePanel=new ludo.Window({cls:"ludo-Filter-Tree-Window",width:this.treeConfig.width,alwaysInFront:true,resizeTop:false,resizeLeft:false,minWidth:this.fieldWidth,height:this.treeConfig.height,titleBar:false,renderTo:document.body,layout:"fill",children:[this.treeConfig]});this.treePanel.hide();this.treePanel.addEvent("beforeresize",this.setBusy.bind(this));this.treePanel.addEvent("afterresize",this.setNotBusy.bind(this));this.treePanel.children[0].getDataSource().addEvent("select",this.receiveSelectedRecord.bind(this));this.parent();this.getEl().addClass("ludo-filter-tree");this.resize.delay(100,this);this.resizeChildren()},ludoRendered:function(){this.parent();if(this.emptyText){this.setViewValue(this.emptyText)}},busyWithResize:false,setBusy:function(){this.busyWithResize=true},setNotBusy:function(){this.setNotBusyAfterDelay.delay(500,this)},setNotBusyAfterDelay:function(){this.busyWithResize=false},arrowClick:function(){if(this.treePanel.isHidden()){this.selectInputText();this.showTree()}else{this.hideTree()
}},selectInputText:function(){this.input.getFormEl().select()},blurInput:function(){this.input.getFormEl().removeClass("ludo-filter-tree-input-active")},autoHide:function(c){if(this.busyWithResize){return}if(!this.treePanel.isVisible()){return}var a=c.target;if(a.id==this.input.getFormEl().id||a.hasClass("ludo-shim-resize")){return}var b=this.viewField.getEl();if(a.id==b.id||a.getParent("#"+b.id)){return}if(a.getParent(".ludo-shim-resize")){return}if(!a.getParent("#"+this.input.getFormEl().id)&&!a.getParent("#"+this.treePanel.id)){this.hideTree()}},hideTree:function(){this.treePanel.hide();if(this.searchable){this.input.hide();this.viewField.show()}},keyDown:function(a){if(a==="esc"||a=="tab"){this.hideTree()}},filter:function(a){if(a==="esc"){return}this.treePanel.show();var c=this.input.getValue();if(c==this.currentSearchValue){return}var b=new Date();this.timeStamp=b.getTime();this.filterAfterDelay(this.input.getValue());this.currentSearchValue=c},filterAfterDelay:function(b){var a=new Date();if(a.getTime()-this.timeStamp<200){this.filterAfterDelay.delay(100,this,b);return}this.timeStamp=a.getTime();if(b==this.input.getValue()){this.treePanel.children[0].filter(this.input.getValue())}},showTree:function(){if(this.searchable){this.viewField.hide();this.input.show();this.input.getFormEl().addClass("ludo-filter-tree-input-active");this.input.getFormEl().focus()}this.treePanel.show();this.positionTree();this.resizeChildren();this.treePanel.increaseZIndex()},setViewValue:function(a){this.input.setValue(a);this.viewField.setViewValue(a)},positionTree:function(){var a;if(this.searchable){a=this.input.getEl()}else{a=this.viewField.getEl()}var b=a.getCoordinates();this.treePanel.setPosition({left:b.left,top:b.top+a.getSize().y})},getFormEl:function(){return this.input.getFormEl()},selectRecord:function(a){this.treePanel.children[0].selectRecord(a)},receiveSelectedRecord:function(a){this.setValue(a.get("id"));this.setViewValue(a.get("title"));this.fireEvent("selectrecord",[this,a.getData()]);this.hideTree.delay(100,this)},getValue:function(){return this.value},getSelectedRecord:function(){return this.treePanel.children[0].getSelectedRecord()},getParentRecord:function(a){return this.treePanel.children[0].getParentRecord(a)}});ludo.form.ComboField=new Class({Extends:ludo.View,cls:"ludo-Filter-Tree-Combo-Field",ludoEvents:function(){this.parent();this.getBody().addEvent("click",this.clickEvent.bind(this))},clickEvent:function(){this.fireEvent("click")},setViewValue:function(a){this.els.valueField.set("html",a)},ludoDOM:function(){this.parent();var c=new Element("div");ludo.dom.addClass(c,"ludo-Filter-Tree-Field-Arrow");this.getBody().adopt(c);var d=new Element("div");ludo.dom.addClass(d,"ludo-Filter-Tree-Bg-Left");this.getBody().adopt(d);var b=new Element("div");ludo.dom.addClass(b,"ludo-Filter-Tree-Bg-Right");this.getBody().adopt(b);var a=this.els.valueField=new Element("div");ludo.dom.addClass(a,"ludo-Filter-Tree-Combo-Value");this.getBody().adopt(a)}});ludo.form.Hidden=new Class({Extends:ludo.form.Element,type:"form.Hidden",labelWidth:0,defaultValue:"",hidden:false,containerCss:{display:"none"},ludoDOM:function(){this.parent();this.els.formEl=new Element("input");this.els.formEl.setProperty("type","hidden");this.els.formEl.id=this.getFormElId();this.getBody().adopt(this.els.formEl)},ludoRendered:function(){this.parent();this.hide()},getHeight:function(){return 0},getWidth:function(){return 0}});ludo.form.Textarea=new Class({Extends:ludo.form.Text,type:"form.Textarea",inputType:undefined,inputTag:"textarea",overflow:"hidden",ludoConfig:function(a){this.parent(a);this.ucWords=false},ludoRendered:function(){this.parent();this.els.formEl.style.paddingRight=0;this.els.formEl.style.paddingTop=0},resizeDOM:function(){this.parent();if(this.layout&&this.layout.weight){var a=this.getEl().offsetHeight;a-=(ludo.dom.getMBPH(this.getEl())+ludo.dom.getMBPH(this.getBody())+ludo.dom.getMH(this.els.formEl.parentNode));a-=1;if(a>0){this.els.formEl.style.height=a+"px"}}}});ludo.form.DisplayField=new Class({Extends:ludo.form.LabelElement,type:"form.DisplayField",inputTag:"span",inputType:"",tpl:"",setValue:function(a){if(!a){this.getFormEl().set("html","");return}this.setTextContent(a)},ludoRendered:function(){this.parent();this.setTextContent(this.value)},setTextContent:function(b){var a=this.tpl?this.getTplParser().getCompiled({value:b}):b?b:"";this.getFormEl().set("html",a)},isValid:function(){return true},getValue:function(){return this.value},supportsInlineLabel:function(){return false}});ludo.form.Checkbox=new Class({Extends:ludo.form.LabelElement,type:"form.Checkbox",inputType:"checkbox",stretchField:false,labelWidth:undefined,image:undefined,checked:false,height:undefined,labelSuffix:"",fieldTpl:["<table ",'cellpadding="0" cellspacing="0" border="0" width="100%">',"<tbody>",'<tr class="checkbox-image-row" style="display:none">','<td colspan="2" class="input-image"></td>',"</tr>",'<tr class="input-row">','<td class="input-cell" style="width:30px"></td>','<td><label class="input-label"></label></td>','<td class="suffix-cell" style="display:none"><label></label></td>',"</tr>","</tbody>","</table>"],ludoConfig:function(a){a=a||{};
a.value=a.value||"1";this.parent(a);this.setConfigParams(a,["inputType","image","checked"]);this.initialValue=this.constructorValue=this.checked?this.value:""},ludoDOM:function(){this.parent();if(this.image){this.addRadioImage()}},addInput:function(){var b=this.getFormElId();var a;if(Browser.ie&&parseInt(Browser.version)<9){a=document.createElement('<input type="'+this.inputType+'" name="'+this.getName()+'" value="'+this.value+'" id="'+b+'">');this.getInputCell().adopt(a);this.els.formEl=document.id(a)}else{a=this.els.formEl=new Element("input");this.getInputCell().adopt(a);a.setProperties({type:this.inputType,name:this.getName(),value:this.value,id:b})}this.els.formEl.addEvent("click",this.toggleImage.bind(this));if(this.inputType==="checkbox"){this.els.formEl.addEvent("click",this.valueChange.bind(this))}if(this.checked){this.getFormEl().checked=true;this.toggleImage()}},addRadioImage:function(){var b=this.els.radioImageDiv=new Element("div");var a=new Element("div");ludo.dom.addClass(a,"ludo-radio-image-inner");a.setStyles({width:"100%",height:"100%",background:"url("+this.image+") no-repeat center center"});b.adopt(a);ludo.dom.addClass(b,"ludo-radio-image");b.addEvent("click",this.clickOnImage.bind(this));this.getImageCell().adopt(b);this.getBody().getElement(".checkbox-image-row").style.display=""},getImageCell:function(){return this.getCell(".input-image","imageCell")},setWidthOfLabel:function(){},clickOnImage:function(){if(this.inputType==="checkbox"){this.setChecked(!this.getFormEl().checked)}else{this.check()}},isChecked:function(){return this.getFormEl().getProperty("checked")},check:function(){if(!this.isChecked()){this.setChecked(true)}},uncheck:function(){if(this.isChecked()){this.setChecked(false)}},focus:function(){},blur:function(){},getValue:function(){return this.isChecked()?this.getFormEl().get("value"):""},setChecked:function(a){this.setCheckedProperty(a);this.fireEvent("change",[this.getValue(),this]);this.value=this.getValue();this.toggleImage();this.toggleDirtyFlag()},setCheckedProperty:function(a){if(a){this.getFormEl().setProperty("checked","1")}else{this.getFormEl().removeProperty("checked")}},valueChange:function(){this.value=this.isChecked()?this.getFormEl().get("value"):"";this.toggleDirtyFlag()},reset:function(){this.setCheckedProperty(this.initialValue?true:false);this.fireEvent("valueChange",[this.getValue(),this]);this.toggleImage()},toggleImage:function(){if(this.els.radioImageDiv){if(this.isChecked()){ludo.dom.addClass(this.els.radioImageDiv,"ludo-radio-image-checked")}else{ludo.dom.removeClass(this.els.radioImageDiv,"ludo-radio-image-checked")}}},supportsInlineLabel:function(){return false}});ludo.form.Radio=new Class({Extends:ludo.form.Checkbox,type:"form.Radio",inputType:"radio"});if(typeof faultylabs=="undefined"){faultylabs={}}faultylabs.MD5=function(j){function c(u){var t=(u>>>0).toString(16);return"00000000".substr(0,8-t.length)+t}function b(v){var t=[];for(var u=0;u<v.length;u++){t=t.concat(q(v[u]))}return t}function s(u){var t=[];for(var v=0;v<8;v++){t.push(u&255);u=u>>>8}return t}function m(u,t){return((u<<t)&4294967295)|(u>>>(32-t))}function n(t,v,u){return(t&v)|(~t&u)}function k(t,v,u){return(u&t)|(~u&v)}function f(t,v,u){return t^v^u}function d(t,v,u){return v^(t|~u)}function p(t,u){return(t[u+3]<<24)|(t[u+2]<<16)|(t[u+1]<<8)|(t[u])}function q(x){var t=[];for(var w=0;w<x.length;w++){if(x.charCodeAt(w)<=127){t.push(x.charCodeAt(w))}else{var v=encodeURIComponent(x.charAt(w)).substr(1).split("%");for(var u=0;u<v.length;u++){t.push(parseInt(v[u],16))}}}return t}function r(v,u,B,A){var z="";var y=0;var w=0;for(var x=3;x>=0;x--){w=arguments[x];y=(w&255);w=w>>>8;y=y<<8;y=y|(w&255);w=w>>>8;y=y<<8;y=y|(w&255);w=w>>>8;y=y<<8;y=y|w;z=z+c(y)}return z}function l(v){var t=new Array(v.length);for(var u=0;u<v.length;u++){t[u]=v[u]}return t}var h=null;var o=null;if(typeof j=="string"){h=q(j)}else{if(j.constructor==Array){if(j.length===0){h=j}else{if(typeof j[0]=="string"){h=b(j)}else{if(typeof j[0]=="number"){h=j}else{o=typeof j[0]}}}}else{if(typeof ArrayBuffer!="undefined"){if(j instanceof ArrayBuffer){h=l(new Uint8Array(j))}else{if((j instanceof Uint8Array)||(j instanceof Int8Array)){h=l(j)}else{if((j instanceof Uint32Array)||(j instanceof Int32Array)||(j instanceof Uint16Array)||(j instanceof Int16Array)||(j instanceof Float32Array)||(j instanceof Float64Array)){h=l(new Uint8Array(j.buffer))}else{o=typeof j}}}}else{o=typeof j}}}if(o){alert("MD5 type mismatch, cannot process "+o)}function a(u,t){return 4294967295&(u+t)}return g();function g(){function w(J,K,H,G){var I=z;z=B;B=D;D=a(D,m(a(F,a(J,a(K,H))),G));F=I}var u=h.length;h.push(128);var x=h.length%64;if(x>56){for(var v=0;v<(64-x);v++){h.push(0)}x=h.length%64}for(v=0;v<(56-x);v++){h.push(0)}h=h.concat(s(u*8));var E=1732584193;var C=4023233417;var A=2562383102;var y=271733878;var F=0,D=0,B=0,z=0;for(v=0;v<h.length/64;v++){F=E;D=C;B=A;z=y;var t=v*64;w(n(D,B,z),3614090360,p(h,t),7);w(n(D,B,z),3905402710,p(h,t+4),12);w(n(D,B,z),606105819,p(h,t+8),17);
w(n(D,B,z),3250441966,p(h,t+12),22);w(n(D,B,z),4118548399,p(h,t+16),7);w(n(D,B,z),1200080426,p(h,t+20),12);w(n(D,B,z),2821735955,p(h,t+24),17);w(n(D,B,z),4249261313,p(h,t+28),22);w(n(D,B,z),1770035416,p(h,t+32),7);w(n(D,B,z),2336552879,p(h,t+36),12);w(n(D,B,z),4294925233,p(h,t+40),17);w(n(D,B,z),2304563134,p(h,t+44),22);w(n(D,B,z),1804603682,p(h,t+48),7);w(n(D,B,z),4254626195,p(h,t+52),12);w(n(D,B,z),2792965006,p(h,t+56),17);w(n(D,B,z),1236535329,p(h,t+60),22);w(k(D,B,z),4129170786,p(h,t+4),5);w(k(D,B,z),3225465664,p(h,t+24),9);w(k(D,B,z),643717713,p(h,t+44),14);w(k(D,B,z),3921069994,p(h,t),20);w(k(D,B,z),3593408605,p(h,t+20),5);w(k(D,B,z),38016083,p(h,t+40),9);w(k(D,B,z),3634488961,p(h,t+60),14);w(k(D,B,z),3889429448,p(h,t+16),20);w(k(D,B,z),568446438,p(h,t+36),5);w(k(D,B,z),3275163606,p(h,t+56),9);w(k(D,B,z),4107603335,p(h,t+12),14);w(k(D,B,z),1163531501,p(h,t+32),20);w(k(D,B,z),2850285829,p(h,t+52),5);w(k(D,B,z),4243563512,p(h,t+8),9);w(k(D,B,z),1735328473,p(h,t+28),14);w(k(D,B,z),2368359562,p(h,t+48),20);w(f(D,B,z),4294588738,p(h,t+20),4);w(f(D,B,z),2272392833,p(h,t+32),11);w(f(D,B,z),1839030562,p(h,t+44),16);w(f(D,B,z),4259657740,p(h,t+56),23);w(f(D,B,z),2763975236,p(h,t+4),4);w(f(D,B,z),1272893353,p(h,t+16),11);w(f(D,B,z),4139469664,p(h,t+28),16);w(f(D,B,z),3200236656,p(h,t+40),23);w(f(D,B,z),681279174,p(h,t+52),4);w(f(D,B,z),3936430074,p(h,t),11);w(f(D,B,z),3572445317,p(h,t+12),16);w(f(D,B,z),76029189,p(h,t+24),23);w(f(D,B,z),3654602809,p(h,t+36),4);w(f(D,B,z),3873151461,p(h,t+48),11);w(f(D,B,z),530742520,p(h,t+60),16);w(f(D,B,z),3299628645,p(h,t+8),23);w(d(D,B,z),4096336452,p(h,t),6);w(d(D,B,z),1126891415,p(h,t+28),10);w(d(D,B,z),2878612391,p(h,t+56),15);w(d(D,B,z),4237533241,p(h,t+20),21);w(d(D,B,z),1700485571,p(h,t+48),6);w(d(D,B,z),2399980690,p(h,t+12),10);w(d(D,B,z),4293915773,p(h,t+40),15);w(d(D,B,z),2240044497,p(h,t+4),21);w(d(D,B,z),1873313359,p(h,t+32),6);w(d(D,B,z),4264355552,p(h,t+60),10);w(d(D,B,z),2734768916,p(h,t+24),15);w(d(D,B,z),1309151649,p(h,t+52),21);w(d(D,B,z),4149444226,p(h,t+16),6);w(d(D,B,z),3174756917,p(h,t+44),10);w(d(D,B,z),718787259,p(h,t+8),15);w(d(D,B,z),3951481745,p(h,t+36),21);E=a(E,F);C=a(C,D);A=a(A,B);y=a(y,z)}return r(y,A,C,E).toUpperCase()}};ludo.form.Password=new Class({Extends:ludo.form.Text,type:"form.Password",inputType:"password",md5:false,ludoConfig:function(a){this.parent(a);if(a.md5!==undefined){this.md5=a.md5}},getValue:function(){var a=this.parent();if(a.length&&this.md5){return faultylabs.MD5(a)}return a},reset:function(){this.setValue("")}});ludo.form.StrongPassword=new Class({Extends:ludo.form.Password,regex:"(?=^.{_length_,}$)((?=.*[0-9])|(?=.*W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$",passwordLength:8,ludoConfig:function(a){a=a||{};this.passwordLength=a.passwordLength||this.passwordLength;this.regex=new RegExp(this.regex.replace("_length_",this.passwordLength));this.parent(a)}});ludo.form.Number=new Class({Extends:ludo.form.Text,type:"form.Number",regex:/^[0-9]+$/,validateKeyStrokes:true,formCss:{"text-align":"right"},stretchField:false,disableWheel:false,reverseWheel:false,minValue:undefined,maxValue:undefined,shiftIncrement:10,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["disableWheel","shiftIncrement","reverseWheel","minValue","maxValue"]);if(this.minValue!==undefined){this.minValue=parseInt(this.minValue)}if(this.maxValue!==undefined){this.maxValue=parseInt(this.maxValue)}this.applyValidatorFns(["minValue","maxValue"])},ludoEvents:function(){this.parent();if(!this.disableWheel){this.getFormEl().addEvent("mousewheel",this._mouseWheel.bind(this))}this.getFormEl().addEvent("keydown",this.keyIncrement.bind(this))},keyIncrement:function(a){if(a.key==="up"||a.key==="down"){if(a.key==="up"){this.incrementBy(1,a.shift)}if(a.key==="down"){this.incrementBy(-1,a.shift)}return false}return undefined},blur:function(){var a=this.getFormEl().value;if(!this.isValid(a)){if(this.minValue!==undefined&&parseInt(a)<this.minValue){a=this.minValue}if(this.maxValue!==undefined&&parseInt(a)>this.maxValue){a=this.maxValue}this.setValue(a)}this.parent()},_mouseWheel:function(a){this.incrementBy(a.wheel>0?Math.ceil(a.wheel):Math.floor(a.wheel),a.shift);return false},incrementBy:function(b,a){if(this.reverseWheel){b=b*-1}b=parseInt(this.value)+(a?b*this.shiftIncrement:b);if(this.maxValue&&b>this.maxValue){b=this.maxValue}if(this.minValue!==undefined&&b<this.minValue){b=this.minValue}if(this.isValid(b)){this.setValue(b);this.fireEvent("change",[b,this])}}});ludo.form.Email=new Class({Extends:ludo.form.Text,type:"form.Email",regex:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.(?:[A-Z]{2}|com|org|net|edu|gov|mil|biz|info|mobi|name|aero|asia|jobs|museum)$/i,validateKeyStrokes:false});ludo.form.Spinner=new Class({Extends:ludo.form.Number,type:"form.Spinner",inputTag:"input",inputType:"text",stretchField:false,regex:undefined,maxValue:100,minValue:0,increment:1,decimals:0,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["increment","decimals"])},mode:{},ludoRendered:function(){this.parent();
this.createSpinnerElements();if(!this.fieldWidth){this.getFormEl().setStyle("width",(this.maxValue+"").length*15)}this._setStyles();this._createEvents();this._clearMode();this.setSpinnerValue(this.value);this._setContainerSize()},createSpinnerElements:function(){this.createSpinnerContainer();var a=this.getFormEl();a.setProperty("maxlength",(this.maxValue+"").length);ludo.dom.addClass(a,"ludo-spinbox-input");var b=this.els.spinnerContainer;this.els.arrowsContainer=this._createContainer({cls:"ludo-spinbox-arrows-container",renderTo:b});this.els.upArrow=this._createContainer({cls:"ludo-spinbox-arrow-up",renderTo:this.els.arrowsContainer});this.els.downArrow=this._createContainer({cls:"ludo-spinbox-arrow-down",renderTo:this.els.arrowsContainer});this.els.arrowSeparator=this._createContainer({cls:"ludo-spinbox-arrow-separator",renderTo:this.els.arrowsContainer})},_clearMode:function(){this.mode={name:false,modeElement:null,shiftKey:false,timeout:false}},createSpinnerContainer:function(){var a=this.els.spinnerContainer=ludo.dom.create({renderTo:this.getFormEl().getParent(),cls:"ludo-spinbox-container"});a.adopt(this.getFormEl())},_createContainer:function(a){a=Object.merge({tag:"div",cls:""},a);var b=new Element(a.tag);b.addClass(a.cls);if(a.renderTo){a.renderTo.adopt(b)}return b},_setStyles:function(){this.els.spinnerContainer.style.position="relative";this.getFormEl().setStyles({border:"0px"});this.els.arrowsContainer.setStyles({position:"absolute",top:"0px",height:"100%",right:"0px"});this.els.upArrow.setStyles({position:"absolute","background-repeat":"no-repeat","background-position":"center center",height:" 50%",top:"0px"});this.els.downArrow.setStyles({position:"absolute","background-repeat":"no-repeat","background-position":"center center",height:"50%",bottom:"0px"});this.els.arrowSeparator.setStyles({position:"absolute",top:"50%"});this.els.spinnerContainer.style.width=this.fieldWidth+"px"},_initNudge:function(a){this._startMode({name:"nudge",x:a.page.x,initValue:parseInt(this.getValue()),labelWidth:this.els.label.getSize().x});return false},_nudge:function(f){if(this.mode.name=="nudge"){var b=f.page.x-this.mode.x;var a=(this.maxValue-this.minValue)/this.mode.labelWidth;var d=this.mode.initValue+(b*a);if(this.increment>1){d=Math.round(d);if(d>0&&(d%this.increment)){d=d-(d%this.increment)+this.increment;if(d>this.maxValue){d=this.maxValue}}}this.setSpinnerValue(d);var c=this.getValue();if(c==this.maxValue||c==this.minValue){this._initNudge(f)}}},_setContainerSize:function(){var a=this.getFormEl().getSize().x;if(!a){return}if(this.stretchField){a-=11}a++;this.els.spinnerContainer.style.width=a+"px"},_createEvents:function(){if(!this.disableWheel){this.getFormEl().addEvent("mousewheel",this._mouseWheel.bind(this))}this.getFormEl().addEvent("keydown",this._validateKeyStroke.bind(this));this.els.upArrow.addEvent("mouseover",this._arrowMouseOver.bind(this));this.els.upArrow.addEvent("mouseout",this._arrowMouseOut.bind(this));this.els.upArrow.addEvent("mousedown",this._arrowMouseDown.bind(this));this.els.upArrow.addEvent("mouseup",this._arrowMouseUp.bind(this));this.els.downArrow.addEvent("mouseover",this._arrowMouseOver.bind(this));this.els.downArrow.addEvent("mouseout",this._arrowMouseOut.bind(this));this.els.downArrow.addEvent("mousedown",this._arrowMouseDown.bind(this));this.els.downArrow.addEvent("mouseup",this._arrowMouseUp.bind(this));Window.getDocument().addEvent("mouseup",this._clearMode.bind(this));if(this.els.label){this.els.label.setStyle("cursor","w-resize");document.id(this.els.label).addEvents({mousedown:this._initNudge.bind(this),selectstart:function(){return false}});Window.getDocument().addEvent("mousemove",this._nudge.bind(this))}},_arrowMode:function(){if(this.mode.name){switch(this.mode.modeElement){case this.els.upArrow:this.incrementBy(1,this.mode.shiftKey);break;case this.els.downArrow:this.incrementBy(-1,this.mode.shiftKey);break;default:}this.mode.timeout=Math.max(Math.round(this.mode.timeout*0.8),15);setTimeout(this._arrowMode.bind(this),this.mode.timeout)}},_startMode:function(a){this.mode=a;switch(this.mode.name){case"mousedown":this._arrowMode();break;default:}},_arrowMouseDown:function(a){ludo.dom.addClass(a.target,"ludo-spinbox-arrow-downeffect");this._startMode({name:"mousedown",modeElement:a.target,shiftKey:a.shift,timeout:400})},_arrowMouseUp:function(a){a.target.removeClass("ludo-spinbox-arrow-downeffect")},_arrowMouseOver:function(a){ludo.dom.addClass(a.target,"ludo-spinbox-arrow-overeffect")},_arrowMouseOut:function(a){a.target.removeClass("ludo-spinbox-arrow-overeffect")},incrementBy:function(b,a){b=b*(a?this.shiftIncrement:this.increment);this.setSpinnerValue(parseInt(this.getValue())+b)},validateSpinnerValue:function(a){a=a||0;if(a<this.minValue){a=this.minValue}if(a>this.maxValue){a=this.maxValue}return parseInt(a)},setSpinnerValue:function(a){this.value=this.validateSpinnerValue(a).toFixed(this.decimals);this.getFormEl().value=this.value;this.fireEvent("change",a,this)},_validateKeyStroke:function(a){if(a.key=="backspace"||a.key=="delete"||a.key=="tab"){return true
}if(this.minValue<0&&this.html.el.value.indexOf("-")==-1&&a.key=="-"){return true}if(this.decimals&&(a.code==190||a.code==46)&&this.html.el.value.indexOf(".")==-1){return true}if(Event.Keys.hasOwnProperty(a.key)){return true}return Event.Keys.hasOwnProperty(a.key)?true:/[0-9]/.test(a.key)},resizeDOM:function(){this.parent();if(this.stretchField){this._setContainerSize()}}});ludo.form.Select=new Class({Extends:ludo.form.LabelElement,type:"form.Select",labelWidth:100,emptyItem:undefined,valueKey:"value",textKey:"text",inputTag:"select",inputType:"",dataSource:{},options:undefined,defaultDS:"dataSource.Collection",ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["emptyItem","options","valueKey","textKey"]);if(!this.emptyItem&&this.inlineLabel){this.emptyItem={};this.emptyItem[this.textKey]=this.inlineLabel;this.inlineLabel=undefined}},ludoEvents:function(){this.parent();if(this.dataSource){if(this.options&&this.dataSourceObj){for(var a=0;a<this.options.length;a++){this.dataSourceObj.addRecord(this.options[a])}}this.populate();var b=this.getDataSource();b.addEvent("select",this.selectRecord.bind(this));b.addEvent("update",this.populate.bind(this));b.addEvent("delete",this.populate.bind(this));b.addEvent("sort",this.populate.bind(this))}},selectRecord:function(a){this.setValue(a[this.valueKey]);this.toggleDirtyFlag()},populate:function(){var c=this.dataSourceObj.getData()||[];this.getFormEl().options.length=0;if(this.emptyItem){this.addOption(this.emptyItem[this.valueKey],this.emptyItem[this.textKey])}for(var a=0,b=c.length;a<b;a++){this.addOption(c[a][this.valueKey],c[a][this.textKey])}if(this.value){this.setValue(this.value);this.setFormElValue(this.value)}},addOption:function(b,c){var a=new Element("option");a.set("value",b);a.set("text",c);this.getFormEl().appendChild(a)},resizeDOM:function(){this.parent()}});ludo.form.FilterText=new Class({Extends:ludo.form.Text,type:"form.FilterText",autoComplete:true,emptyItem:{value:"",title:""},filterOnServer:false,maxDisplayed:10,idField:"id",displayField:"title",selectedRecord:undefined,timeStamp:0,remote:{},ludoConfig:function(a){this.filterOnServer=a.filterOnServer||this.filterOnServer;if(a.remote){a.remote.isJSON=true;this.remote.queryParam=a.remote.queryParam||this.remote.queryParam;this.remote.queryParamRecord=a.remote.queryParamRecord||a.remote.queryParamRecord}this.emptyItem=a.emptyItem||this.emptyItem;this.parent(a);if(this.filterOnServer){this.remote.autoLoad=false}this.autoComplete=a.autoComplete||this.autoComplete},ludoRendered:function(){this.parent();var a=this.els.cellInput;var c=ludo.dom.getNumericStyle(this.els.formEl,"width")+ludo.dom.getPW(this.els.formEl)+ludo.dom.getBW(this.els.formEl)+ludo.dom.getMW(this.els.formEl);var b=this.els.inputContainer=new Element("div");a.adopt(b);b.adopt(this.els.formEl);ludo.dom.addClass(b,"ludo-form-text-autocomplete-container");if(!isNaN(c)){b.setStyles({width:c})}this.createFilterComponent();this.createHiddenInput();this.getFormEl().addClass("ludo-form-text-autocomplete");this.getFormEl().setProperty("autocomplete","off");this.getFormEl().setStyles({"background-color":"transparent","z-index":100});var d=this.els.autoComplete=new Element("input");ludo.dom.addClass(d,"ludo-form-text-autocomplete");d.disabled=true;d.style.zIndex=99;d.style.color="silver";d.style.cursor="none";this.els.inputContainer.adopt(d);this.els.formElDiv=new Element("div");this.els.hiddenEl=new Element("div");this.setRecord(this.getEmptyItem())},getEmptyItem:function(){var a={};a[this.idField]=this.emptyItem[this.idField]===undefined?this.emptyItem.value:this.emptyItem[this.idField];a[this.displayField]=this.emptyItem.title||this.emptyItem.text;return a},createHiddenInput:function(){var a=this.els.hiddenInput=new Element("input");a.type="hidden";a.value=this.value;this.getEl().adopt(a)},getHiddenInput:function(){if(this.els.hiddenInput){return this.els.hiddenInput}return null},getValue:function(){var a=this.getHiddenInput();if(a){return a.get("value")}return this.parent()},setAutoCompleteRecord:function(a){this.els.autoComplete.set("value",a[this.displayField])},createFilterComponent:function(){this.getFormEl().addEvent("keyup",this.filter.bind(this));this.getFormEl().addEvent("keydown",this.filterKeyEvents.bind(this));this.getFormEl().addEvent("focus",this.hideFilter.bind(this));this.getEventEl().addEvent("mousedown",this.autoHideFilter.bind(this));this.getFormEl().addEvent("blur",this.chooseSelectedRecord.bind(this));if(this.getParent()){this.getParent().addEvent("startmove",this.hideFilter.bind(this))}this.filterComponent=new ludo.form.TextFilterContainer({formComponent:this,width:this.getFormEl().getSize().x,height:300,maxDisplayed:this.maxDisplayed});this.hideFilter()},filterKeyEvents:function(b){this.timeStamp=new Date().getTime();if(b.key=="esc"){this.clearSelectedRecord();this.setRecord(this.getEmptyItem());this.filterComponent.hide()}if(b.key=="enter"||b.key=="tab"){var c=this.filterComponent.getSelectedRecord();if(c){this.setRecord(c)
}this.hideFilter();if(b.key==="enter"){var a=ludo.Form.getNext(this);if(a){a.focus()}return false}}if(b.key=="up"){this.filterComponent.selectPrevious()}if(b.key=="down"){this.filterComponent.selectNext()}return undefined},autoHideFilter:function(a){if(a.target.id&&a.target.id==this.getFormEl().id){return}if(a.target.hasClass("ludo-filter-text-options")||a.target.getParent(".ludo-filter-text-options")){return}this.filterComponent.hide()},filter:function(a){if(a&&a.key){if(a.key=="up"||a.key=="down"||a.key=="enter"||a.key=="esc"||a.key=="tab"){return}}this.getHiddenInput().set("value",this.getFormEl().value);this.filterData(this.getFormEl().value)},getFieldWidth:function(){return this.formFieldWidth+ludo.dom.getBW(this.els.inputContainer)+ludo.dom.getPW(this.els.inputContainer)},reset:function(){this.parent();this.filter()},setValue:function(a){if(this.remote.url){var b={};b[this.idField]=a;this.setRecord(b)}else{this.parent(a)}},setRecord:function(a){this.selectedRecord=a;if(a[this.idField]!==undefined&&a[this.displayField]===undefined){this.loadSingleRecordRemote(a)}else{this.chooseSelectedRecord();this.filterComponent.hide()}},loadSingleRecordRemote:function(a){if(!this.remote.url){return}var b={url:this.getUrl(),method:"post",onSuccess:function(d){var c=d.data;if(this.idField&&c[this.idField]!==undefined&&c[this.displayField]){this.setRecord(c)}}.bind(this)};b.params={};b.params[this.idField]=a.id;b.params[this.remote.queryParamRecord]=a;this.JSONRequest(b)},chooseSelectedRecord:function(){var a=this.getSelectedRecord();if(a){var b=a[this.displayField];if(this.isEmptyRecord(a)){b=""}this.getFormEl().set("value",b);this.els.autoComplete.set("value",a[this.displayField]);this.getHiddenInput().set("value",a[this.idField])}},isEmptyRecord:function(a){return a[this.idField].length===0},originalSearch:undefined,filterData:function(a){this.originalSearch=a;a=a.toLowerCase();if(a.length==0){this.clearSelectedRecord();this.setRecord(this.getEmptyItem());this.filterComponent.hide();return}this.clearSelectedRecord();if(!this.data&&!this.filterOnServer){return}if(this.filterOnServer){this.filterRemote(a)}else{var b=this.getFilteredRecords(a);if(b.length>0){this.showSuggestionAndPopulateDropDown(a,b)}else{this.clearSelectedRecord();this.filterComponent.hide()}}},filterRemote:function(a){if(this.filterCache[a]){this.showSuggestionAndPopulateDropDown(a,this.filterCache[a]);return}var c=new Date();if(c.getTime()-this.timeStamp<500){if(a==this.getFormEl().value.toLowerCase()){this.filterRemote.delay(100,this,[a])}return}this.filterCache[a]=[];if(!this.remote.url){return}var b={url:this.remote.url,method:"post",onSuccess:function(d){this.filterCache[a]=d.data;this.showSuggestionAndPopulateDropDown(a,d.data)}.bind(this)};b.params=this.remote.data;b.params[this.remote.queryParam]=a;b.params.maxDisplayed=this.maxDisplayed;this.JSONRequest(b)},showSuggestionAndPopulateDropDown:function(c,b){if(b.length==0){this.filterComponent.hide();this.clearSelectedRecord();return}var a=this.getSuggestedRecord(b);if(a){this.selectedRecord=a;this.els.autoComplete.set("value",a[this.displayField])}else{this.clearSelectedRecord()}this.filterComponent.position();this.filterComponent.populate(b);this.filterComponent.show()},getSuggestedRecord:function(b){var a=Math.min(this.maxDisplayed,b.length);for(var c=0;c<a;c++){if(b[c][this.displayField].indexOf(this.originalSearch)==0){return b[c]}}return null},clearSelectedRecord:function(){this.els.autoComplete.set("value","");this.selectedRecord=undefined},getSelectedRecord:function(){return this.selectedRecord},filterCache:{},getFilteredRecords:function(b){if(!this.filterCache[b]){this.filterCache[b]=[];for(var a=0;a<this.data.length;a++){if(this.data[a].searchString.indexOf(b)>=0){this.filterCache[b].push(this.data[a])}}}return this.filterCache[b]},hideFilter:function(){this.filterComponent.hide.delay(200,this.filterComponent)},resizeDOM:function(){this.parent();this.els.inputContainer.style.width=this.getFormEl().style.width},populate:function(b){this.data=b;for(var a=0;a<b.length;a++){this.data[a].searchString=this.data[a][this.displayField].toLowerCase()}},focus:function(){this.parent();this.getFormEl().focus()}});ludo.form.TextFilterContainer=new Class({Extends:ludo.View,type:"form.TextFilterContainer",formComponent:undefined,width:500,height:300,titleBar:false,hidden:true,maxDisplayed:10,tpl:"<div>{title}</div>",records:[],selectedIndex:undefined,containerCss:{position:"absolute",border:"1px solid #AAA","background-color":"#FFF"},ludoConfig:function(a){this.formComponent=a.formComponent;a.els=a.els||{};a.renderTo=document.body;this.parent(a);this.alwaysInFront=true;this.maxDisplayed=a.maxDisplayed},ludoRendered:function(){this.parent();this.resize({width:this.layout.width,height:this.layout.height});this.getBody().setStyle("overflow","hidden");this.getBody().addClass("ludo-filter-text-options")},keyUp:function(){},position:function(){var a=this.getFormEl().els.inputContainer.getCoordinates(this.renderTo);
this.setPosition({left:a.left,top:a.top+a.height})},getFormEl:function(){return this.formComponent},populate:function(b){this.records=b;this.getBody().set("html","");this.els.recordNodes=[];this.selectedIndex=undefined;var a=Math.min(b.length,this.maxDisplayed);for(var c=0;c<a;c++){var d=this.els.recordNodes[c]=new Element("div");d.setProperty("recordIndex",c);d.className="ludo-form-autocomplete-suggestion";d.set("html",b[c][this.formComponent.displayField]);this.getBody().adopt(d);d.addEvent("click",this.setRecord.bind(this));d.addEvent("mouseenter",this.mouseEnterRecord.bind(this));d.addEvent("mouseleave",this.mouseLeaveRecord.bind(this))}this.autoResize.delay(30,this,a)},autoResize:function(b){var c=this.getBody().getElement(".ludo-form-autocomplete-suggestion");var a=b*this.getHeightOfSuggestionElement(c);a+=ludo.dom.getMH(this.getEl());a+=ludo.dom.getMH(this.getBody());a+=ludo.dom.getBH(this.getBody());a+=ludo.dom.getPH(this.getBody());this.resize({width:this.formComponent.getFieldWidth(),height:a})},selectNext:function(){if(this.records.length===0){return}if(this.selectedIndex===undefined||this.selectedIndex==this.records.length-1){this.selectedIndex=0}else{this.selectedIndex++}this.highlightRecord(this.selectedIndex)},selectPrevious:function(){if(this.records.length===0){return}if(this.selectedIndex===undefined||this.selectedIndex==0){this.selectedIndex=this.records.length-1}else{this.selectedIndex--}this.highlightRecord(this.selectedIndex)},mouseEnterRecord:function(a){this.selectedIndex=a.target.getProperty("recordIndex");this.highlightRecord(this.selectedIndex)},mouseLeaveRecord:function(a){a.target.removeClass("ludo-form-autocomplete-suggestion-over")},highlightRecord:function(a){if(this.highlightedRecord){this.highlightedRecord.removeClass("ludo-form-autocomplete-suggestion-over")}this.highlightedRecord=this.els.recordNodes[a];ludo.dom.addClass(this.highlightedRecord,"ludo-form-autocomplete-suggestion-over")},getSelectedRecord:function(){if(this.selectedIndex!==undefined&&this.records[this.selectedIndex]){return this.records[this.selectedIndex]}return undefined},setRecord:function(b){var a=b.target.getProperty("recordIndex");this.formComponent.setRecord(this.records[a]);this.formComponent.hideFilter()},heightOfSuggestionElement:undefined,getHeightOfSuggestionElement:function(a){if(this.layout.heightOfSuggestionElement===undefined){this.layout.heightOfSuggestionElement=a.measure(function(){return this.getSize().y})}return this.layout.heightOfSuggestionElement}});ludo.form.RadioGroup=new Class({Extends:ludo.form.Select,type:"form.RadioGroup",checkboxes:[],height:undefined,inputTag:"",ludoDOM:function(){this.parent();var b=new Element("table");this.getInputCell().adopt(b);var a=this.els.tBody=new Element("tbody");b.adopt(a)},populate:function(){var d=this.dataSource?this.getDataSource().getData()||[]:[];var f=new Element("tr");this.els.tBody.innerHTML="";this.els.tBody.adopt(f);this.disposeCheckboxes();for(var c=0;c<d.length;c++){var a=new Element("td");f.adopt(a);var b=new ludo.form.Checkbox({inputType:"radio",name:this.getName(),value:d[c][this.valueKey],label:d[c][this.textKey],image:d[c].image?d[c].image:null,listeners:{change:this.valueChange.bind(this)}});this.checkboxes.push(b);a.adopt(b.getEl())}if(this.value){this.setValue(this.value)}},disposeCheckboxes:function(){for(var a=0;a<this.checkboxes.length;a++){this.checkboxes[a].dispose()}this.checkboxes=[]},valueChange:function(b){this.value=b;for(var a=0;a<this.checkboxes.length;a++){this.checkboxes[a].toggleImage()}this.fireEvent("change",[this.value,this]);this.toggleDirtyFlag()},ludoRendered:function(){this.parent();if(this.checkboxes.length>0&&!this.isChecked()){this.checkboxes[0].check()}},isChecked:function(){for(var a=0;a<this.checkboxes.length;a++){if(this.checkboxes[a].isChecked()){return true}}return false},disable:function(){for(var a=0;a<this.checkboxes.length;a++){this.checkboxes[a].disable()}},enable:function(){for(var a=0;a<this.checkboxes.length;a++){this.checkboxes[a].enable()}},getValue:function(){var a=this.getCheckedRadio();if(a){return a.getValue()}return undefined},getCheckedRadio:function(){for(var a=0;a<this.checkboxes.length;a++){if(this.checkboxes[a].isChecked()){return this.checkboxes[a]}}return undefined},setValue:function(b){for(var a=0;a<this.checkboxes.length;a++){if(this.checkboxes[a].getFormEl().get("value")==b){return this.checkboxes[a].check()}}this.parent(b)},supportsInlineLabel:function(){return false}});ludo.form.File=new Class({Extends:ludo.form.LabelElement,type:"form.File",inputTag:"input",inputType:"file",labelButton:"Browse",labelRemove:"Remove",labelDelete:"Delete",valueForDisplay:"",instantUpload:true,uploadInProgress:false,fileUploadComplete:true,isFileUploadComponent:true,buttonWidth:80,accept:undefined,resource:"FileUpload",ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["resource","instantUpload","labelButton","labelRemove","labelDelete","buttonWidth"]);if(a.accept){this.accept=a.accept.toLowerCase().split(/,/g)
}if(a.value){this.valueForDisplay=a.value}this.value=""},ludoRendered:function(){this.parent();var a=new Element("td");a.width=this.buttonWidth;a.style.textAlign="right";this.getInputRow().adopt(a);a.adopt(this.getFormEl());var c=new ludo.form.Button({type:"form.Button",layout:{height:30,width:this.buttonWidth},value:this.labelButton,overflow:"hidden",renderTo:a});var b=this.getFormEl();b.setStyles({opacity:0,"-moz-opacity":0,height:"100%",position:"absolute",right:0,top:0,"z-index":100000,cursor:"pointer",filter:"alpha(opacity=0)"});b.addEvents({mouseover:c.mouseOver.bind(c),mouseout:c.mouseOut.bind(c),mousedown:c.mouseDown.bind(c),mouseup:c.mouseUp.bind(c),change:this.selectFile.bind(this)});c.getEl().adopt(b);this.createIframe();this.createFormElementForComponent();if(this.valueForDisplay){this.displayFileName()}},createFormElementForComponent:function(){var a=this.els.form=new Element("form");a.target=this.getIframeName();a.setProperties({method:"post",action:this.getUploadUrl(),enctype:"multipart/form-data"});a.setStyles({margin:0,padding:0,border:0});this.getEl().adopt(a);a.adopt(this.getBody());this.addElToForm("ludo-file-upload-name",this.getName());this.addElToForm("request",this.getResource()+"/save")},getResource:function(){return this.resource||"FileUpload"},addElToForm:function(a,c){var b=new Element("input");b.type="hidden";b.name=a;b.value=c;this.els.form.adopt(b)},createIframe:function(){var a=this.els.iframe=new Element("iframe");a.name=this.iframeName=this.getIframeName();a.setStyles({width:1,height:1,visibility:"hidden",position:"absolute"});this.getEl().adopt(a);a.addEvent("load",this.onUploadComplete.bind(this))},getIframeName:function(){return"iframe-"+this.getId()},onUploadComplete:function(){this.fileUploadComplete=true;if(window.frames[this.iframeName].location.href.indexOf("http:")==-1){return}try{var b=JSON.decode(window.frames[this.iframeName].document.body.innerHTML);if(b.success){this.value=b.response;this.fireEvent("submit",[b.response,this])}else{this.fireEvent("submitfail",[b,this])}this.fireEvent("valid",["",this])}catch(c){var a="";try{a=window.frames[this.iframeName].document.body.innerHTML}catch(c){}this.fireEvent("fail",[c,a,this])}this.uploadInProgress=false;this.displayFileName();this.validate()},isValid:function(){if(this.required&&!this.getValue()&&!this.hasFileToUpload()){return false}if(!this.hasValidExtension()){return false}return !this.uploadInProgress},hasValidExtension:function(){if(!this.hasFileToUpload()||this.accept===undefined){return true}return this.accept.indexOf(this.getExtension())>=0},getExtension:function(){var a=this.getValue();var b=a.split(/\./g);return b.pop().toLowerCase()},getUploadUrl:function(){var a=ludo.config.getFileUploadUrl()||this.getUrl();if(!a){ludo.util.warn("No url defined for file upload. You can define it with the code ludo.config.setFileUploadUrl(url)")}return a},selectFile:function(){this.value=this.valueForDisplay=this.getFormEl().get("value");this.fileUploadComplete=false;this.displayFileName();this.setDirty();if(this.instantUpload){this.upload()}},displayFileName:function(){var c=this.els.cellInput;c.set("html","");ludo.dom.removeClass(c,"ludo-input-file-name-new-file");ludo.dom.removeClass(c,"ludo-input-file-name-initial");ludo.dom.removeClass(c,"ludo-input-file-name-not-uploaded");if(this.valueForDisplay){var d=ludo.dom.create({tag:"span",html:this.valueForDisplay+" ",renderTo:c});var b=new Element("a");b.addEvent("click",this.removeFile.bind(this));b.set("href","#");var a=this.labelRemove;if(this.valueForDisplay==this.initialValue){a=this.labelDelete;ludo.dom.addClass(c,"ludo-input-file-name-initial")}else{ludo.dom.addClass(c,"ludo-input-file-name-new-file")}if(!this.fileUploadComplete){ludo.dom.addClass(c,"ludo-input-file-name-not-uploaded")}b.set("html",a);c.adopt(b)}},resizeDOM:function(){},upload:function(){if(!this.hasValidExtension()){return}this.fireEvent("invalid",["",this]);this.uploadInProgress=true;this.els.form.submit()},getValue:function(){return this.value},setValue:function(a){this.valueForDisplay=a;this.displayFileName();this.validate()},commit:function(){this.initialValue=this.valueForDisplay;this.displayFileName()},removeFile:function(){this.valueForDisplay=this.valueForDisplay===this.initialValue?"":this.initialValue;this.value="";this.displayFileName();this.validate();return false},hasFileToUpload:function(){return !this.fileUploadComplete},blur:function(){},supportsInlineLabel:function(){return false}});ludo.form.SearchField=new Class({Extends:ludo.form.Text,type:"form.SearchField",searchIn:undefined,delay:0,lastValue:undefined,searchFn:undefined,remote:false,lastSearch:undefined,ludoConfig:function(a){this.parent(a);this.setConfigParams(a,["searchIn","delay","searchFn","remote"]);if(this.searchFn!==undefined){this.searchFn=this.searchFn.bind(this)}this.addEvent("key",this.queue.bind(this));this.setDataSource()},setDataSource:function(){if(ludo.util.isString(this.searchIn)){var a=ludo.get(this.searchIn);
if(!a){this.setDataSource.delay(100,this)}else{this.searchIn=ludo.get(this.searchIn)}}},queue:function(a){this.value=a;if(this.delay===0){this.search()}else{this.lastValue=a;this.execute.delay(this.delay*1000,this,a)}},execute:function(a){if(a!=this.lastValue||a==this.lastSearch){return undefined}this.lastSearch=this.getValue();return this.search()},search:function(){if(this.remote){this.searchIn.remoteSearch(this.getValue());return undefined}else{return this.searchIn.getSearcher().search(this.searchFn?this.searchFn:this.getValue())}}});ludo.form.validator.Base=new Class({Extends:ludo.Core,value:undefined,applyTo:undefined,ludoConfig:function(a){this.parent(a);if(a.value!==undefined){this.value=a.value}if(a.applyTo!==undefined){this.applyTo=a.applyTo}if(!this.value){this.loadValue()}},loadValue:function(){new ludo.remote.JSON({url:this.getUrl,data:{request:["Md5Validation",this.applyTo.getName(),"read"].join("/"),data:{md5Validation:true,getValidatorValueFor:this.applyTo.getName()}},listeners:{success:function(a){this.value=a.getData().value;this.fireEvent("loadValue",this)}.bind(this)}})},isValid:function(a){return a==this.value}});ludo.form.validator.Md5=new Class({Extends:ludo.form.validator.Base,type:"form.validator.Md5",value:undefined,isValid:function(a){return faultylabs.MD5(a)==this.value}});ludo.paging.Button=new Class({Extends:ludo.form.Button,type:"grid.paging.Next",width:25,buttonCls:"",tpl:undefined,onLoadMessage:undefined,ludoDOM:function(){this.parent();this.getBody().addClass(this.buttonCls)},ludoEvents:function(){this.parent();this.dataSourceEvents()},dataSourceEvents:function(){var a=ludo.get(this.dataSource);if(a){this.addDataSourceEvents()}else{this.dataSourceEvents.delay(100,this)}},addDataSourceEvents:function(){},insertJSON:function(){}});ludo.paging.Next=new Class({Extends:ludo.paging.Button,type:"grid.paging.Next",buttonCls:"ludo-paging-next",addDataSourceEvents:function(){this.addEvent("click",this.nextPage.bind(this));var a=this.getDataSource();a.addEvent("lastPage",this.disable.bind(this));a.addEvent("notLastPage",this.enable.bind(this))},nextPage:function(){this.getDataSource().nextPage()}});ludo.paging.Previous=new Class({Extends:ludo.paging.Button,type:"grid.paging.Previous",buttonCls:"ludo-paging-previous",addDataSourceEvents:function(){this.addEvent("click",this.nextPage.bind(this));var a=this.getDataSource();a.addEvent("firstPage",this.disable.bind(this));a.addEvent("notFirstPage",this.enable.bind(this));if(a.isOnFirstPage()){this.disable()}},nextPage:function(){this.getDataSource().previousPage()}});ludo.paging.Last=new Class({Extends:ludo.paging.Button,type:"grid.paging.Last",buttonCls:"ludo-paging-last",addDataSourceEvents:function(){this.addEvent("click",this.nextPage.bind(this));var a=this.getDataSource();a.addEvent("lastPage",this.disable.bind(this));a.addEvent("notLastPage",this.enable.bind(this))},nextPage:function(){this.getDataSource().lastPage()}});ludo.paging.First=new Class({Extends:ludo.paging.Button,type:"grid.paging.First",buttonCls:"ludo-paging-first",addDataSourceEvents:function(){this.addEvent("click",this.firstPage.bind(this));var a=this.getDataSource();a.addEvent("firstPage",this.disable.bind(this));a.addEvent("notFirstPage",this.enable.bind(this));if(a.isOnFirstPage()){this.disable()}},firstPage:function(){this.getDataSource().firstPage()}});ludo.paging.PageInput=new Class({Extends:ludo.form.Number,type:"grid.paging.PageInput",width:35,fieldWidth:30,minValue:1,reverseWheel:true,ludoEvents:function(){this.parent();this.dataSourceEvents()},dataSourceEvents:function(){if(ludo.get(this.dataSource)){var a=this.getDataSource();if(a){a.addEvent("page",this.setPageNumber.bind(this));a.addEvent("load",this.updateMaxValue.bind(this));this.setPageNumber(a.getPageNumber());this.addEvent("change",this.updateDataSourcePageNumber.bind(this));this.updateMaxValue()}}else{this.dataSourceEvents.delay(100,this)}},setPageNumber:function(a){this.value=a;this.els.formEl.set("value",a)},updateDataSourcePageNumber:function(){this.getDataSource().toPage(this.getValue())},updateMaxValue:function(){this.maxValue=this.getDataSource().getPageCount()},insertJSON:function(){}});ludo.paging.CurrentPage=new Class({Extends:ludo.View,type:"grid.paging.CurrentPage",width:25,onLoadMessage:"",tpl:"{page}",ludoDOM:function(){this.parent();this.getEl().addClass("ludo-paging-text");this.getEl().addClass("ludo-paging-current-page")},ludoEvents:function(){this.parent();this.dataSourceEvents()},dataSourceEvents:function(){if(ludo.get(this.dataSource)){var a=this.getDataSource();if(a){a.addEvent("page",this.setPageNumber.bind(this));this.setPageNumber(a.getPageNumber())}}else{this.dataSourceEvents.delay(100,this)}},setPageNumber:function(){this.setHtml(this.tpl.replace("{page}",this.getDataSource().getPageNumber()))},insertJSON:function(){}});ludo.paging.TotalPages=new Class({Extends:ludo.View,type:"grid.paging.TotalPages",width:25,onLoadMessage:"",tpl:"/{pages}",ludoDOM:function(){this.parent();this.getEl().addClass("ludo-paging-text");
this.getEl().addClass("ludo-paging-total-pages")},ludoEvents:function(){this.parent();this.dataSourceEvents()},dataSourceEvents:function(){if(ludo.get(this.dataSource)){var a=this.getDataSource();if(a){a.addEvent("load",this.setPageNumber.bind(this));a.addEvent("pageCount",this.setPageNumber.bind(this));this.setPageNumber(a.getPageNumber())}}else{this.dataSourceEvents.delay(100,this)}},setPageNumber:function(){this.setHtml(this.tpl.replace("{pages}",this.getDataSource().getPageCount()))},insertJSON:function(){}});ludo.paging.NavBar=new Class({Extends:ludo.View,type:"paging.NavBar",layout:"cols",height:25,children:[{type:"paging.First"},{type:"paging.Previous"},{type:"paging.PageInput"},{type:"paging.TotalPages"},{type:"paging.Next"},{type:"paging.Last"}],ludoConfig:function(a){this.parent(a);if(a.dataSource){for(var b=0;b<a.children.length;b++){a.children[b].dataSource=a.dataSource}this.dataSource=undefined}},insertJSON:function(){}});ludo.paging.PageSize=new Class({Extends:ludo.form.Select,options:[{value:10,text:"10"},{value:25,text:"25"},{value:50,text:"50"},{value:100,text:"100"}],label:"Page size",applyTo:undefined,ludoConfig:function(a){this.applyTo=ludo.get(a.dataSource||this.applyTo);a.dataSource=undefined;this.parent(a)},ludoEvents:function(){this.parent();this.addEvent("change",this.setPageSize.bind(this))},setPageSize:function(){if(this.applyTo){this.applyTo.setPageSize(this.getValue())}}});ludo.Panel=new Class({Extends:ludo.View,tagBody:"fieldset",_createDOM:function(){this.parent();this.getEl().addClass("ludo-panel");this.els.legend=new Element("legend");this.els.body.adopt(this.els.legend);this.getEl().addClass("ludo-panel")},ludoDOM:function(){this.parent();this.setTitle(this.title)},ludoRendered:function(){this.parent();this.getBody().setStyle("display","block")},autoSetHeight:function(){this.parent();var a=this.els.legend.measure(function(){return this.getSize()});this.layout.height+=a.y},getInnerHeightOfBody:function(){return this.parent()-this.getHeightOfLegend()-5},heightOfLegend:undefined,getHeightOfLegend:function(){if(this.layout.heightOfLegend===undefined){this.layout.heightOfLegend=this.els.legend.offsetHeight}return this.layout.heightOfLegend},resizeDOM:function(){var a=this.getHeight();if(a==0){return}a-=(ludo.dom.getMBPH(this.getBody())+ludo.dom.getMBPH(this.getEl()));if(a>0&&!isNaN(a)){this.getBody().style.height=a+"px"}var b=this.getWidth();b-=(ludo.dom.getMBPW(this.getBody())+ludo.dom.getMBPW(this.getEl()));if(b>0&&!isNaN(b)){this.getBody().style.width=b+"px"}},setTitle:function(a){this.parent(a);this.els.legend.set("html",a)}});ludo.Anchor=new Class({Extends:ludo.View,type:"Anchor",height:15,ludoConfig:function(a){this.parent(a);this.anchorText=a.anchorText},ludoDOM:function(){this.parent();this.els.anchor=new Element("a");ludo.dom.addClass(this.els.anchor,"ludo-anchor-text");this.els.anchor.set("html",this.html);this.els.anchor.setProperty("href","#");this.els.anchor.addEvent("click",this.anchorClick.bind(this));this.getBody().adopt(this.els.anchor)},ludoEvents:function(){this.parent();this.getBody().addEvent("click",this.anchorClick.bind(this))},getAnchorTag:function(){return this.els.anchor},anchorClick:function(){this.fireEvent("click",this);return false}});ludo.dialog.Dialog=new Class({Extends:ludo.Window,type:"dialog.Dialog",modal:true,autoDispose:true,autoHideOnBtnClick:true,buttonConfig:undefined,movable:true,closable:false,minimizable:false,ludoConfig:function(a){a.buttonConfig=a.buttonConfig||this.buttonConfig;if(a.buttonConfig){var c=a.buttonConfig.replace(/([A-Z])/g," $1");c=c.trim();c=c.split(/\s/g);a.buttons=[];for(var b=0;b<c.length;b++){a.buttons.push({value:c[b]})}}this.parent(a);this.setConfigParams(a,["modal","autoDispose","autoHideOnBtnClick"])},ludoDOM:function(){this.parent();this.getEl().addClass("ludo-dialog")},getShim:function(){if(this.els.shim===undefined){var a=this.els.shim=ludo.dom.create({cls:"ludo-dialog-shim",renderTo:document.body});a.style.display="none"}return this.els.shim},ludoEvents:function(){this.parent();if(this.isModal()){this.getEventEl().addEvent("resize",this.resizeShim.bind(this))}},ludoRendered:function(){this.parent();if(!this.isHidden()){this.center();this.showShim()}var b=this.getButtons();for(var a=0;a<b.length;a++){b[a].addEvent("click",this.buttonClick.bind(this))}},isModal:function(){return this.modal},show:function(){this.showShim();this.parent()},hide:function(){this.parent();this.hideShim();if(this.autoDispose){this.dispose.delay(1000,this)}},showShim:function(){this.center();if(this.isModal()){var a=this.getShim().style;a.display="";a.zIndex=this.getEl().getStyle("z-index")-1;this.resizeShim()}},resizeShim:function(){var a=document.body.getSize();this.getShim().style.width=a.x+"px";this.getShim().style.height=a.y+"px"},hideShim:function(){if(this.isModal()){this.getShim().style.display="none"}},buttonClick:function(b,a){this.fireEvent(a.getValue().replace(/\s/g,"").toLowerCase(),this);if(this.autoHideOnBtnClick){this.hide()
}}});ludo.dialog.Confirm=new Class({Extends:ludo.dialog.Dialog,type:"dialog.Confirm",ludoConfig:function(a){if(!a.buttons&&!a.buttonConfig&&!a.buttonBar){a.buttons=[{value:"OK",width:60,defaultSubmit:true,type:"form.Button"},{value:"Cancel",width:60}]}this.parent(a)}});ludo.dialog.Alert=new Class({Extends:ludo.dialog.Dialog,type:"dialog.Alert",buttonConfig:undefined,width:300,height:150,resizable:false,ludoConfig:function(a){if(a.substr){a={html:a}}if(!a.buttons){a.buttons=[{value:"OK",width:60}]}this.parent(a)}});ludo.dialog.Prompt=new Class({Extends:ludo.dialog.Dialog,type:"dialog.Prompt",input:undefined,inputConfig:{},label:"",value:"",ludoConfig:function(a){if(!a.buttons&&!a.buttonConfig&&!a.buttonBar){a.buttons=[{value:"OK",width:60,defaultSubmit:true,type:"form.Button"},{value:"Cancel",width:60}]}this.setConfigParams(a,["label","value","inputConfig"]);this.parent(a)},ludoRendered:function(){this.parent();var a=Object.merge(this.inputConfig,{type:"form.Text",label:this.label,value:this.value});this.input=this.addChild(a);this.input.focus()},getValue:function(){return this.input.getValue()},buttonClick:function(b,a){this.fireEvent(a.value.toLowerCase(),[this.getValue(),this]);if(this.autoHideOnBtnClick){this.hide()}}});ludo.video.Video=new Class({Extends:ludo.View,type:"video.Video",movieId:undefined,ludoConfig:function(a){this.parent(a);if(a.movieId){this.movieId=a.movieId}},setContent:function(){var a=this.els.body;var c=new Element("object");c.setProperties({width:"100%",height:"100%"});a.adopt(c);var d=new Element("param");d.setProperties({name:"movie",value:this.getUrl()});c.adopt(d);var b=new Element("param");b.setProperties({name:"wmode",value:"transparent"});c.adopt(b);var f=this.els.embed=new Element("embed");f.setProperties({src:this.getVideoUrl(),type:"application/x-shockwave-flash",wmode:"transparent",width:"100%",height:"100%"});c.adopt(f);a.setStyle("overflow","hidden");return a},loadMovie:function(a){this.movieId=a;this.els.embed.setProperty("src",this.getVideoUrl())}});ludo.video.YouTube=new Class({Extends:ludo.video.Video,type:"video.YouTube",getVideoUrl:function(){return"http://www.youtube.com/v/"+this.movieId}});ludo.video.GoogleVideo=new Class({Extends:ludo.video.Video,type:"video.GoogleVideo",getVideoUrl:function(){return"http://video.google.com/googleplayer.swf?docid="+this.movieId}});ludo.video.DailyMotion=new Class({Extends:ludo.video.Video,type:"video.DailyMotion",getVideoUrl:function(){return"http://www.dailymotion.com/swf/"+this.movieId}});ludo.canvas.Gradient=new Class({Extends:ludo.canvas.NamedNode,tagName:"linearGradient",stopTags:[],addStop:function(d,b,c){var a={offset:d,"stop-color":b};if(c!==undefined){if(c>1){c=c/100}a["stop-opacity"]=c}var f=new ludo.canvas.Stop(a);this.adopt(f);this.stopTags.push(f);return f},getStop:function(a){return this.stopTags[a]}});ludo.canvas.RadialGradient=new Class({Extends:ludo.canvas.Gradient,tagName:"radialGradient",initialize:function(a){a=a||{};a.gradientUnits=a.gradientUnits||"userSpaceOnUse";this.parent(a)},setCx:function(a){this.set("cx",a)},setCy:function(a){this.set("cy",a)},setR:function(a){this.set("r",a)},setFx:function(a){this.set("fx",a)},setFy:function(a){this.set("fy",a)}});ludo.canvas.Stop=new Class({Extends:ludo.canvas.Node,initialize:function(a){this.parent("stop",a)},setOffset:function(a){this.set("offset",a)},setStopColor:function(a){this.set("stop-color",a)},getOffset:function(){return this.get("offset")},getStopColor:function(){return this.get("stop-color")},setStopOpacity:function(a){this.set("stop-opacity",a)},getStopOpacity:function(){return this.get("stop-opacity")}});ludo.canvas.Drag=new Class({Extends:ludo.effect.Drag,ludoEvents:function(){this.parent();this.addEvent("before",this.setStartTranslate.bind(this))},setStartTranslate:function(a){this.dragProcess.startTranslate=a.el.getTransformation("translate")||{x:0,y:0}},add:function(a){a=this.getValidNode(a);if(!a.handle){a.handle=a.el}var b=a.el.getEl().id;this.els[b]=Object.merge(a,{handle:a.handle});this.els[b].handle.addEvent(ludo.util.getDragStartEvent(),this.startDrag.bind(this));return this.els[b]},getValidNode:function(a){if(!this.isElConfigObject(a)){a={el:a}}a.el.set("forId",a.el.getEl().id);return a},isElConfigObject:function(a){return a.getEl===undefined},getPositionedParent:function(){return undefined},getIdByEvent:function(b){var a=b.target||b.event.srcElement.correspondingUseElement;var c=a.id;while(!this.els[c]&&a.parentNode){a=a.parentNode;c=a.id}return c},transformationExists:false,startDrag:function(a){this.parent(a);this.transformationExists=this.hasTransformation()},hasTransformation:function(){var b=this.els[this.dragProcess.dragged].el.get("transform");if(b){var a=b.split(/\s([a-z])/g);if(a.length>1){return true}if(a.length===0){return false}return a[0].split(/\(/g)[0]!=="translate"}return false},move:function(c){var a=this.els[this.dragProcess.dragged].el;var b={x:this.dragProcess.startTranslate.x,y:this.dragProcess.startTranslate.y};if(c.x!==undefined){b.x=c.x;
this.dragProcess.currentX=c.x}if(c.y!==undefined){b.y=c.y;this.dragProcess.currentY=c.y}if(this.transformationExists){a.translate(b.x,b.y);a.setTransformation("translate",b.x+" "+b.y)}else{a.el.setAttribute("transform",["translate(",b.x," ",b.y,")"].join(""));this.lastTranslate=b}},endDrag:function(b){if(this.dragProcess.active){if(this.lastTranslate!==undefined){var a=this.els[this.dragProcess.dragged].el;a.setTransformation("translate",this.lastTranslate.x+" "+this.lastTranslate.y)}this.parent(b)}},getPositionOf:function(a){return a.getTransformation("translate")||{x:0,y:0}}});ludo.canvas.EventManager=new Class({nodes:{},currentNodeId:undefined,currentNodeFn:undefined,addMouseEnter:function(b,a){b.addEvent("mouseover",this.getMouseOverFn(a));b.addEvent("mouseout",this.clearCurrent.bind(this,b))},addMouseLeave:function(b,a){b.addEvent("mouseout",this.getMouseOutFn(a));b.addEvent("mouseout",this.clearCurrent.bind(this,b))},clearCurrent:function(a){if(a.getEl().id===this.currentNodeId){this.currentNodeId=undefined}},getMouseOverFn:function(a){return function(c,b){if(this.okToEnterAndLeave(a,b)){this.currentNodeId=b.getEl().id;this.currentNodeFn=a;a.call(b,c,b)}}.bind(this)},getMouseOutFn:function(a){return function(c,b){if(this.okToEnterAndLeave(a,b)){this.currentNodeId=undefined;this.currentNodeFn=undefined;a.call(b,c,b)}}.bind(this)},okToEnterAndLeave:function(a,b){return a&&(!this.isInCurrentBranch(b)||a!=this.currentNodeFn)},isInCurrentBranch:function(a){if(!this.currentNodeId){return false}if(a.getEl().id===this.currentNodeId){return true}a=a.parentNode;while(a){if(a.getEl().id===this.currentNodeId){return true}a=a.parentNode}return false}});ludo.canvasEventManager=new ludo.canvas.EventManager();ludo.canvas.Circle=new Class({Extends:ludo.canvas.NamedNode,tagName:"circle",setRadius:function(a){this.set("r",a)},getRadius:function(){return this.el.r.animVal.value},setCx:function(a){this.set("cx",a)},getCx:function(){return this.el.cx.animVal.value},setCy:function(a){this.set("cy",a)},getCy:function(){return this.el.cy.animVal.value},getPosition:function(){var b=this.getTranslate();var a=this.getRadius();return{x:this.getCx()-a+b.x,y:this.getCy()-a+b.y}},getSize:function(){var a=this.getRadius();return{x:a*2,y:a*2}}});ludo.canvas.Polyline=new Class({Extends:ludo.canvas.NamedNode,tagName:"polyline",pointString:"",pointArray:undefined,size:undefined,position:undefined,initialize:function(b,a){a=a||{};a.points=b;this.parent(a);this.pointString=b},getPoint:function(a){if(this.pointArray===undefined){this.buildPointArray()}a*=2;if(a>this.pointArray.length-2){return undefined}return{x:this.pointArray[a],y:this.pointArray[a+1]}},setPoint:function(b,a,c){if(this.pointArray===undefined){this.buildPointArray()}b*=2;if(b>this.pointArray.length-2){return}this.pointArray[b]=a;this.pointArray[b+1]=c;this.set("points",this.pointArray.join(" "));this.size=undefined;this.position=undefined},buildPointArray:function(){var a=this.pointString.replace(/,/g," ");a=a.replace(/\s+/g," ");this.pointArray=a.split(/\s/g)},getSize:function(){if(this.size===undefined){var a=this.getMinAndMax();this.size={x:Math.abs(a.maxX-a.minX),y:Math.abs(a.maxY-a.minY)}}return this.size},getPosition:function(){if(this.position===undefined){var a=this.getMinAndMax();this.position={x:a.minX,y:a.minY}}return this.position},getMinAndMax:function(){if(this.pointArray===undefined){this.buildPointArray()}var f=this.pointArray;var a=10000,d=-100000;var g=10000,c=-100000;for(var b=0;b<f.length;b+=2){a=Math.min(a,f[b]);d=Math.max(d,f[b]);g=Math.min(g,f[b+1]);c=Math.max(c,f[b+1])}return{minX:a,minY:g,maxX:d,maxY:c}}});ludo.canvas.Polygon=new Class({Extends:ludo.canvas.Polyline,tagName:"polygon"});ludo.canvas.Ellipse=new Class({Extends:ludo.canvas.NamedNode,tagName:"ellipse",setRadiusX:function(a){this.set("rx",a)},setRadiusY:function(a){this.set("ry",a)},getRadiusX:function(){return this.el.rx.animVal.value},getRadiusY:function(){return this.el.ry.animVal.value},setCx:function(a){this.set("cx",a)},getCx:function(){return this.el.cx.animVal.value},setCy:function(a){this.set("cy",a)},getCy:function(){return this.el.cy.animVal.value},getPosition:function(){var a=this.getTranslate();return{x:this.getCx()-this.getRadiusX()+a.x,y:this.getCy()-this.getRadiusY()+a.y}},getSize:function(){return{x:this.getRadiusX()*2,y:this.getRadiusY()*2}}});ludo.canvas.Path=new Class({Extends:ludo.canvas.NamedNode,tagName:"path",pointString:undefined,pointArray:undefined,size:undefined,position:undefined,initialize:function(b,a){a=a||{};if(b){b=this.getValidPointString(b);a.d=b}this.parent(a);this.pointString=b},getValidPointString:function(a){return a.replace(/([A-Z])/g,"$1 ").trim().replace(/,/g," ").replace(/\s+/g," ")},setPath:function(a){this.pointString=this.getValidPointString(a);this.pointArray=undefined;this.set("d",this.pointString)},getPoint:function(a){if(this.pointArray===undefined){this.buildPointArray()}a*=3;return{x:this.pointArray[a+1],y:this.pointArray[a+2]}},setPoint:function(b,a,c){if(this.pointArray===undefined){this.buildPointArray()
}b*=3;if(b<this.pointArray.length-3){this.pointArray[b+1]=a;this.pointArray[b+2]=c;this.pointString=this.pointArray.join(" ");this.set("d",this.pointString);this.size=undefined;this.position=undefined}},buildPointArray:function(){var a=this.pointString.replace(/,/g," ").replace(/\s+/g," ");this.pointArray=a.split(/([A-Z\s])/g).erase(" ").erase("")},getSize:function(){if(this.size===undefined){var a=this.getMinAndMax();this.size={x:Math.abs(a.maxX-a.minX),y:Math.abs(a.maxY-a.minY)}}return this.size},getPosition:function(){if(this.position===undefined){var a=this.getMinAndMax();this.position={x:a.minX,y:a.minY}}return this.position},getMinAndMax:function(){if(this.pointArray===undefined){this.buildPointArray()}var c=this.pointArray;var a=[];var d=[];for(var b=0;b<c.length-2;b+=3){a.push(c[b+1]);d.push(c[b+2])}return{minX:Math.min.apply(this,a),minY:Math.min.apply(this,d),maxX:Math.max.apply(this,a),maxY:Math.max.apply(this,d)}}});ludo.canvas.Text=new Class({Extends:ludo.canvas.NamedNode,tagName:"text",initialize:function(b,a){this.parent(a,b);this.fireSize()},fireSize:function(){if(this.getEl().parentNode){this.fireEvent("textSize",this.getSize())}}});ludo.canvas.Filter=new Class({Extends:ludo.canvas.NamedNode,tagName:"filter",mergeTags:{},mergeTagsOrder:["dropShadow","SourceGraphic"],effectNodes:{dropShadow:["feGaussianBlur","feOffset"]},nodes:{dropShadow:undefined},initialize:function(a){a=a||{};if(a.x===undefined){a.x="-40%"}if(a.y===undefined){a.y="-40%"}a.width=a.width||"180%";a.height=a.height||"180%";this.parent(a)},setDropShadow:function(b){var a=this.getNodesForEffect("dropShadow");var d=a.feGaussianBlur;d.set("in","SourceAlpha");d.set("result","dropShadowBlur");d.set("stdDeviation",b.deviation);var c=a.feOffset;c.set("dx",b.x||2);c.set("dy",b.y||2);c.set("in","dropShadowBlur");c.set("result","dropShadow")},getNodesForEffect:function(b){var d=this.nodes[b];if(d===undefined){d={};var c=this.effectNodes[b];for(var a=0;a<c.length;a++){d[c[a]]=new ludo.canvas.Node(c[a]);this.adopt(d[c[a]])}this.addFeMergeNode("SourceGraphic");this.addFeMergeNode(b)}return d},updateMergeTag:function(){var a=this.getMergeTag();var c=this.mergeTagsOrder;for(var b=0;b<c.length;b++){if(this.mergeTags[c[b]]!==undefined){ludo.canvasEngine.toFront(this.mergeTags[c[b]].el)}}ludo.canvasEngine.toFront(a.el)},mergeTag:undefined,getMergeTag:function(){if(this.mergeTag===undefined){this.mergeTag=new ludo.canvas.Node("feMerge");this.adopt(this.mergeTag)}return this.mergeTag},addFeMergeNode:function(a){if(this.mergeTags[a]===undefined){this.mergeTags[a]=new ludo.canvas.Node("feMergeNode",{"in":a});this.getMergeTag().adopt(this.mergeTags[a]);this.updateMergeTag()}return this.mergeTags[a]}});ludo.canvas.Mask=new Class({Extends:ludo.canvas.NamedNode,tagName:"mask"});ludo.canvas.Curtain=new Class({Extends:ludo.canvas.Node,applyTo:undefined,nodes:{},bb:undefined,animation:undefined,action:undefined,initialize:function(b){this.parent("clipPath");this.applyTo=b;var a=new ludo.canvas.Node("g");a.adopt(this);this.applyTo.getCanvas().appendChild(a.getEl())},open:function(c,b,a){this.onStart();this.action="open";this.getAnimation().animate(this.getCoordinates(c),b,a)},close:function(c,b,a){this.onStart();this.action="close";this.getAnimation().animate(this.getCoordinates(c,true),b,a)},onStart:function(){this.applyTo.show();this.setBB();this.applyTo.applyClipPath(this)},getAnimation:function(){if(this.animation===undefined){this.animation=this.rect().animation();this.animation.addEvent("finish",this.removeClipPath.bind(this))}this.rect().setProperties(this.bb);return this.animation},setBB:function(){this.bb=this.applyTo.getBBox()},removeClipPath:function(){if(this.action==="close"){this.applyTo.hide()}this.applyTo.remove("clip-path")},getCoordinates:function(h,j){var a;if(j){var g=this.getDirections(h);h=g[1]+g[0]}switch(h){case"RightLeft":a={width:{from:0,to:this.bb.width},x:{from:this.bb.width+this.bb.x,to:this.bb.x}};break;case"TopBottom":a={height:{from:0,to:this.bb.height}};break;case"BottomTop":a={height:{from:0,to:this.bb.height},y:{from:this.bb.height+this.bb.y,to:this.bb.y}};break;default:a={width:{from:0,to:this.bb.width}}}if(j){var c=["width","height","x","y"];for(var b=0;b<c.length;b++){if(a[c[b]]!==undefined){var d=a[c[b]].from;a[c[b]].from=a[c[b]].to;a[c[b]].to=d}}}return a},getDirections:function(a){return a.replace(/([A-Z])/g," $1").trim().split(/\s/g)},rect:function(){if(this.nodes.rect===undefined){this.nodes.rect=new ludo.canvas.Rect({x:this.bb.x,y:this.bb.y,width:this.bb.width,height:this.bb.height});this.adopt(this.nodes.rect)}return this.nodes.rect}});ludo.canvas.Animation=new Class({Extends:Events,fps:33,el:undefined,initialize:function(a){this.el=a},animate:function(a,c,b){c=c||1;b=b||33;this.execute(this.getAnimationSteps(a,c,b),0)},execute:function(a,d){var c=a.values[d];if(d<a.values.length-1){this.execute.delay(a.fps,this,[a,d+1])}for(var b=0;b<c.length;b++){if(c[b].key==="width"||c[b].key==="height"&&c[b].value<0){c[b].value=0
}this.el.set(c[b].key,c[b].value)}if(d===a.values.length-1){this.fireEvent("finish",this)}},getAnimationSteps:function(j,c,a){var g=c*a;var h=[];var b=this.getIncrements(j,c,a);var f={};for(var l in j){if(j.hasOwnProperty(l)){for(var d=0;d<=g;d++){if(!h[d]){h[d]=[]}if(!f[l]){f[l]=j[l].from}var k=f[l];if(j[l].units){k+=j[l].units}h[d].push({key:l,value:k});f[l]+=b[l]}}}return{values:h,fps:a}},getIncrements:function(c,g,f){var d=g*f;var a={};for(var b in c){if(c.hasOwnProperty(b)){a[b]=(c[b].to-c[b].from)/d}}return a}});